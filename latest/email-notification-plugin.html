<!DOCTYPE html><html lang="en"><head><title>Email Notification Plugin</title><style>pre.pygments .hll { background-color: #ffffcc }
pre.pygments { background: #f8f8f8; }
pre.pygments .tok-c { color: #3D7B7B; font-style: italic } /* Comment */
pre.pygments .tok-err { border: 1px solid #FF0000 } /* Error */
pre.pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
pre.pygments .tok-o { color: #666666 } /* Operator */
pre.pygments .tok-ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #9C6500 } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
pre.pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gr { color: #E40000 } /* Generic.Error */
pre.pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { color: #008400 } /* Generic.Inserted */
pre.pygments .tok-go { color: #717171 } /* Generic.Output */
pre.pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
pre.pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
pre.pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #B00040 } /* Keyword.Type */
pre.pygments .tok-m { color: #666666 } /* Literal.Number */
pre.pygments .tok-s { color: #BA2121 } /* Literal.String */
pre.pygments .tok-na { color: #687822 } /* Name.Attribute */
pre.pygments .tok-nb { color: #008000 } /* Name.Builtin */
pre.pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
pre.pygments .tok-no { color: #880000 } /* Name.Constant */
pre.pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
pre.pygments .tok-ni { color: #717171; font-weight: bold } /* Name.Entity */
pre.pygments .tok-ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
pre.pygments .tok-nf { color: #0000FF } /* Name.Function */
pre.pygments .tok-nl { color: #767600 } /* Name.Label */
pre.pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
pre.pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #19177C } /* Name.Variable */
pre.pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
pre.pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
pre.pygments .tok-se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #008000 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #A45A77 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */</style><link rel="icon" type="image/x-icon" href="/stylesheets/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"><link rel="preconnect" href="https://S2ISXITURI-dsn.algolia.net"><link rel="stylesheet" href='stylesheets/bootstrap.min.css'><link rel="stylesheet" href='stylesheets/bootstrap-toc.min.css'><link rel="stylesheet" href="stylesheets/kb.css"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Email Notification Plugin"></head><body data-spy="scroll" data-target="#myScrollspy" data-offset="100"><div class="loader-wrapper"><div id="loading"></div></div><header class="header sticky" id="header"><div class="header-wrapper"><div class="container-fluid"><div class="row flex-xl-nowrap justify-content-evenly"><div class="header-logo"><div class="logo"><a href="/"><img src="/stylesheets/images/logo/light-logo.svg" style="height:38px" alt="Kill Bill Docs" id="logo" height="38" width="146"></a></div><div class="switch"><input type="checkbox" aria-label="Search" name="theme-toggle" id="theme-toggle"><span class="slider round"></span></div></div><div class="nav-toggler sidebar-toggler"><svg class="hamburger" xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 7C20.75 7.41421 20.4142 7.75 20 7.75L4 7.75C3.58579 7.75 3.25 7.41421 3.25 7C3.25 6.58579 3.58579 6.25 4 6.25L20 6.25C20.4142 6.25 20.75 6.58579 20.75 7Z" fill=""/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 12C20.75 12.4142 20.4142 12.75 20 12.75L4 12.75C3.58579 12.75 3.25 12.4142 3.25 12C3.25 11.5858 3.58579 11.25 4 11.25L20 11.25C20.4142 11.25 20.75 11.5858 20.75 12Z" fill=""/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 17C20.75 17.4142 20.4142 17.75 20 17.75L4 17.75C3.58579 17.75 3.25 17.4142 3.25 17C3.25 16.5858 3.58579 16.25 4 16.25L20 16.25C20.4142 16.25 20.75 16.5858 20.75 17Z" fill=""/></svg></div><div class="header-search"><div class="search-form-wrapper"><div id="docsearch" style="height: 43px; display: flex; align-items: center; width: 100%;"></div></div></div></div></div></div></header><main class="main sidebar-show"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="sidebar-wrapper"><aside class="sidebar"><div class="sidebar__control"><svg width="8" height="12" viewBox="0 0 8 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.33316 10.6665L1.6665 5.99992L6.33316 1.33325" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div><nav class="sidebar-nav"><ul class="nav navbar-nav"><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Getting Started</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li><a class="nav-link" href="/latest/what_is_kill_bill.html">What is Kill Bill?</a></li><li><a class="nav-link" href="/latest/getting_started.html">Getting Started (Installation)</a></li><li><a class="nav-link" href="/latest/quick_start_with_kaui.html">Quick Start with Kaui</a></li><li><a class="nav-link" href="/latest/quick_start_with_kb_api.html">Quick Start with the Kill Bill API</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Installation</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/stripe_plugin.html">Kill Bill + Stripe DIY</a></li><li><a class="nav-link" href="/latest/userguide_deployment.html">Going to Production</a></li><li><a class="nav-link" href="/latest/how-to-upgrade-the-database.html">Database Migrations</a></li><li><a class="nav-link" href="/latest/PostgreSQL.html">PostgreSQL Setup</a></li><li><a class="nav-link" href="https://github.com/killbill/killbill/releases" onclick="getOutboundLink('https://github.com/killbill/killbill/releases'); return false;">Release&nbsp;Notes</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">AWS</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/how-to-set-up-a-single-tier-system.html">Single-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-multi-tier-system.html">Multi-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-cloud-formation-system.html">CloudFormation Setup</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/how-to-maintain-a-single-tier-system.html">Single-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-multi-tier-system.html">Multi-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-cloud-formation-system.html">CloudFormation Maintenance</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Manuals</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/userguide_subscription.html">Subscription&nbsp;Billing</a></li><li><a class="nav-link" href="/latest/userguide_payment.html">Payment Processing</a></li><li><a class="nav-link" href="/latest/userguide_kaui.html">Kaui, the Administrative&nbsp;UI</a></li><li><a class="nav-link" href="/latest/email-notification-plugin.html">Email Notification Plugin</a></li><li><a class="nav-link" href="/latest/custom-email-invoice-formatter.html">Custom Email Formatter</a></li><li><a class="nav-link" href="/latest/userguide_analytics.html">Analytics Plugin</a></li><li><a class="nav-link" href="/latest/userguide_configuration.html">Kill Bill&nbsp;Configuration</a></li><li><a class="nav-link" href="/latest/internationalization.html">Kill Bill&nbsp;Internationalization</a></li><li><a class="nav-link" href="/latest/migration_guide.html">Migrating to Kill Bill</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Tutorials</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plan_alignment.html">Plans Alignments</a></li><li><a class="nav-link" href="/latest/overdue.html">Overdue System</a></li><li><a class="nav-link" href="/latest/consumable_in_arrear.html">In Arrear UsageBilling</a></li><li><a class="nav-link" href="/latest/ha.html">Hierarchical Accounts</a></li><li><a class="nav-link" href="/latest/catalog-examples.html">Catalog Examples</a></li><li><a class="nav-link" href="/latest/invoice_examples.html">Invoice Examples</a></li><li><a class="nav-link" href="/latest/invoice_templates.html">Invoice Templates</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Integration</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="http://killbill.github.io/slate" onclick="getOutboundLink('http://killbill.github.io/slate'); return false;">REST API Reference</a></li><li><a class="nav-link" href="/latest/swagger_documentation.html">Swagger UI Documentation</a></li><li><a class="nav-link" href="/latest/postman.html">Postman Integration</a></li><li><a class="nav-link" href="/latest/debugging.html">Debugging</a></li><li><a class="nav-link" href="/latest/push_notifications.html">Push Notifications</a></li><li><a class="nav-link" href="/latest/kill_bill_events.html">Kill Bill Events</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Plugin Development</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_introduction.html">Plugin Introduction</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_development.html">Plugin Development</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_installation.html">Plugin Installation</a></li><li><a class="nav-link" href="/latest/plugin_use_cases.html">Special Plugin Use Cases</a></li><li><a class="nav-link" href="/latest/notification_plugin.html">Notification Plugins</a></li><li><a class="nav-link" href="/latest/payment_plugin.html">Payment Plugins</a></li><li><a class="nav-link" href="/latest/payment_control_plugin.html">Payment Control Plugins</a></li><li><a class="nav-link" href="/latest/usage_plugin.html">Usage Plugins</a></li><li><a class="nav-link" href="/latest/invoice_plugin.html">Invoice Plugins</a></li><li><a class="nav-link" href="/latest/catalog_plugin.html">Catalog Plugins</a></li><li><a class="nav-link" href="/latest/entitlement_plugin.html">Entitlement Plugins</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Operational Guides</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/deploy_to_kubernetes.html">Kubernetes (K8s) Deployment</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/user_management.html">Users, Roles, and Permissions</a></li><li><a class="nav-link" href="/latest/plugin_management.html">Plugin Management</a></li><li><a class="nav-link" href="/latest/aws-tools.html">AWS Analytics Tools</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Client Libraries</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/java_client.html">Java</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-ruby" onclick="getOutboundLink('http://github.com/killbill/killbill-client-ruby'); return false;">Ruby</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-php" onclick="getOutboundLink('http://github.com/killbill/killbill-client-php'); return false;">PHP</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-js" onclick="getOutboundLink('http://github.com/killbill/killbill-client-js'); return false;">Node.js</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-python" onclick="getOutboundLink('http://github.com/killbill/killbill-client-python'); return false;">Python</a></li><li><a class="nav-link" href="http://github.com/killbill/kbcli" onclick="getOutboundLink('http://github.com/killbill/kbcli'); return false;">KillBill Go </a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">About Kill Bill</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/demo.html">Demo</a></li><li><a class="nav-link" href="/latest/features.html">Features List</a></li><li><a class="nav-link" href="/latest/faq.html">Technical FAQs</a></li><li><a class="nav-link" href="/latest/Kill-Bill-Glossary.html">Glossary</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Internal</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/internal_design.html">Internal Design</a></li><li><a class="nav-link" href="/latest/entitlement_subsystem.html">Entitlement Subsystem</a></li><li><a class="nav-link" href="/latest/invoice_subsystem.html">Invoice Subsystem</a></li><li><a class="nav-link" href="/latest/development.html">Development Environment</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">References</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="https://github.com/killbill/killbill-docs/tree/v3/swagger" onclick="getOutboundLink('https://github.com/killbill/killbill-docs/tree/v3/swagger'); return false;">Swagger&nbsp;API Schema</a></li><li><a class="nav-link" href="/latest/catalog.xsd">Catalog XSD Reference</a></li><li><a class="nav-link" href="/latest/overdue.xsd">Overdue XSD Reference</a></li></ul></li></ul></nav><a class="doclink" href="mailto:support@killbill.io">Report a doc problem</a></aside></div><div class="article-container"><div class="center-content"><div class="main-wrapper"><article class="content-wrapper"><div class="banner"><h1>Email Notification Plugin</h1></div><div id="content"><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>As the name implies, the <a href="https://github.com/killbill/killbill-email-notifications-plugin">email notification plugin</a> is a plugin that sends out emails when certain events occur. This document covers how to install, test, and use this plugin.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Ensure that you have Kill Bill, Kaui, and the database set up as explained in the <a href="https://docs.killbill.io/latest/getting_started.html"><em>Getting Started Guide</em></a>.</p>
</li>
<li>
<p>Ensure that you have <a href="https://curl.haxx.se/"><em>cURL</em></a> installed. If you are on Windows, we recommend that you use <a href="https://git-scm.com/download/win"><em>Git Bash</em></a> to run the <code>cURL</code> commands.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://github.com/killbill/killbill-email-notifications-plugin">email notification plugin</a> is a <a href="https://docs.killbill.io/latest/notification_plugin.html">notification plugin</a>. It listens to <a href="https://docs.killbill.io/latest/kill_bill_events.html">Kill Bill Events</a> and sends emails accordingly.</p>
</div>
<div class="paragraph">
<p>Currently, the email notification plugin supports the following events:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event Type</th>
<th class="tableblock halign-left valign-top">Email Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INVOICE_CREATION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The customer will receive an email informing them that a new invoice is available.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INVOICE_NOTIFICATION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The customer will receive an email about upcoming invoices (The time at which to send the email can be configured through the <code>org.killbill.invoice.dryRunNotificationSchedule</code> property as specified in the <a href="https://docs.killbill.io/latest/userguide_configuration.html"><em>Kill Bill Configuration Guide</em></a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INVOICE_PAYMENT_SUCCESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The customer will receive an email after each successful payment or refund.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INVOICE_PAYMENT_FAILED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The customer will receive an email after each failed payment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUBSCRIPTION_CANCEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The customer will receive an email at the time a subscription was requested to be canceled and/or at the effective date of the subscription cancellation.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition, it can be extended to to handle other types of events as well. This is explained in the <a href="#configuring_the_plugin_for_additional_events">"Configuring the Plugin for Additional Events"</a> section below.</p>
</div>
<div class="paragraph">
<p>To send an email the following is required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The tenant or account must be configured to permit such event(s). This is explained in the <a href="#plugin_configuration">"Plugin Configuration"</a> section below.</p>
</li>
<li>
<p>The account for which the emails need to be sent must have certain fields set. This is explained in the <a href="#account_configuration">"Account Configuration"</a> section below.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_plugin_installation">Plugin Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A plugin can be installed either via <a href="https://docs.killbill.io/latest/userguide_kaui.html"><em>Kaui</em></a> or <a href="https://github.com/killbill/killbill-cloud/blob/master/kpm"><em>KPM</em></a>. In order to install a plugin via Kaui, please refer to the <a href="https://docs.killbill.io/latest/plugin_installation.html#_installing_via_kaui"><em>Plugin Installation Instructions</em></a> document. In order to install a plugin via kpm, you may follow the steps given below:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that you have kpm installed as explained <a href="https://github.com/killbill/killbill-cloud/tree/master/kpm#kpm-installation">here</a>.</p>
</li>
<li>
<p>Install the plugin using the following kpm command (Replace <code>&lt;path_to_install_plugin&gt;</code> with the path where you want to install the plugin. This path needs to be configured via the <code>org.killbill.osgi.bundle.install.dir</code> property as specified in the <a href="https://docs.killbill.io/latest/userguide_configuration.html">Kill Bill Configuration Guide</a>):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>kpm<span class="tok-w"> </span>install_java_plugin<span class="tok-w"> </span>email-notifications<span class="tok-w"> </span>--destination<span class="tok-o">=</span>&lt;path_to_install_plugin&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the plugin is installed properly. This can be done by ensuring that the plugin JAR is present at the <code>path_to_install_plugin</code> specified in the previous step. Alternatively, you can also open <code>kpm</code> in <a href="https://docs.killbill.io/latest/userguide_kaui.html">Kaui</a> and verify that the email notification plugin is running as follows:</p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/email-notification-plugin/kaui_email_notification_plugin.png" alt="kaui email notification plugin">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you would like to make changes to the plugin, you can clone the plugin code, build and deploy it as explained <a href="https://github.com/killbill/killbill-email-notifications-plugin">here</a>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_database_configuration">Database Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The email-notification-plugin requires some additional database tables. To create these tables, please follow the steps given below:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connect to the Kill Bill database.</p>
</li>
<li>
<p>Run the <a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/master/src/main/resources/ddl.sql">email-notification-plugin</a> DDL.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="plugin_configuration">Plugin Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to use the email notification plugin, a tenant needs to be configured with the SMTP properties required for sending emails. Additionally, the tenant can also be configured with the events for which emails should be sent. In addition to the per-tenant configuration, the plugin also allows a more granular account-level configuration for the set of emails to be sent for the particular account. Thus, either the tenant or the account needs to be configured with the events for which the email needs to be sent.</p>
</div>
<div class="paragraph">
<p>The tenant/account configuration can be done by executing the required API endpoints via <strong>cURL</strong> as explained below:</p>
</div>
<div id="tenant-config" class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Configure the tenant</strong> using the following cURL command (Replace <code>&lt;events&gt;</code> with a comma-separated list of the events for which the emails need to be sent. For example, to configure the tenant to send emails for <strong>INVOICE_CREATION</strong> and <strong>INVOICE_PAYMENT_SUCCESS</strong>, specify <code>org.killbill.billing.plugin.email-notifications.defaultEvents=INVOICE_CREATION,INVOICE_PAYMENT_SUCCESS</code>):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl<span class="tok-w"> </span>-v<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">     </span>-X<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">     </span>-u<span class="tok-w"> </span>admin:password<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">     </span>-H<span class="tok-w"> </span><span class="tok-s1">&#39;X-Killbill-ApiKey: bob&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">     </span>-H<span class="tok-w"> </span><span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">     </span>-H<span class="tok-w"> </span><span class="tok-s1">&#39;X-Killbill-CreatedBy: admin&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">     </span>-H<span class="tok-w"> </span><span class="tok-s1">&#39;Content-Type: text/plain&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">     </span>-d<span class="tok-w"> </span><span class="tok-s1">&#39;org.killbill.billing.plugin.email-notifications.defaultEvents=&lt;events&gt;</span>
<span class="tok-s1">org.killbill.billing.plugin.email-notifications.smtp.host=127.0.0.1</span>
<span class="tok-s1">org.killbill.billing.plugin.email-notifications.smtp.port=25</span>
<span class="tok-s1">org.killbill.billing.plugin.email-notifications.smtp.useAuthentication=true</span>
<span class="tok-s1">org.killbill.billing.plugin.email-notifications.smtp.userName=uuuuuu</span>
<span class="tok-s1">org.killbill.billing.plugin.email-notifications.smtp.password=zzzzzz</span>
<span class="tok-s1">org.killbill.billing.plugin.email-notifications.smtp.useSSL=false</span>
<span class="tok-s1">org.killbill.billing.plugin.email-notifications.smtp.sendHTMLEmail=true</span>
<span class="tok-s1">org.killbill.billing.plugin.email-notifications.smtp.defaultSender=xxx@yyy.com&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginConfig/killbill-email-notifications</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>Note:</strong> On Windows systems, multiline <code>cURL</code> commands like the one above do not run property when <code>cURL</code> is used on the standard windows command prompt. So, we recommend using either <a href="https://git-scm.com/download/win"><em>Git Bash</em></a> or <a href="https://www.postman.com/"><em>Postman</em></a> as explained <a href="https://docs.killbill.io/latest/postman.html"><em>here</em></a>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>Configure the account</strong> using the following <code>cURL</code> command (Replace <code>{accountId}</code> with the id of the account for which emails need to be sent and <code>&lt;events&gt;</code> with a comma-separated list of the events for which the emails need to be sent. For example, to configure the account to send emails for <strong>INVOICE_CREATION</strong> and <strong>INVOICE_PAYMENT_SUCCESS</strong>, specify <code>"INVOICE_CREATION", "INVOICE_PAYMENT_SUCCESS"</code>):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl<span class="tok-w"> </span>-v<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">     </span>-X<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">     </span>-u<span class="tok-w"> </span>admin:password<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">     </span>-H<span class="tok-w"> </span><span class="tok-s1">&#39;X-Killbill-ApiKey: bob&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">     </span>-H<span class="tok-w"> </span><span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">     </span>-H<span class="tok-w"> </span><span class="tok-s1">&#39;X-Killbill-CreatedBy: admin&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">     </span>-H<span class="tok-w"> </span><span class="tok-s1">&#39;Content-Type: application/json&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">     </span>-d<span class="tok-w"> </span><span class="tok-s1">&#39;[&lt;events&gt;]&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>http://127.0.0.1:8080/plugins/killbill-email-notifications/v1/accounts/<span class="tok-o">{</span>accountId<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Note that either the <strong>tenant</strong> or the <strong>account</strong> should be configured with the events for which emails need to be sent, otherwise, emails will not be sent. Some scenarios for this:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If a tenant is configured with some events, but the account is not configured, then emails will be sent based on what is configured at the tenant level.</p>
</li>
<li>
<p>If a tenant is not configured with any events but the account is configured with events, then emails will be sent based on what is configured at the account level.</p>
</li>
<li>
<p>If both tenant and account are configured with separate events, emails will be sent based on the events configured for both.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="account_configuration">Account Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The account for which emails need to be sent, needs to have the <code>email</code> and <code>locale</code> fields set. In addition, the <a href="#email-templates">default email templates</a> used by the notification plugin also require the  <code>company</code>, <code>address1</code>, <code>city</code>, <code>state</code>, <code>postalCode</code>, <code>country</code> fields set on the Account.</p>
</div>
<div class="paragraph">
<p>Thus, ensure that the account is created using the following <code>cURL</code> command (Replace <code>&lt;email_id&gt;</code> with the email id where you would like to receive the email and change values for the other fields as required):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl<span class="tok-w"> </span>-v<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-X<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-u<span class="tok-w"> </span>admin:password<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;Content-Type: application/json&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;Accept: application/json&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-CreatedBy: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-Reason: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-Comment: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-d<span class="tok-w"> </span><span class="tok-s1">&#39;{ &quot;name&quot;: &quot;John Doe&quot;, &quot;email&quot;: &quot;&lt;email_id&gt;&quot;, &quot;currency&quot;: &quot;USD&quot;, &quot;company&quot;: &quot;Acme Corporation&quot;, &quot;locale&quot;:&quot;en_US&quot;, &quot;address1&quot;: &quot;57 Academy Drive&quot;,&quot;city&quot;: &quot;Oak Creek&quot;,&quot;state&quot;: &quot;WI&quot;,&quot;postalCode&quot;: &quot;53154&quot;, &quot;country&quot;: &quot;US&quot;}&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/accounts&quot;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="smtp_server_notes">SMTP Server Notes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to be able to use the email notification plugin to send emails, a local SMTP server is required.</p>
</div>
<div class="paragraph">
<p>We typically use the <code>namshi/smtp</code> docker image as follows to start a local SMTP server on port 25:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>docker<span class="tok-w"> </span>run<span class="tok-w"> </span>-tid<span class="tok-w"> </span>--name<span class="tok-w"> </span>smtp_server<span class="tok-w"> </span>-p<span class="tok-w"> </span><span class="tok-m">25</span>:25<span class="tok-w">  </span>-e<span class="tok-w"> </span><span class="tok-nv">DISABLE_IPV6</span><span class="tok-o">=</span><span class="tok-nb">true</span><span class="tok-w"> </span>namshi/smtp</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if you would like to use a non-docker based SMTP server, you can use <a href="https://www.mailslurper.com/"><em>MailSlurper</em></a>. MailSlurper is a small handy SMTP server that can be useful for development and testing. It can be downloaded and configured as explained in its <a href="https://github.com/mailslurper/mailslurper/wiki/Getting-Started"><em>documentation</em></a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_the_plugin">Testing the Plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once the plugin is installed and configured as explained above, it can be used for sending emails. You can verify that the plugin is working correctly by following the steps given below:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a local SMTP server as explained in the <a href="#smtp_server_notes">"SMTP Server Notes"</a> section.</p>
</li>
<li>
<p>Ensure that Kill Bill is running either in <a href="https://docs.killbill.io/latest/development.html#<em>running_the_application">_standalone</em></a> mode or in <a href="https://docs.killbill.io/latest/getting_started.html"><em>Tomcat</em></a>.</p>
</li>
<li>
<p>Create a tenant as follows (specify the required <code>apiKey</code> and <code>apiSecret</code>):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl<span class="tok-w"> </span>-v<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-X<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-u<span class="tok-w"> </span>admin:password<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;Content-Type: application/json&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;Accept: application/json&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-CreatedBy: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-Reason: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-Comment: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-d<span class="tok-w"> </span><span class="tok-s1">&#39;{ &quot;apiKey&quot;: &quot;bob&quot;, &quot;apiSecret&quot;: &quot;lazar&quot;}&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/tenants&quot;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Configure the tenant as specified in the <a href="#tenant-config">"Plugin Configuration"</a> section above with <strong>INVOICE_CREATION</strong> and <strong>INVOICE_PAYMENT_SUCCESS</strong> events.</p>
</li>
<li>
<p>Create an account as follows (Replace <code>&lt;email_id&gt;</code> with the email id where you would like to receive the email and change values for the other fields as required):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl<span class="tok-w"> </span>-v<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-X<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-u<span class="tok-w"> </span>admin:password<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;Content-Type: application/json&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;Accept: application/json&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-CreatedBy: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-Reason: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-Comment: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-d<span class="tok-w"> </span><span class="tok-s1">&#39;{ &quot;name&quot;: &quot;John Doe&quot;, &quot;email&quot;: &quot;&lt;email_id&gt;&quot;, &quot;currency&quot;: &quot;USD&quot;, &quot;company&quot;: &quot;Acme Corporation&quot;, &quot;locale&quot;:&quot;en_US&quot;, &quot;address1&quot;: &quot;57 Academy Drive&quot;,&quot;city&quot;: &quot;Oak Creek&quot;,&quot;state&quot;: &quot;WI&quot;,&quot;postalCode&quot;: &quot;53154&quot;, &quot;country&quot;: &quot;US&quot;}&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/accounts&quot;</span></code></pre>
</div>
</div>
</li>
<li>
<p>If successful, the command above returns a <code>Location</code> header like http://127.0.0.1:8080/1.0/kb/accounts/eda3e357-20a1-456d-a9b3-b39ca3db8020. Copy the <code>account_id</code> in the header (<code>eda3e357-20a1-456d-a9b3-b39ca3db8020</code> in this case) and save it for future use.</p>
</li>
<li>
<p>Add a payment method as follows (replace <code>&lt;account_id&gt;</code> with the account id obtained above):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl<span class="tok-w"> </span>-v<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-X<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-u<span class="tok-w"> </span>admin:password<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;Content-Type: application/json&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;Accept: application/json&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-CreatedBy: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-Reason: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-Comment: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-d<span class="tok-w"> </span><span class="tok-s1">&#39;{ &quot;accountId&quot;: &quot;&lt;account_id&gt;&quot;, &quot;pluginName&quot;: &quot;__EXTERNAL_PAYMENT__&quot;}&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/accounts/&lt;account_id&gt;/paymentMethods&quot;</span></code></pre>
</div>
</div>
</li>
<li>
<p>If successful, the command above returns a <code>Location</code> header like
http://127.0.0.1:8080/1.0/kb/paymentMethods/c2ff0040-7c5b-48bf-9685-a4c57501535f. Copy the <code>payment_method_id</code> in the header (<code>c2ff0040-7c5b-48bf-9685-a4c57501535f</code> in this case) and save it for future use.</p>
</li>
<li>
<p>Set the payment method as default as follows  (Replace <code>&lt;account_id&gt;</code> and <code>&lt;payment_method_id&gt;</code> with the values obtained above):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl<span class="tok-w"> </span>-v<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-X<span class="tok-w"> </span>PUT<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-u<span class="tok-w"> </span>admin:password<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;Content-Type: application/json&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;Accept: application/json&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-CreatedBy: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-Reason: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-Comment: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/accounts/&lt;account_id&gt;/paymentMethods/&lt;payment_method_id&gt;/setDefault&quot;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create a external charge to trigger an invoice as follows (Replace <code>&lt;account_id&gt;</code> with the account_id obtained above):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl<span class="tok-w"> </span>-v<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-X<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-u<span class="tok-w"> </span>admin:password<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;Content-Type: application/json&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;Accept: application/json&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-CreatedBy: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-Reason: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-Comment: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-d<span class="tok-w"> </span><span class="tok-s1">&#39;[ { &quot;accountId&quot;: &quot;&lt;account_id&gt;&quot;, &quot;description&quot;: &quot;My charge&quot;, &quot;amount&quot;: 50, &quot;currency&quot;: &quot;USD&quot; }]&#39;</span><span class="tok-w">    </span><span class="tok-se">\</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/invoices/charges/&lt;account_id&gt;?autoCommit=true&quot;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that an email is sent for the invoice and successful payment.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that you can also use <a href="https://docs.killbill.io/latest/userguide_kaui.html"><em>Kaui</em></a> for executing steps 2-9 above.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="template_and_resource_configuration">Template and Resource Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The email notification plugin uses <a href="https://mustache.github.io/"><em>Mustache</em></a> templates for generating emails. This section explains how custom email templates can be configured.</p>
</div>
<div class="sect2">
<h3 id="email-templates">Templates Overview</h3>
<div class="paragraph">
<p>An email template contains the body of an email. In addition to static text, it contains some variables which are replaced at runtime by the <a href="https://mustache.github.io/"><em>mustache</em></a> engine.</p>
</div>
<div class="paragraph">
<p>The email notification plugin comes with some <a href="https://github.com/killbill/killbill-email-notifications-plugin/tree/master/src/main/resources/org/killbill/billing/plugin/notification/templates">default templates</a>. However, users can also upload their custom templates.</p>
</div>
<div class="paragraph">
<p>The email notification plugin uses <strong>one template per locale and per type</strong> (as opposed to one template per type with an additional set of translation string bundles for each locale). So, for example, the <strong>INVOICE_CREATION</strong> event can have templates like <code>INVOICE_CREATION_en_US</code>, <code>INVOICE_CREATION_fr_FR</code>, and so on. When an <strong>INVOICE CREATION</strong> email needs to be sent for a user, the user&#8217;s <code>locale</code> is checked and the corresponding template is used. The <a href="https://github.com/killbill/killbill-email-notifications-plugin/tree/master/src/main/resources/org/killbill/billing/plugin/notification/templates">default templates</a> are available only for the <strong>en_US</strong> locale, however, users can upload templates for other locales if required.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resources_overview">Resources Overview</h3>
<div class="paragraph">
<p>In addition to templates, the email notification plugin requires a resource file. This resource file contains <strong>key-value pairs</strong> which can be used to replace variables in a template. The email notification plugin comes with a <a href="https://github.com/killbill/killbill-email-notifications-plugin/tree/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/resources/org/killbill/billing/plugin/notification/translations">default resource file</a> that contains key-value pairs for the variables in the default templates.</p>
</div>
<div class="paragraph">
<p>Unlike email templates, all the events have a single resource file. However, different locales can have different resource files. This allows having string translations in different languages, (like different translations for the catalog product names). So for example, you can have different resource files like <code>Translation_en_US.properties</code>, <code>Translation_fr_FR.properties</code>, and so on. When an email needs to be sent for a user, the user&#8217;s <code>locale</code> is checked and the corresponding resource file is used to replace the variables in the template.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/resources/org/killbill/billing/plugin/notification/translations/Translation_en_US.properties">default resource file</a> is available only for the <strong>en_US</strong> locale. Users can add additional key-value pairs to this resource file as well as add new resource files for different locales.</p>
</div>
</div>
<div class="sect2">
<h3 id="_templatetranslation_resource_keys">Template/Translation Resource Keys</h3>
<div class="paragraph">
<p>Each email template and the translation resource is assigned a <strong>key</strong>. To upload a custom email template/translation resource, its key needs to be specified.</p>
</div>
<div class="paragraph">
<p>The following table provides details about the template/translation resource keys (assuming that the locale is <code>en_US</code>):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Template Type</th>
<th class="tableblock halign-left valign-top">Template Key</th>
<th class="tableblock halign-left valign-top">Template Description</th>
<th class="tableblock halign-left valign-top">Default Template</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invoice creation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">killbill-email-notifications:INVOICE_CREATION_en_US</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template for the email that will be sent when an invoice is created</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/resources/org/killbill/billing/plugin/notification/templates/InvoiceCreation.mustache"><em>InvoiceCreation.mustache</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upcoming invoices</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">killbill-email-notifications:UPCOMING_INVOICE_en_US</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template for the email that will be sent when an invoice is due</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/resources/org/killbill/billing/plugin/notification/templates/UpcomingInvoice.mustache"><em>UpcomingInvoice.mustache</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Successful payments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">killbill-email-notifications:SUCCESSFUL_PAYMENT_en_US</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template for the email that will be sent when a payment is successful</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/resources/org/killbill/billing/plugin/notification/templates/SuccessfulPayment.mustache"><em>SuccessfulPayment.mustache</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failed payments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">killbill-email-notifications:FAILED_PAYMENT_en_US</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template for the email that will be sent when a payment fails</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/resources/org/killbill/billing/plugin/notification/templates/FailedPayment.mustache"><em>FailedPayment.mustache</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription cancellation (requested date)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">killbill-email-notifications:SUBSCRIPTION_CANCELLATION_REQUESTED_en_US</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template for the email that will be sent when a user requests to cancel a subscription</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/resources/org/killbill/billing/plugin/notification/templates/SubscriptionCancellationRequested.mustache"><em>SubscriptionCancellationRequested.mustache</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription cancellation (effective date)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">killbill-email-notifications:SUBSCRIPTION_CANCELLATION_EFFECTIVE_en_US</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template for the email that will be sent when a subscription is actually cancelled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/resources/org/killbill/billing/plugin/notification/templates/SubscriptionCancellationEffective.mustache"><em>SubscriptionCancellationEffective.mustache</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Payment refunds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">killbill-email-notifications:PAYMENT_REFUND_en_US</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template for the email that will be sent when a payment is refunded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/resources/org/killbill/billing/plugin/notification/templates/PaymentRefund.mustache"><em>PaymentRefund.mustache</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Translation strings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">killbill-email-notifications:TEMPLATE_TRANSLATION_en_US</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes all the text values referenced in the templates. Also includes the email subjects using the following keys:
<strong>upcomingInvoiceSubject
successfulPaymentSubject
failedPaymentSubject
paymentRefundSubject
subscriptionCancellationRequestedSubject
subscriptionCancellationEffectiveSubject
invoiceCreationSubject</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/resources/org/killbill/billing/plugin/notification/translations/Translation_en_US.properties"><em>Translation_en_US.properties</em></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_uploading_a_custom_template">Uploading a Custom Template</h3>
<div class="paragraph">
<p>As explained earlier, you can upload per-tenant email templates for various events. Let&#8217;s look at an example to upload a template for the next upcoming invoice for a locale <code>en_US</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the template <code>/tmp/UpcomingInvoice.mustache</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>***<span class="tok-w"> </span>You<span class="tok-w"> </span>Have<span class="tok-w"> </span>a<span class="tok-w"> </span>New<span class="tok-w"> </span>Invoice<span class="tok-w"> </span>***

You<span class="tok-w"> </span>have<span class="tok-w"> </span>a<span class="tok-w"> </span>new<span class="tok-w"> </span>invoice<span class="tok-w"> </span>from<span class="tok-w"> </span><span class="tok-o">{{</span>text.merchantName<span class="tok-o">}}</span>,<span class="tok-w"> </span>due<span class="tok-w"> </span>on<span class="tok-w"> </span><span class="tok-o">{{</span>invoice.targetDate<span class="tok-o">}}</span>.

<span class="tok-o">{{</span><span class="tok-c1">#invoice.invoiceItems}}</span>
<span class="tok-o">{{</span>startDate<span class="tok-o">}}</span><span class="tok-w"> </span><span class="tok-o">{{</span>planName<span class="tok-o">}}</span><span class="tok-w"> </span>:<span class="tok-w"> </span><span class="tok-o">{{</span>invoice.formattedAmount<span class="tok-o">}}</span>
<span class="tok-o">{{</span>/invoice.invoiceItems<span class="tok-o">}}</span>

<span class="tok-o">{{</span>text.invoiceAmountTotal<span class="tok-o">}}</span>:<span class="tok-w"> </span><span class="tok-o">{{</span>invoice.formattedBalance<span class="tok-o">}}</span>

<span class="tok-o">{{</span>text.billedTo<span class="tok-o">}}</span>:
<span class="tok-o">{{</span>account.companyName<span class="tok-o">}}</span>
<span class="tok-o">{{</span>account.name<span class="tok-o">}}</span>
<span class="tok-o">{{</span>account.address1<span class="tok-o">}}</span>
<span class="tok-o">{{</span>account.city<span class="tok-o">}}</span>,<span class="tok-w"> </span><span class="tok-o">{{</span>account.stateOrProvince<span class="tok-o">}}</span><span class="tok-w"> </span><span class="tok-o">{{</span>account.postalCode<span class="tok-o">}}</span>
<span class="tok-o">{{</span>account.country<span class="tok-o">}}</span>

If<span class="tok-w"> </span>you<span class="tok-w"> </span>have<span class="tok-w"> </span>any<span class="tok-w"> </span>questions<span class="tok-w"> </span>about<span class="tok-w"> </span>your<span class="tok-w"> </span>account,<span class="tok-w"> </span>please<span class="tok-w"> </span>reply<span class="tok-w"> </span>to<span class="tok-w"> </span>this<span class="tok-w"> </span>email<span class="tok-w"> </span>or<span class="tok-w"> </span>contact<span class="tok-w"> </span><span class="tok-o">{{</span>text.merchantName<span class="tok-o">}}</span><span class="tok-w"> </span>Support<span class="tok-w"> </span>at:<span class="tok-w"> </span><span class="tok-o">{{</span>text.merchantContactPhone<span class="tok-o">}}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Upload the template for your tenant:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl<span class="tok-w"> </span>-v<span class="tok-w"> </span><span class="tok-se">\</span>
-u<span class="tok-w"> </span>admin:password<span class="tok-w"> </span><span class="tok-se">\</span>
-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
-H<span class="tok-w"> </span><span class="tok-s1">&#39;X-Killbill-CreatedBy: admin&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
-H<span class="tok-w"> </span><span class="tok-s2">&quot;Content-Type: text/plain&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
-X<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
--data-binary<span class="tok-w"> </span>@/tmp/UpcomingInvoice.mustache<span class="tok-w"> </span><span class="tok-se">\</span>
http://127.0.0.1:8080/1.0/kb/tenants/userKeyValue/killbill-email-notifications:UPCOMING_INVOICE_en_US</code></pre>
</div>
</div>
</li>
<li>
<p>If your template uses some additional keys than what are specified in the <a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/resources/org/killbill/billing/plugin/notification/translations/Translation_en_US.properties">default translation file</a>, these need to be added to the translation file as explained in the next section.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="uploading_resource_files">Uploading Resource Files</h3>
<div class="paragraph">
<p>As explained earlier, you can upload additional resource files for different locales or additional keys in existing resource files. In order to do this, please follow the steps given below:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check if a resource file <a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/resources/org/killbill/billing/plugin/notification/translations/">already exists</a> for your locale. If so, download the file and if not, create a new file. You can use the <a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/resources/org/killbill/billing/plugin/notification/translations/Translation_en_US.properties">default translation template</a> as a reference to create a new file.</p>
</li>
<li>
<p>Add the required properties (key-value pairs) to your file.</p>
</li>
<li>
<p>Upload the new resource file using the following cURL command (Replace <code>&lt;template-name&gt;</code> with the name of the file created in the previous step and <code>&lt;translation_key&gt;</code> with the translation key. For example the translation key for a resource file for the <code>en_US</code> locale will be <strong>TEMPLATE_TRANSLATION_en_US</strong>):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl<span class="tok-w"> </span>-v<span class="tok-w"> </span><span class="tok-se">\</span>
-u<span class="tok-w"> </span>admin:password<span class="tok-w"> </span><span class="tok-se">\</span>
-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
-H<span class="tok-w"> </span><span class="tok-s1">&#39;X-Killbill-CreatedBy: admin&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
-H<span class="tok-w"> </span><span class="tok-s2">&quot;Content-Type: text/plain&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
-X<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
--data-binary<span class="tok-w"> </span>@/&lt;template-name&gt;.properties<span class="tok-w"> </span><span class="tok-se">\</span>
http://127.0.0.1:8080/1.0/kb/tenants/userKeyValue/killbill-email-notifications:&lt;translation_key&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_default_templates">Default Templates</h3>
<div class="paragraph">
<p>As mentioned earlier, the email notification plugin comes with some <a href="https://github.com/killbill/killbill-email-notifications-plugin/tree/master/src/main/resources/org/killbill/billing/plugin/notification/templates">default templates</a>.</p>
</div>
<div class="paragraph">
<p>For example, the default <a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/93115e20e53a25c3c5a58731bc746bc31e8834be/src/main/resources/org/killbill/billing/plugin/notification/templates/InvoiceCreation.mustache">invoice creation</a> template will result in the following email being sent:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/invoice_templates/invoice_email.png" alt="invoice email">
</div>
</div>
<div class="paragraph">
<p>The default <a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/93115e20e53a25c3c5a58731bc746bc31e8834be/src/main/resources/org/killbill/billing/plugin/notification/templates/SubscriptionCancellationEffective.mustache">subscription cancellation</a> template will result in the following email being sent:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/invoice_templates/cancellation_email.png" alt="cancellation email">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring_the_plugin_for_additional_events">Configuring the Plugin for Additional Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As explained earlier, the email notification plugin is a <a href="https://docs.killbill.io/latest/notification_plugin.html">notification plugin</a>. In addition to the events handled by it by default, it can be configured to listen to other events and send emails accordingly.</p>
</div>
<div class="paragraph">
<p>In order to configure the plugin to send emails for other events, you will need to modify the plugin code as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that the event for which you would like to send an email is defined in the <a href="https://github.com/killbill/killbill-plugin-api/blob/d9eca5af0e37541069b1c608f95e100dbe13b301/notification/src/main/java/org/killbill/billing/notification/plugin/api/ExtBusEventType.java">ExtBusEventType.java</a>.</p>
</li>
<li>
<p>Modify the <a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/java/org/killbill/billing/plugin/notification/setup/EmailNotificationListener.java">EmailNotificationListener</a> class as follows:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Modify the <a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/java/org/killbill/billing/plugin/notification/setup/EmailNotificationListener.java#L113">EmailNotificationListener#handleKillbillEvent</a> method to add case statements corresponding to the events that need to be handled.</p>
</li>
<li>
<p>Add a method corresponding to the email that you would like to send similar to the <a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/6fc76403233fd5be290841ee6fc9d728028892f0/src/main/java/org/killbill/billing/plugin/notification/setup/EmailNotificationListener.java#L213">EmailNotificationListener#sendEmailForUpComingInvoice</a> method.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Upload email templates and translation resource file corresponding to the email that you would like to send as explained in the <a href="#template_and_resource_configuration">"Template and Resource Configuration"</a> section.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_the_invoice_sent_in_an_email">Customizing the Invoice Sent in an Email</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes, you may need to customize the invoice sent in an email with additional fields. For this, you will need to create a custom plugin. The detailed instructions for this are mentioned in our <a href="https://docs.killbill.io/latest/custom-email-invoice-formatter.html"><em>Custom Email Invoice Formatter</em></a> document.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting">Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers some common issues and their solutions.</p>
</div>
<div class="sect2">
<h3 id="_emails_not_sent">Emails not Sent</h3>
<div class="paragraph">
<p>Sometimes, even after configuring the plugin as mentioned above, you may find that emails are not sent. There are several reasons for this:</p>
</div>
<div class="paragraph">
<p><strong>Missing information on Account</strong></p>
</div>
<div class="paragraph">
<p>In order to send an email, the <code>Account</code> record needs to have
the <code>locale</code> and <code>email</code> fields set. In addition, if you are using the default templates provided by the plugin, the <code>company</code>, <code>address1</code>, <code>city</code>, <code>state</code>, <code>postalCode</code>, <code>country</code> fields also need to be set on the Account. If any of these fields are missing, emails will not be sent and you will see the following exception in the Kill Bill logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>com.samskivert.mustache.MustacheException:<span class="tok-w"> </span>No<span class="tok-w"> </span>key,<span class="tok-w"> </span>method<span class="tok-w"> </span>or<span class="tok-w"> </span>field<span class="tok-w"> </span>with<span class="tok-w"> </span>name<span class="tok-w"> </span><span class="tok-s1">&#39;account.companyName&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ensure that the account for which the emails are to be sent is configured with all the required fields as explained in the <a href="#account_configuration">"Account Configuration"</a> section above.</p>
</div>
<div class="paragraph">
<p><strong>Missing information in template</strong></p>
</div>
<div class="paragraph">
<p>Sometimes, you may upload a custom template. However, you may forget to upload the translation keys for it in the resource file. In such a case, the email will not be sent and you will see the following exception in the Kill Bill logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>com.samskivert.mustache.MustacheException:<span class="tok-w"> </span>No<span class="tok-w"> </span>key,<span class="tok-w"> </span>method<span class="tok-w"> </span>or<span class="tok-w"> </span>field<span class="tok-w"> </span>with<span class="tok-w"> </span>name<span class="tok-w"> </span><span class="tok-s1">&#39;text.merchantName&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ensure that you also update the translation properties as specified in the <a href="#uploading_resource_files">"Uploading Resource Files"</a> section above.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_ssl_in_emails">Enabling SSL in Emails</h3>
<div class="paragraph">
<p>In order to enable SSL while sending emails, you need to configure the tenant with the <code>org.killbill.mail.useSSL=true</code> as specified in the <a href="#tenant-config">"Tenant Config"</a> section above.</p>
</div>
</div>
</div>
</div></div><div class="bottom-nav-links"><a href="#" id="prev-nav-link" class="bottom-nav-link card prev"><span class="arrow-icon left"><svg class="i-arrow" width="12" height="11" viewBox="0 0 12 11" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.19526 1.02876C4.45561 0.768409 4.87772 0.768409 5.13807 1.02876C5.39842 1.28911 5.39842 1.71122 5.13807 1.97157L2.27614 4.8335H11.3333C11.7015 4.8335 12 5.13197 12 5.50016C12 5.86835 11.7015 6.16683 11.3333 6.16683H2.27614L5.13807 9.02876C5.39842 9.28911 5.39842 9.71122 5.13807 9.97157C4.87772 10.2319 4.45561 10.2319 4.19526 9.97157L0.195261 5.97157C-0.0650883 5.71122 -0.0650883 5.28911 0.195261 5.02876L4.19526 1.02876Z" fill=""/></svg><span class="prev-text">Previous</span></span><span id="prev-navigator" class="bottom-nav-text">Prev</span>                               </a><a href="#" id="next-nav-link" class="bottom-nav-link card next"><span class="arrow-icon"><span class="next-text">Next</span><svg class="i-arrow icon-left" width="12" height="11" viewBox="0 0 12 11" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.19526 1.02876C4.45561 0.768409 4.87772 0.768409 5.13807 1.02876C5.39842 1.28911 5.39842 1.71122 5.13807 1.97157L2.27614 4.8335H11.3333C11.7015 4.8335 12 5.13197 12 5.50016C12 5.86835 11.7015 6.16683 11.3333 6.16683H2.27614L5.13807 9.02876C5.39842 9.28911 5.39842 9.71122 5.13807 9.97157C4.87772 10.2319 4.45561 10.2319 4.19526 9.97157L0.195261 5.97157C-0.0650883 5.71122 -0.0650883 5.28911 0.195261 5.02876L4.19526 1.02876Z" fill=""/></svg></span><span id="next-navigator" class="bottom-nav-text">Next</span></a></div></article></div><div class="bd-links-wrapper"><nav class="bd-links toc right-side-menu" id="myScrollspy" data-toggle="toc"></nav></div></div></div></div></div></main><script src="javascripts/jquery-3.6.1.min.js"></script><script src="javascripts/bootstrap.min.js"></script><script src="javascripts/bootstrap-toc.min.js"></script><script type="module" src="javascripts/kb.js"></script><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script><script>docsearch({apiKey: '3ef227e7fd5e2e1a3fffd880484934bf', container: '#docsearch', appId: 'S2ISXITURI', indexName: 'killbill'});</script><script>
  jQuery(document).ready(function($){
    $('.sidebar-nav .icon-title').on('click', function (e) {
      e.preventDefault();
      $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
      $('.sidebar-nav > .navbar-nav > li').removeClass('open');

      if($(this).next().is(':visible')){
        $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
        $('.sidebar-nav > .navbar-nav > li').removeClass('open');
      } else {
        $(this).parent().addClass('open');
        $(this).next().slideDown(200);
      }
    });

    let pageURL = $(location).attr("href");
    pageURL = pageURL.includes('.html') ? pageURL : pageURL + '.html';
    $('.nav-link').each(function() {
      if (pageURL.toLowerCase().includes($(this).attr('href').toLowerCase())) {
        $(this).parent().addClass('list-item-active');
        $(this).parent().parent().addClass('active-list');
        $(this).parent().parent().prev().addClass('bd-link-active-wrap');
      }
    });
  });
</script>
</body></html>