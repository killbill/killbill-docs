<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 2.0.20"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticaly.com/gh/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"><link rel="preconnect" href="https://S2ISXITURI-dsn.algolia.net"><style type="text/css"></style><title>Kill Bill Analytics Guide</title><style>/*Default CSS*/

/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */

@import "https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap";

*,
*::before,
*::after {
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
}

ul,
ol {
  padding: 0;
  list-style-type: none;
}

body,
h1,
h2,
h3,
h4,
p,
ul[class],
ol[class],
li,
figure,
figcaption,
blockquote,
dl,
dd {
  margin: 0;
}

body {
  min-height: 100vh;
  scroll-behavior: smooth;
  text-rendering: optimizeSpeed;
  font-family: 'Inter', sans-serif;
  font-size: 16px;
  line-height: 150%;
  color: #374151;
  max-width: 100%;
  overflow-x: hidden;
}

ul[class],
ol[class] {
  list-style: none;
}

img {
  max-width: 100%;
  display: block;
}

img[align=center] {
  margin: 0 auto;
}

button {
  cursor: pointer;
}

input,
button,
textarea,
select {
  font: inherit;
}
a {
  color: #167BB7;
}
h1,
h3,
h4 {
  font-weight: 400;
}
h2,
h3,
h4 {
  color: #1F2937;
}
h1 {
  font-size: 40px;
  line-height: 120%;
  letter-spacing: -0.025em;
  color: #FFFFFF;
}
h2 {
  font-weight: 600;
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
  font-weight: 500;
}

.header {
  padding: 16px 0;
  background: #FFFFFF;
  box-shadow: 0 1px 3px rgba(0, 0, 0, .1), 0 1px 2px rgba(0, 0, 0, .06);
}
@media (min-width: 768px) {
  .header-logo {
    width: 320px;
  }
}
.header-wrapper .logo {
  max-width: 215px;
  margin: auto;
  width: 80%;
}
.header-wrapper .logo img {
  object-fit: contain;
}
@media (max-width: 767px) {
  .header-wrapper .logo a {
    display: flex;
    justify-content: center;
  }
}
.header-search {
  flex-grow: 1;
  padding-right: 16px;
}
@media (min-width: 768px) {
  .header-search {
    /*flex-grow: 1;*/
    /*max-width: calc(100% - 590px);*/
    /*padding-right: 53px;*/
    /*padding-left: 45px;*/
  }
}
@media (min-width: 1200px) {
  .header-search {
    max-width: calc(100% - 590px);
    padding-right: 53px;
    padding-left: 45px;
  }
}

.header-wrapper .search-form-wrapper {
  flex-grow: 1;
}
.header-wrapper .search-form {
  position: relative;
}
.header-wrapper .search-form .algolia-autocomplete {
  width: 100%;
}
.header-wrapper .search-form input[type="search"] {
  width: 100%;
  padding: 9px 9px 9px 40px;
  border: 1px solid #D1D5DB;
  border-radius: 6px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
}
.header-wrapper .search-form .ds-dropdown-menu {
  max-width: none;
  width: 100%;
}
.header-wrapper .search-form .search-form-icon {
  position: absolute;
  left: 13px;
  top: 9px;
  z-index: 1;
  width: 20px;
  height: 20px;
  pointer-events: none;
}
.content-wrapper {
  padding: 24px 20px;
}
@media (min-width: 1024px) {
  .content-wrapper {
    padding-right: 54px;
    padding-left: 54px;
  }
}

.content-wrapper .banner {
  position: relative;
  display: flex;
  align-items: center;
  min-height: 174px;
  margin-bottom: 24px;
  padding: 0 40px;
  background-color: #167BB7;
  border-radius: 8px;
}
.content-wrapper .banner .bg-image {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
}

.main {
  position: relative;
  line-height: 1.5;
}

.main p {
  margin-bottom: 12px;
}

.main .sidebar {
  width: calc(100% + 15px);
  flex-shrink: 0;
  margin-right: 40px;
  position: sticky;
  top: 0;
  margin-left: -15px;
  padding: 24px 16px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, .1), 0 1px 2px rgba(0, 0, 0, .06);
}

.main .sidebar .icon-title {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-top: 8px;
  padding-bottom: 8px;
  cursor: pointer;
}

.main .sidebar .icon-title .left-part{
  display: flex;
  align-items: center;
  order: 2;
  flex-grow: 1;
}

.main .sidebar .icon-title .chevron,
.main .sidebar .icon-title.bd-link-active-wrap .chevron.rotated {
  transform: rotate(180deg);
}

.main .sidebar .icon-title.bd-link-active-wrap .bd-toc-link {
  color: #167BB7;
}

.main .sidebar .open .icon-title .chevron,
.main .sidebar .icon-title.bd-link-active-wrap .chevron{
  transform: rotate(0);
  transition-duration: .25s;
  transform-origin: center;
}

.main .sidebar .bd-link-active-wrap  .chevron path {
  fill: #D1D5DB;
}

.main .sidebar .bd-link-active-wrap svg path {
  fill: #167BB7;
}

.main .sidebar .icon-title svg {
  width: 16px;
  order: 1;
}
.main .sidebar-nav {
  height: 100vh;
}
.main .sidebar-nav,
.main .right-side-menu {
  overflow-y: scroll;
  padding: 0 24px;
}

.main .right-side-menu {
  direction: rtl;
  padding: 24px 0 0 24px;
}

.main .right-side-menu .navbar-nav {
  direction: ltr;
}

.main .sidebar-nav::-webkit-scrollbar,
.main .right-side-menu::-webkit-scrollbar
{
  width: 8px;
}

.main .sidebar-nav::-webkit-scrollbar-track,
.main .right-side-menu::-webkit-scrollbar-track
{
  background-color: transparent;
}

.main .sidebar-nav::-webkit-scrollbar-thumb,
.main .right-side-menu::-webkit-scrollbar-thumb
{
  background-color: #F3F4F6;
  width: 6px;
  border-radius: 32px;
}

.main .sidebar-nav a.nav-link {
  transition-duration: .25s;
  transition-property: color;
}
.main .sidebar-nav a.nav-link:hover {
  color: #167BB7;
}
.main .sidebar-nav a {
  color: #6B7280;
}

.main .sidebar-nav a.bd-toc-link {
  padding-left: 12px;
  font-weight: 500;
  font-size: 14px;
  display: block;
  color: #6B7280;
  transition-duration: .25s;
  transition-property: color;
}
.main .sidebar-nav li:hover a.bd-toc-link,
.main .sidebar-nav li.active a.bd-toc-link,
.main .sidebar-nav .open a.bd-toc-link {
  color: #374151;
}
@media (min-width: 768px) {
  .main .sidebar:after {
    content: '';
    position: absolute;
    top: 30px;
    right: -12px;
    width: 13px;
    height: 24px;
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
  }
}
.sidebar-toggler {
  display: none;
}
@media (min-width: 768px) {
  .sidebar-toggler {
    display: block;
    position: absolute;
    top: 30px;
    right: -12px;
    width: 24px;
    height: 24px;
    border-radius: 4px;
    cursor: pointer;
    background-color: #F3F4F6;
    transition-duration: .25s;
    z-index: 2;
  }
  .sidebar-toggler:hover {
    background-color: #efefef;
  }
  .sidebar-toggler:after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 8px;
    height: 12px;
    transform: translate(-50%, -50%) rotate(0deg);
    background-image: url("data:image/svg+xml,%3Csvg width='8' height='12' viewBox='0 0 8 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M6.33337 10.6666L1.66671 5.99998L6.33337 1.33331' stroke='%23167BB7' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A");
    background-size: contain;
    background-repeat: no-repeat;
    transition-duration: .25s;
  }
  .sidebar-toggler.active:after {
    transform: translate(-50%, -50%) rotate(180deg);
  }
}


pre.pygments .tok-o {
  color: #167BB7;
}

.main p code {
  color: inherit;
  font-size: inherit;
}

.main table,.main table td,.main table th {
  border: 1px solid #dedede;
  padding: 10px;
}

.main .note table,.main .note table td,.main .note table th {
  border: none;
}

.main .note .icon {
  width: 60px;
}

.main .note .icon .fa.icon-note {
  display: none;
}

.main .note .content {
  font-weight: normal;
  color: #374151;
}

.main table td.icon svg{
  width: 30px;
  height: auto;
}

.main table td.icon .title {
  display: none;
}

.main table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 15px;
}

.main table .title {
  text-transform: uppercase;
  font-weight: 600;
  padding: 0 5px;
}

pre.pygments .tok-o {
  color: #167BB7!important;
}

.main .sidebar-nav > ul li ul {
  display: none;
  padding-left: 16px;
  padding-bottom: 8px;
  font-size: 14px;
  border-bottom: 1px solid #F3F4F6;
}

.main .sidebar-nav > ul li ul.active-list {
  display: block;
}

.main .sidebar-nav > ul li ul li a{
  display: block;
  position: relative;
  padding-left: 16px;
  font-size: 14px;
}

.main .sidebar-nav .list-item-active a {
  color: #167BB7;
}

.main .sidebar-nav > .navbar-nav  > li {
  margin-bottom: 8px;
}

.main .right-side-menu {
  position: sticky;
  top: 16px;
  height: calc(100vh - 40px);
  margin-top: 24px;
}

.main .right-side-menu > .navbar-nav {
  position: relative;
}

.sidebar-wrapper {
  margin-left: 0;
  transition-duration: .25s;
  flex-shrink: 0;
  width: calc(100% - 16px);
}
.main-wrapper {
  flex-grow: 1;
}
.bd-links-wrapper {
  flex-shrink: 0;
}
.right-side-menu ul ul {
  padding-left: 16px;
}
@media (min-width: 768px) {
  .sidebar-wrapper {
    width: 310px;
  }
  .sidebar-hide .sidebar-wrapper {
    margin-left: -280px;
  }
  .main-wrapper {
    width: calc(100% - 520px);
  }
}
@media (min-width: 1200px) {
  .main-wrapper {
    width: calc(100% - 590px);
  }
  .bd-links-wrapper {
    width: 268px;
  }
}


.main .right-side-menu > .navbar-nav:before {
  content: "In this document";
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  font-size: 14px;
  line-height: 16px;
  text-transform: uppercase;
  color: #1F2937;
}

.main .right-side-menu > ul > li > a {
  font-size: 14px;
  font-weight: 300;
  margin-bottom: 7px;
  padding: 4px 0;
}

.main .right-side-menu .nav-link {
  border: none!important;
  color: #6B7280!important;
}

.main .right-side-menu .nav-link.active{
  padding-left: 0;
  color: #167BB7!important;
  font-weight: 500;
}

.main .right-side-menu .navbar-nav {
  display: block;
}
.main nav[data-toggle=toc] .nav > li > a {
  padding-left: 0;
  transition-property: color;
  transition-duration: .25s;
}
.main nav[data-toggle=toc] .nav > li > a:focus,
.main nav[data-toggle=toc] .nav > li > a:hover {
  color: #167BB7!important;
}
.main nav[data-toggle=toc] .nav .nav > li > a:focus,
.main nav[data-toggle=toc] .nav .nav > li > a:hover,
.main nav[data-toggle=toc] .nav .nav > li > .active,
.main nav[data-toggle=toc] .nav .nav > li > .active:focus,
.main nav[data-toggle=toc] .nav .nav > li > .active:hover {
  padding-left: 0;
}
.main nav[data-toggle=toc] .nav-link.active:hover {
  padding-left: 0;
}

.main img {
  box-shadow: none;
  border-radius: 0;
  margin-bottom: 24px;
  margin-top: 10px;
  display: inline;
}

.main .note img {
  box-shadow: none;
  border-radius: 0;
  min-width: 40px;
  width: 40px;
  margin-bottom: 10px;
}

.main .imageblock img {
  height: auto;
}
.main p span.image {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  height: 16px;
  width: 20px;
  margin-left: 4px;
  margin-right: 4px;
}
.main p span.image img {
  height: 100%;
  width: 100%;
  margin-bottom: 0;
  margin-top: 0;
  box-shadow: none;
  object-fit: cover;
}

.main .listingblock, .literalblock > .content pre {
  padding: 8px 14px;
  background: #50576A;
  border-radius: 4px;
  margin-bottom: 24px;
  font-size: 14px;
  font-weight: 400;
  color: #CECECE;
}

pre.pygments {
  background: #50576A!important;
  margin-bottom: 0;
}

.main .listingblock  .tok-nt {
  color: #29A9C9;
}

.main .listingblock .tok-s {
  color: #E44C3A;
}

.main .listingblock  .tok-p {
  color: #F5FBFF;
}

.main ol {
  counter-reset: my-awesome-counter;
  list-style: none;
  color: #167BB7;
  margin-left: 20px;
  margin-bottom: 16px;
}

.main ol > li {
  position: relative;
  counter-increment: my-awesome-counter;
  font-weight: 600;
}

.main ol.arabic > li::before {
  content: counter(my-awesome-counter);
  position: absolute;
  top: -1px;
  left: -20px;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background-color: #E5E7EB;
  color: #6B7280;
  font-weight: 400;
  font-size: inherit;
}
.main ol > li::before {
}

.main ol.arabic:first-child p {
  color: #374151;
  margin-left: 10px;
  font-weight: 400;
}

.main .content-wrapper ul{
  color: #374151;
  list-style: disc;
  margin-left: 20px;
}

.main .content-wrapper ul > li ul {
  margin-left: 0;
  list-style-type: none;
}

.main .content-wrapper ul.nav-tabs{
  list-style: none;
}
.main ol ol {
  margin-left: 30px;
}
.main ol.loweralpha[type=a] > li {
  list-style-type: lower-alpha;
}
.main ol.lowerroman[type=i] > li {
  list-style-type: lower-roman;
}
.main ol li::marker {
  color: #6B7280;
}

.main h2, .main h3 {
  margin-bottom: 16px;
  padding-top: 24px;
}

.main h4 {
  margin-bottom: 16px;
  padding-top: 16px;
}

.content-wrapper h2 a, .content-wrapper h3 a, .content-wrapper h4 a {
  display: none;
  margin-left: 5px;
}

.content-wrapper h4 a svg {
  height: 14px;
  width: auto;
}

.content-wrapper h2:hover a, .content-wrapper h3:hover a, .content-wrapper h4:hover a {
  display: inline;
}

.breadcrumbs-wrapper {
  margin-bottom: 24px;
}
.breadcrumbs-list {
  display: flex;
  align-items: center;
}
.breadcrumbs-list li {
  display: flex;
  align-items: center;
}
.breadcrumbs-list li:not(:last-of-type):after {
  content: '/';
  margin-left: 6px;
  margin-right: 6px;
}
.breadcrumbs-list a {
  display: flex;
  align-items: center;
  letter-spacing: -0.025em;
  color: #374151;
}
.breadcrumbs-list a svg {
  width: 24px;
  height: 24px;
  margin-right: 4px;
}

.note table code {
  color: #374151;
}

.banner .absolute-figure {
  position: absolute;
}

.banner .absolute-figure.abstract-figure {
  right: 0;
}

.banner .absolute-figure.circle2 {
  right: 30%;
  top: 10%;
}

.banner .absolute-figure.circle3 {
  right: 15%;
  top: 10%;
}

.banner .absolute-figure.circle4 {
  left: 5%;
  top: 10%;
}

.banner .absolute-figure.circle5 {
  left: 30%;
}

.banner .absolute-figure.circle6 {
  left: 6%;
  bottom: 0;
}

.banner .absolute-figure.circle7 {
  left: 35%;
  bottom: 15%;
}

.banner .absolute-figure.circle8 {
  left: 55%;
  bottom: 0;
}

.banner .absolute-figure.circle9 {
  bottom: 0;
  right: 0;
}

.doclink {
  position: fixed;
  bottom: 0;
  padding: 0 15px 10px;
  background-color: #FBFDFF;
  z-index: 1000;
  font-size: 12px;
}

.btn-primary, .btn-primary:hover {
  background-color: #167BB7;
  border-color: #167BB7;
}

.card {
  height: 100%;
}
.card-wrapper .card-text {
  min-height: 80px;
  margin-bottom: 16px;
}

.card-wrapper .card-body {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 1rem 0.25rem;
}

pre.pygments .tok-c1 {
  color: #29A9C9!important;
}

@media screen and (max-width: 1520px) {
  .card-wrapper .card-text {
    min-height: 110px;
  }
}

.DocSearch.DocSearch-Button {
    margin-left: 0;
    width: 100%;
    height: 38px;
    padding: 0 15px;
    background-color: transparent;
    border: 1px solid #D1D5DB;
    box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
    border-radius: 6px;
    font-weight: 400;
    font-size: 14px;
    line-height: 20px;
    color: #6B7280;
}
.search-form-wrapper .DocSearch-Button-Keys {
  display: none;
}
.DocSearch-Hit-content-wrapper {
  overflow-x: inherit !important;
}
.search-form-wrapper .DocSearch-Button .DocSearch-Search-Icon {
  color: #9CA3AF;
  width: 16px;
  height: 16px;
}
.search-form-wrapper .DocSearch-Button-Placeholder {
  padding-left: 10px;
}
.oneline_with_image img {
    display: inline-block;
    height: 30px;
    margin: 0 10px;
}

.warning table td, .warning table,
.important table td, .important table {
  border: none;
}
.copy-icon {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  height: 40px;
  margin: -8px -14px 8px;
  padding: 0 16px;
  background-color: #3C4356;
  border-top-left-radius: 4px;
  border-top-right-radius: 4px;
}
.copy-icon svg {
  cursor: pointer;
}
.icon-tip {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 502 502' xml:space='preserve'%3E%3Cpath d='M230.523 78.722c-35.583-.342-69.221 13.48-94.756 38.802-25.528 25.316-39.587 58.839-39.587 94.396 0 34.708 13.278 67.567 37.387 92.524 24 24.844 37.216 57.409 37.216 91.697v70.281c0 5.523 4.477 10 10 10h12.756C197.871 491.185 211.53 502 227.676 502s29.805-10.815 34.138-25.578h16.166c5.523 0 10-4.477 10-10v-70.275c0-34.627 12.99-66.961 36.576-91.044 24.522-25.04 38.027-58.133 38.027-93.185 0-35.38-13.723-68.697-38.64-93.812-24.902-25.1-58.079-39.086-93.42-39.384zM227.676 482c-4.787 0-9.076-2.17-11.936-5.578h23.872c-2.86 3.408-7.149 5.578-11.936 5.578zm40.304-25.578h-77.197v-37.125h77.197v37.125zm42.287-165.313c-27.269 27.844-42.287 65.148-42.287 105.039v3.15h-77.197v-3.156c0-39.5-15.211-77-42.832-105.593-20.488-21.208-31.771-49.133-31.771-78.629 0-30.183 11.958-58.663 33.67-80.194 21.72-21.538 50.338-33.226 80.505-33.005 61.882.521 112.228 51.301 112.228 113.197 0 29.789-11.477 57.912-32.316 79.191zM229.381 55.584c5.523 0 10-4.477 10-10V10c0-5.523-4.477-10-10-10s-10 4.477-10 10v35.584c0 5.523 4.477 10 10 10zM85.246 29.896a9.988 9.988 0 0 0 8.099 4.123 9.96 9.96 0 0 0 5.87-1.91c4.468-3.247 5.458-9.5 2.212-13.968l-7.108-9.783C91.073 3.89 84.82 2.9 80.351 6.146c-4.468 3.247-5.458 9.5-2.212 13.968l7.107 9.782zM124.729 84.239a9.988 9.988 0 0 0 8.099 4.123 9.96 9.96 0 0 0 5.87-1.91c4.468-3.246 5.458-9.5 2.212-13.968l-19.113-26.308c-3.246-4.468-9.499-5.459-13.968-2.212-4.468 3.246-5.458 9.5-2.212 13.968l19.112 26.307zM37.031 160.15l33.843 10.996a10.01 10.01 0 0 0 3.092.492c4.215 0 8.136-2.687 9.509-6.913 1.707-5.253-1.168-10.894-6.42-12.601l-33.843-10.996c-5.251-1.705-10.894 1.168-12.601 6.42-1.707 5.254 1.167 10.895 6.42 12.602zM84.808 260.51c-1.707-5.253-7.346-8.126-12.601-6.42l-33.843 10.996c-5.252 1.707-8.127 7.348-6.42 12.601 1.373 4.226 5.293 6.913 9.509 6.913a10.01 10.01 0 0 0 3.092-.492l33.843-10.996c5.252-1.708 8.126-7.349 6.42-12.602zM102.626 391.668c-4.467-3.246-10.721-2.255-13.968 2.212l-8.903 12.253c-3.246 4.468-2.256 10.722 2.212 13.968a9.952 9.952 0 0 0 5.87 1.91 9.99 9.99 0 0 0 8.099-4.123l8.903-12.253c3.246-4.467 2.256-10.72-2.213-13.967z'/%3E%3Cpath d='M134.544 347.736c-4.468-3.246-10.722-2.255-13.968 2.212l-8.845 12.175c-3.246 4.468-2.255 10.722 2.212 13.968a9.952 9.952 0 0 0 5.87 1.91 9.99 9.99 0 0 0 8.099-4.123l8.845-12.175c3.246-4.467 2.255-10.721-2.213-13.967zM338.347 336.895c-3.246-4.468-9.499-5.459-13.968-2.212-4.468 3.247-5.458 9.5-2.212 13.968l20.916 28.789a9.988 9.988 0 0 0 8.099 4.123 9.96 9.96 0 0 0 5.87-1.91c4.468-3.247 5.458-9.5 2.212-13.968l-20.917-28.79zM426.045 260.984l-33.843-10.997c-5.252-1.705-10.894 1.168-12.601 6.42-1.707 5.252 1.168 10.894 6.42 12.601l33.843 10.997a10.01 10.01 0 0 0 3.092.492c4.215 0 8.136-2.687 9.509-6.913 1.707-5.251-1.167-10.893-6.42-12.6zM471.39 130.367c-1.706-5.252-7.347-8.127-12.601-6.42l-14.678 4.769c-5.252 1.707-8.127 7.348-6.42 12.601 1.373 4.226 5.293 6.913 9.509 6.913a10.01 10.01 0 0 0 3.092-.492l14.678-4.769c5.252-1.708 8.126-7.349 6.42-12.602zM387.777 167.536a10.01 10.01 0 0 0 3.092-.492l25.994-8.446c5.252-1.707 8.127-7.348 6.42-12.601-1.707-5.252-7.347-8.127-12.601-6.42l-25.994 8.446c-5.252 1.707-8.127 7.348-6.42 12.601 1.374 4.225 5.294 6.912 9.509 6.912zM320.89 83.916a9.952 9.952 0 0 0 5.87 1.91 9.99 9.99 0 0 0 8.099-4.123l20.916-28.789c3.246-4.468 2.255-10.722-2.212-13.968-4.469-3.246-10.722-2.255-13.968 2.212l-20.916 28.789c-3.248 4.469-2.257 10.722 2.211 13.969zM288.349 135.549c-11.289-8.76-24.609-14.981-38.521-17.992-5.395-1.169-10.721 2.26-11.889 7.659-1.168 5.398 2.261 10.721 7.659 11.889 11.007 2.382 21.55 7.308 30.491 14.245a9.954 9.954 0 0 0 6.124 2.1 9.981 9.981 0 0 0 7.907-3.87c3.385-4.363 2.592-10.645-1.771-14.031zM202.914 119.066c-41.096 11.729-69.797 49.799-69.797 92.579 0 5.523 4.477 10 10 10s10-4.477 10-10c0-33.895 22.735-64.056 55.287-73.346 5.311-1.516 8.387-7.05 6.872-12.361-1.518-5.31-7.052-8.388-12.362-6.872z'/%3E%3C/svg%3E");
  width: 42px;
  height: 42px;
  background-repeat: no-repeat;
  background-position: center;
}
.main table td.icon {
  text-align: center;
}
.icon-warning {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='554.2' height='554.199' xml:space='preserve' fill='%23E44C3A'%3E%3Cpath d='M538.5 386.199 356.5 70.8a91.803 91.803 0 0 0-79.501-45.9c-32.8 0-63.1 17.5-79.5 45.9L12.3 391.6a91.793 91.793 0 0 0 0 91.8c16.4 28.4 46.7 45.9 79.5 45.9H462.4c50.7 0 91.8-41.101 91.8-91.8 0-19-5.8-36.7-15.7-51.301zm-222.2 30.7c0 21.7-16.7 38.3-39.2 38.3s-39.2-16.6-39.2-38.3V416c0-21.601 16.7-38.301 39.2-38.301S316.3 394.3 316.3 416v.899zm.9-258.199-19.4 169.4c-1.3 12.2-9.4 19.8-20.7 19.8s-19.4-7.7-20.7-19.8L237 158.6c-1.3-13.1 5.801-23 18-23h44.1c12.2.1 19.4 10 18.1 23.1z'/%3E%3C/svg%3E%0A");
  width: 40px;
  height: 39px;
  background-size: 100%;
}
.icon-important {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cg transform='scale(.521)'%3E%3Ccircle cx='96' cy='96' r='74' fill='%23E44C3A'/%3E%3Cpath d='M86 48h20l-4 72H90z' fill='%23fff'/%3E%3Ccircle cx='96' cy='140' r='10' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E");
  width: 40px;
  height: 40px;
  background-size: 100%;
}
.main .admonitionblock.tip table,
.main .admonitionblock.tip table td {
  border: none;
}
/*Light box start*/

.lightbox-modal {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  background-color: #ebebeb;
  padding: 20px;
  transform: translate(-50%, -50%);
  z-index: 100;
  border-radius: 8px;
  max-width: 95vw;
  width: 100%;
  height: 90vh;
}
.lightbox-modal .img {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}
.lightbox-modal .img img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  margin: 0;
}
@media (max-width: 1023px) {
  .lightbox-modal {
    height: auto;
    max-width: 95vw;
  }
}
#close-ligtbox {
  position: absolute;
  right: -35px;
  top: -35px;
  display: block;
  width: 30px;
  font-size: 36px;
  border-radius: 8px;
  cursor: pointer;
  color: #fff;
}
@media (max-width: 1023px) {
  #close-ligtbox {
    right: 0;
    top: -40px;
    width: 24px;
    font-size: 28px;
  }
}
.overlay {
  display: none;
  position: fixed;
  background-color: rgba(0,0,0,.5);
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  z-index: 99;
}
.imageblock img, .paragraph .image img {
  cursor: pointer;
}
/*Light box end*/

.ulist {
  margin-left: 10px;
}
.main ol.arabic:first-child .ulist p,
.ulist ul li p {
  margin-left: 0!important;
}

.ulist li::marker {
  font-size: 20px;
  color: #6d7176;
}
.ulist li ul {
  list-style-type: none;
}
.ulist li ul li {
  position: relative;
  padding-left: 24px;
}
.ulist li ul li:before {
  content: '';
  position: absolute;
  left: 0;
  top: 9px;
  width: 8px;
  height: 8px;
  background-color: #E5E7EB;
  border: 1px solid #9CA3AF;
  border-radius: 100%;
}
.right-side-menu ul ul li:not(:last-child) {
  margin-bottom: 5px;
}
.imageblock .title {
  margin-bottom: 24px;
}
</style>
<style>pre.pygments .hll { background-color: #49483e }
pre.pygments { background: #272822; color: #f8f8f2 }
pre.pygments .tok-c { color: #75715e } /* Comment */
pre.pygments .tok-err { color: #960050; background-color: #1e0010 } /* Error */
pre.pygments .tok-k { color: #66d9ef } /* Keyword */
pre.pygments .tok-l { color: #ae81ff } /* Literal */
pre.pygments .tok-n { color: #f8f8f2 } /* Name */
pre.pygments .tok-o { color: #f92672 } /* Operator */
pre.pygments .tok-p { color: #f8f8f2 } /* Punctuation */
pre.pygments .tok-ch { color: #75715e } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #75715e } /* Comment.Multiline */
pre.pygments .tok-cp { color: #75715e } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #75715e } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #75715e } /* Comment.Single */
pre.pygments .tok-cs { color: #75715e } /* Comment.Special */
pre.pygments .tok-gd { color: #f92672 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gi { color: #a6e22e } /* Generic.Inserted */
pre.pygments .tok-go { color: #66d9ef } /* Generic.Output */
pre.pygments .tok-gp { color: #f92672; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #75715e } /* Generic.Subheading */
pre.pygments .tok-kc { color: #66d9ef } /* Keyword.Constant */
pre.pygments .tok-kd { color: #66d9ef } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #f92672 } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #66d9ef } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #66d9ef } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #66d9ef } /* Keyword.Type */
pre.pygments .tok-ld { color: #e6db74 } /* Literal.Date */
pre.pygments .tok-m { color: #ae81ff } /* Literal.Number */
pre.pygments .tok-s { color: #e6db74 } /* Literal.String */
pre.pygments .tok-na { color: #a6e22e } /* Name.Attribute */
pre.pygments .tok-nb { color: #f8f8f2 } /* Name.Builtin */
pre.pygments .tok-nc { color: #a6e22e } /* Name.Class */
pre.pygments .tok-no { color: #66d9ef } /* Name.Constant */
pre.pygments .tok-nd { color: #a6e22e } /* Name.Decorator */
pre.pygments .tok-ni { color: #f8f8f2 } /* Name.Entity */
pre.pygments .tok-ne { color: #a6e22e } /* Name.Exception */
pre.pygments .tok-nf { color: #a6e22e } /* Name.Function */
pre.pygments .tok-nl { color: #f8f8f2 } /* Name.Label */
pre.pygments .tok-nn { color: #f8f8f2 } /* Name.Namespace */
pre.pygments .tok-nx { color: #a6e22e } /* Name.Other */
pre.pygments .tok-py { color: #f8f8f2 } /* Name.Property */
pre.pygments .tok-nt { color: #f92672 } /* Name.Tag */
pre.pygments .tok-nv { color: #f8f8f2 } /* Name.Variable */
pre.pygments .tok-ow { color: #f92672 } /* Operator.Word */
pre.pygments .tok-w { color: #f8f8f2 } /* Text.Whitespace */
pre.pygments .tok-mb { color: #ae81ff } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #ae81ff } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #ae81ff } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #ae81ff } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #ae81ff } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #e6db74 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #e6db74 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #e6db74 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #e6db74 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #e6db74 } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #e6db74 } /* Literal.String.Double */
pre.pygments .tok-se { color: #ae81ff } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #e6db74 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #e6db74 } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #e6db74 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #e6db74 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #e6db74 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #e6db74 } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #a6e22e } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #f8f8f2 } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #f8f8f2 } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #f8f8f2 } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #f8f8f2 } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #ae81ff } /* Literal.Number.Integer.Long */</style></head><body data-spy="scroll" data-target="#toc" class="book"><header class="header"><div class="header-wrapper"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="header-logo"><div class="logo"><a href="https://docs.killbill.io"><img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/logo.png" style="height:41px" alt="KillBill Docs"></a></div></div><div class="header-search"><div class="search-form-wrapper"><div id="docsearch" style="height: 43px; display: flex; align-items: center; width: 100%;"></div></div></div></div></div></div></header><main class="main"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="sidebar-wrapper"><aside class="sidebar"><nav class="sidebar-nav"><ul class="nav navbar-nav"><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Getting Started</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li><a class="nav-link" href="/latest/what_is_kill_bill.html">What is Kill Bill?</a></li><li><a class="nav-link" href="/latest/getting_started.html">Getting Started (Installation)</a></li><li><a class="nav-link" href="/latest/quick_start_with_kaui.html">Quick Start with Kaui</a></li><li><a class="nav-link" href="/latest/quick_start_with_kb_api.html">Quick Start with the Kill Bill API</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Installation</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/stripe_plugin.html">Kill Bill + Stripe DIY</a></li><li><a class="nav-link" href="/latest/userguide_deployment.html">Going to Production</a></li><li><a class="nav-link" href="/latest/how-to-upgrade-the-database.html">Database Migrations</a></li><li><a class="nav-link" href="/latest/PostgreSQL.html">PostgreSQL Setup</a></li><li><a class="nav-link" href="https://github.com/killbill/killbill/releases" onclick="getOutboundLink('https://github.com/killbill/killbill/releases'); return false;">Release&nbsp;Notes</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">AWS</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/how-to-set-up-a-single-tier-system.html">Single-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-multi-tier-system.html">Multi-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-cloud-formation-system.html">CloudFormation Setup</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/how-to-maintain-a-single-tier-system.html">Single-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-multi-tier-system.html">Multi-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-cloud-formation-system.html">CloudFormation Maintenance</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Manuals</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/userguide_subscription.html">Subscription&nbsp;Billing</a></li><li><a class="nav-link" href="/latest/userguide_payment.html">Payment Processing</a></li><li><a class="nav-link" href="/latest/userguide_kaui.html">Kaui, the Administrative&nbsp;UI</a></li><li><a class="nav-link" href="/latest/email-notification-plugin.html">Email Notification Plugin</a></li><li><a class="nav-link" href="/latest/custom-email-invoice-formatter.html">Custom Email Formatter</a></li><li><a class="nav-link" href="/latest/userguide_analytics.html">Analytics Plugin</a></li><li><a class="nav-link" href="/latest/userguide_configuration.html">Kill Bill&nbsp;Configuration</a></li><li><a class="nav-link" href="/latest/internationalization.html">Kill Bill&nbsp;Internationalization</a></li><li><a class="nav-link" href="/latest/migration_guide.html">Migrating to Kill Bill</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Tutorials</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plan_alignment.html">Plans Alignments</a></li><li><a class="nav-link" href="/latest/overdue.html">Overdue System</a></li><li><a class="nav-link" href="/latest/consumable_in_arrear.html">In Arrear UsageBilling</a></li><li><a class="nav-link" href="/latest/ha.html">Hierarchical Accounts</a></li><li><a class="nav-link" href="/latest/catalog-examples.html">Catalog Examples</a></li><li><a class="nav-link" href="/latest/invoice_examples.html">Invoice Examples</a></li><li><a class="nav-link" href="/latest/invoice_templates.html">Invoice Templates</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Integration</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="http://killbill.github.io/slate" onclick="getOutboundLink('http://killbill.github.io/slate'); return false;">REST API Reference</a></li><li><a class="nav-link" href="/latest/swagger_documentation.html">Swagger UI Documentation</a></li><li><a class="nav-link" href="/latest/postman.html">Postman Integration</a></li><li><a class="nav-link" href="/latest/debugging.html">Debugging</a></li><li><a class="nav-link" href="/latest/push_notifications.html">Push Notifications</a></li><li><a class="nav-link" href="/latest/kill_bill_events.html">Kill Bill Events</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Plugin Development</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_introduction.html">Plugin Introduction</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_development.html">Plugin Development</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_installation.html">Plugin Installation</a></li><li><a class="nav-link" href="/latest/plugin_use_cases.html">Special Plugin Use Cases</a></li><li><a class="nav-link" href="/latest/notification_plugin.html">Notification Plugins</a></li><li><a class="nav-link" href="/latest/payment_plugin.html">Payment Plugins</a></li><li><a class="nav-link" href="/latest/payment_control_plugin.html">Payment Control Plugins</a></li><li><a class="nav-link" href="/latest/invoice_plugin.html">Invoice Plugins</a></li><li><a class="nav-link" href="/latest/catalog_plugin.html">Catalog Plugins</a></li><li><a class="nav-link" href="/latest/entitlement_plugin.html">Entitlement Plugins</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Operational Guides</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/deploy_to_kubernetes.html">Kubernetes (K8s) Deployment</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/user_management.html">Users, Roles, and Permissions</a></li><li><a class="nav-link" href="/latest/plugin_management.html">Plugin Management</a></li><li><a class="nav-link" href="/latest/aws-tools.html">AWS Analytics Tools</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Client Libraries</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/java_client.html">Java</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-ruby" onclick="getOutboundLink('http://github.com/killbill/killbill-client-ruby'); return false;">Ruby</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-php" onclick="getOutboundLink('http://github.com/killbill/killbill-client-php'); return false;">PHP</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-js" onclick="getOutboundLink('http://github.com/killbill/killbill-client-js'); return false;">Node.js</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-python" onclick="getOutboundLink('http://github.com/killbill/killbill-client-python'); return false;">Python</a></li><li><a class="nav-link" href="http://github.com/killbill/kbcli" onclick="getOutboundLink('http://github.com/killbill/kbcli'); return false;">Go</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">About Kill Bill</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/demo.html">Demo</a></li><li><a class="nav-link" href="/latest/features.html">Features List</a></li><li><a class="nav-link" href="/latest/faq.html">Technical FAQs</a></li><li><a class="nav-link" href="/latest/Kill-Bill-Glossary.html">Glossary</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Internal</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/internal_design.html">Internal Design</a></li><li><a class="nav-link" href="/latest/entitlement_subsystem.html">Entitlement Subsystem</a></li><li><a class="nav-link" href="/latest/invoice_subsystem.html">Invoice Subsystem</a></li><li><a class="nav-link" href="/latest/development.html">Development Environment</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">References</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="https://github.com/killbill/killbill-docs/tree/v3/swagger" onclick="getOutboundLink('https://github.com/killbill/killbill-docs/tree/v3/swagger'); return false;">Swagger&nbsp;API Schema</a></li><li><a class="nav-link" href="/latest/catalog.xsd">Catalog XSD Reference</a></li><li><a class="nav-link" href="/latest/overdue.xsd">Overdue XSD Reference</a></li></ul></li></ul><div class="sidebar-toggler"></div></nav><script src="https://code.jquery.com/jquery-3.6.1.min.js"></script><script>
  let $ = jQuery;
  $('.sidebar-nav .icon-title').on('click', function (e) {
    e.preventDefault();
    $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
    $('.sidebar-nav > .navbar-nav > li').removeClass('open');

    if($(this).next().is(':visible')){
      $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
      $('.sidebar-nav > .navbar-nav > li').removeClass('open');
    } else {
      $(this).parent().addClass('open');
      $(this).next().slideDown(200);
    }
  });

  let pageURL = $(location).attr("href");
  $('.nav-link').each(function() {
    if (pageURL.includes($(this).attr('href'))) {
      $(this).parent().addClass('list-item-active');
      $(this).parent().parent().addClass('active-list');
      $(this).parent().parent().prev().addClass('bd-link-active-wrap');
    }
  });
</script><a class="doclink" href="mailto:support@killbill.io">Report a doc problem</a></aside></div><div class="main-wrapper"><article class="content-wrapper"><div class="banner"><div class="bg-image"><svg class="absolute-figure circle1" width="41" height="38" viewBox="0 0 41 38" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="12.5" cy="10.5" rx="28.5" ry="27.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle2" width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="10" cy="9.5" rx="10" ry="9.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle3" width="97" height="97" viewBox="0 0 97 97" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="48.5" cy="48.5" r="48.5" fill="white" fill-opacity="0.4"/>
</svg>
<svg class="absolute-figure circle4" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="7" cy="7" r="7" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle5" width="65" height="23" viewBox="0 0 65 23" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="32.5" cy="-9.5" r="32.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle6" width="48" height="31" viewBox="0 0 48 31" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="24" cy="24" r="24" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle7" width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="10" cy="9.5" rx="10" ry="9.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle8" width="20" height="10" viewBox="0 0 20 10" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="10" cy="9.5" rx="10" ry="9.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle9" width="49" height="48" viewBox="0 0 49 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="48.5" cy="48.5" r="48.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure abstract-figure" width="703" height="174" viewBox="0 0 703 174" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M25.5 246C-96 87.7673 245.949 67.3215 475.548 64.1799C705.146 61.0384 565.01 -188.501 629.653 -188.741C694.297 -188.982 766.062 221.014 766.062 221.014L297.072 460.733C297.072 460.733 147 404.233 25.5 246Z" fill="white" fill-opacity="0.2"/>
</svg></div><h1>Kill Bill Analytics Guide</h1></div><div id="content"><div id="preamble"><div class="sectionbody"><div class="paragraph"><p>The <a href="https://github.com/killbill/killbill-analytics-plugin">Kill Bill analytics plugin</a> provides business analytics and reporting capabilities. You can use this plugin to create reports and view them via Kaui. Not only that, it allows creating reports against external databases as well. This document explains how to install and use this plugin.</p></div></div></div>
<div class="sect1"><h2 id="_prerequisites">Prerequisites</h2><div class="sectionbody"><div class="ulist"><ul><li><p>Ensure that you have Kill Bill, Kaui, and the database set up as explained in the <a href="https://docs.killbill.io/latest/getting_started.html">Getting Started Guide</a>.</p></li><li><p>Ensure that you have <a href="https://curl.haxx.se/">cURL</a> installed. If you are on Windows, we recommend that you use <a href="https://git-scm.com/download/win">Git Bash</a> to run the <code>cURL</code> commands.</p></li></ul></div></div></div>
<div class="sect1"><h2 id="components-analytics-overview">Analytics Plugin Internals</h2><div class="sectionbody"><div class="paragraph"><p>Kill Bill maintains a separate <a href="#analytics_tables">reporting database</a> for analytics purposes. The tables in this database are meant to be used as building blocks for reports. Unlike other tables in the system, this set of tables is stable and potentially changes only between major revisions of Kill Bill. This database is kept current in realtime.</p></div>
<div class="paragraph"><p>The <a href="https://github.com/killbill/killbill-analytics-plugin">analytics plugin</a> is a <a href="https://docs.killbill.io/latest/notification_plugin.html">notification plugin</a>. It listens to <a href="https://docs.killbill.io/latest/kill_bill_events.html">events</a> generated by Kill Bill when any system change occurs and rebuilds the analytics tables upon receipt of events. So, for example, if a new account is created, Kill Bill triggers an <code>ACCOUNT_CREATION</code> event. The analytics plugin listens to this event and on receipt updates the analytics tables based on the Kill Bill tables.</p></div></div></div>
<div class="sect1"><h2 id="_plugin_installation">Plugin Installation</h2><div class="sectionbody"><div class="paragraph"><p>A plugin can be installed either via <a href="https://docs.killbill.io/latest/userguide_kaui.html"><em>Kaui</em></a> or <a href="https://github.com/killbill/killbill-cloud/blob/master/kpm"><em>KPM</em></a>. In order to install a plugin via Kaui, please refer to the <a href="https://docs.killbill.io/latest/plugin_installation.html#_installing_via_kaui"><em>Plugin Installation Instructions</em></a> document. In order to install a plugin via kpm, you may follow the steps given below:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Ensure that you have kpm installed as explained <a href="https://github.com/killbill/killbill-cloud/tree/master/kpm#kpm-installation">here</a>.</p></li><li><p>Install the plugin using the following <code>kpm</code> command (Replace <code>&lt;path_to_install_plugin&gt;</code> with the path where you want to install the plugin. This path should match the path specified by the <code>org.killbill.osgi.bundle.install.dir</code> property in the  <a href="https://docs.killbill.io/latest/userguide_configuration.html#_configuration_properties_table"><em>Kill Bill Configuration</em></a>):</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>kpm install_java_plugin analytics --destination<span class="tok-o">=</span>&lt;path_to_install_plugin&gt;</code></pre></div></div></li><li><p>Verify that the plugin is installed properly. This can be done by ensuring that the plugin JAR is present at the <code>path_to_install_plugin</code> specified in the previous step. Alternatively, you can also open <a href="https://docs.killbill.io/latest/userguide_kaui.html">Kaui</a>, hover over the plug icon and click on <code>analytics</code>. This should display the following screen:</p></li></ol></div>
<div style="text-align: center;" class="imageblock"><div class="content"><img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/analytics-plugin/analytics-plugin-in-kaui.png" alt="analytics plugin in kaui"></div></div>
<div class="olist arabic"><ol class="arabic"><li><p>If you would like to make changes to the plugin, you can clone the plugin code, build and deploy it as explained <a href="https://github.com/killbill/killbill-analytics-plugin">here</a>.</p></li></ol></div></div></div>
<div class="sect1"><h2 id="_database_configuration">Database Configuration</h2><div class="sectionbody"><div class="paragraph"><p>As mentioned earlier, the analytics plugin uses its own reporting tables. To create these tables, please follow the steps given below:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Connect to the Kill Bill database.</p></li><li><p>Run the analytics plugin <a href="https://github.com/killbill/killbill-analytics-plugin/blob/0a25c18c3951b663e4d1ebf81619f325175209cf/src/main/resources/org/killbill/billing/plugin/analytics/ddl.sql">DDL</a>.</p></li></ol></div>
<div class="paragraph"><p>The <a href="#analytics_tables">"Analytics Tables"</a> section provides an overview of some of the important tables in the analytics database.</p></div></div></div>
<div class="sect1"><h2 id="_plugin_configuration">Plugin Configuration</h2><div class="sectionbody"><div class="paragraph"><p>You can configure the following properties related to the analytics plugin in the <a href="https://docs.killbill.io/latest/userguide_configuration.html#global_configuration_properties">Kill Bill Configuration File</a>:</p></div>
<table class="tableblock frame-all grid-all spread"><colgroup><col style="width: 33.3333%;"><col style="width: 33.3333%;"><col style="width: 33.3334%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Property Name</th><th class="tableblock halign-left valign-top">Description</th><th class="tableblock halign-left valign-top">Default Value</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.killbill.notificationq.analytics.tableName</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the notification queue table</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">notifications (Same as Kill Bill notification queue table)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.killbill.notificationq.analytics.historyTableName</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the notification queue history table</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">notifications_history (Same as Kill Bill notification queue history table)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.killbill.analytics.lockSleepMilliSeconds</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">How long to sleep between retries to get the lock. See <a href="#lock_notes">lock notes</a>.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.killbill.billing.plugin.analytics.referenceCurrency</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The reference currency. See  <a href="#currency_conversion">Currency Conversion</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">USD</p></td></tr></tbody></table>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><strong>Note:</strong>
All the properties specified above are optional and the analytics plugin uses suitable defaults in case they are not specified. We however encourage you use different notification queue tables by specifying the <code>org.killbill.notificationq.analytics.tableName</code> and <code>org.killbill.notificationq.analytics.historyTableName</code> properties.</td></tr></table></div>
<div class="paragraph"><p>In addition, the analytics plugin also allows some optional  <a href="https://docs.killbill.io/latest/userguide_configuration.html#_per_tenant_properties">tenant level</a> configuration. This can be done by executing the following API endpoint via <code>cURL</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -X POST <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiKey: bob&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-CreatedBy: admin&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;Content-Type: text/plain&#39;</span> <span class="tok-se">\</span>
     -d <span class="tok-s1">&#39;!!org.killbill.billing.plugin.analytics.api.core.AnalyticsConfiguration</span>
<span class="tok-s1">  refreshDelaySeconds: 10</span>
<span class="tok-s1">  lockAttemptRetries: 100</span>
<span class="tok-s1">  rescheduleIntervalOnLockSeconds: 10</span>
<span class="tok-s1">  enablePartialRefreshes: true</span>
<span class="tok-s1">  enableTemplateVariables:false</span>
<span class="tok-s1">  blacklist:</span>
<span class="tok-s1">    - 468e5259-6635-4988-9ae7-3d79b11fc6ed</span>
<span class="tok-s1">    - f7da09af-8593-4a88-b6d4-1c4ebf807103</span>
<span class="tok-s1">  highCardinalityAccounts:</span>
<span class="tok-s1">    - a8e594e5-1b78-4c2d-876b-f09ec36c611c</span>
<span class="tok-s1">    - 31ea22c7-19ae-4316-a432-5e6319e49f97</span>
<span class="tok-s1">  ignoredGroups:</span>
<span class="tok-s1">    - FIELDS</span>
<span class="tok-s1">  pluginPropertyKeys:</span>
<span class="tok-s1">    killbill-stripe:</span>
<span class="tok-s1">      1: processorResponse</span>
<span class="tok-s1">      2: avsResultCode</span>
<span class="tok-s1">      3: cvvResultCode</span>
<span class="tok-s1">  databases:</span>
<span class="tok-s1">    warehouse:</span>
<span class="tok-s1">      type: trino</span>
<span class="tok-s1">      url: jdbc:trino://example.net:8080/hive/sales?user=admin&#39;</span> <span class="tok-se">\</span>
    http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginConfig/killbill-analytics</code></pre></div></div>
<div class="paragraph"><p>This configures the following:</p></div>
<table class="tableblock frame-all grid-all spread"><colgroup><col style="width: 33.3333%;"><col style="width: 33.3333%;"><col style="width: 33.3334%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Property Name</th><th class="tableblock halign-left valign-top">Description</th><th class="tableblock halign-left valign-top">Default Value</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">refreshDelaySeconds</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The delay in seconds, before starting to refresh analytics tables after an event is received. For workflows with lots of successive events (e.g. create account, add payment method, create payment), this makes sure that the latest state is available when starting the refresh.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">lockAttemptRetries</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The number of retries to get the lock. See <a href="#lock_notes">lock notes</a>.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">rescheduleIntervalOnLockSeconds</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The duration in seconds after which the refresh job should be scheduled in case the lock is not available. See <a href="#lock_notes">lock notes</a>.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">enablePartialRefreshes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Whether partial refreshes are allowed. If true, the plugin refreshes only a subset of the analytics tables based on the received event. If false, all the analytics tables are updated. When configured, some features are disabled, namely: <code>analytics_bundles.bundle_account_rank</code> cannot be computed</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">enableTemplateVariables</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Whether template variables should be allowed in raw SQL queries while creating reports based on SQL queries. Note that this could be prone to SQL injection and should only be enabled in trusted environments.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">blacklist</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">A list of account IDs to ignore.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">highCardinalityAccounts</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">A list of account IDs with a high cardinality (account with 100k+ subscriptions). This is a performance hint to the plugin and tells the plugin to look up individual subscription rows instead of querying everything based on <code>account_record_id</code>. When configured, some features are disabled, namely: <code>analytics_accounts.nb_active_bundles</code> is not computed for that account</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">ignoredGroups</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">A list of <a href="https://github.com/killbill/killbill-analytics-plugin/blob/59c282f97960dc59b944ca33e17353bc19d7c842/src/main/java/org/killbill/billing/plugin/analytics/AnalyticsJobHierarchy.java#L59">groups</a> that should be ignored for refresh. Possible values are <code>FIELDS</code>, <code>INVOICES</code>, <code>INVOICE_AND_PAYMENTS</code>,<code>OVERDUE</code>, <code>OTHER</code>, <code>SUBSCRIPTIONS</code>, <code>ALL</code>. Thus, database tables corresponding to these groups will be ignored while performing a refresh.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">pluginPropertyKeys</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">A payment plugin name and plugin properties related to the payment plugin to be stored into the analytics tables. So, if a payment plugin populates these values, these are fetched and stored in the <code>analytics_payment_auths</code> table.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">1:processorResponse,
                                                                                  2:avsResultCode,                                                                                                3:cvvResultCode,                                                                                               4:payment_processor_account_id                                                                                                 5:paymentMethod</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">databases<a></a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the database configuration for external (remote) databases against which reports can be created. The database <code>type</code> and <code>url</code> needs to be specified as part of the database configuration. The analytics plugin currently only supports <code>trino</code> databases. See the <a href="#advanced_report_creation_options">"Advanced Report Creation Options"</a> section.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td></tr></tbody></table>
<div class="paragraph" id="lock_notes"><p><strong>Lock Notes</strong>: Some critical operations in Kill Bill use a <a href="https://github.com/killbill/killbill-commons/tree/master/locker">database-based global lock</a> to ensure a single Kill Bill node performs a given operation at a time. Bumping the <code>lockSleepMilliSeconds</code> parameter could help if these critical operations (refresh) take a long time. By default, if a refresh is in progress (i.e. lock is taken) and another node tries to refresh the same account, it will attempt <code>lockAttemptRetries</code> times to grab the lock, sleeping <code>lockSleepMilliSeconds</code> in between retries, before giving up. If the lock is taken and <code>rescheduleIntervalOnLockSeconds</code> is configured, it will reschedule itself <code>rescheduleIntervalOnLockSeconds</code> in the future, before trying the above algorithm.</p></div></div></div>
<div class="sect1"><h2 id="_reports">Reports</h2><div class="sectionbody"><div class="paragraph"><p>Once the plugin is installed and configured, you can access it via Kaui. By default, the analytics plugin does not display any reports. You can either <a href="#installing_canned_reports">install our canned reports</a> or <a href="#create_custom_reports">create your own custom reports</a>. Custom reports can be created by specifying a table/view in the local database or by specifying an SQL query to be executed on a remote database. Depending on the <a href="#report_types">report type</a>, the database table/view/SQL query needs to include certain columns.</p></div>
<div class="sect2"><h3 id="report_types">Report Types</h3><div class="paragraph"><p>The analytics plugin supports three types of reports as explained below:</p></div>
<div class="ulist"><ul><li><p><strong>COUNTERS</strong>: Such reports are displayed as <strong>pie charts</strong>.</p><div class="ulist"><ul><li><p><strong>Local</strong>: For a report based on a local database, the columns <code>tenant_record_id</code>, <code>label</code>, and <code>count</code> are mandatory.</p></li><li><p><strong>Remote</strong>: For a report based on a remote database, only the columns <code>label</code>, and <code>count</code> are mandatory. You can optionally specify the placeholder <code>TENANT_RECORD_ID</code> in the query which will be replaced by the <code>tenantRecordId</code> from the Kill Bill database before the query is executed.</p></li></ul></div></li><li><p><strong>TIMELINE</strong>: Such reports are displayed as <strong>line charts</strong>.</p><div class="ulist"><ul><li><p><strong>Local</strong>: For a report based on a local database, the columns <code>day</code> (or <code>ts</code>) and <code>tenant_record_id</code> are mandatory.</p></li><li><p><strong>Remote</strong>:  For a report based on a remote database, the column <code>day</code> (or <code>ts</code>) is mandatory. You can optionally specify the placeholders <code>TENANT_RECORD_ID</code>, <code>START_DATE</code>, and <code>END_DATE</code> in the query which will be replaced by the <code>tenantRecordId</code> from the Kill Bill database and dates specified by a user before the query is executed.</p></li></ul></div></li><li><p><strong>TABLE</strong>: This is used for rendering underlying table data.</p><div class="ulist"><ul><li><p><strong>Local</strong>: For a report based on a local database, the <code>tenant_record_id</code> column is mandatory.</p></li><li><p><strong>Remote</strong>:  For a report based on a remote database, there are no mandatory columns. You can optionally specify the placeholder <code>TENANT_RECORD_ID</code> in the query which will be replaced by the <code>tenantRecordId</code> from the Kill Bill database before the query is executed.</p></li></ul></div></li></ul></div></div>
<div class="sect2"><h3 id="installing_canned_reports">Installing Canned Reports</h3><div class="paragraph"><p>As explained earlier, we provide a set of canned reports that can be useful as a starting point. On non-Windows machines, these can be installed by running the <a href="https://github.com/killbill/killbill-analytics-plugin/blob/59c282f97960dc59b944ca33e17353bc19d7c842/src/main/resources/seed_reports.sh">seed_reports.sh</a> script. On Windows machines, you can install a report by opening the desired report sub-directory from the <a href="https://github.com/killbill/killbill-analytics-plugin/tree/master/src/main/resources/reports">reports</a> directory and creating the <em>view</em>, <em>stored procedure</em> and <em>report</em> as explained in the next section.</p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><strong>Note:</strong> The default views will use the converted amount columns when applicable, which require the <code>analytics_currency_conversion</code> table to be populated with currency conversion rates as explained in the <a href="#currency_conversion">"Currency Conversion"</a> section. If you are only using one currency, use the non-converted columns instead (<code>next_mrr</code> instead of <code>converted_next_mrr</code> for example).</td></tr></table></div></div>
<div class="sect2"><h3 id="create_custom_reports">Creating Custom Reports</h3><div class="paragraph"><p>As mentioned earlier, the analytics plugin allows creating custom reports as per your requirements. A custom report can be created by executing API endpoints or via Kaui.</p></div>
<div class="paragraph"><p>In order to create a custom report via Kaui, hover over the plug icon and click on <strong>"Analytics"</strong>. This displays existing reports if any and also allows creating a new report by clicking on <strong>"Available Reports"</strong>.</p></div>
<div class="paragraph"><p>The rest of this section covers report creation via API endpoint execution.</p></div>
<div class="paragraph"><p>There are basically three steps in creating a report:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create a table/view corresponding to the report.</p><div class="paragraph"><p>Suppose you want to view the number of accounts created per day. This is typically a <a href="#timeline">timeline</a> report and needs to include the <code>tenant_record_id</code> and <code>day</code> columns.</p></div>
<div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Identify the SQL query corresponding to the report:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="sql"><span></span><span class="tok-k">select</span>
  <span class="tok-n">tenant_record_id</span>
<span class="tok-p">,</span> <span class="tok-n">date_format</span><span class="tok-p">(</span><span class="tok-n">created_date</span><span class="tok-p">,</span> <span class="tok-s1">&#39;%Y-%m-%d&#39;</span><span class="tok-p">)</span> <span class="tok-k">as</span> <span class="tok-k">day</span>
<span class="tok-p">,</span> <span class="tok-k">count</span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-p">)</span> <span class="tok-k">as</span> <span class="tok-k">count</span>
<span class="tok-k">from</span> <span class="tok-n">analytics_accounts</span>
<span class="tok-k">where</span> <span class="tok-n">report_group</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;default&#39;</span>
<span class="tok-k">group</span> <span class="tok-k">by</span> <span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span>
<span class="tok-k">order</span> <span class="tok-k">by</span> <span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span> <span class="tok-k">asc</span>
<span class="tok-p">;</span></code></pre></div></div></li><li><p>Create a view corresponding to this query as follows:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="sql"><span></span><span class="tok-k">create</span> <span class="tok-k">or</span> <span class="tok-k">replace</span> <span class="tok-k">view</span> <span class="tok-n">v_new_accounts_per_day</span> <span class="tok-k">as</span>
<span class="tok-k">select</span>
  <span class="tok-n">tenant_record_id</span>
<span class="tok-p">,</span> <span class="tok-n">date_format</span><span class="tok-p">(</span><span class="tok-n">created_date</span><span class="tok-p">,</span> <span class="tok-s1">&#39;%Y-%m-%d&#39;</span><span class="tok-p">)</span> <span class="tok-k">as</span> <span class="tok-k">day</span>
<span class="tok-p">,</span> <span class="tok-k">count</span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-p">)</span> <span class="tok-k">as</span> <span class="tok-k">count</span>
<span class="tok-k">from</span> <span class="tok-n">analytics_accounts</span>
<span class="tok-k">where</span> <span class="tok-n">report_group</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;default&#39;</span>
<span class="tok-k">group</span> <span class="tok-k">by</span> <span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span>
<span class="tok-k">order</span> <span class="tok-k">by</span> <span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span> <span class="tok-k">asc</span>
<span class="tok-p">;</span></code></pre></div></div></li></ol></div></li><li><p>Create the actual report.</p><div class="paragraph"><p>You can then create the actual report by executing the following endpoint:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -X POST <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey:bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret:lazar&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;Content-Type: application/json&#39;</span> <span class="tok-se">\</span>
     -d <span class="tok-s1">&#39;{&quot;reportName&quot;: &quot;new_accounts_per_day&quot;,</span>
<span class="tok-s1">          &quot;reportPrettyName&quot;: &quot;New accounts created (per day)&quot;,</span>
<span class="tok-s1">          &quot;sourceTableName&quot;: &quot;v_new_accounts_per_day&quot;}&#39;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/reports&quot;</span></code></pre></div></div>
<div class="paragraph"><p>This creates a report called <code>new_accounts_per_day</code> based on the <code>v_new_accounts_per_day</code> view. Refer to the <a href="#_report_creation_options">"Report Creation Options"</a> section for a description of all the fields.</p></div>
<div class="paragraph"><p>Alternatively, you can directly specify an SQL query (instead of creating a view) while creating the report. Refer to the <a href="#advanced_report_creation_options">"Advanced Report Creation"</a> section for further information.</p></div></li><li><p>Create a stored procedure for the report.</p><div class="paragraph"><p>This is an optional step and should be followed for expensive view queries.</p></div>
<div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Create a stored procedure that populates a table from the view as follows:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="sql"><span></span><span class="tok-k">create</span> <span class="tok-k">table</span> <span class="tok-n">new_accounts_per_day</span> <span class="tok-k">as</span> <span class="tok-k">select</span> <span class="tok-o">*</span> <span class="tok-k">from</span> <span class="tok-n">v_new_accounts_per_day</span> <span class="tok-k">limit</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

<span class="tok-k">drop</span> <span class="tok-k">procedure</span> <span class="tok-k">if</span> <span class="tok-k">exists</span> <span class="tok-n">refresh_new_accounts_per_day</span><span class="tok-p">;</span>
<span class="tok-k">DELIMITER</span> <span class="tok-o">//</span>
<span class="tok-k">CREATE</span> <span class="tok-k">PROCEDURE</span> <span class="tok-n">refresh_new_accounts_per_day</span><span class="tok-p">()</span>
<span class="tok-k">BEGIN</span>
<span class="tok-k">delete</span> <span class="tok-k">from</span> <span class="tok-n">new_accounts_per_day</span><span class="tok-p">;</span>
<span class="tok-k">insert</span> <span class="tok-k">into</span> <span class="tok-n">new_accounts_per_day</span> <span class="tok-k">select</span> <span class="tok-o">*</span> <span class="tok-k">from</span> <span class="tok-n">v_new_accounts_per_day</span><span class="tok-p">;</span>
<span class="tok-k">END</span><span class="tok-p">;</span>
<span class="tok-o">//</span>
<span class="tok-k">DELIMITER</span> <span class="tok-p">;</span></code></pre></div></div>
<div class="paragraph"><p>This creates a table called <code>new_accounts_per_day</code> and a stored procedure called <code>refresh_new_accounts_per_day</code> which populates the <code>new_accounts_per_day</code> table from the <code>v_new_accounts_per_day</code> view.</p></div></li><li><p>Create your report using the table name from the previous step and a refresh schedule as follows:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -X POST <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey:bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret:lazar&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;Content-Type: application/json&#39;</span> <span class="tok-se">\</span>
     -d <span class="tok-s1">&#39;{&quot;reportName&quot;: &quot;new_accounts_per_day&quot;,</span>
<span class="tok-s1">          &quot;reportPrettyName&quot;: &quot;New accounts created (per day)&quot;,</span>
<span class="tok-s1">          &quot;sourceTableName&quot;: &quot;new_accounts_per_day&quot;,</span>
<span class="tok-s1">          &quot;refreshProcedureName&quot;: &quot;refresh_new_accounts_per_day&quot;,</span>
<span class="tok-s1">          &quot;refreshFrequency&quot;: &quot;DAILY&quot;,</span>
<span class="tok-s1">          &quot;refreshHourOfDayGmt&quot;: 4}&#39;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/reports&quot;</span></code></pre></div></div>
<div class="paragraph"><p>This creates a report called <code>new_accounts_per_day</code> based on the <code>new_accounts_per_day</code> table. The <code>refresh_new_accounts_per_day</code> stored procedure refreshes the table from the view. It runs everyday at 4 AM GMT. Refer to the <a href="#_report_creation_options">"Report Creation Options"</a> section for a description of all the fields.</p></div>
<div class="paragraph"><p>You can alternatively create the report with a different refresh schedule as follows:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -X POST <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey:bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret:lazar&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;Content-Type: application/json&#39;</span> <span class="tok-se">\</span>
     -d <span class="tok-s1">&#39;{&quot;reportName&quot;: &quot;new_accounts_per_day&quot;,</span>
<span class="tok-s1">          &quot;reportPrettyName&quot;: &quot;New accounts created (per day)&quot;,</span>
<span class="tok-s1">          &quot;sourceTableName&quot;: &quot;new_accounts_per_day&quot;,</span>
<span class="tok-s1">          &quot;refreshProcedureName&quot;: &quot;refresh_new_accounts_per_day&quot;,</span>
<span class="tok-s1">          &quot;refreshFrequency&quot;: &quot;HOURLY&quot;}&#39;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/reports&quot;</span></code></pre></div></div>
<div class="paragraph"><p>This specifies that the stored procedure should run on an hourly basis (it will run at 5' past the hour).</p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><strong>Note:</strong> When configuring refreshes via stored procedures, it is recommended to bump the connection timeout using the <code>org.killbill.billing.osgi.dao.connectionTimeout</code>. See <a href="https://docs.killbill.io/latest/userguide_configuration.html#configuration_properties_table">Kill Bill Configuration Guide</a> for further information.</td></tr></table></div></li></ol></div></li></ol></div></div>
<div class="sect2"><h3 id="advanced_report_creation_options">Advanced Report Creation</h3><div class="paragraph"><p>You can create a report based on SQL executed on a remote database (<code>warehouse</code>) as follows:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -X POST <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey:bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret:lazar&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;Content-Type: application/json&#39;</span> <span class="tok-se">\</span>
     -d <span class="tok-s1">&#39;{&quot;reportName&quot;: &quot;report_historical_orders&quot;,</span>
<span class="tok-s1">          &quot;reportType&quot;: &quot;TABLE&quot;,</span>
<span class="tok-s1">          &quot;reportPrettyName&quot;: &quot;Historical orders&quot;,</span>
<span class="tok-s1">          &quot;sourceName&quot;: &quot;warehouse&quot;,</span>
<span class="tok-s1">          &quot;sourceQuery&quot;: &quot;select * from warehouse.public.orders&quot;}&#39;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/reports&quot;</span></code></pre></div></div>
<div class="paragraph"><p>This creates a report called <code>report_historical_orders</code> based on a remote database (<code>warehouse</code>). It executes the specified SQL query. Refer to the <a href="#_report_creation_options">"Report Creation Options"</a> section for a description of all the fields.</p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><strong>Note:</strong> In order to create a report based on a remote database, the database first needs to be configured at a tenant level as explained in the <a href="#remote_database_configuration">"Plugin Configuration"</a> section.</td></tr></table></div>
<div class="paragraph"><p>The above <code>cURL</code> command can also be used to create a report based on a local database by directly specifying an SQL query (instead of a table/view).</p></div></div>
<div class="sect2"><h3 id="_report_creation_options">Report Creation Options</h3><div class="paragraph"><p>The following table lists all the report creation options. A subset of these options need to be specified while <a href="#create_custom_reports">creating the report</a>, depending on the report being created.</p></div>
<table class="tableblock frame-all grid-all spread"><colgroup><col style="width: 50%;"><col style="width: 50%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Field Name</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">reportName</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Unique identifier for your report.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">reportPrettyName</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Description, that will be used in Kaui.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">reportType</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Type of report. Possible values are <code>COUNTERS</code>, <code>TIMELINE</code>, <code>TABLE</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sourceTableName</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Name of the source table/view.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sourceName</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Name of the remote database.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sourceQuery</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">SQL query to be executed.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">refreshProcedureName</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Name of the stored procedure.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">refreshFrequency</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Frequency with which the refresh. procedure will be executed. Possible values are <code>HOURLY</code> and <code>DAILY</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">refreshHourOfDayGmt</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Hour of the day when the procedure will be executed.</p></td></tr></tbody></table></div>
<div class="sect2"><h3 id="_other_report_operations">Other Report Operations</h3><div class="paragraph"><p>Once a report is created, you can perform several operations on it as explained below.</p></div>
<div class="sect3"><h4 id="_retrieve_report_configuration">Retrieve Report Configuration</h4><div class="paragraph"><p>You can retrieve a report configuration by specifying the report name:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey:bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret:lazar&quot;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/reports/new_accounts_per_day&quot;</span></code></pre></div></div>
<div class="paragraph"><p>This returns the report configuration (<code>reportName</code>, <code>reportPrettyName</code>, etc. fields) for the <code>new_accounts_per_day</code> report.</p></div></div>
<div class="sect3"><h4 id="_update_a_report">Update a Report</h4><div class="paragraph"><p>You can update a report (edit all fields except <code>reportName</code>):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -X PUT <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey:bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret:lazar&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;Content-Type: application/json&#39;</span> <span class="tok-se">\</span>
     -d <span class="tok-s1">&#39;{&quot;reportPrettyName&quot;: &quot;New accounts created (refreshed at 2am GMT)&quot;,</span>
<span class="tok-s1">          &quot;refreshFrequency&quot;: &quot;DAILY&quot;,</span>
<span class="tok-s1">          &quot;refreshHourOfDayGmt&quot;: 2}&#39;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/reports/new_accounts_per_day&quot;</span></code></pre></div></div>
<div class="paragraph"><p>This updates the <code>reportPrettyName</code>, <code>refreshFrequency</code> and <code>refreshHourOfDayGmt</code> fields for the <code>new_accounts_per_day</code> report.</p></div></div>
<div class="sect3"><h4 id="_delete_a_report">Delete a Report</h4><div class="paragraph"><p>You can delete a report by specifying the report name:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -X DELETE <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey:bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret:lazar&quot;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/reports/new_accounts_per_day&quot;</span></code></pre></div></div>
<div class="paragraph"><p>This deletes the <code>new_accounts_per_day</code> report.</p></div></div>
<div class="sect3"><h4 id="_download_report_data">Download Report Data</h4><div class="paragraph"><p>You can download the data behind your report as <code>csv</code> or <code>json</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey:bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret:lazar&quot;</span> <span class="tok-se">\</span>
     <span class="tok-s1">&#39;http://127.0.0.1:8080/plugins/killbill-analytics/reports?name=new_accounts_per_day&amp;format=csv&#39;</span></code></pre></div></div>
<div class="paragraph"><p>This returns the data behind the <code>new_accounts_per_day</code> report in <code>csv</code> format.</p></div></div>
<div class="sect3"><h4 id="_retrieve_report_sql_query">Retrieve Report SQL Query</h4><div class="paragraph"><p>You can retrieve the SQL query corresponding to your report:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey:bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret:lazar&quot;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/reports?name=report_accounts_summary&amp;startDate=2018-01-01&amp;endDate=2022-01-01&amp;sqlOnly=true&quot;</span></code></pre></div></div>
<div class="paragraph"><p>This returns the SQL query corresponding to the <code>report_accounts_summary</code> report.</p></div></div>
<div class="sect3"><h4 id="_refresh_a_report">Refresh a Report</h4><div class="paragraph"><p>You can refresh a report:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -X PUT <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey:bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret:lazar&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;Content-Type: application/json&#39;</span> <span class="tok-se">\</span>
<span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/reports/new_accounts_per_day?shouldRefresh=true&quot;</span></code></pre></div></div>
<div class="paragraph"><p>This refreshes the table/view corresponding to the <code>new_accounts_per_day</code> report.</p></div></div></div></div></div>
<div class="sect1"><h2 id="_data_api">Data API</h2><div class="sectionbody"><div class="paragraph"><p>The analytics plugin provides a Data API that supports some account level operations as explained below.</p></div>
<div class="sect2"><h3 id="_retrieve_analytics_data_for_account">Retrieve Analytics Data for Account</h3><div class="paragraph"><p>You can retrieve all analytics data for an account as follows:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey:bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret:lazar&quot;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/&lt;account_id&gt;&quot;</span></code></pre></div></div>
<div class="paragraph"><p>This returns the data from the analytics tables for the specified <code>account_id</code>.</p></div></div>
<div class="sect2"><h3 id="_refresh_an_account">Refresh an Account</h3><div class="paragraph"><p>You can force a refresh for a given account as follows:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -X PUT <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey:bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret:lazar&quot;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/&lt;account_id&gt;&quot;</span></code></pre></div></div>
<div class="paragraph"><p>This refreshes the analytics tables for the specified <code>account id</code>.</p></div></div>
<div class="sect2"><h3 id="_refresh_all_accounts">Refresh all Accounts</h3><div class="paragraph"><p>You can refresh all accounts as follows:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -X PUT <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey:bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret:lazar&quot;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/&quot;</span></code></pre></div></div>
<div class="paragraph"><p>This refreshes the analytics table for all accounts. This happens asynchronously and may take a while to complete depending on the number of accounts.</p></div></div></div></div>
<div class="sect1"><h2 id="analytics_tables">Analytics Tables</h2><div class="sectionbody"><div class="paragraph"><p>This section gives a brief overview of some of the important tables in the analytics database.</p></div>
<div class="sect2"><h3 id="_accounts">Accounts</h3><div class="paragraph"><p>The table <strong>analytics_accounts</strong> maintains information about Kill Bill accounts. The table doesn&#8217;t contain historic records (it will contain at most one record per Kill Bill account).</p></div></div>
<div class="sect2"><h3 id="_subscriptions">Subscriptions</h3><div class="paragraph"><p>The table <strong>analytics_subscription_transitions</strong> maintains information about Kill Bill subscriptions. It describes the history of changes (both past and future) on a per subscription basis. It contains all phase transitions for all subscriptions and can be used to build subscription timelines. A few remarks:</p></div>
<div class="ulist"><ul><li><p>Given a subscription ID, events are sorted chronologically when stored (you can rely on <code>record_id asc</code>).</p></li><li><p><strong>prev_</strong> fields will always be <code>NULL</code> for creation events.</p></li><li><p><strong>next_</strong> fields will always be <code>NULL</code> for cancellation events.</p></li><li><p>A <code>CHANGE</code> event corresponds to a user initiated change (e.g. upgrade) whereas <code>SYSTEM_CHANGE</code> corresponds to a phase event (e.g. transition from trial to evergreen phase).</p></li><li><p>The <strong>requested_timestamp</strong> field reflects when the transition was requested; the <strong>next_start_date</strong> field reflects the effective transition time.</p></li></ul></div></div>
<div class="sect2"><h3 id="_invoices">Invoices</h3><div class="paragraph"><p>The following tables maintain information about invoices posted by account:</p></div>
<div class="ulist"><ul><li><p>analytics_invoices</p></li><li><p>analytics_invoice_adjustments</p></li><li><p>analytics_invoice_item_adjustments</p></li><li><p>analytics_invoice_credits</p></li><li><p>analytics_invoice_items</p></li></ul></div>
<div class="paragraph"><p>A few remarks:</p></div>
<div class="ulist"><ul><li><p><code>EXTERNAL_CHARGE</code>, <code>FIXED</code>, and <code>RECURRING</code> items are treated as regular line items and are stored in <strong>analytics_invoice_items</strong>.</p></li><li><p><code>ITEM_ADJ</code> items are treated as invoice item adjustments and stored in <strong>analytics_invoice_item_adjustments</strong>.</p></li><li><p><code>CBA_ADJ</code> items (gained or consumed) are treated as account credits and stored in <strong>analytics_invoice_credits</strong>.</p></li><li><p><code>CREDIT_ADJ</code> items that are not on their own invoice (items on an existing <code>DRAFT</code> invoice) are stored in <strong>analytics_invoice_adjustments</strong>.</p></li><li><p><code>CREDIT_ADJ</code> items on their on invoice are not stored separately in the analytics table since their corresponding <code>CBA_ADJ</code> items are stored in the <strong>analytics_invoice_credits</strong> as mentioned above.</p></li><li><p><code>REPAIR_ADJ</code> items are stored in the <strong>analytics_invoice_item_adjustments</strong> table. For example, if a recurring item of $20 was repaired into a $5 recurring item, <strong>analytics_invoice_items</strong> would contain the original $20 line item and <strong>analytics_invoice_item_adjustments</strong> would contain a $-15 adjustment item.</p></li><li><p>Any invoice item has a revenue recognizable attribute which is used to tell if the item is recognizable from a finance perspective (tied to cash). This is used for credits only today and we assume that any administrator generated credit (<code>CREDIT_ADJ</code> and <code>CBA_ADJ</code> on their own invoice) is not recognizable. All other credit items, including system generated ones, are.</p></li></ul></div>
<div class="paragraph"><p>Some of the important invoice related attributes can be computed as follows:</p></div>
<div class="ulist"><ul><li><p><a href="https://docs.killbill.io/latest/Kill-Bill-Glossary.html#invoice_balance"><strong>invoice balance</strong></a>: Calculated as: <strong>invoice_amount_charged + invoice_amount_credited + invoice_amount_adjusted_for_account_credit - (invoice_amount_paid + invoice_amount_refunded)</strong>. Note that <strong>invoice_amount_adjusted_for_account_credit</strong> is an internal adjustment that applies for account level credits only (<code>CREDIT_ADJ</code> items on their own invoices) and is not represented in Analytics. See <a href="https://docs.killbill.io/latest/invoice_examples.html#\_invoice\_balance">"<em>Invoice Balance</em>"</a> for further information.</p></li><li><p><strong>invoice_amount_charged</strong>: Sum of all <strong>analytics_invoice_items</strong>, <strong>analytics_invoice_adjustments</strong>, and <strong>analytics_invoice_item_adjustments</strong> items for that invoice.</p></li><li><p><strong>invoice_amount_credited</strong>: Sum of all <strong>analytics_invoice_credits</strong> items for that invoice (positive if granted, negative if used).</p></li><li><p><strong>invoice_amount_paid</strong>:
Sum of all <strong>analytics_payment_purchases</strong> items for that invoice.</p></li><li><p><strong>invoice_amount_refunded</strong>: Sum of all <strong>analytics_payment_chargebacks</strong> and <strong>analytics_payment_refunds</strong> items for that invoice.</p></li><li><p><strong>invoice_original_amount_charged</strong>: Sum of all <strong>analytics_invoice_items</strong> items for that invoice at the time of invoice creation.</p></li></ul></div>
<div class="paragraph"><p><strong>References:</strong></p></div>
<div class="ulist"><ul><li><p><a href="https://docs.killbill.io/latest/userguide_subscription.html#components-invoice-items">Invoice Items</a></p></li><li><p><a href="https://docs.killbill.io/latest/invoice_examples.html">Charged Amount and Invoice Balance Calculation examples</a></p></li><li><p><a href="https://docs.killbill.io/latest/Kill-Bill-Glossary.html#_i">Kill Bill Glossary</a></p></li></ul></div></div>
<div class="sect2"><h3 id="_payments">Payments</h3><div class="paragraph"><p>The following tables maintain information about Kill Bill payments, refunds and chargebacks:</p></div>
<div class="ulist"><ul><li><p>analytics_payment_auths</p></li><li><p>analytics_payment_captures,</p></li><li><p>analytics_payment_purchases</p></li><li><p>analytics_payment_refunds</p></li><li><p>analytics_payment_credits</p></li><li><p>analytics_payment_chargebacks</p></li><li><p>analytics_payment_voids</p></li></ul></div></div>
<div class="sect2"><h3 id="_entitlement_states">Entitlement States</h3><div class="paragraph"><p>The table <strong>analytics_entitlement_states</strong> maintains information about Kill Bill entitlement states, including overdue statuses. The table contains historic status for a given account.</p></div></div>
<div class="sect2"><h3 id="_tags_and_custom_fields">Tags and Custom Fields</h3><div class="paragraph"><p>The following tables maintain information about tags and custom fields:</p></div>
<div class="ulist"><ul><li><p>analytics_account_tags</p></li><li><p>analytics_bundle_tags</p></li><li><p>analytics_invoice_tags</p></li><li><p>analytics_payment_tags</p></li><li><p>analytics_account_fields</p></li><li><p>analytics_bundle_fields</p></li><li><p>analytics_invoice_fields</p></li><li><p>analytics_invoice_payment_fields</p></li><li><p>analytics_payment_fields</p></li><li><p>analytics_payment_method_fields</p></li><li><p>analytics_transaction_fields</p></li></ul></div>
<div class="paragraph"><p>These tables don&#8217;t contain historic records (they will contain the current state of tags and custom fields).</p></div></div></div></div>
<div class="sect1"><h2 id="currency_conversion">Currency Conversion</h2><div class="sectionbody"><div class="paragraph"><p>Each table containing monetary columns (e.g. price, balance, &#8230;&#8203;) will also contain a currency column, expressing the currency of the monetary values. This can be difficult to work with as tables can contain rows in various currencies: any arithmetic across them won&#8217;t make any sense.</p></div>
<div class="paragraph"><p>To work around this problem, the analytics plugin has the concept of <strong>converted currency</strong>, which is a global constant currency of reference. All analytics tables contain an additional column (prefixed with <strong>converted_</strong>) corresponding to each monetary column. The <strong>converted_</strong> column stores the value in the converted currency. So, for example, the <code>balance</code> column (which has a monetary value) in the  <code>analytics_accounts</code> table has a corresponding <code>converted_balance</code> column.</p></div>
<div class="paragraph"><p>By default, the <strong>converted_</strong> column stores the value in <code>USD</code>. You can however change this to any other currency as required.</p></div>
<div class="paragraph"><p>For example, to use <code>EUR</code> as the converted currency, you need to do the following:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Set <code>EUR</code> as the reference currency in the <a href="https://docs.killbill.io/latest/userguide_configuration.html#global_configuration_properties">Kill Bill configuration file</a> as follows:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>org.killbill.billing.plugin.analytics.referenceCurrency<span class="tok-o">=</span>EUR</code></pre></div></div></li><li><p>Populate the <strong>analytics_currency_conversion</strong> table to contain the rates you&#8217;d like to use for various currencies, for a given period of time.</p><div class="paragraph"><p>For example, the following query populates this table with the <code>USD</code> to <code>EUR</code> conversion rate of <code>0.88</code> for the time period <code>2022-01-01</code> to <code>2022-02-01</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="sql"><span></span><span class="tok-k">insert</span> <span class="tok-k">into</span> <span class="tok-n">analytics_currency_conversion</span> <span class="tok-p">(</span><span class="tok-n">currency</span><span class="tok-p">,</span><span class="tok-n">start_date</span><span class="tok-p">,</span> <span class="tok-n">end_date</span><span class="tok-p">,</span><span class="tok-n">reference_rate</span><span class="tok-p">,</span> <span class="tok-n">reference_currency</span><span class="tok-p">)</span> <span class="tok-k">values</span> <span class="tok-p">(</span><span class="tok-s1">&#39;USD&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;2022-01-01&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;2022-02-01&#39;</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">.</span><span class="tok-mi">88</span><span class="tok-p">,</span><span class="tok-s1">&#39;EUR&#39;</span><span class="tok-p">);</span></code></pre></div></div></li></ol></div>
<div class="paragraph"><p>Once the above change is done, the <code>converted_</code> columns will store the monetary value in <code>EUR</code> using the specified conversion rate.</p></div></div></div>
<div class="sect1"><h2 id="_health_check">Health Check</h2><div class="sectionbody"><div class="paragraph"><p>The analytics plugin provides the following healthcheck related endpoints.</p></div>
<div class="sect2"><h3 id="_checking_status">Checking Status</h3><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/healthcheck&quot;</span></code></pre></div></div></div>
<div class="sect2"><h3 id="_put_out_of_rotation">Put out of Rotation</h3><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -X DELETE <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/healthcheck&quot;</span></code></pre></div></div></div>
<div class="sect2"><h3 id="_put_in_rotation">Put in Rotation</h3><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -X PUT <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/killbill-analytics/healthcheck&quot;</span></code></pre></div></div></div></div></div></div></article></div><div class="bd-links-wrapper"><nav class="bd-links toc right-side-menu" id="toc" data-toggle="toc"></nav></div></div></div></main><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script><script src="https://cdn.staticaly.com/gh/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script><script src="https://www.googletagmanager.com/gtag/js?id=G-C0HVJ1E78Z"></script><script>
    setTimeout(function(){
      $('.content-wrapper h2, .content-wrapper h3, .content-wrapper h4').append('<a href=""><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>');
      $('.content-wrapper h2, .content-wrapper h3, .content-wrapper h4').each(function(){
        let itemHref = '#' + $(this).attr('id');
        $(this).find('a').attr("href", itemHref);
      })
      $('.content-wrapper table').each(function() {
        $(this).wrap('<div class="table-wrap"></div>')
        $('.table-wrap').each(function() {
          if ($(this).find('table').width() > $(this).width()){
            $(this).css('max-width', '100%');
            $(this).css('overflow-x', 'scroll');
          }
        })
      })
      function copyToClipboard(text) {
        let sampleTextarea = document.createElement("textarea");
        document.body.appendChild(sampleTextarea);
        sampleTextarea.value = text;
        sampleTextarea.select();
        document.execCommand("copy");
        document.body.removeChild(sampleTextarea);
      }
      $('.content-wrapper h2 a, .content-wrapper h3 a, .content-wrapper h4 a').on('click', function(){
        setTimeout(function(){
          copyToClipboard($(location).attr("href"));
        }, 500);
      });
      $('.content-wrapper .note td.icon').append('<img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/note-icon.png">');

      $('.content pre').parent('.content').prepend('<div class="copy-icon"><svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a1 1 0 0 1 1-1h2a1 1 0 1 1 0 2H9a1 1 0 0 1-1-1Z" fill="#78AECD"/><path d="M6 3a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2 3 3 0 0 1-3 3H9a3 3 0 0 1-3-3Z" fill="#78AECD"/></svg></div>');
      $('.copy-icon svg').on('click', function () {
        copyToClipboard($(this).parent().next().find('code').text());
      });
    }, 1000);

    $('.main').append('<div class="lightbox-modal"> <div id="close-ligtbox">✕</div> <div class="img"><img src="" alt=""></div></div><div class="overlay"></div>');
    $('.main img').on('click', function () {
      let path = $(this).attr('src');
      $('.lightbox-modal img').attr('src', path);
      $('.lightbox-modal, .overlay').show();
    });
    $('#close-ligtbox, .overlay').on('click',function () {
      $('.lightbox-modal, .overlay').hide();
    });

$('.sidebar-toggler').on('click', function () {
  $(this).toggleClass('active');
  $('main.main').toggleClass('sidebar-hide');
});

$('.content-wrapper a').filter(function() {
  return this.hostname && this.hostname !== location.hostname;
}).each(function() {
  $(this).attr({
    target: '_blank',
    title: 'Visit ' + this.href + ' (click to open in a new window)'
  });
});

  </script><script>docsearch({apiKey: '3ef227e7fd5e2e1a3fffd880484934bf', container: '#docsearch', appId: 'S2ISXITURI', indexName: 'killbill'});</script><script>window.dataLayer = window.dataLayer || [];
function gtag(){window.dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-C0HVJ1E78Z');</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create','UA-32705710-3','auto');
  ga('send','pageview');
  var getOutboundLink = function(url) {
    ga('send', {
      hitType: 'event',
      eventCategory: 'outbound',
      eventAction: 'click',
      eventLabel: url,
      hitCallback: function(){document.location = url;}
    });
  }</script></body></html>