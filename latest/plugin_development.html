<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 2.0.20"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticaly.com/gh/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"><link rel="preconnect" href="https://S2ISXITURI-dsn.algolia.net"><style type="text/css"></style><title>Plugin Development</title><style>/*Default CSS*/

/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */

@import "https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap";

*,
*::before,
*::after {
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
}

ul,
ol {
  padding: 0;
  list-style-type: none;
}

body,
h1,
h2,
h3,
h4,
p,
ul[class],
ol[class],
li,
figure,
figcaption,
blockquote,
dl,
dd {
  margin: 0;
}

body {
  min-height: 100vh;
  scroll-behavior: smooth;
  text-rendering: optimizeSpeed;
  font-family: 'Inter', sans-serif;
  font-size: 16px;
  line-height: 150%;
  color: #374151;
  max-width: 100%;
  overflow-x: hidden;
}

ul[class],
ol[class] {
  list-style: none;
}

img {
  max-width: 100%;
  display: block;
}

img[align=center] {
  margin: 0 auto;
}

button {
  cursor: pointer;
}

input,
button,
textarea,
select {
  font: inherit;
}
a {
  color: #167BB7;
}
h1,
h3,
h4 {
  font-weight: 400;
}
h2,
h3,
h4 {
  color: #1F2937;
}
h1 {
  font-size: 40px;
  line-height: 120%;
  letter-spacing: -0.025em;
  color: #FFFFFF;
}
h2 {
  font-weight: 600;
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
  font-weight: 500;
}

.header {
  padding: 16px 0;
  background: #FFFFFF;
  box-shadow: 0 1px 3px rgba(0, 0, 0, .1), 0 1px 2px rgba(0, 0, 0, .06);
}
@media (min-width: 768px) {
  .header-logo {
    width: 320px;
  }
}
.header-wrapper .logo {
  max-width: 215px;
  margin: auto;
  width: 80%;
}
.header-wrapper .logo img {
  object-fit: contain;
}
@media (max-width: 767px) {
  .header-wrapper .logo a {
    display: flex;
    justify-content: center;
  }
}
.header-search {
  flex-grow: 1;
  padding-right: 16px;
}
@media (min-width: 768px) {
  .header-search {
    /*flex-grow: 1;*/
    /*max-width: calc(100% - 590px);*/
    /*padding-right: 53px;*/
    /*padding-left: 45px;*/
  }
}
@media (min-width: 1200px) {
  .header-search {
    max-width: calc(100% - 590px);
    padding-right: 53px;
    padding-left: 45px;
  }
}

.header-wrapper .search-form-wrapper {
  flex-grow: 1;
}
.header-wrapper .search-form {
  position: relative;
}
.header-wrapper .search-form .algolia-autocomplete {
  width: 100%;
}
.header-wrapper .search-form input[type="search"] {
  width: 100%;
  padding: 9px 9px 9px 40px;
  border: 1px solid #D1D5DB;
  border-radius: 6px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
}
.header-wrapper .search-form .ds-dropdown-menu {
  max-width: none;
  width: 100%;
}
.header-wrapper .search-form .search-form-icon {
  position: absolute;
  left: 13px;
  top: 9px;
  z-index: 1;
  width: 20px;
  height: 20px;
  pointer-events: none;
}
.content-wrapper {
  padding: 24px 20px;
}
@media (min-width: 1024px) {
  .content-wrapper {
    padding-right: 54px;
    padding-left: 54px;
  }
}

.content-wrapper .banner {
  position: relative;
  display: flex;
  align-items: center;
  min-height: 174px;
  margin-bottom: 24px;
  padding: 0 40px;
  background-color: #167BB7;
  border-radius: 8px;
}
.content-wrapper .banner .bg-image {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
}

.main {
  position: relative;
  line-height: 1.5;
}

.main p {
  margin-bottom: 12px;
}

.main .sidebar {
  width: calc(100% + 15px);
  flex-shrink: 0;
  margin-right: 40px;
  position: sticky;
  top: 0;
  margin-left: -15px;
  padding: 24px 16px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, .1), 0 1px 2px rgba(0, 0, 0, .06);
}

.main .sidebar .icon-title {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-top: 8px;
  padding-bottom: 8px;
  cursor: pointer;
}

.main .sidebar .icon-title .left-part{
  display: flex;
  align-items: center;
  order: 2;
  flex-grow: 1;
}

.main .sidebar .icon-title .chevron,
.main .sidebar .icon-title.bd-link-active-wrap .chevron.rotated {
  transform: rotate(180deg);
}

.main .sidebar .icon-title.bd-link-active-wrap .bd-toc-link {
  color: #167BB7;
}

.main .sidebar .open .icon-title .chevron,
.main .sidebar .icon-title.bd-link-active-wrap .chevron{
  transform: rotate(0);
  transition-duration: .25s;
  transform-origin: center;
}

.main .sidebar .bd-link-active-wrap  .chevron path {
  fill: #D1D5DB;
}

.main .sidebar .bd-link-active-wrap svg path {
  fill: #167BB7;
}

.main .sidebar .icon-title svg {
  width: 16px;
  order: 1;
}
.main .sidebar-nav {
  height: 100vh;
}
.main .sidebar-nav,
.main .right-side-menu {
  overflow-y: scroll;
  padding: 0 24px;
}

.main .right-side-menu {
  direction: rtl;
  padding: 24px 0 0 24px;
}

.main .right-side-menu .navbar-nav {
  direction: ltr;
}

.main .sidebar-nav::-webkit-scrollbar,
.main .right-side-menu::-webkit-scrollbar
{
  width: 8px;
}

.main .sidebar-nav::-webkit-scrollbar-track,
.main .right-side-menu::-webkit-scrollbar-track
{
  background-color: transparent;
}

.main .sidebar-nav::-webkit-scrollbar-thumb,
.main .right-side-menu::-webkit-scrollbar-thumb
{
  background-color: #F3F4F6;
  width: 6px;
  border-radius: 32px;
}

.main .sidebar-nav a.nav-link {
  transition-duration: .25s;
  transition-property: color;
}
.main .sidebar-nav a.nav-link:hover {
  color: #167BB7;
}
.main .sidebar-nav a {
  color: #6B7280;
}

.main .sidebar-nav a.bd-toc-link {
  padding-left: 12px;
  font-weight: 500;
  font-size: 14px;
  display: block;
  color: #6B7280;
  transition-duration: .25s;
  transition-property: color;
}
.main .sidebar-nav li:hover a.bd-toc-link,
.main .sidebar-nav li.active a.bd-toc-link,
.main .sidebar-nav .open a.bd-toc-link {
  color: #374151;
}
@media (min-width: 768px) {
  .main .sidebar:after {
    content: '';
    position: absolute;
    top: 30px;
    right: -12px;
    width: 13px;
    height: 24px;
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
  }
}
.sidebar-toggler {
  display: none;
}
@media (min-width: 768px) {
  .sidebar-toggler {
    display: block;
    position: absolute;
    top: 30px;
    right: -12px;
    width: 24px;
    height: 24px;
    border-radius: 4px;
    cursor: pointer;
    background-color: #F3F4F6;
    transition-duration: .25s;
    z-index: 2;
  }
  .sidebar-toggler:hover {
    background-color: #efefef;
  }
  .sidebar-toggler:after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 8px;
    height: 12px;
    transform: translate(-50%, -50%) rotate(0deg);
    background-image: url("data:image/svg+xml,%3Csvg width='8' height='12' viewBox='0 0 8 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M6.33337 10.6666L1.66671 5.99998L6.33337 1.33331' stroke='%23167BB7' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A");
    background-size: contain;
    background-repeat: no-repeat;
    transition-duration: .25s;
  }
  .sidebar-toggler.active:after {
    transform: translate(-50%, -50%) rotate(180deg);
  }
}


pre.pygments .tok-o {
  color: #167BB7;
}

.main p code {
  color: inherit;
  font-size: inherit;
}

.main table,.main table td,.main table th {
  border: 1px solid #dedede;
  padding: 10px;
}

.main .note table,.main .note table td,.main .note table th {
  border: none;
}

.main .note .icon {
  width: 60px;
}

.main .note .icon .fa.icon-note {
  display: none;
}

.main .note .content {
  font-weight: normal;
  color: #374151;
}

.main table td.icon svg{
  width: 30px;
  height: auto;
}

.main table td.icon .title {
  display: none;
}

.main table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 15px;
}

.main table .title {
  text-transform: uppercase;
  font-weight: 600;
  padding: 0 5px;
}

pre.pygments .tok-o {
  color: #167BB7!important;
}

.main .sidebar-nav > ul li ul {
  display: none;
  padding-left: 16px;
  padding-bottom: 8px;
  font-size: 14px;
  border-bottom: 1px solid #F3F4F6;
}

.main .sidebar-nav > ul li ul.active-list {
  display: block;
}

.main .sidebar-nav > ul li ul li a{
  display: block;
  position: relative;
  padding-left: 16px;
  font-size: 14px;
}

.main .sidebar-nav .list-item-active a {
  color: #167BB7;
}

.main .sidebar-nav > .navbar-nav  > li {
  margin-bottom: 8px;
}

.main .right-side-menu {
  position: sticky;
  top: 16px;
  height: calc(100vh - 40px);
  margin-top: 24px;
}

.main .right-side-menu > .navbar-nav {
  position: relative;
}

.sidebar-wrapper {
  margin-left: 0;
  transition-duration: .25s;
  flex-shrink: 0;
  width: calc(100% - 16px);
}
.main-wrapper {
  flex-grow: 1;
}
.bd-links-wrapper {
  flex-shrink: 0;
}
.right-side-menu ul ul {
  padding-left: 16px;
}
@media (min-width: 768px) {
  .sidebar-wrapper {
    width: 310px;
  }
  .sidebar-hide .sidebar-wrapper {
    margin-left: -280px;
  }
  .main-wrapper {
    width: calc(100% - 520px);
  }
}
@media (min-width: 1200px) {
  .main-wrapper {
    width: calc(100% - 590px);
  }
  .bd-links-wrapper {
    width: 268px;
  }
}


.main .right-side-menu > .navbar-nav:before {
  content: "In this document";
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  font-size: 14px;
  line-height: 16px;
  text-transform: uppercase;
  color: #1F2937;
}

.main .right-side-menu > ul > li > a {
  font-size: 14px;
  font-weight: 300;
  margin-bottom: 7px;
  padding: 4px 0;
}

.main .right-side-menu .nav-link {
  border: none!important;
  color: #6B7280!important;
}

.main .right-side-menu .nav-link.active{
  padding-left: 0;
  color: #167BB7!important;
  font-weight: 500;
}

.main .right-side-menu .navbar-nav {
  display: block;
}
.main nav[data-toggle=toc] .nav > li > a {
  padding-left: 0;
  transition-property: color;
  transition-duration: .25s;
}
.main nav[data-toggle=toc] .nav > li > a:focus,
.main nav[data-toggle=toc] .nav > li > a:hover {
  color: #167BB7!important;
}
.main nav[data-toggle=toc] .nav .nav > li > a:focus,
.main nav[data-toggle=toc] .nav .nav > li > a:hover,
.main nav[data-toggle=toc] .nav .nav > li > .active,
.main nav[data-toggle=toc] .nav .nav > li > .active:focus,
.main nav[data-toggle=toc] .nav .nav > li > .active:hover {
  padding-left: 0;
}
.main nav[data-toggle=toc] .nav-link.active:hover {
  padding-left: 0;
}

.main img {
  box-shadow: none;
  border-radius: 0;
  margin-bottom: 24px;
  margin-top: 10px;
  display: inline;
}

.main .note img {
  box-shadow: none;
  border-radius: 0;
  min-width: 40px;
  width: 40px;
  margin-bottom: 10px;
}

.main .imageblock img {
  height: auto;
}
.main p span.image {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  height: 16px;
  width: 20px;
  margin-left: 4px;
  margin-right: 4px;
}
.main p span.image img {
  height: 100%;
  width: 100%;
  margin-bottom: 0;
  margin-top: 0;
  box-shadow: none;
  object-fit: cover;
}

.main .listingblock, .literalblock > .content pre {
  padding: 8px 14px;
  background: #50576A;
  border-radius: 4px;
  margin-bottom: 24px;
  font-size: 14px;
  font-weight: 400;
  color: #CECECE;
}

pre.pygments {
  background: #50576A!important;
  margin-bottom: 0;
}

.main .listingblock  .tok-nt {
  color: #29A9C9;
}

.main .listingblock .tok-s {
  color: #E44C3A;
}

.main .listingblock  .tok-p {
  color: #F5FBFF;
}

.main ol {
  counter-reset: my-awesome-counter;
  list-style: none;
  color: #167BB7;
  margin-left: 20px;
  margin-bottom: 16px;
}

.main ol > li {
  position: relative;
  counter-increment: my-awesome-counter;
  font-weight: 600;
}

.main ol.arabic > li::before {
  content: counter(my-awesome-counter);
  position: absolute;
  top: -1px;
  left: -20px;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background-color: #E5E7EB;
  color: #6B7280;
  font-weight: 400;
  font-size: inherit;
}
.main ol > li::before {
}

.main ol.arabic:first-child p {
  color: #374151;
  margin-left: 10px;
  font-weight: 400;
}

.main .content-wrapper ul{
  color: #374151;
  list-style: disc;
  margin-left: 20px;
}

.main .content-wrapper ul > li ul {
  margin-left: 0;
  list-style-type: none;
}

.main .content-wrapper ul.nav-tabs{
  list-style: none;
}
.main ol ol {
  margin-left: 30px;
}
.main ol.loweralpha[type=a] > li {
  list-style-type: lower-alpha;
}
.main ol.lowerroman[type=i] > li {
  list-style-type: lower-roman;
}
.main ol li::marker {
  color: #6B7280;
}

.main h2, .main h3 {
  margin-bottom: 16px;
  padding-top: 24px;
}

.main h4 {
  margin-bottom: 16px;
  padding-top: 16px;
}

.content-wrapper h2 a, .content-wrapper h3 a, .content-wrapper h4 a {
  display: none;
  margin-left: 5px;
}

.content-wrapper h4 a svg {
  height: 14px;
  width: auto;
}

.content-wrapper h2:hover a, .content-wrapper h3:hover a, .content-wrapper h4:hover a {
  display: inline;
}

.breadcrumbs-wrapper {
  margin-bottom: 24px;
}
.breadcrumbs-list {
  display: flex;
  align-items: center;
}
.breadcrumbs-list li {
  display: flex;
  align-items: center;
}
.breadcrumbs-list li:not(:last-of-type):after {
  content: '/';
  margin-left: 6px;
  margin-right: 6px;
}
.breadcrumbs-list a {
  display: flex;
  align-items: center;
  letter-spacing: -0.025em;
  color: #374151;
}
.breadcrumbs-list a svg {
  width: 24px;
  height: 24px;
  margin-right: 4px;
}

.note table code {
  color: #374151;
}

.banner .absolute-figure {
  position: absolute;
}

.banner .absolute-figure.abstract-figure {
  right: 0;
}

.banner .absolute-figure.circle2 {
  right: 30%;
  top: 10%;
}

.banner .absolute-figure.circle3 {
  right: 15%;
  top: 10%;
}

.banner .absolute-figure.circle4 {
  left: 5%;
  top: 10%;
}

.banner .absolute-figure.circle5 {
  left: 30%;
}

.banner .absolute-figure.circle6 {
  left: 6%;
  bottom: 0;
}

.banner .absolute-figure.circle7 {
  left: 35%;
  bottom: 15%;
}

.banner .absolute-figure.circle8 {
  left: 55%;
  bottom: 0;
}

.banner .absolute-figure.circle9 {
  bottom: 0;
  right: 0;
}

.doclink {
  position: fixed;
  bottom: 0;
  padding: 0 15px 10px;
  background-color: #FBFDFF;
  z-index: 1000;
  font-size: 12px;
}

.btn-primary, .btn-primary:hover {
  background-color: #167BB7;
  border-color: #167BB7;
}

.card {
  height: 100%;
}
.card-wrapper .card-text {
  min-height: 80px;
  margin-bottom: 16px;
}

.card-wrapper .card-body {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 1rem 0.25rem;
}

pre.pygments .tok-c1 {
  color: #29A9C9!important;
}

@media screen and (max-width: 1520px) {
  .card-wrapper .card-text {
    min-height: 110px;
  }
}

.DocSearch.DocSearch-Button {
    margin-left: 0;
    width: 100%;
    height: 38px;
    padding: 0 15px;
    background-color: transparent;
    border: 1px solid #D1D5DB;
    box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
    border-radius: 6px;
    font-weight: 400;
    font-size: 14px;
    line-height: 20px;
    color: #6B7280;
}
.search-form-wrapper .DocSearch-Button-Keys {
  display: none;
}
.DocSearch-Hit-content-wrapper {
  overflow-x: inherit !important;
}
.search-form-wrapper .DocSearch-Button .DocSearch-Search-Icon {
  color: #9CA3AF;
  width: 16px;
  height: 16px;
}
.search-form-wrapper .DocSearch-Button-Placeholder {
  padding-left: 10px;
}
.oneline_with_image img {
    display: inline-block;
    height: 30px;
    margin: 0 10px;
}

.warning table td, .warning table,
.important table td, .important table {
  border: none;
}
.copy-icon {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  height: 40px;
  margin: -8px -14px 8px;
  padding: 0 16px;
  background-color: #3C4356;
  border-top-left-radius: 4px;
  border-top-right-radius: 4px;
}
.copy-icon svg {
  cursor: pointer;
}
.icon-tip {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 502 502' xml:space='preserve'%3E%3Cpath d='M230.523 78.722c-35.583-.342-69.221 13.48-94.756 38.802-25.528 25.316-39.587 58.839-39.587 94.396 0 34.708 13.278 67.567 37.387 92.524 24 24.844 37.216 57.409 37.216 91.697v70.281c0 5.523 4.477 10 10 10h12.756C197.871 491.185 211.53 502 227.676 502s29.805-10.815 34.138-25.578h16.166c5.523 0 10-4.477 10-10v-70.275c0-34.627 12.99-66.961 36.576-91.044 24.522-25.04 38.027-58.133 38.027-93.185 0-35.38-13.723-68.697-38.64-93.812-24.902-25.1-58.079-39.086-93.42-39.384zM227.676 482c-4.787 0-9.076-2.17-11.936-5.578h23.872c-2.86 3.408-7.149 5.578-11.936 5.578zm40.304-25.578h-77.197v-37.125h77.197v37.125zm42.287-165.313c-27.269 27.844-42.287 65.148-42.287 105.039v3.15h-77.197v-3.156c0-39.5-15.211-77-42.832-105.593-20.488-21.208-31.771-49.133-31.771-78.629 0-30.183 11.958-58.663 33.67-80.194 21.72-21.538 50.338-33.226 80.505-33.005 61.882.521 112.228 51.301 112.228 113.197 0 29.789-11.477 57.912-32.316 79.191zM229.381 55.584c5.523 0 10-4.477 10-10V10c0-5.523-4.477-10-10-10s-10 4.477-10 10v35.584c0 5.523 4.477 10 10 10zM85.246 29.896a9.988 9.988 0 0 0 8.099 4.123 9.96 9.96 0 0 0 5.87-1.91c4.468-3.247 5.458-9.5 2.212-13.968l-7.108-9.783C91.073 3.89 84.82 2.9 80.351 6.146c-4.468 3.247-5.458 9.5-2.212 13.968l7.107 9.782zM124.729 84.239a9.988 9.988 0 0 0 8.099 4.123 9.96 9.96 0 0 0 5.87-1.91c4.468-3.246 5.458-9.5 2.212-13.968l-19.113-26.308c-3.246-4.468-9.499-5.459-13.968-2.212-4.468 3.246-5.458 9.5-2.212 13.968l19.112 26.307zM37.031 160.15l33.843 10.996a10.01 10.01 0 0 0 3.092.492c4.215 0 8.136-2.687 9.509-6.913 1.707-5.253-1.168-10.894-6.42-12.601l-33.843-10.996c-5.251-1.705-10.894 1.168-12.601 6.42-1.707 5.254 1.167 10.895 6.42 12.602zM84.808 260.51c-1.707-5.253-7.346-8.126-12.601-6.42l-33.843 10.996c-5.252 1.707-8.127 7.348-6.42 12.601 1.373 4.226 5.293 6.913 9.509 6.913a10.01 10.01 0 0 0 3.092-.492l33.843-10.996c5.252-1.708 8.126-7.349 6.42-12.602zM102.626 391.668c-4.467-3.246-10.721-2.255-13.968 2.212l-8.903 12.253c-3.246 4.468-2.256 10.722 2.212 13.968a9.952 9.952 0 0 0 5.87 1.91 9.99 9.99 0 0 0 8.099-4.123l8.903-12.253c3.246-4.467 2.256-10.72-2.213-13.967z'/%3E%3Cpath d='M134.544 347.736c-4.468-3.246-10.722-2.255-13.968 2.212l-8.845 12.175c-3.246 4.468-2.255 10.722 2.212 13.968a9.952 9.952 0 0 0 5.87 1.91 9.99 9.99 0 0 0 8.099-4.123l8.845-12.175c3.246-4.467 2.255-10.721-2.213-13.967zM338.347 336.895c-3.246-4.468-9.499-5.459-13.968-2.212-4.468 3.247-5.458 9.5-2.212 13.968l20.916 28.789a9.988 9.988 0 0 0 8.099 4.123 9.96 9.96 0 0 0 5.87-1.91c4.468-3.247 5.458-9.5 2.212-13.968l-20.917-28.79zM426.045 260.984l-33.843-10.997c-5.252-1.705-10.894 1.168-12.601 6.42-1.707 5.252 1.168 10.894 6.42 12.601l33.843 10.997a10.01 10.01 0 0 0 3.092.492c4.215 0 8.136-2.687 9.509-6.913 1.707-5.251-1.167-10.893-6.42-12.6zM471.39 130.367c-1.706-5.252-7.347-8.127-12.601-6.42l-14.678 4.769c-5.252 1.707-8.127 7.348-6.42 12.601 1.373 4.226 5.293 6.913 9.509 6.913a10.01 10.01 0 0 0 3.092-.492l14.678-4.769c5.252-1.708 8.126-7.349 6.42-12.602zM387.777 167.536a10.01 10.01 0 0 0 3.092-.492l25.994-8.446c5.252-1.707 8.127-7.348 6.42-12.601-1.707-5.252-7.347-8.127-12.601-6.42l-25.994 8.446c-5.252 1.707-8.127 7.348-6.42 12.601 1.374 4.225 5.294 6.912 9.509 6.912zM320.89 83.916a9.952 9.952 0 0 0 5.87 1.91 9.99 9.99 0 0 0 8.099-4.123l20.916-28.789c3.246-4.468 2.255-10.722-2.212-13.968-4.469-3.246-10.722-2.255-13.968 2.212l-20.916 28.789c-3.248 4.469-2.257 10.722 2.211 13.969zM288.349 135.549c-11.289-8.76-24.609-14.981-38.521-17.992-5.395-1.169-10.721 2.26-11.889 7.659-1.168 5.398 2.261 10.721 7.659 11.889 11.007 2.382 21.55 7.308 30.491 14.245a9.954 9.954 0 0 0 6.124 2.1 9.981 9.981 0 0 0 7.907-3.87c3.385-4.363 2.592-10.645-1.771-14.031zM202.914 119.066c-41.096 11.729-69.797 49.799-69.797 92.579 0 5.523 4.477 10 10 10s10-4.477 10-10c0-33.895 22.735-64.056 55.287-73.346 5.311-1.516 8.387-7.05 6.872-12.361-1.518-5.31-7.052-8.388-12.362-6.872z'/%3E%3C/svg%3E");
  width: 42px;
  height: 42px;
  background-repeat: no-repeat;
  background-position: center;
}
.main table td.icon {
  text-align: center;
}
.icon-warning {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='554.2' height='554.199' xml:space='preserve' fill='%23E44C3A'%3E%3Cpath d='M538.5 386.199 356.5 70.8a91.803 91.803 0 0 0-79.501-45.9c-32.8 0-63.1 17.5-79.5 45.9L12.3 391.6a91.793 91.793 0 0 0 0 91.8c16.4 28.4 46.7 45.9 79.5 45.9H462.4c50.7 0 91.8-41.101 91.8-91.8 0-19-5.8-36.7-15.7-51.301zm-222.2 30.7c0 21.7-16.7 38.3-39.2 38.3s-39.2-16.6-39.2-38.3V416c0-21.601 16.7-38.301 39.2-38.301S316.3 394.3 316.3 416v.899zm.9-258.199-19.4 169.4c-1.3 12.2-9.4 19.8-20.7 19.8s-19.4-7.7-20.7-19.8L237 158.6c-1.3-13.1 5.801-23 18-23h44.1c12.2.1 19.4 10 18.1 23.1z'/%3E%3C/svg%3E%0A");
  width: 40px;
  height: 39px;
  background-size: 100%;
}
.icon-important {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cg transform='scale(.521)'%3E%3Ccircle cx='96' cy='96' r='74' fill='%23E44C3A'/%3E%3Cpath d='M86 48h20l-4 72H90z' fill='%23fff'/%3E%3Ccircle cx='96' cy='140' r='10' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E");
  width: 40px;
  height: 40px;
  background-size: 100%;
}
.main .admonitionblock.tip table,
.main .admonitionblock.tip table td {
  border: none;
}
/*Light box start*/

.lightbox-modal {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  background-color: #ebebeb;
  padding: 20px;
  transform: translate(-50%, -50%);
  z-index: 100;
  border-radius: 8px;
  max-width: 95vw;
  width: 100%;
  height: 90vh;
}
.lightbox-modal .img {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}
.lightbox-modal .img img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  margin: 0;
}
@media (max-width: 1023px) {
  .lightbox-modal {
    height: auto;
    max-width: 95vw;
  }
}
#close-ligtbox {
  position: absolute;
  right: -35px;
  top: -35px;
  display: block;
  width: 30px;
  font-size: 36px;
  border-radius: 8px;
  cursor: pointer;
  color: #fff;
}
@media (max-width: 1023px) {
  #close-ligtbox {
    right: 0;
    top: -40px;
    width: 24px;
    font-size: 28px;
  }
}
.overlay {
  display: none;
  position: fixed;
  background-color: rgba(0,0,0,.5);
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  z-index: 99;
}
.imageblock img, .paragraph .image img {
  cursor: pointer;
}
/*Light box end*/

.ulist {
  margin-left: 10px;
}
.main ol.arabic:first-child .ulist p,
.ulist ul li p {
  margin-left: 0!important;
}

.ulist li::marker {
  font-size: 20px;
  color: #6d7176;
}
.ulist li ul {
  list-style-type: none;
}
.ulist li ul li {
  position: relative;
  padding-left: 24px;
}
.ulist li ul li:before {
  content: '';
  position: absolute;
  left: 0;
  top: 9px;
  width: 8px;
  height: 8px;
  background-color: #E5E7EB;
  border: 1px solid #9CA3AF;
  border-radius: 100%;
}
.right-side-menu ul ul li:not(:last-child) {
  margin-bottom: 5px;
}
.imageblock .title {
  margin-bottom: 24px;
}
</style>
<style>pre.pygments .hll { background-color: #49483e }
pre.pygments { background: #272822; color: #f8f8f2 }
pre.pygments .tok-c { color: #75715e } /* Comment */
pre.pygments .tok-err { color: #960050; background-color: #1e0010 } /* Error */
pre.pygments .tok-k { color: #66d9ef } /* Keyword */
pre.pygments .tok-l { color: #ae81ff } /* Literal */
pre.pygments .tok-n { color: #f8f8f2 } /* Name */
pre.pygments .tok-o { color: #f92672 } /* Operator */
pre.pygments .tok-p { color: #f8f8f2 } /* Punctuation */
pre.pygments .tok-ch { color: #75715e } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #75715e } /* Comment.Multiline */
pre.pygments .tok-cp { color: #75715e } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #75715e } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #75715e } /* Comment.Single */
pre.pygments .tok-cs { color: #75715e } /* Comment.Special */
pre.pygments .tok-gd { color: #f92672 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gi { color: #a6e22e } /* Generic.Inserted */
pre.pygments .tok-go { color: #66d9ef } /* Generic.Output */
pre.pygments .tok-gp { color: #f92672; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #75715e } /* Generic.Subheading */
pre.pygments .tok-kc { color: #66d9ef } /* Keyword.Constant */
pre.pygments .tok-kd { color: #66d9ef } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #f92672 } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #66d9ef } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #66d9ef } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #66d9ef } /* Keyword.Type */
pre.pygments .tok-ld { color: #e6db74 } /* Literal.Date */
pre.pygments .tok-m { color: #ae81ff } /* Literal.Number */
pre.pygments .tok-s { color: #e6db74 } /* Literal.String */
pre.pygments .tok-na { color: #a6e22e } /* Name.Attribute */
pre.pygments .tok-nb { color: #f8f8f2 } /* Name.Builtin */
pre.pygments .tok-nc { color: #a6e22e } /* Name.Class */
pre.pygments .tok-no { color: #66d9ef } /* Name.Constant */
pre.pygments .tok-nd { color: #a6e22e } /* Name.Decorator */
pre.pygments .tok-ni { color: #f8f8f2 } /* Name.Entity */
pre.pygments .tok-ne { color: #a6e22e } /* Name.Exception */
pre.pygments .tok-nf { color: #a6e22e } /* Name.Function */
pre.pygments .tok-nl { color: #f8f8f2 } /* Name.Label */
pre.pygments .tok-nn { color: #f8f8f2 } /* Name.Namespace */
pre.pygments .tok-nx { color: #a6e22e } /* Name.Other */
pre.pygments .tok-py { color: #f8f8f2 } /* Name.Property */
pre.pygments .tok-nt { color: #f92672 } /* Name.Tag */
pre.pygments .tok-nv { color: #f8f8f2 } /* Name.Variable */
pre.pygments .tok-ow { color: #f92672 } /* Operator.Word */
pre.pygments .tok-w { color: #f8f8f2 } /* Text.Whitespace */
pre.pygments .tok-mb { color: #ae81ff } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #ae81ff } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #ae81ff } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #ae81ff } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #ae81ff } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #e6db74 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #e6db74 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #e6db74 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #e6db74 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #e6db74 } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #e6db74 } /* Literal.String.Double */
pre.pygments .tok-se { color: #ae81ff } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #e6db74 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #e6db74 } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #e6db74 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #e6db74 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #e6db74 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #e6db74 } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #a6e22e } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #f8f8f2 } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #f8f8f2 } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #f8f8f2 } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #f8f8f2 } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #ae81ff } /* Literal.Number.Integer.Long */</style></head><body data-spy="scroll" data-target="#toc" class="book"><header class="header"><div class="header-wrapper"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="header-logo"><div class="logo"><a href="https://docs.killbill.io"><img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/logo.png" style="height:41px" alt="KillBill Docs"></a></div></div><div class="header-search"><div class="search-form-wrapper"><div id="docsearch" style="height: 43px; display: flex; align-items: center; width: 100%;"></div></div></div></div></div></div></header><main class="main"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="sidebar-wrapper"><aside class="sidebar"><nav class="sidebar-nav"><ul class="nav navbar-nav"><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Getting Started</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li><a class="nav-link" href="/latest/what_is_kill_bill.html">What is Kill Bill?</a></li><li><a class="nav-link" href="/latest/getting_started.html">Getting Started (Installation)</a></li><li><a class="nav-link" href="/latest/quick_start_with_kaui.html">Quick Start with Kaui</a></li><li><a class="nav-link" href="/latest/quick_start_with_kb_api.html">Quick Start with the Kill Bill API</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Installation</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/stripe_plugin.html">Kill Bill + Stripe DIY</a></li><li><a class="nav-link" href="/latest/userguide_deployment.html">Going to Production</a></li><li><a class="nav-link" href="/latest/how-to-upgrade-the-database.html">Database Migrations</a></li><li><a class="nav-link" href="/latest/PostgreSQL.html">PostgreSQL Setup</a></li><li><a class="nav-link" href="https://github.com/killbill/killbill/releases" onclick="getOutboundLink('https://github.com/killbill/killbill/releases'); return false;">Release&nbsp;Notes</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">AWS</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/how-to-set-up-a-single-tier-system.html">Single-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-multi-tier-system.html">Multi-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-cloud-formation-system.html">CloudFormation Setup</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/how-to-maintain-a-single-tier-system.html">Single-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-multi-tier-system.html">Multi-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-cloud-formation-system.html">CloudFormation Maintenance</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Manuals</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/userguide_subscription.html">Subscription&nbsp;Billing</a></li><li><a class="nav-link" href="/latest/userguide_payment.html">Payment Processing</a></li><li><a class="nav-link" href="/latest/userguide_kaui.html">Kaui, the Administrative&nbsp;UI</a></li><li><a class="nav-link" href="/latest/email-notification-plugin.html">Email Notification Plugin</a></li><li><a class="nav-link" href="/latest/custom-email-invoice-formatter.html">Custom Email Formatter</a></li><li><a class="nav-link" href="/latest/userguide_analytics.html">Analytics Plugin</a></li><li><a class="nav-link" href="/latest/userguide_configuration.html">Kill Bill&nbsp;Configuration</a></li><li><a class="nav-link" href="/latest/internationalization.html">Kill Bill&nbsp;Internationalization</a></li><li><a class="nav-link" href="/latest/migration_guide.html">Migrating to Kill Bill</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Tutorials</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plan_alignment.html">Plans Alignments</a></li><li><a class="nav-link" href="/latest/overdue.html">Overdue System</a></li><li><a class="nav-link" href="/latest/consumable_in_arrear.html">In Arrear UsageBilling</a></li><li><a class="nav-link" href="/latest/ha.html">Hierarchical Accounts</a></li><li><a class="nav-link" href="/latest/catalog-examples.html">Catalog Examples</a></li><li><a class="nav-link" href="/latest/invoice_examples.html">Invoice Examples</a></li><li><a class="nav-link" href="/latest/invoice_templates.html">Invoice Templates</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Integration</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="http://killbill.github.io/slate" onclick="getOutboundLink('http://killbill.github.io/slate'); return false;">REST API Reference</a></li><li><a class="nav-link" href="/latest/swagger_documentation.html">Swagger UI Documentation</a></li><li><a class="nav-link" href="/latest/postman.html">Postman Integration</a></li><li><a class="nav-link" href="/latest/debugging.html">Debugging</a></li><li><a class="nav-link" href="/latest/push_notifications.html">Push Notifications</a></li><li><a class="nav-link" href="/latest/kill_bill_events.html">Kill Bill Events</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Plugin Development</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_introduction.html">Plugin Introduction</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_development.html">Plugin Development</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_installation.html">Plugin Installation</a></li><li><a class="nav-link" href="/latest/plugin_use_cases.html">Special Plugin Use Cases</a></li><li><a class="nav-link" href="/latest/notification_plugin.html">Notification Plugins</a></li><li><a class="nav-link" href="/latest/payment_plugin.html">Payment Plugins</a></li><li><a class="nav-link" href="/latest/payment_control_plugin.html">Payment Control Plugins</a></li><li><a class="nav-link" href="/latest/usage_plugin.html">Usage Plugins</a></li><li><a class="nav-link" href="/latest/invoice_plugin.html">Invoice Plugins</a></li><li><a class="nav-link" href="/latest/catalog_plugin.html">Catalog Plugins</a></li><li><a class="nav-link" href="/latest/entitlement_plugin.html">Entitlement Plugins</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Operational Guides</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/deploy_to_kubernetes.html">Kubernetes (K8s) Deployment</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/user_management.html">Users, Roles, and Permissions</a></li><li><a class="nav-link" href="/latest/plugin_management.html">Plugin Management</a></li><li><a class="nav-link" href="/latest/aws-tools.html">AWS Analytics Tools</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Client Libraries</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/java_client.html">Java</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-ruby" onclick="getOutboundLink('http://github.com/killbill/killbill-client-ruby'); return false;">Ruby</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-php" onclick="getOutboundLink('http://github.com/killbill/killbill-client-php'); return false;">PHP</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-js" onclick="getOutboundLink('http://github.com/killbill/killbill-client-js'); return false;">Node.js</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-python" onclick="getOutboundLink('http://github.com/killbill/killbill-client-python'); return false;">Python</a></li><li><a class="nav-link" href="http://github.com/killbill/kbcli" onclick="getOutboundLink('http://github.com/killbill/kbcli'); return false;">Go</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">About Kill Bill</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/demo.html">Demo</a></li><li><a class="nav-link" href="/latest/features.html">Features List</a></li><li><a class="nav-link" href="/latest/faq.html">Technical FAQs</a></li><li><a class="nav-link" href="/latest/Kill-Bill-Glossary.html">Glossary</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Internal</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/internal_design.html">Internal Design</a></li><li><a class="nav-link" href="/latest/entitlement_subsystem.html">Entitlement Subsystem</a></li><li><a class="nav-link" href="/latest/invoice_subsystem.html">Invoice Subsystem</a></li><li><a class="nav-link" href="/latest/development.html">Development Environment</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">References</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="https://github.com/killbill/killbill-docs/tree/v3/swagger" onclick="getOutboundLink('https://github.com/killbill/killbill-docs/tree/v3/swagger'); return false;">Swagger&nbsp;API Schema</a></li><li><a class="nav-link" href="/latest/catalog.xsd">Catalog XSD Reference</a></li><li><a class="nav-link" href="/latest/overdue.xsd">Overdue XSD Reference</a></li></ul></li></ul><div class="sidebar-toggler"></div></nav><script src="https://code.jquery.com/jquery-3.6.1.min.js"></script><script>
  let $ = jQuery;
  $('.sidebar-nav .icon-title').on('click', function (e) {
    e.preventDefault();
    $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
    $('.sidebar-nav > .navbar-nav > li').removeClass('open');

    if($(this).next().is(':visible')){
      $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
      $('.sidebar-nav > .navbar-nav > li').removeClass('open');
    } else {
      $(this).parent().addClass('open');
      $(this).next().slideDown(200);
    }
  });

  let pageURL = $(location).attr("href");
  $('.nav-link').each(function() {
    if (pageURL.includes($(this).attr('href'))) {
      $(this).parent().addClass('list-item-active');
      $(this).parent().parent().addClass('active-list');
      $(this).parent().parent().prev().addClass('bd-link-active-wrap');
    }
  });
</script><a class="doclink" href="mailto:support@killbill.io">Report a doc problem</a></aside></div><div class="main-wrapper"><article class="content-wrapper"><div class="banner"><div class="bg-image"><svg class="absolute-figure circle1" width="41" height="38" viewBox="0 0 41 38" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="12.5" cy="10.5" rx="28.5" ry="27.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle2" width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="10" cy="9.5" rx="10" ry="9.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle3" width="97" height="97" viewBox="0 0 97 97" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="48.5" cy="48.5" r="48.5" fill="white" fill-opacity="0.4"/>
</svg>
<svg class="absolute-figure circle4" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="7" cy="7" r="7" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle5" width="65" height="23" viewBox="0 0 65 23" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="32.5" cy="-9.5" r="32.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle6" width="48" height="31" viewBox="0 0 48 31" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="24" cy="24" r="24" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle7" width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="10" cy="9.5" rx="10" ry="9.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle8" width="20" height="10" viewBox="0 0 20 10" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="10" cy="9.5" rx="10" ry="9.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle9" width="49" height="48" viewBox="0 0 49 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="48.5" cy="48.5" r="48.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure abstract-figure" width="703" height="174" viewBox="0 0 703 174" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M25.5 246C-96 87.7673 245.949 67.3215 475.548 64.1799C705.146 61.0384 565.01 -188.501 629.653 -188.741C694.297 -188.982 766.062 221.014 766.062 221.014L297.072 460.733C297.072 460.733 147 404.233 25.5 246Z" fill="white" fill-opacity="0.2"/>
</svg></div><h1>Plugin Development</h1></div><div id="content"><div id="preamble"><div class="sectionbody"><div class="paragraph"><p>This document can be used as a guide to develop custom plugins.</p></div></div></div>
<div class="sect1"><h2 id="_scope">Scope</h2><div class="sectionbody"><div class="ulist"><ul><li><p>How to start plugin development?</p></li><li><p>Tooling and APIs to build and deploy plugins</p></li></ul></div></div></div>
<div class="sect1"><h2 id="_where_to_start">Where to Start?</h2><div class="sectionbody"><div class="paragraph"><p>We provide a sample <a href="https://github.com/killbill/killbill-hello-world-java-plugin"><em>hello world plugin</em></a> which can be used as the starting point for developing a custom plugin.</p></div>
<div class="paragraph"><p>In addition, we have separate docs for different types of plugins. A good starting point would be to assess what the plugin should do and then based on that, read the various docs that describe the different types of plugins offered in Kill Bill:</p></div>
<div class="ulist"><ul><li><p><a href="https://docs.killbill.io/latest/catalog_plugin.html">Catalog Plugin</a></p></li><li><p><a href="https://docs.killbill.io/latest/payment_plugin.html">Payment Plugin</a></p></li><li><p><a href="https://docs.killbill.io/latest/payment_control_plugin.html">(Payment) Control Plugin</a></p></li><li><p><a href="https://docs.killbill.io/latest/entitlement_plugin.html">Entitlement Plugin</a></p></li><li><p><a href="https://docs.killbill.io/latest/invoice_plugin.html">Invoice Plugin</a></p></li><li><p><a href="https://docs.killbill.io/latest/notification_plugin.html">Notification Plugin</a></p></li></ul></div>
<div class="paragraph"><p>The next stage is to identify existing (similar) plugins which could be used as a starting point to write the code. At this point, this becomes a normal software development cycle, including writing unit tests for that plugin (independent of Kill Bill).</p></div>
<div class="paragraph"><p>The rest of this document will explain how to setup and work with the <code>hello-world-plugin</code>.</p></div></div></div>
<div class="sect1"><h2 id="_prerequisites">Prerequisites</h2><div class="sectionbody"><div class="ulist"><ul><li><p>Ensure that you have gone through the <a href="https://docs.killbill.io/latest/what_is_kill_bill.html"><em>What is Kill Bill</em></a> document and are familiar with Kill Bill.</p></li><li><p>Ensure that you have gone through the <a href="https://docs.killbill.io/latest/plugin_introduction.html"><em>Plugin Introduction</em></a> document and are familiar with Kill Bill plugins.</p></li><li><p>Ensure that you have <strong>Maven 3.5.2</strong> or higher (It can be downloaded from <a href="http://maven.apache.org/download.cgi"><em>here</em></a>).</p></li><li><p>Ensure that you have <strong>JDK 8</strong> or higher (It can be downloaded from <a href="https://www.oracle.com/in/java/technologies/javase-downloads.html"><em>here</em></a>).</p></li><li><p>Ensure that <strong>JAVA_HOME</strong> environment variable is set to the path of your JDK installation (For example, if JDK is installed at <strong>C:\Software\jdk1.8.0_102</strong>, you need to set <strong>JAVA_HOME</strong> to <strong>C:\Software\jdk1.8.0_102</strong>).</p></li></ul></div></div></div>
<div class="sect1"><h2 id="_getting_started">Getting Started</h2><div class="sectionbody"><div class="paragraph"><p>Let us now take a look at the steps involved in setting up the <code>hello world plugin</code>.</p></div>
<div class="sect2"><h3 id="_setting_up_the_code_in_an_ide">Setting up the Code in an IDE</h3><div class="paragraph"><p>The first step is to set up the plugin code in an IDE. For this, you need to do the following:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Clone the <code>hello-world-plugin</code> repository from <a href="https://github.com/killbill/killbill-hello-world-java-plugin"><em>Github</em></a>.</p></li><li><p>Set up the code in the IDE of your choice. You can refer to our <a href="https://docs.killbill.io/latest/development.html#_setting_up_code_in_an_ide"><em>Development Document</em></a> for detailed instructions on how to clone a repository and set up the code in Eclipse.</p></li><li><p>This path where the repository is cloned will be referred to as <strong>PROJECT_ROOT</strong> from now on. For example, if you choose <code>C:/MyProjects/killbill-hello-world-java-plugin</code>, <strong>PROJECT_ROOT</strong> refers to this path.</p></li><li><p>Once the code is set up in Eclipse, your Eclipse workspace should look like this:</p><div style="text-align: center;" class="imageblock"><div class="content"><img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/plugin_development/eclipse_workspace_with_helloworldplugin.png" alt="eclipse workspace with helloworldplugin"></div></div></li></ol></div></div>
<div class="sect2"><h3 id="build">Build</h3><div class="paragraph"><p>The <code>hello-world-plugin</code> is a standard Maven project. So you can build it as follows:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Open a command prompt/terminal window and navigate to the <strong>PROJECT_ROOT</strong>  directory.</p></li><li><p>Run the following command:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>mvn clean install -DskipTests</code></pre></div></div></li><li><p>Verify that a <strong>BUILD SUCCESS</strong> message is displayed on the console and that the plugin jar file
is created as <code>PROJECT_ROOT/target/&lt;artifact_id&gt;-&lt;version&gt;.jar</code>.</p></li></ol></div></div>
<div class="sect2"><h3 id="deployment">Deployment</h3><div class="paragraph"><p>The <code>hello-world-plugin</code> can be deployed in an AWS, Docker or Tomcat Kill Bill installation as explained in the <a href="https://docs.killbill.io/latest/getting_started.html"><em>Getting Started</em></a> guide. However, if you are using the plugin as a basis to develop your own plugin, it would be useful to deploy the plugin in a <a href="https://docs.killbill.io/latest/development.html#_setting_up_kill_bill_in_your_development_environment"><em>standalone Kill Bill installation</em></a>. Let us take a look at how to do this.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Ensure that the Kill Bill application is configured and running in a Jetty server as explained <a href="https://docs.killbill.io/latest/development.html#_setting_up_kill_bill_in_your_development_environment">here</a>.</p></li><li><p>Ensure that you have <strong>kpm</strong> installed as per the instructions  <a href="https://github.com/killbill/killbill-cloud/tree/master/kpm">here</a>.</p></li><li><p>Open a command prompt/terminal window and run the following command to install the plugin (Replace <code>PROJECT_ROOT</code> with your actual project root, <code>&lt;artifact_id&gt;-&lt;version&gt;</code> with your JAR file name and  <code>path_to_install_plugin</code> with the actual path where you would like to install the plugin):</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>kpm install_java_plugin <span class="tok-s1">&#39;dev:hello&#39;</span> --from-source-file<span class="tok-o">=</span>PROJECT_ROOT/target/&lt;artifact_id&gt;-&lt;version&gt;.jar --destination<span class="tok-o">=</span>&lt;path_to_install_plugin&gt;</code></pre></div></div></li><li><p>Verify that the <code>&lt;artifact_id&gt;-&lt;version&gt;.jar</code> is copied at the <code>path_to_install_plugin</code> path.</p></li><li><p>Open <code>PROJECT_ROOT/profiles/killbill/src/main/resources/killbill-server.properties</code> and specify the following property (Replace <code>plugin_path</code> with the actual path where the plugin is installed. Note that if this property is not specified, Kill Bill looks for the plugin at the <code>/var/tmp/bundles/</code> path):</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="properties"><span></span><span class="tok-na">org.killbill.osgi.bundle.install.dir</span><span class="tok-o">=</span><span class="tok-s">&lt;plugin_path&gt;</span></code></pre></div></div></li><li><p>Open a command prompt/terminal window and navigate to the <strong>PROJECT_ROOT</strong>  directory. Start Kill Bill by running the following command (Replace <code>PROJECT_ROOT</code> with your actual project root):</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span> mvn -Dorg.killbill.server.properties<span class="tok-o">=</span>file:///PROJECT_ROOT/profiles/killbill/src/main/resources/killbill-server.properties -Dlogback.configurationFile<span class="tok-o">=</span>./profiles/killbill/src/main/resources/logback.xml jetty:run</code></pre></div></div></li><li><p>Verify that the following is displayed in the Kill Bill logs which confirms that the plugin is installed successfully:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>  GET /               <span class="tok-o">[</span>*/*<span class="tok-o">]</span>     <span class="tok-o">[</span>*/*<span class="tok-o">]</span>    <span class="tok-o">(</span>/HelloWorldServlet.hello<span class="tok-o">)</span>
  GET /healthcheck    <span class="tok-o">[</span>*/*<span class="tok-o">]</span>     <span class="tok-o">[</span>*/*<span class="tok-o">]</span>    <span class="tok-o">(</span>/HelloWorldHealthcheckServlet.check<span class="tok-o">)</span>
listening on:
  http://localhost:8080/plugins/hello-world-plugin/</code></pre></div></div></li><li><p>Open a browser and type http://localhost:8080/plugins/hello-world-plugin/. If the plugin is installed properly, the following should be displayed in the Kill Bill logs:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-m">2020</span>-12-09T04:58:15,750+0000 <span class="tok-nv">lvl</span><span class="tok-o">=</span><span class="tok-s1">&#39;INFO&#39;</span>, <span class="tok-nv">log</span><span class="tok-o">=</span><span class="tok-s1">&#39;HelloWorldServlet&#39;</span>, <span class="tok-nv">th</span><span class="tok-o">=</span><span class="tok-s1">&#39;http-nio-8080-exec-1&#39;</span>, <span class="tok-nv">xff</span><span class="tok-o">=</span><span class="tok-s1">&#39;&#39;</span>, <span class="tok-nv">rId</span><span class="tok-o">=</span><span class="tok-s1">&#39;b79decfb-e809-4c01-9064-cff18722a67c&#39;</span>, <span class="tok-nv">tok</span><span class="tok-o">=</span><span class="tok-s1">&#39;&#39;</span>, <span class="tok-nv">aRId</span><span class="tok-o">=</span><span class="tok-s1">&#39;&#39;</span>, <span class="tok-nv">tRId</span><span class="tok-o">=</span><span class="tok-s1">&#39;&#39;</span>, Hello world</code></pre></div></div></li></ol></div></div></div></div>
<div class="sect1"><h2 id="_a_closer_look_at_plugin_code">A Closer Look at Plugin Code</h2><div class="sectionbody"><div class="paragraph"><p>Let us now take a look at some of the important classes in the hello world plugin.</p></div>
<div class="sect2"><h3 id="_helloworldservlet">HelloWorldServlet</h3><div class="paragraph"><p>Plugins can export their own HTTP endpoints. The <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldServlet.java"><em>HelloWorldServet</em></a> provides an example of this. It exports the <code>plugins/hello-world-plugin/</code> endpoint. You can extend the <code>HelloWorldServlet</code> to add other endpoints as required.</p></div>
<div class="paragraph"><p>A few pointers about the <code>HelloWorldServlet.hello</code> method (which provides the code for the <code>plugins/hello-world-plugin/</code> endpoint):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-nd">@GET</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">hello</span><span class="tok-p">(</span><span class="tok-nd">@Local</span> <span class="tok-nd">@Named</span><span class="tok-p">(</span><span class="tok-s">&quot;killbill_tenant&quot;</span><span class="tok-p">)</span> <span class="tok-kd">final</span> <span class="tok-n">Optional</span><span class="tok-o">&lt;</span><span class="tok-n">Tenant</span><span class="tok-o">&gt;</span> <span class="tok-n">tenant</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-c1">// Find me on http://127.0.0.1:8080/plugins/hello-world-plugin</span>
        <span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;Hello world&quot;</span><span class="tok-p">);</span>
        <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">tenant</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">tenant</span><span class="tok-p">.</span><span class="tok-na">isPresent</span><span class="tok-p">()</span> <span class="tok-p">)</span> <span class="tok-p">{</span>
        	<span class="tok-n">Tenant</span> <span class="tok-n">t1</span> <span class="tok-o">=</span> <span class="tok-n">tenant</span><span class="tok-p">.</span><span class="tok-na">get</span><span class="tok-p">();</span>
        	<span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;tenant id:&quot;</span><span class="tok-o">+</span><span class="tok-n">t1</span><span class="tok-p">.</span><span class="tok-na">getId</span><span class="tok-p">());</span>
        	<span class="tok-n">login</span><span class="tok-p">();</span>
        <span class="tok-p">}</span>
        <span class="tok-k">else</span> <span class="tok-p">{</span>
        	<span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;tenant is not available&quot;</span><span class="tok-p">);</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span></code></pre></div></div>
<div class="ulist"><ul><li><p>This method provides the code for the http://localhost:8080/plugins/hello-world-plugin endpoint.</p></li><li><p>It accepts a parameter corresponding to <code>Tenant</code> which is an <code>Optional</code>.</p></li><li><p>If the headers <strong>X-Killbill-ApiKey / X-Killbill-ApiSecret</strong> are set while accessing this endpoint as shown below, Kill Bill automatically injects a <code>Tenant</code> object into the servlet.</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v -u admin:password -H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> -H <span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span> <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/hello-world-plugin&quot;</span></code></pre></div></div></li><li><p>The <code>Tenant</code> object can then be used to retrieve tenant information like <code>tenantId</code> as demonstrated in the code above.</p></li><li><p>If the headers <strong>X-Killbill-ApiKey / X-Killbill-ApiSecret</strong> are NOT set while accessing this endpoint as shown below, Kill Bill injects an empty <code>Optional</code> into the servlet.</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v -u admin:password <span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/hello-world-plugin&quot;</span></code></pre></div></div></li></ul></div></div>
<div class="sect2"><h3 id="_helloworldlistener">HelloWorldListener</h3><div class="paragraph"><p>The <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldListener.java"><em>HelloWorldListener</em></a> provides sample code for developing a notification plugin.  It listens to <a href="https://docs.killbill.io/latest/kill_bill_events.html"><em>Kill Bill events</em></a> and takes actions. You can extend this class to handle other events as required. See the <a href="https://docs.killbill.io/latest/notification_plugin.html"><em>Notification Plugin Tutorial</em></a> for further information.</p></div></div>
<div class="sect2"><h3 id="_helloworldpaymentpluginapi">HelloWorldPaymentPluginApi</h3><div class="paragraph"><p>The <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldPaymentPluginApi.java"><em>HelloWorldPaymentPluginApi</em></a> class provides sample code for developing a payment plugin. It implements the <a href="https://github.com/killbill/killbill-plugin-api/blob/d9eca5af0e37541069b1c608f95e100dbe13b301/payment/src/main/java/org/killbill/billing/payment/plugin/api/PaymentPluginApi.java"><em>PaymentPluginApi</em></a> interface. You can extend this class as required to develop a payment plugin. See the <a href="https://docs.killbill.io/latest/payment_plugin.html"><em>Payment Plugin Tutorial</em></a> for further information.</p></div></div>
<div class="sect2"><h3 id="_other_classes">Other Classes</h3><div class="paragraph"><p>In addition to the classes listed above, some of the other classes in the <code>hello-world-plugin</code> are as follows:</p></div>
<div class="ulist"><ul><li><p><a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldActivator.java"><em>HelloWorldActivator</em></a>: While building a plugin, you need to create a class similar to <code>HelloWorldActivator</code>. You need to specify your plugin name here.</p></li><li><p><a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldConfigurationHandler.java"><em>HelloWorldConfigurationHandler</em></a>: Most plugins require custom configuration. A configuration handler similar to the <code>HelloWorldConfigurationHandler</code> can be used to read the configuration properties.</p></li><li><p><a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldHealthcheck.java"><em>HelloWorldHealthcheck</em></a> and <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldHealthcheckServlet.java"><em>HelloWorldHealthcheckServlet</em></a>: Can be used to provide the health status of the plugin.</p></li></ul></div></div></div></div>
<div class="sect1"><h2 id="_enabling_per_tenant_configuration">Enabling Per-tenant Configuration</h2><div class="sectionbody"><div class="paragraph"><p>As explained <a href="https://docs.killbill.io/latest/plugin_installation.html#per-tenant-configuration"><em>here</em></a>, Kill Bill supports per tenant configuration for plugins. In order enable per tenant configuration, the following needs to be done:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create a custom configuration handler similar to <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldConfigurationHandler.java"><em>HelloWorldConfigurationHandler</em></a></p></li><li><p>Initialize it in the <code>start</code> method of your activator class as follows (see <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldActivator.java#L57">HelloWorldActivator.start</a>):</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">helloWorldConfigurationHandler</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HelloWorldConfigurationHandler</span><span class="tok-p">(</span><span class="tok-n">region</span><span class="tok-p">,</span> <span class="tok-n">PLUGIN_NAME</span><span class="tok-p">,</span> <span class="tok-n">killbillAPI</span><span class="tok-p">);</span>
<span class="tok-kd">final</span> <span class="tok-n">Properties</span> <span class="tok-n">globalConfiguration</span> <span class="tok-o">=</span> <span class="tok-n">helloWorldConfigurationHandler</span><span class="tok-p">.</span><span class="tok-na">createConfigurable</span><span class="tok-p">(</span><span class="tok-n">configProperties</span><span class="tok-p">.</span><span class="tok-na">getProperties</span><span class="tok-p">());</span>
<span class="tok-n">helloWorldConfigurationHandler</span><span class="tok-p">.</span><span class="tok-na">setDefaultConfigurable</span><span class="tok-p">(</span><span class="tok-n">globalConfiguration</span><span class="tok-p">);</span></code></pre></div></div></li></ol></div>
<div class="paragraph"><p>Now, you can use the <code>ConfigurationHandler</code> to retrieve per-tenant properties. You can see an example of this in the <a href="#retrieve_configuration_example">Authentication Steps</a> section below.</p></div></div></div>
<div class="sect1"><h2 id="_setting_up_a_breakpoint_and_debugging">Setting Up a Breakpoint and Debugging</h2><div class="sectionbody"><div class="paragraph"><p>When you start developing your own plugin, it would be useful to be able to set up a break point and debug the plugin code. This section explains how you can achieve this.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create a new environment variable <strong>MAVEN_OPTS</strong> and set it to <code>-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=n</code>.</p></li><li><p>Open Eclipse and do the following:</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Set up a break point in the HelloWorldServlet#L41.</p></li><li><p>Click <strong>Run &gt; Debug Configurations</strong>.</p></li><li><p>Double-click  <strong>New Remote Java Application</strong>.</p></li><li><p>Enter the name that you would like to give to this debug configuration in the <strong>Name</strong> field.</p></li><li><p>Click <strong>Apply</strong>.</p></li><li><p>Click <strong>Close</strong>.</p></li></ol></div></li><li><p>Restart the Kill Bill application as explained in the <a href="#deployment">"Deployment"</a> section above.</p></li><li><p>Click <code>Run &gt; Debug Configurations</code> and double click the  the Debug configuration that you created above.</p></li><li><p>This runs the application in debug mode. You can also set additional breakpoints as required.</p></li></ol></div></div></div>
<div class="sect1"><h2 id="_authentication_within_plugins">Authentication Within Plugins</h2><div class="sectionbody"><div class="paragraph"><p>In order to invoke write API operations like <code>AccountUserApi#createAccount</code>, plugin code must authenticate against Kill Bill first. Otherwise, it will result in an <code>org.apache.shiro.authz.UnauthenticatedException</code>. This section explains how authentication can be done.</p></div>
<div class="sect2"><h3 id="authentication_steps">Authentication Steps</h3><div class="paragraph"><p>In order to authenticate against Kill Bill, the following needs to be done:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Configure the plugin with custom credentials - Although plugins can use the <code>admin/password</code> credentials for authentication, it is typically not advisable to do so. This is to limit the scope of operations that plugins can execute. It is thus recommended to <em>configure plugins with custom credentials</em>. (See <a href="https://docs.killbill.io/latest/plugin_installation.html#_per-tenant-configuration"><em>Per-tenant Plugin Configuration</em></a>). So, you can configure the <code>hello-world-plugin</code> with custom credentials as follows:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
    -X POST <span class="tok-se">\</span>
    -u admin:password <span class="tok-se">\</span>
    -H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
    -H <span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span> <span class="tok-se">\</span>
    -H <span class="tok-s2">&quot;Content-Type: text/plain&quot;</span> <span class="tok-se">\</span>
    -H <span class="tok-s2">&quot;Accept: application/json&quot;</span> <span class="tok-se">\</span>
    -H <span class="tok-s2">&quot;X-Killbill-CreatedBy: demo&quot;</span> <span class="tok-se">\</span>
    -H <span class="tok-s2">&quot;X-Killbill-Reason: demo&quot;</span> <span class="tok-se">\</span>
    -H <span class="tok-s2">&quot;X-Killbill-Comment: demo&quot;</span> <span class="tok-se">\</span>
   -d <span class="tok-s1">&#39;org.killbill.billing.plugin.hello-world.credentials.username=hello-world-user</span>
<span class="tok-s1">org.killbill.billing.plugin.hello-world.credentials.password=hello-world-password&#39;</span> <span class="tok-se">\</span>
    <span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginConfig/hello-world-plugin&quot;</span></code></pre></div></div></li><li><p>Retrieve credentials in the code. For example, you can retrieve the credentials in the <code>HelloWorldListener</code> class as follows:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Properties</span> <span class="tok-n">properties</span> <span class="tok-o">=</span> <span class="tok-n">helloWorldConfigurationHandler</span><span class="tok-p">.</span><span class="tok-na">getConfigurable</span><span class="tok-p">(</span><span class="tok-n">killbillEvent</span><span class="tok-p">.</span><span class="tok-na">getTenantId</span><span class="tok-p">());</span>
<span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">username</span> <span class="tok-o">=</span> <span class="tok-n">properties</span><span class="tok-p">.</span><span class="tok-na">getProperty</span><span class="tok-p">(</span><span class="tok-s">&quot;org.killbill.billing.plugin.hello-world.credentials.username&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">password</span> <span class="tok-o">=</span> <span class="tok-n">properties</span><span class="tok-p">.</span><span class="tok-na">getProperty</span><span class="tok-p">(</span><span class="tok-s">&quot;org.killbill.billing.plugin.hello-world.credentials.password&quot;</span><span class="tok-p">);</span></code></pre></div></div></li><li><p>Invoke SecurityApi - Use the credentials obtained above to login as follows:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">killbillAPI</span><span class="tok-p">.</span><span class="tok-na">getSecurityApi</span><span class="tok-p">().</span><span class="tok-na">login</span><span class="tok-p">(</span><span class="tok-n">login</span><span class="tok-p">,</span> <span class="tok-n">password</span><span class="tok-p">);</span></code></pre></div></div></li><li><p>Invoke the necessary write API method (The code below invokes the <code>accountUserApi.createAccount</code> method):</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="java"><span></span> <span class="tok-n">osgiKillbillAPI</span><span class="tok-p">.</span><span class="tok-na">getAccountUserApi</span><span class="tok-p">().</span><span class="tok-na">createAccount</span><span class="tok-p">(</span><span class="tok-n">accountData</span><span class="tok-p">,</span> <span class="tok-n">context</span><span class="tok-p">);</span></code></pre></div></div></li><li><p>Invoke the <code>logout</code> method. This should typically be done within a <code>finally</code> clause:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">osgiKillbillAPI</span><span class="tok-p">.</span><span class="tok-na">getSecurityApi</span><span class="tok-p">().</span><span class="tok-na">logout</span><span class="tok-p">();</span></code></pre></div></div></li><li><p>You can also perform authentication within the <code>HelloWorldPaymentPluginApi</code> as well as <code>HelloWorldServlet</code>. Within the servlet, you will need to write code similar to the following:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span> <span class="tok-kt">void</span> <span class="tok-nf">login</span><span class="tok-p">(</span><span class="tok-kd">final</span> <span class="tok-n">HttpServletRequest</span> <span class="tok-n">req</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-n">String</span> <span class="tok-n">authHeader</span> <span class="tok-o">=</span> <span class="tok-n">req</span><span class="tok-p">.</span><span class="tok-na">getHeader</span><span class="tok-p">(</span><span class="tok-s">&quot;Authorization&quot;</span><span class="tok-p">);</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">authHeader</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-kd">final</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">authHeaderChunks</span> <span class="tok-o">=</span> <span class="tok-n">authHeader</span><span class="tok-p">.</span><span class="tok-na">split</span><span class="tok-p">(</span><span class="tok-s">&quot; &quot;</span><span class="tok-p">);</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">authHeaderChunks</span><span class="tok-p">.</span><span class="tok-na">length</span> <span class="tok-o">&lt;</span> <span class="tok-mi">2</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-k">try</span> <span class="tok-p">{</span>
        <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">credentials</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-p">(</span><span class="tok-n">BaseEncoding</span><span class="tok-p">.</span><span class="tok-na">base64</span><span class="tok-p">().</span><span class="tok-na">decode</span><span class="tok-p">(</span><span class="tok-n">authHeaderChunks</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span><span class="tok-p">),</span> <span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-p">);</span>
        <span class="tok-kt">int</span> <span class="tok-n">p</span> <span class="tok-o">=</span> <span class="tok-n">credentials</span><span class="tok-p">.</span><span class="tok-na">indexOf</span><span class="tok-p">(</span><span class="tok-s">&quot;:&quot;</span><span class="tok-p">);</span>
        <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">p</span> <span class="tok-o">==</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
            <span class="tok-k">return</span><span class="tok-p">;</span>
        <span class="tok-p">}</span>

        <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">login</span> <span class="tok-o">=</span> <span class="tok-n">credentials</span><span class="tok-p">.</span><span class="tok-na">substring</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">p</span><span class="tok-p">).</span><span class="tok-na">trim</span><span class="tok-p">();</span>
        <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">password</span> <span class="tok-o">=</span> <span class="tok-n">credentials</span><span class="tok-p">.</span><span class="tok-na">substring</span><span class="tok-p">(</span><span class="tok-n">p</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">).</span><span class="tok-na">trim</span><span class="tok-p">();</span>
        <span class="tok-n">killbillAPI</span><span class="tok-p">.</span><span class="tok-na">getSecurityApi</span><span class="tok-p">().</span><span class="tok-na">login</span><span class="tok-p">(</span><span class="tok-n">login</span><span class="tok-p">,</span> <span class="tok-n">password</span><span class="tok-p">);</span>
    <span class="tok-p">}</span> <span class="tok-k">catch</span> <span class="tok-p">(</span><span class="tok-n">UnsupportedEncodingException</span> <span class="tok-n">ignored</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_skipping_authentication">Skipping Authentication</h3><div class="paragraph"><p>It is also possible to skip authentication in the plugin code. For this, the following needs to be done:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Set the following property in the <a href="https://docs.killbill.io/latest/userguide_configuration.html#global_configuration_properties">Kill Bill config file</a>:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>org.killbill.security.skipAuthForPlugins<span class="tok-o">=</span><span class="tok-nb">true</span></code></pre></div></div></li><li><p>Create a <code>PluginCallContext</code> class in your code similar to the <a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/8df47156a2e80c65ce574e0ad689afd02b926f59/src/main/java/org/killbill/billing/plugin/notification/setup/PluginCallContext.java">email notification plugin PluginCallContext</a> class.</p></li><li><p>Create a <code>PluginCallContext</code> instance with <code>CallOrigin.INTERNAL</code> and <code>UserType.ADMIN</code> as follows:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">final</span> <span class="tok-n">PluginCallContext</span> <span class="tok-n">callContext</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PluginCallContext</span><span class="tok-p">(</span><span class="tok-n">UUID</span><span class="tok-p">.</span><span class="tok-na">randomUUID</span><span class="tok-p">(),</span><span class="tok-n">pluginName</span><span class="tok-p">,</span> <span class="tok-n">CallOrigin</span><span class="tok-p">.</span><span class="tok-na">INTERNAL</span><span class="tok-p">,</span><span class="tok-n">UserType</span><span class="tok-p">.</span><span class="tok-na">ADMIN</span><span class="tok-p">,</span><span class="tok-n">reasonCode</span><span class="tok-p">,</span><span class="tok-n">comments</span><span class="tok-p">,</span> <span class="tok-n">createdDate</span><span class="tok-p">,</span><span class="tok-n">updatedDate</span><span class="tok-p">,</span><span class="tok-n">accountId</span><span class="tok-p">,</span> <span class="tok-n">tenantId</span><span class="tok-p">);</span></code></pre></div></div></li><li><p>Use the above <code>callContext</code> while invoking the desired api method:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">accountUserApi</span><span class="tok-p">.</span><span class="tok-na">createAccount</span><span class="tok-p">(</span><span class="tok-n">accountData</span><span class="tok-p">,</span> <span class="tok-n">callContext</span><span class="tok-p">);</span></code></pre></div></div></li></ol></div></div></div></div>
<div class="sect1"><h2 id="_additional_notes">Additional Notes</h2><div class="sectionbody"><div class="ulist"><ul><li><p>We provide a <a href="https://github.com/killbill/killbill-plugin-framework-java">Java plugin framework</a> that can be used to implement some of the work that plugins need to do - although your plugin does not have to rely on this framework, it is often a good idea to leverage it to avoid boilerplate code.</p></li><li><p>Also, for internal reference, you might want to take a look at <a href="https://github.com/killbill/killbill-platform/blob/killbill-platform-0.36.2/osgi-bundles/libs/killbill/src/main/java/org/killbill/billing/osgi/libs/killbill/KillbillActivatorBase.java#L59">KillbillActivatorBase</a>, which provides all the abstractions that plugins require (access to java APIs, database connections, system properties, logging, &#8230;&#8203;).</p></li></ul></div></div></div>
<div class="sect1"><h2 id="_osgi_configuration">OSGi Configuration</h2><div class="sectionbody"><div class="paragraph"><p>As explained earlier, Kill Bill plugins are based on the OSGi standard. Let us now take a look at how this works and some additional OSGi configuration which may be required in some situations.</p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><strong>Note</strong>: OSGi configuration is an advanced configuration option and may be required only in rare situations. So, feel free to skip this section.</td></tr></table></div>
<div class="sect2"><h3 id="_brief_osgi_overview">Brief OSGi Overview</h3><div class="paragraph"><p>Let us first briefly understand how OSGi works. OSGi allows creating modular Java components (known as bundles) that run within an <a href="https://felix.apache.org/"><em>OSGi container</em></a>. The OSGi container ensures that each bundle is isolated from other bundles. Thus, each bundle can use any external dependencies that it requires without having to worry about conflicts.</p></div>
<div class="paragraph"><p>A bundle is nothing but a JAR file. However, its <code>manifest.mf</code> has some additional OSGi related headers.</p></div>
<div class="paragraph"><p>Although each bundle is isolated from other bundles, sometimes bundles may need to communicate/share classes with other bundles. A bundle can export a package to make the corresponding classes available for use by other bundles. A bundle can also import a package to use the classes of another bundle.</p></div>
<div class="paragraph"><p>For example if a bundle <code>bundle1</code> requires a class <code>p1.p2.A</code> from <code>bundle2</code>, <code>bundle2</code> needs to export the <code>p1.p2</code> package and <code>bundle1</code> needs to import this package. The packages imported by a bundle are specified as a <code>Import-package</code> header in the <code>manifest.mf</code> while packages exported by a bundle are specified as a <code>Export-package</code> header in the <code>manifest.mf</code>.</p></div>
<div class="paragraph"><p>The OSGi container ensures that a given bundle&#8217;s package dependencies can be satisfied before the bundle runs. Thus, if the package dependencies cannot be satisfied, the bundle will not run.</p></div></div>
<div class="sect2"><h3 id="_kill_bill_osgi_overview">Kill Bill OSGi Overview</h3><div class="paragraph"><p>Before we dive into the details, let us understand at a high-level how the import-export mechanism works in case of the core Kill Bill system and its plugins.</p></div>
<div class="ulist"><ul><li><p>The Kill Bill core itself is packaged as an OSGi bundle (referred to as system bundle). It exports several packages. This is explained in the <a href="#packages_exported_by_killbill">"Packages exported by Kill Bill"</a> section.</p></li><li><p>A plugin automatically imports any packages exported by Kill Bill. This is explained in the <a href="#packages_imported_by_plugins_by_default">"Packages Imported by Plugins by Default"</a> section.</p></li><li><p>However, in some cases, a plugin may need to explicitly import packages exported by Kill Bill. This is explained in the <a href="#importing_additional_packages_in_plugins">"Importing Additional Packages in Plugins"</a> section.</p></li></ul></div></div>
<div class="sect2"><h3 id="packages_exported_by_killbill">Packages Exported by Kill Bill</h3><div class="paragraph"><p>As explained earlier, the Kill Bill system bundle exports the packages which it desires to share with plugins. Refer to the value of the <code>org.killbill.osgi.system.bundle.export.packages.api</code> property in the <a href="https://docs.killbill.io/latest/userguide_configuration.html#configuration_properties_table"><em>Kill Bill Configuration Properties Table</em></a> to see the complete list of packages exported by default.</p></div>
<div class="paragraph"><p>Additionally, Kill Bill also offers the <code>org.killbill.osgi.system.bundle.export.packages.extra</code> property which can be used to specify additional packages to be exported by the system bundle and that could in turn be imported by a plugin.  This property can be configured as explained in the <a href="https://docs.killbill.io/latest/userguide_configuration.html"><em>Kill Bill configuration document</em></a>.</p></div></div>
<div class="sect2"><h3 id="packages_imported_by_plugins_by_default">Packages Imported by Plugins by Default</h3><div class="paragraph"><p>As explained earlier, Kill Bill plugins are packaged as OSGi bundles. The <a href="http://felix.apache.org/documentation/subprojects/apache-felix-maven-bundle-plugin-bnd.html"><em>maven-bundle-plugin</em></a> specified in the <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/pom.xml"><em>pom.xml</em></a> is responsible for packaging a plugin as an OSGi bundle. Thus, the <code>maven-bundle-plugin</code> takes care of creating the jar with the correct OSGi headers (including adding the required packages to the <code>Import-Package</code> header). In addition, the <a href="https://github.com/killbill/killbill-oss-parent/blob/f3d9725cc7759a54eb6f978b3d3f763e1d170021/pom.xml"><em>killbill-oss-parent pom</em></a> file (which is the parent of the plugin <code>pom.xml</code> file) also specifies the packages to be included in the <code>Import-Package</code> header.</p></div>
<div class="paragraph"><p>Thus, when a plugin is built, the <code>Import-Package</code> header is automatically computed based on:</p></div>
<div class="ulist"><ul><li><p>Packages computed by the <code>maven-bundle-plugin</code>.</p></li><li><p>Packages specified in the <code>killbill-oss-parent</code> pom file.</p></li></ul></div></div>
<div class="sect2"><h3 id="importing_additional_packages_in_plugins">Importing Additional Packages in Plugins</h3><div class="paragraph"><p>Sometimes, a plugin may require to use some additional packages from Kill Bill (other than those automatically imported as specified above). In such cases, you will need to explicitly <strong>export</strong> the package from Kill Bill and <strong>import</strong> it in the plugin as explained below.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>All the packages exported by Kill Bill by default are specified as the value of the <code>org.killbill.osgi.system.bundle.export.packages.api</code> property in the <a href="https://docs.killbill.io/latest/userguide_configuration.html"><em>Kill Bill Configuration Properties Table</em></a>. Check whether the desired package is already present in this list.</p></li><li><p>If Kill Bill does not already export the package, add the following property in the <a href="https://docs.killbill.io/latest/userguide_configuration.html"><em>Kill Bill configuration file</em></a>:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>org.killbill.osgi.system.bundle.export.packages.extra<span class="tok-o">=</span>&lt;package1&gt;,&lt;package2&gt;..&lt;packagen&gt;</code></pre></div></div></li><li><p>Open plugin <code>pom.xml</code> and specify the following in the <code>properties</code> section (Replace <code>&lt;package&gt;</code> with the fully qualified name of the package that you would like to export):</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span> <span class="tok-nt">&lt;osgi.extra-import&gt;</span>
            <span class="tok-nt">&lt;package1&gt;</span>;
            <span class="tok-nt">&lt;package2&gt;</span>;
            ....
            <span class="tok-nt">&lt;packagen&gt;</span>
<span class="tok-nt">&lt;/osgi.extra-import&gt;</span></code></pre></div></div></li><li><p><a href="#build">Build</a> the plugin using Maven as specified above.</p></li></ol></div>
<div class="paragraph"><p>This causes the package to be added to the <code>Import-Package</code> header of the plugin jar. You can see an example of this in the <a href="https://github.com/killbill/killbill-adyen-plugin/blob/0c5205d2ee42b543852e7cbd1a6f6f065ad575e5/pom.xml#L44"><em>Kill Bill Adyen Plugin pom file</em></a>.</p></div></div>
<div class="sect2"><h3 id="_exporting_additional_packages_from_a_plugin">Exporting Additional Packages from a Plugin</h3><div class="paragraph"><p>A plugin can also export packages corresponding to the classes that it wants to share with other plugins. This mechanism is particularly useful since it allows plugins to share custom functionality with other plugins.</p></div>
<div class="paragraph"><p>To <strong>export</strong> a package from a plugin, you need to follow the steps given below.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Open plugin <code>pom.xml</code>. Specify the following in the <code>properties</code> section (Replace <code>&lt;package&gt;</code> with the fully qualified name of the package that you would like to export):</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;osgi.export&gt;</span>
  <span class="tok-nt">&lt;package1&gt;</span>,
  <span class="tok-nt">&lt;package2&gt;</span>
   ....
  <span class="tok-nt">&lt;packagen&gt;</span>
<span class="tok-nt">&lt;/osgi.export&gt;</span></code></pre></div></div></li><li><p><a href="#build">Build</a> the plugin using Maven as specified above.</p></li></ol></div>
<div class="paragraph"><p>This causes the specified packages to be added to the <code>Export-Package</code> header of the plugin jar. Other plugins can then use the classes in these packages by importing them as explained above.</p></div>
<div class="paragraph"><p>In order to see an example of a plugin exporting packages, you can refer to the <a href="https://github.com/killbill/killbill-email-notifications-plugin"><em>email notification plugin</em></a>. It <a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/819f4659825684131cf9a5f77b818d56dd86d163/pom.xml#L46"><em>exports</em></a> packages required for creating a custom invoice formatter. The <a href="https://github.com/killbill/killbill-custom-invoice-formatter-example"><em>custom invoice formatter</em></a> plugin (which is a sample plugin) then <a href="https://github.com/killbill/killbill-custom-invoice-formatter-example/blob/79e2f63cb536263f0272fdc9182e961f2616c5e3/pom.xml#L43"><em>imports</em></a> these packages to customize the email invoice.</p></div></div></div></div>
<div class="sect1"><h2 id="_faq">FAQ</h2><div class="sectionbody"><div class="paragraph"><p>This section lists some common errors that are encountered while developing plugins and how you can fix them.</p></div>
<div class="sect2"><h3 id="_authentication_error">Authentication Error</h3><div class="paragraph"><p>Sometimes, you may see the <code>org.apache.shiro.authz.UnauthenticatedException: This subject is anonymous</code>. This occurs when your plugin code invokes any of the read/write Kill Bill operations without authenticating against Kill Bill. So, you first need to invoke <code>SecurityApi#login</code> API. See <a href="#authentication_steps">"Authentication Steps"</a> section.</p></div></div>
<div class="sect2"><h3 id="_maven_build_error">Maven Build Error</h3><div class="paragraph"><p>Sometimes, when you build the code using <code>mvn clean install</code> you may see some build errors as follows:</p></div>
<div class="ulist"><ul><li><p>Enforcer error:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>Failed to execute goal org.apache.maven.plugins:maven-enforcer-plugin:3.0.0-M3:enforce <span class="tok-o">(</span>default<span class="tok-o">)</span> on project killbill-plugin-momo: Some Enforcer rules have failed.</code></pre></div></div>
<div class="paragraph"><p>This generally occurs when your <code>pom.xml</code> contains dependencies that are not recommended. In such cases, we recommend that you fix the POM file and rerun the build, or run the build with the <code>-Dcheck.fail-enforcer=false</code> option.</p></div></li><li><p>Spotbugs error:
Kill Bill automatically performs <code>spotbugs</code> checks when running <code>mvn verify</code>. So, this may result in some <a href="https://spotbugs.readthedocs.io/en/stable/bugDescriptions.html">spotbugs</a> errors.</p><div class="paragraph"><p>In such cases, we recommend that you fix the spotbugs errors and rerun the build, or run the build with the <code>-Dcheck.fail-spotbugs=false</code> option.</p></div></li><li><p>Other errors:
The build process has several checks in place to make sure the right dependencies are pulled in (for example, there are no duplicate dependencies, there are no obvious bugs, etc.). If you&#8217;d like to ignore all these checks and still proceed with the build, you can run the following command:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>mvn clean install -Dcheck.fail-enforcer<span class="tok-o">=</span><span class="tok-nb">false</span> -Dcheck.fail-dependency<span class="tok-o">=</span><span class="tok-nb">false</span> -Dcheck.fail-dependency-scope<span class="tok-o">=</span><span class="tok-nb">false</span> -Dcheck.fail-dependency-versions<span class="tok-o">=</span><span class="tok-nb">false</span> -Dcheck.fail-duplicate-finder<span class="tok-o">=</span><span class="tok-nb">false</span> -Dcheck.fail-enforcer<span class="tok-o">=</span><span class="tok-nb">false</span> -Dcheck.fail-spotbugs<span class="tok-o">=</span><span class="tok-nb">false</span> -Dcheck.ignore-rat<span class="tok-o">=</span><span class="tok-nb">true</span></code></pre></div></div></li></ul></div></div>
<div class="sect2"><h3 id="_java_lang_noclassdeffounderror_or_java_lang_classnotfoundexception">java.lang.NoClassDefFoundError or java.lang.ClassNotFoundException</h3><div class="paragraph"><p>Sometimes, when you develop a custom plugin, a <code>java.lang.NoClassDefFoundError</code> or a <code>java.lang.ClassNotFoundException</code> exception may occur on starting Kill Bill. This is most probably because the class in question is not present on the classpath.</p></div>
<div class="paragraph"><p>For a plugin to work, any classes used by the plugin must be present on the classpath. So, the class needs to be present in the <strong>plugin jar</strong> itself or it must be <strong>imported</strong> from Kill Bill. Refer to the <a href="#importing_additional_packages_in_plugins">"Importing Additional Packages in Plugins"</a> section above for further details.</p></div></div>
<div class="sect2"><h3 id="_payment_plugin_xxx_is_not_registered_error">"Payment plugin xxx is not registered" Error</h3><div class="paragraph"><p>Sometimes, when you develop a custom payment plugin, you may see a <code>Payment plugin xxx is not registered</code> error. This is typically because the plugin is not registered as a payment plugin in your activator class. Ensure that it is registered as shown <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/2dd9cbddb3f9e7a56cb4a217fcc12bc97c0795e2/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldActivator.java#L70">here</a>.</p></div></div></div></div>
<div class="sect1"><h2 id="_further_reading">Further Reading</h2><div class="sectionbody"><div class="ulist"><ul><li><p><a href="https://docs.killbill.io/latest/plugin_installation.html"><em>Plugin Layout, Installation, and Configuration</em></a></p></li><li><p><a href="https://docs.killbill.io/latest/plugin_management.html"><em>Plugin Management</em></a></p></li></ul></div></div></div></div></article></div><div class="bd-links-wrapper"><nav class="bd-links toc right-side-menu" id="toc" data-toggle="toc"></nav></div></div></div></main><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script><script src="https://cdn.staticaly.com/gh/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script><script src="https://www.googletagmanager.com/gtag/js?id=G-C0HVJ1E78Z"></script><script>
    setTimeout(function(){
      $('.content-wrapper h2, .content-wrapper h3, .content-wrapper h4').append('<a href=""><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>');
      $('.content-wrapper h2, .content-wrapper h3, .content-wrapper h4').each(function(){
        let itemHref = '#' + $(this).attr('id');
        $(this).find('a').attr("href", itemHref);
      })
      $('.content-wrapper table').each(function() {
        $(this).wrap('<div class="table-wrap"></div>')
        $('.table-wrap').each(function() {
          if ($(this).find('table').width() > $(this).width()){
            $(this).css('max-width', '100%');
            $(this).css('overflow-x', 'scroll');
          }
        })
      })
      function copyToClipboard(text) {
        let sampleTextarea = document.createElement("textarea");
        document.body.appendChild(sampleTextarea);
        sampleTextarea.value = text;
        sampleTextarea.select();
        document.execCommand("copy");
        document.body.removeChild(sampleTextarea);
      }
      $('.content-wrapper h2 a, .content-wrapper h3 a, .content-wrapper h4 a').on('click', function(){
        setTimeout(function(){
          copyToClipboard($(location).attr("href"));
        }, 500);
      });
      $('.content-wrapper .note td.icon').append('<img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/note-icon.png">');

      $('.content pre').parent('.content').prepend('<div class="copy-icon"><svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a1 1 0 0 1 1-1h2a1 1 0 1 1 0 2H9a1 1 0 0 1-1-1Z" fill="#78AECD"/><path d="M6 3a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2 3 3 0 0 1-3 3H9a3 3 0 0 1-3-3Z" fill="#78AECD"/></svg></div>');
      $('.copy-icon svg').on('click', function () {
        copyToClipboard($(this).parent().next().find('code').text());
      });
    }, 1000);

    $('.main').append('<div class="lightbox-modal"> <div id="close-ligtbox">✕</div> <div class="img"><img src="" alt=""></div></div><div class="overlay"></div>');
    $('.main img').on('click', function () {
      let path = $(this).attr('src');
      $('.lightbox-modal img').attr('src', path);
      $('.lightbox-modal, .overlay').show();
    });
    $('#close-ligtbox, .overlay').on('click',function () {
      $('.lightbox-modal, .overlay').hide();
    });

$('.sidebar-toggler').on('click', function () {
  $(this).toggleClass('active');
  $('main.main').toggleClass('sidebar-hide');
});

$('.content-wrapper a').filter(function() {
  return this.hostname && this.hostname !== location.hostname;
}).each(function() {
  $(this).attr({
    target: '_blank',
    title: 'Visit ' + this.href + ' (click to open in a new window)'
  });
});

  </script><script>docsearch({apiKey: '3ef227e7fd5e2e1a3fffd880484934bf', container: '#docsearch', appId: 'S2ISXITURI', indexName: 'killbill'});</script><script>window.dataLayer = window.dataLayer || [];
function gtag(){window.dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-C0HVJ1E78Z');</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create','UA-32705710-3','auto');
  ga('send','pageview');
  var getOutboundLink = function(url) {
    ga('send', {
      hitType: 'event',
      eventCategory: 'outbound',
      eventAction: 'click',
      eventLabel: url,
      hitCallback: function(){document.location = url;}
    });
  }</script></body></html>