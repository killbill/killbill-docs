<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 2.0.12"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.staticaly.com/gh/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.css"><title>Kill Bill Migration Guide</title><style>/*Default CSS*/

/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
/* html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%} */
body{margin:0}
a{background:transparent; text-decoration: none !important;}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
/* button,input,select,textarea{font-family:inherit;font-size:100%;margin:0} */
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
/* body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto} */
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
    h1{font-size:2.75em}
    h2{font-size:2.3125em}
    h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
    h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
    body.toc2{padding-left:15em;padding-right:0}
    #toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
    #toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
    #toc.toc2>ul{font-size:.9em;margin-bottom:0}
    #toc.toc2 ul ul{margin-left:0;padding-left:1em}
    #toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
    body.toc2.toc-right{padding-left:0;padding-right:15em}
    body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
    #toc.toc2{width:20em}
    #toc.toc2 #toctitle{font-size:1.375em}
    #toc.toc2>ul{font-size:.95em}
    #toc.toc2 ul ul{padding-left:1.25em}
    body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:#2E3336;padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
    *{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
    a{color:inherit!important;text-decoration:underline!important}
    a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
    a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
    abbr[title]:after{content:" (" attr(title) ")"}
    pre,blockquote,tr,img{page-break-inside:avoid}
    thead{display:table-header-group}
    img{max-width:100%!important}
    p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
    h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
    #toc,.sidebarblock,.exampleblock>.content{background:none!important}
    #toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
    .sect1{padding-bottom:0!important}
    .sect1+.sect1{border:0!important}
    #header>h1:first-child{margin-top:1.25rem}
    body.book #header{text-align:center}
    body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
    body.book #header .details{border:0!important;display:block;padding:0!important}
    body.book #header .details span:first-child{margin-left:0!important}
    body.book #header .details br{display:block}
    body.book #header .details br+span:before{content:none!important}
    body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
    body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
    .listingblock code[data-lang]:before{display:block}
    #footer{background:none!important;padding:0 .9375em}
    #footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
    .hide-on-print{display:none!important}
    .print-only{display:block!important}
    .hide-for-print{display:none!important}
    .show-for-print{display:inherit!important}}

  .listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */

/*Custom CSS*/
body {
  background: #F5F5F5;
}
#header-main-title {
  float: left;
}
#cards {
  clear: both;
}
#cards .btn-primary {
  background-color: #1F7CB5;
  border-color: #1F7CB5;
}
#asciinema-player-section {
  margin-bottom: 25px;
}
/* .container{
    max-width: 100%;
} */
.logo{
    width: 70%;
    padding-top: 20px;
    padding-bottom: 10px;
}
#main-row {
  min-height: 100%;
  height: 100%;
}
#toc {
  border-bottom: none;
  /* position: fixed; */
  overflow-y: auto;
  margin:0;
top: 0px;
z-index: 9;
/* position: relative !important; */
  
}

#toc .nav-link {
  font-size: 13px;
}
.toc{
  margin-top: 116px;
  max-width: 223px;

}
#toctitle{
    font-size: 1.2em;
}
#aws-link {
  width: 80%;
}
.sectlevel1{
    padding-left: 7px;
}
/* .border-columns{ */
    /* background-color: #2E3336; */
/* } */
.footer {
    display: block;
    bottom: 0;
    width: 75%;
    height: 40px;
    line-height: 40px;
    background-color: #2E3336;
    margin: 0 auto;
}
.footer > .container {
    padding-right: 15px;
    padding-left: 15px;
}
nav[data-toggle=toc] .nav>li>a {
    display: block;
    padding: 4px 20px;
    font-size: 13px;
    font-weight: 500;
    color: rgba(0,0,0,.65);
}
nav[data-toggle=toc] .nav>li>a:hover {
    background-color: #ba3925;
    color: rgba(0,0,0,.65);
}
.text-muted {
    color: rgba(0,0,0,.65)!important;
}
/* nav[data-toggle='toc'] {
    top: 80px;
} */
nav[data-toggle=toc] .nav .nav>li>a, nav[data-toggle=toc] .nav .nav>li>a:focus, nav[data-toggle=toc] .nav .nav>li>a:hover {
    padding-left: 10px;
}
nav[data-toggle=toc] .nav .nav>li>.active, nav[data-toggle=toc] .nav .nav>li>.active:focus, nav[data-toggle=toc] .nav .nav>li>.active:hover, nav[data-toggle=toc] .nav-link.active, nav[data-toggle=toc] .nav-link.active:focus, nav[data-toggle=toc] .nav-link.active:hover {
    padding-left: 10px;
    font-weight: 700;
    color: #ba3925;
    background-color: transparent;
    border-left: 2px solid #ba3925;
}
#toc > ul > li > ul {
  margin-left: 10px;
}

/* small screens */
@media (max-width: 767px) {
    /* override stickyness so that the navigation does not follow scrolling */
    nav[data-toggle='toc'] {
        margin-bottom: 42px;
        /* position: static !important; */
    }
    nav[data-toggle='toc'] .nav .active .nav {
        display: none;
    }
    #aws-link {
      width: 50%;
      margin-bottom: 5px;
    }
}



html,
body {
  height: 100%;
}

/* Scrollbar styles */
#toc::-webkit-scrollbar {
  width: 3px;
}

/* Track */
#toc::-webkit-scrollbar-track {
  background: transparent;
}

/* Handle */
#toc::-webkit-scrollbar-thumb {
  background: rgb(182, 182, 182);
}

/* Handle on hover */
#toc::-webkit-scrollbar-thumb:hover {
  background: rgb(163, 163, 163);
}

/* Gernal styles */
.toggle-nav-btn {
  position: absolute;
  right: 30px;
  top: 34px;

}
.bd-sidebar {
  height: 100vh !important;
  
}
.bd-sidebar .nav>li>a {
  padding-left: 10px;
  margin-left: 5px;
}
.main-link {
  border-left: 2px solid #ba3925;
  color: #ba3925 !important;
  cursor: pointer;
  font-weight: bold;
}

/* card styles */
.card-wrapper {
  height: 280px;
  -webkit-box-shadow: 0 0 30px rgba(0, 0, 0, 0.1); /* Safari 3-4, iOS 4.0.2 - 4.2, Android 2.3+ */
  -moz-box-shadow: 0 0 30px rgba(0, 0, 0, 0.1); /* Firefox 3.5 - 3.6 */
  box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
}
.card-wrapper .card-body {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}
.card-wrapper .card-body .card-title {
  color: #ba3925;
  font-size: 22px;
  font-weight: 500;
}
#cards .btn-primary {
  background-color: #1f7cb5;
  border-color: #1f7cb5;
}
.LogoAndToggle{
  border-bottom: 1px solid gainsboro;
    margin: 0px;
    display: block;
    padding-bottom: 10px;
     background: whitesmoke;
}
/* media quires */
@media (max-width: 767px) {
  .bd-sidebar {
    height: 100px !important;
    border: 0;
  }

  #toc{
    min-width: 100%;
    top: 93px;
  }
  #toc.show{
    border-bottom: none;
    left: 0;
    min-width: 100%;
    margin: 0;
    box-shadow: 0px 7px 10px 2px #ababab3b;
  }
  .LogoAndToggle{
    display: flex;
    justify-content: space-around;
    position: fixed;
    width: 100%;
   margin: 0;

  }
  .bd-links {
    background: white;
    z-index: 9;
    position: relative;
    max-height: 300px;
    overflow-y: scroll;
    margin-top: -5px;
    border-bottom: 1px solid #d6d6d6;
  }
}
@media (min-width: 768px) {
  .bd-links {
    height: 100% !important;
    overflow-y: auto;
    display: block !important;
  }
  #toc {
   position: relative;
    top: 0;
    max-width: 100%;
    margin: 0;
  }
  .toc{
    height: calc(100vh - 97px) !important;
  }
  .bd-sidebar {
    padding-right: 20px;
    top: 0 !important;
  }
}

.bdr-right{
  border-right: 1px solid gainsboro;
}
.bdr-left{
  border-left: 1px solid gainsboro;
}


nav[data-toggle=toc] .nav>li>a:focus, nav[data-toggle=toc] .nav>li>a:hover{
  border-left: 2px solid #ba3925;
}
nav[data-toggle=toc] .nav>li>a:hover{
  background-color: #ba39251a;
  color: rgba(0,0,0,.65);
}
pre.pygments .tok-n {
    color: rgba(0,0,0,.9) !important;
}</style>
<style>pre { line-height: 125%; }
td.linenos pre { color: #000000; background-color: #f0f0f0; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #000000; background-color: #f0f0f0; padding-left: 5px; padding-right: 5px; }
td.linenos pre.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
pre.pygments .hll { background-color: #49483e }
pre.pygments { background: #272822; color: #f8f8f2 }
pre.pygments .tok-c { color: #75715e } /* Comment */
pre.pygments .tok-err { color: #960050; background-color: #1e0010 } /* Error */
pre.pygments .tok-k { color: #66d9ef } /* Keyword */
pre.pygments .tok-l { color: #ae81ff } /* Literal */
pre.pygments .tok-n { color: #f8f8f2 } /* Name */
pre.pygments .tok-o { color: #f92672 } /* Operator */
pre.pygments .tok-p { color: #f8f8f2 } /* Punctuation */
pre.pygments .tok-ch { color: #75715e } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #75715e } /* Comment.Multiline */
pre.pygments .tok-cp { color: #75715e } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #75715e } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #75715e } /* Comment.Single */
pre.pygments .tok-cs { color: #75715e } /* Comment.Special */
pre.pygments .tok-gd { color: #f92672 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gi { color: #a6e22e } /* Generic.Inserted */
pre.pygments .tok-go { color: #66d9ef } /* Generic.Output */
pre.pygments .tok-gp { color: #f92672; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #75715e } /* Generic.Subheading */
pre.pygments .tok-kc { color: #66d9ef } /* Keyword.Constant */
pre.pygments .tok-kd { color: #66d9ef } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #f92672 } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #66d9ef } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #66d9ef } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #66d9ef } /* Keyword.Type */
pre.pygments .tok-ld { color: #e6db74 } /* Literal.Date */
pre.pygments .tok-m { color: #ae81ff } /* Literal.Number */
pre.pygments .tok-s { color: #e6db74 } /* Literal.String */
pre.pygments .tok-na { color: #a6e22e } /* Name.Attribute */
pre.pygments .tok-nb { color: #f8f8f2 } /* Name.Builtin */
pre.pygments .tok-nc { color: #a6e22e } /* Name.Class */
pre.pygments .tok-no { color: #66d9ef } /* Name.Constant */
pre.pygments .tok-nd { color: #a6e22e } /* Name.Decorator */
pre.pygments .tok-ni { color: #f8f8f2 } /* Name.Entity */
pre.pygments .tok-ne { color: #a6e22e } /* Name.Exception */
pre.pygments .tok-nf { color: #a6e22e } /* Name.Function */
pre.pygments .tok-nl { color: #f8f8f2 } /* Name.Label */
pre.pygments .tok-nn { color: #f8f8f2 } /* Name.Namespace */
pre.pygments .tok-nx { color: #a6e22e } /* Name.Other */
pre.pygments .tok-py { color: #f8f8f2 } /* Name.Property */
pre.pygments .tok-nt { color: #f92672 } /* Name.Tag */
pre.pygments .tok-nv { color: #f8f8f2 } /* Name.Variable */
pre.pygments .tok-ow { color: #f92672 } /* Operator.Word */
pre.pygments .tok-w { color: #f8f8f2 } /* Text.Whitespace */
pre.pygments .tok-mb { color: #ae81ff } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #ae81ff } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #ae81ff } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #ae81ff } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #ae81ff } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #e6db74 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #e6db74 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #e6db74 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #e6db74 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #e6db74 } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #e6db74 } /* Literal.String.Double */
pre.pygments .tok-se { color: #ae81ff } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #e6db74 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #e6db74 } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #e6db74 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #e6db74 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #e6db74 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #e6db74 } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #a6e22e } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #f8f8f2 } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #f8f8f2 } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #f8f8f2 } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #f8f8f2 } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #ae81ff } /* Literal.Number.Integer.Long */</style></head><body data-spy="scroll" data-target="#toc" class="book"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 bd-sidebar sticky-top border-columns border-right p-0"><div class="mx-auto text-center LogoAndToggle"><a href="/0.22/"><img class="logo rounded mx-auto d-block img-fluid" src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/logo.png" /></a><button class="btn btn-link bd-search-docs-toggle d-md-none p-0 ml-3 toggle-nav-btn" type="button" data-toggle="collapse" data-target="#toc" aria-controls="toc" aria-expanded="false" aria-label="Toggle docs navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"></path></svg></button></div><nav class="collapse bd-links toc" id="toc" data-toggle="toc"></nav></div><div class="col-12 col-md-9 col-xl-10 border-right"><div id="header"><h1>Kill Bill Migration Guide</h1></div><div id="content"><div class="sect1"><h2 id="_overview">Overview</h2><div class="sectionbody"><div class="paragraph"><p>This guide is intended to provide some guidelines for running migrations from an <strong>existing billing system</strong> to <strong>Kill Bill</strong>.
It is by no means an exact recipe book to follow, but it provides some recommendations on how to do things (based on previous experiences) and highlights some specific areas of concern. The assumption is that there is already an internal or third party billing system in place, and so the goal of the migration is to preserve the current state of the system and yet reach a point where this old system can be fully unplugged. The old billing system currently:</p></div>
<div class="ulist"><ul><li><p>receives some live traffic, and migration should not cause any downtime</p></li><li><p>contains existing state (subscriptions, invoices, &#8230;&#8203;) that needs to be migrated without impacting customers</p></li><li><p>offers apis that are used by one or several systems within the company</p></li><li><p>provides a UI for customer service (CS) to handle customer tickets and that functionality still needs to exist in some form</p></li><li><p>provides state/data that is used by accounting/financial departments and this data will need to remain available for these departments</p></li></ul></div>
<div class="paragraph"><p>The end goal of the migration is to make sure that we can <strong>unplug completely the old billing system</strong> and yet provide the same level of service (or better) for the customers and the various departments in the organization.</p></div>
<div class="paragraph"><p>This is a fairly ambitious goal, which may require some tradeoffs and a gradual shutdown of the old system.</p></div></div></div>
<div class="sect1"><h2 id="_strategy">Strategy</h2><div class="sectionbody"><div class="paragraph"><p>Like most complicated projects, it makes sense to divide the project in stages and to look for opportunities to simplify the requirements.  Also, it makes sense to first make a migration while preserving existing functionality to keep the number of changing parts to a minimum. Additional functional modifications can come at a later phase when things are stable.</p></div>
<div class="sect2"><h3 id="_what_really_needs_to_be_migrated">What (Really) Needs to be Migrated?</h3><div class="paragraph"><p>One must first decide on the data that must be migrated, so let&#8217;s start by the minimum amount of data that needs to be migrated:</p></div>
<div class="ulist"><ul><li><p><strong>Account data</strong>: All of the customer information such as name, email, phone, address, &#8230;&#8203; pretty much everything that would fit in the Kill Bill <code>accounts</code> table. If additional data needs to be kept, one could use custom fields to add key-value parameters attached to the account data.</p></li><li><p><strong>Active Subscriptions</strong>: In order for users to still be billed and receive service, those need to be migrated and in a way to allow to switch from one system to the next with no (minimum) impact/visibility. Also note that since we are looking at the minimal amount of data to migrate, we can ignore the historical data associated with a given subscription (for example, we won&#8217;t migrate downgrades or upgrades that happened in the past, only the current state).</p></li></ul></div></div>
<div class="sect2"><h3 id="_simplifications">Simplifications</h3><div class="sect3"><h4 id="_historical_data_invoices_and_payments">Historical Data, Invoices and Payments</h4><div class="paragraph"><p>Other state such as non-active subscriptions, past invoices, and payments <strong>don&#8217;t need</strong> to be migrated into Kill Bill to have the system function correctly, but <strong>that data may still need to be available in some fashion</strong>. By not migrating that data into Kill Bill, this simplifies the problem:</p></div>
<div class="ulist"><ul><li><p><strong>Non active subscriptions</strong>: Migrating those means migrating more data; also it is often the case that the older the data, the less 'clean' it is and the harder it is to migrate (associated <code>Plans</code> may not be active anymore, previous bugs from existing billing systems may create data that is difficult to migrate, &#8230;&#8203;). Also, while this is feasible, this does not add much value unless one wants to also migrate past invoices.</p></li><li><p><strong>Past Invoices</strong>: Those are difficult to migrate as such, because they can&#8217;t simply be replayed by Kill Bill (if we were to migrate all subscriptions with their historical state and let Kill Bill catch up with invoices, the result would be a set of invoices not exactly identical to the original system (pro-ration logic would be different, catalog may have been configured slightly differently in the old system and in Kill Bill, &#8230;&#8203;) and so those would not be useful as they could not provide a real replacement for past invoices. Another strategy would be to insert them manually in the Kill Bill invoice table to make sure they exactly match, but then invoices and subscriptions would not correspond exactly and the system would try to correct the state. Also, such a route would require inserting data directly or providing custom endpoints to touch these tables, both of which are risky and error prone initiatives.</p></li><li><p><strong>Past Payments</strong>: The same set of issues described for invoices apply to payments. They need to match exactly past invoices and the same set of challenges exists here.</p></li></ul></div>
<div class="paragraph"><p>We identified the minimal state that needs to be migrated and also explored why migrating more is a difficult endeavor. The next question is whether this is a realistic strategy. One way to answer is to look at the use cases for this data (that we don&#8217;t plan to migrate directly into Kill Bill), and the way we can make that info available in some fashion:</p></div>
<div class="ulist"><ul><li><p><strong>Customer Use Case</strong>: Customers may still need to access their old invoices and payments. Assuming this data is static, one could keep those (past invoices and payments) outside of the pure Kill Bill tables (that could still be in the same database with additional tables, or using an entirely different database) and <strong>provide new apis that would fetch existing invoices and payments by merging old data with the new one from Kill Bill</strong>.
However, keeping that data completely static is a challenge because customers may still require some invoice adjustments, payment refunds associated with this old data, etc.  A good strategy is to keep the old billing system alive for a while after the migration has been completed and serve those invoices/payments from the old system, allowing customer service to still make the changes through the old system. After a while (maybe a few months), there will be very few such adjustments to make on those old invoices/payments and that data can be fetched and served from a static source. Isolated cases where customers still require some changes associated with these old invoices/payments cannot be made anymore but customer could still be satisfied by generating invoice or payment credit. At this point Accounting/Finance departments would be impacted minimally because the number of such requests becomes very small. So finally the old system can be fully unplugged.</p></li><li><p><strong>Finance/Accounting department</strong>: These teams will still require old invoice and payment data to run reports but it does not necessarily need to be part of Kill Bill. A good alternative is to provide some kind of view that will merge both the old data (from the old billing system) and the new data coming from Kill Bill. The old data could be ETL&#8217;ed from the old billing system as long as it is alive and then that data could be frozen after it has been turned off.</p></li></ul></div></div>
<div class="sect3"><h4 id="_clean_accounts">Clean Accounts</h4><div class="paragraph"><p>A corollary of what we described earlier is that we should only migrate clean accounts, i.e accounts that have a $0 balance. Any other account would have unpaid invoices, and since we don&#8217;t plan on migrating invoices, that balance is hard to carry over in a clean form.</p></div>
<div class="paragraph"><p>A good and easy strategy here is to do the migration in several batches, making sure we reach a point of convergence:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>A first migration batch with all clean accounts (preferably, the bulk of them)</p></li><li><p>The current dunning strategy should be in place to first email customers, and moving through a gradual degrade of the service up to the point where subscriptions either become paid (and then accounts can be migrated) or subscriptions become cancelled (invoices are written off), and there is nothing to migrate for that account. This means unplugging the system will not happen overnight, this will be a gradual process (typically most accounts are migrated within a week, and then the system stays up for a few more months).</p></li><li><p>The point of convergence is eventually reached because:</p><div class="ulist"><ul><li><p>existing customers who have unpaid invoices either pay and get migrated or don&#8217;t pay and become inactive in the old system</p></li><li><p>new customers are already on the new system and so they will not impact the final date at which the old system could be unplugged (more on that later)</p></li></ul></div></li></ol></div></div></div>
<div class="sect2"><h3 id="_how_does_the_migration_work">How Does The Migration Work?</h3><div class="sect3"><h4 id="_migration_cutover_dates">Migration Cutover Dates</h4><div class="paragraph"><p>The first thing to discuss is the <strong>cutOverDate</strong>, that is the date at which Kill Bill starts handling requests. In fact, we made the assumption that the migration would happen on a live system (with no downtime), and that has two consequences:</p></div>
<div class="ulist"><ul><li><p>The first consequence is that there needs to be a point in time where <strong>new accounts</strong> will be created in Kill Bill. While this is not a migration data issue (because those new accounts would never see the old system, so there is no data to migrate per say), we still need to define when is that <strong>newAccountCutOverDate</strong></p></li><li><p>The second consequence is that because we will make that migration work with no downtime, it does not need to happen all at once. In fact, we propose to migrate the existing accounts on a per account basis. That way, each account is migrated independently (and occasional failures can be investigated and retried). So, we will have one <strong>cutOverDate</strong> per account.</p></li></ul></div>
<div class="paragraph"><p>Assuming we have N existing accounts to migrate, we end up with one <strong>newAccountCutOverDate</strong> and N <strong>cutOverDate</strong>. We first need to move new accounts to Kill Bill before migrating any of the existing accounts (i.e. <code>newAccountCutOverDate</code> &lt; <code>cutOverDate{i, i E [1, N]}</code> because:</p></div>
<div class="ulist"><ul><li><p>Only when the old billing system stops accepting new accounts can we compute how many existing accounts there are (N becomes fixed at this point),</p></li><li><p>This also allows us to verify that Kill Bill works as expected before we start migrating existing data.</p></li></ul></div></div>
<div class="sect3"><h4 id="_migration_framework">Migration Framework</h4><div class="paragraph"><p>The migration code consists of several pieces:</p></div>
<div class="ulist"><ul><li><p>Ability to make api calls to the old billing system (may already exist in some form)</p></li><li><p>Ability to make api calls to Kill Bill (mandatory to handle new accounts, regardless of migration data)</p></li><li><p>Ability to route traffic to one (or both systems)</p></li><li><p>Provide migration apis:</p><div class="ulist"><ul><li><p>Ability to set/get <strong>newAccountCutOverDate</strong></p></li><li><p>Ability to migrate specific accounts (would set things like <strong>cutOverDate</strong> for that account)</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>The choice of where those pieces are implemented really depends on the current architecture of the system. For instance, if the code interacting with the existing billing system is well isolated, those new functions could take place at this level (client side). Conversely, if there are many components already interacting with the existing billing system, it might make sense to provide a new proxy server that encapsulates all of that logic and have those components go through that proxy (and from an implementation point of view, that proxy server could live in the same webapp as Kill Bill and access some new tables in the same database).</p></div>
<div class="paragraph"><p>The figure below shows that the migration logic owns its own migration state. It is also able to make api calls to both the old billing system and Kill Bill and provide an interface to the existing Billing&amp;Payment Components (systems that currently interact with the old billing system). From a logical point of view, the migration logic has been shown in a separate box, but again, this could be implemented in various ways.</p></div>
<div class="paragraph"><p><span class="image"><img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/migration/migration_logic.png" alt="migration logic"></span></p></div></div>
<div class="sect3"><h4 id="_migration_state">Migration State</h4><div class="paragraph"><p>As discussed previously, each existing account would be migrated independently from the others providing a small granularity (and avoiding a risky 'success or fail all' type of migration). It is also important to allow for a process that provides clarity on what failed and what succeeded and the ability to restart things from where they failed. In essence, migrating an account should be an idempotent process, so if it fails part way through, things can be resumed. In order to achieve that result, the Migration Framework should own a <code>migration</code> table with the following fields (obviously one could add/remove fields as needed):</p></div>
<div class="ulist"><ul><li><p><code>account_key</code>: The unique identifier for the account to be migrated. Based on that key account data can be pulled from the old billing system.</p></li><li><p><code>migration_state</code>: We will see later that migrating an account is not an atomic operation so this will hold where we are in the migration process for that account</p></li><li><p><code>last_error_msg</code>: Some indication of what fails to ease debugging and resuming operation</p></li><li><p><code>created_date</code>: Date when we first attempted to start the migration</p></li><li><p><code>update_date</code>: Date when we last attempted to run the migration</p></li><li><p><code>cut_over_date</code>: Date the migration completed (equals to <code>update_date</code> when migration has completed). Any subsequent requests after that date would be redirected to Kill Bill.</p></li></ul></div></div></div></div></div>
<div class="sect1"><h2 id="_pre_requisites">Pre-Requisites</h2><div class="sectionbody"><div class="paragraph"><p>Before we can dig into more details on how the migration works, it is important to be ready to migrate these accounts. The readiness is something to be defined on a case by case basis, but there are some things that are pretty much mandatory in all situations:</p></div>
<div class="sect2"><h3 id="_setting_up_kill_bill">Setting up Kill Bill</h3><div class="paragraph"><p>Migrating accounts to Kill Bill first implies that Kill Bill has been deployed and configured correctly. The goal of that doc is not to describe those steps (we have other <a href="http://docs.killbill.io/">docs</a> to explain that), but let&#8217;s go through a few items that require special care:</p></div>
<div class="ulist"><ul><li><p><strong>Catalog Creation</strong>: The catalog should include all the <code>Plans</code> that were configured in the old billing system, so that subscription migration works. Special care should be made for billing alignments to ensure that customer ends up being billed at the same dates as they used to. Most probably the abstractions between the two worlds are slightly different (e.g in Kill Bill world we have the concept of a <code>PlanPhase</code> while in the old billing system each <code>PlanPhase</code> may correspond to a different <code>Plan</code> or even implemented differently).</p></li><li><p><strong>Templates and Translations</strong>: Kill Bill allows to configure the system using templates (e.g. invoice html visible to customer) and for <a href="http://docs.killbill.io/latest/internationalization.html">internationalization</a> (e.g translating plan names in different languages).</p></li><li><p><strong>Payment plugins</strong>: Kill Bill typically interacts with a payment gateway or processor through a <a href="http://docs.killbill.io/latest/payment_plugin.html">playment plugin</a>. We already have quite a few tested integrations out there so the work is either to test one of our payment plugins or to write a new one to integrate with the desired gateway/processor.</p></li><li><p><strong>Overdue Configuration</strong>: Often called dunning in billing systems, this <a href="http://docs.killbill.io/latest/overdue.html">feature</a> lets you control what is happening when customers don&#8217;t pay. Note that there is no obligation to try reproducing existing logic from the old billing system if this one was not satisfactory as this will not directly impact migration. Instead it is advised to configure it to provide the desired results. This step could also be omitted and postponed until the end of the migration.</p></li><li><p><strong>Analytics</strong>: This is also a good time to think about how financial reports will be computed and what kind of reports will be available for the financial team. At this stage, one can become familiar with the data model and investigate how existing reports will be generated. Kill Bill also has an <a href="https://github.com/killbill/killbill-analytics-plugin">analytics plugin</a>, which provides the following benefits:</p><div class="ulist"><ul><li><p>Denormalized tables (on which queries become easier to run)</p></li><li><p>Ability to generate custom reports</p></li><li><p>UI side for visualization inside KAUI if needed</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>After the system has been configured, it is imperative to try out creating subscriptions with all the plans defined in the catalog, moving through phases by moving the Kill Bill <code>Clock</code>, performing upgrades/downgradse and at each step verifying the behavior of the system (invoice generation, payments, &#8230;&#8203;).</p></div></div>
<div class="sect2"><h3 id="_behavioral_analysis">Behavioral Analysis</h3><div class="paragraph"><p>At this stage, the system has been setup (proper validated catalog, &#8230;&#8203;) and there was enough manual testing to provide confidence with the setup of the system. We are now moving in the behavioral analysis stage, which can be achieved by forking the stream of requests for new accounts to go both in the old billing system (because <code>t &lt; newAccountCutOverDate</code>) and to a Kill Bill test deployment.</p></div>
<div class="paragraph"><p>This provides the following benefits:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>It creates production-like data (actually, data is exactly like production except for fields such as CC number, names, &#8230;&#8203; that should be obfuscated). It can be used to start computing reports and bringing confidence to the financial team that the new system will provide similar type of data/results. We suggest to configure the system with a default payment plugin inside Kill Bill (to avoid any interaction with payment gateway). The reporting only happens on the subscriptions and invoices but this is enough to guarantee that the system behaves correctly.</p></li><li><p>It paves the way for the first stage of the migration where new accounts are directed towards Kill Bill.</p></li></ol></div>
<div class="paragraph"><p>Regarding implementation, the forking of the stream can happen in the migration logic proxy. A good way to achieve this result is to write a servlet filter that forwards existing requests to the old billing system but also calls the matching Kill Bill endpoints.</p></div>
<div class="paragraph"><p>Regarding numbers, one should not expect the same numbers because both systems will behave differently: most existing billing systems are batch oriented while Kill Bill is event-based, so timing will be very different. Invoicing will also likely vary due to pro-ration logic and potentially different billing alignments. However, this is the right time to investigate differences so those are well understood and potentilaly corrected (e.g catalog issue, system configuration issue, &#8230;&#8203;).</p></div></div>
<div class="sect2"><h3 id="_redirecting_new_accounts_to_kill_bill">Redirecting New Accounts to Kill Bill</h3><div class="paragraph"><p>At this point, we have a working Kill Bill system that was correctly configured. There is a clear path forward to provide business reports, so everything is in place to start accepting new accounts. This is <code>t = newAccountCutOverDate</code>. The migration framework is then modified in such a way that it will <strong>not</strong> fork the stream between the old billing system and the Kill Bill instance but instead will split the stream between both systems:</p></div>
<div class="ulist"><ul><li><p>New accounts are created in Kill Bill and subsequent requests for this account are also directed to Kill Bill.</p></li><li><p>Requests pertaining to old accounts are still directed towards the old billing system.</p></li></ul></div>
<div class="paragraph"><p>From an implementation point of view, the servlet filter is again a good place for this logic to happen: given an incoming request, extract <code>ID</code> of the request (depending on the request, could be the <code>accountId</code>, a <code>subscriptionId</code>, &#8230;&#8203; ) and first fetch the matching object inside Kill Bill. If it exists, the request is made to Kill Bill, and if not, the request is forwarded to the old billing system.</p></div></div></div></div>
<div class="sect1"><h2 id="_running_the_migration">Running the Migration</h2><div class="sectionbody"><div class="sect2"><h3 id="_summary">Summary</h3><div class="paragraph"><p>The main idea it to provide a migration endpoint, implemented in the migration logic proxy, that knows how to migrate each account individually. Each account migration is composed of several steps:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><strong><code>migration_state</code> = <code>INIT</code></strong>: Create an entry in the migration table.</p></li><li><p><strong><code>migration_state</code> = <code>ACCOUNT_MIGRATED</code></strong>: Migrate account data. This is relatively easy and low risk. The work consists of pulling account data from the old billing system and mapping that to the Kill Bill data model. As mentioned before, additional info could be added as custom fields on the Kill Bill created <code>Account</code> (e.g ID of the account in the old system).</p></li><li><p><strong><code>migration_state</code> = <code>AUTO_INVOICING_OFF</code></strong>: Setup <code>AUTO_INVOICING_OFF</code> for the <code>Account</code> to prevent the system to trigger invoices when we start migrating the subscriptions.</p></li><li><p><strong><code>migration_state</code> = <code>SUBSCRIPTIONS_MIGRATED</code></strong>: Migrate active subscriptions. We will provide more detail in the next section on how that works, but the overall idea is to fetch all active subscriptions from the old billing system and to recreate them in Kill Bill using the right date and using the right <code>Plan</code>. The goal is to get a clean cutover and avoid any misbilling (double billing, loss of revenue) or service disruption. Also note that in a system where there are dependencies among subscriptions (e.g. ADD_ON subscriptions), special care should be made to migrate them in the right order.</p></li><li><p><strong><code>migration_state</code> = <code>OLD_SUBSCRIPTIONS_CANCELLED</code></strong>: Cancel all subscriptions in the old billing system at the right time (more detail in the next section). This is a fairly risky step because this changes the state in the old billing system. This is <strong>not</strong> a point of 'no-return' but a point when rollback becomes difficult. Needless to say that cancellation code for the old billing system should have been tested carefully.</p></li><li><p><strong><code>migration_state</code> = <code>MIGRATED</code></strong>: Remove <code>AUTO_INVOICING_OFF</code> for the <code>Account</code>.</p></li></ol></div>
<div class="paragraph"><p>After <code>t &gt;= newAccountCutOverDate</code>, the set of account is fixed in the old billing system. It becomes easy to get a reliable list of all accounts that should be migrated and use that as an input for the migration endpoint.</p></div></div>
<div class="sect2"><h3 id="_subscriptions_migration">Subscriptions Migration</h3><div class="sect3"><h4 id="_catalog_mapping">Catalog Mapping</h4><div class="paragraph"><p>We discussed in the Pre-Requisites section, the importance to build a Kill Bill catalog that will provide the same kind of products/plans than the one configured in the old billing system. In addition to the Kill Bill catalog, we also need a <strong>mapping layer</strong> between the name of the plans defined in the old system and the name of the <code>Plan</code> in the Kill Bill catalog. At the time of the migration, the plan associated with the subscription in the old catalog becomes a key in that mapping table to choose the correct Kill Bill <code>Plan</code> to use for the creation of the subscription.</p></div></div>
<div class="sect3"><h4 id="_billing_dates">Billing Dates</h4><div class="paragraph"><p>Migrating the active subscriptions correctly is definitely one of the challenges of the migration process. Whether the billing happens in arrear or in advance, for each subscription, there is a date up to which it was billed for. This date is referred to as the <code>chargedThroughDate</code>:</p></div>
<div class="ulist"><ul><li><p>When billing in advance, the <code>chargedThroughDate</code> is the date in the future where the next invoice will occur (charging for the next period). So <code>nextBillingDate</code> = <code>chargedThroughDate</code></p></li><li><p>When billing in arrear, the <code>chargedThroughDate</code> is the date in the past (or present) when it was last billed. So <code>nextBillingDate</code> = <code>chargedThroughDate</code> + 1 period (e.g 1 month)</p></li></ul></div>
<div class="paragraph"><p>A clean subscription migration implies that we stop the billing in the old system at the <code>currentBillingDate</code> (where <code>currentBillingDate</code> + 1 Period = <code>nextBillingDate</code>) and starts the billing in Kill Bill at the <code>nextBillingDate</code>. So how to achieve that result?</p></div>
<div class="paragraph"><p>The first mandatory piece is to be able to extract those dates from the old billing system for each individual subscription attached to the account. In some billing systems, there is only some support to have a <code>billCycleDate</code> (<code>BCD</code>) at the account level (day of the month at which account is billed) and so that simplifies the problem. In some other cases, different subscriptions can have their own individual schedules. Kill Bill supports all models through the use of billing alignments (and for reference, even a <code>BUNDLE</code> alignment) defined in the catalog. So, the starting point is to verify those alignments match the old system (this was part of the Pre-Requisites section).</p></div>
<div class="paragraph"><p>From a billing point of view, we want to cancel the old subscription at <code>currentBillingDate</code> and start (the billing of) the subscription at <code>nextBillingDate</code>.</p></div></div>
<div class="sect3"><h4 id="_entitlement_dates">Entitlement Dates</h4><div class="paragraph"><p>A naive migration strategy would be to start the subscription in Kill Bill at <code>nextBillingDate</code>. While this works from a billing point of view, this causes some issues when the customer makes some changes (upgrade, downgrade, cancellation,&#8230;&#8203;) during the interval of time such that <code>cutOverDate</code> &lt;= t &lt; <code>nextBillingDate</code>: In that interval of time, the subscription would have a future startDate (= <code>nextBillingDate</code>) so immediate changes could not be applied. Also, from an entitlement point of view, starting the subscription in the future means there is no service until we reach that date.</p></div>
<div class="paragraph"><p>So, we need to separate the date at which the subscription starts (<code>subscriptionStartDate</code>) and the date at which the invoicing starts: from an entitlement point of view, we could use the <code>cutOverDate</code> as the <code>subscriptionStartDate</code>, and this would work, but a better choice is to use the <code>originalSubscriptionStartDate</code> (date at which the subscription started in the old billing system). As far as entitlement goes, starting a subscription in the past is equivalent to starting it in the present, so using the Kill Bill <code>subscriptionStartDate</code> = <code>originalSubscriptionStartDate</code> solves the entitlement issue we mentioned above and it also preserves the <code>originalSubscriptionStartDate</code> of the subscription (which can be really useful for customer support when they interact with the customer).</p></div></div>
<div class="sect3"><h4 id="_summary_for_migration_dates">Summary for Migration Dates</h4><div class="paragraph"><p>Let&#8217;s summarize, the discussion about dates using the diagram below:</p></div>
<div class="paragraph"><p><span class="image"><img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/migration/migration_dates.png" alt="migration dates"></span></p></div>
<div class="paragraph"><p>At t = <code>cutOverDate</code>, the account is being migrated and for each existing active subscription in the old billing system, we create a subscription by specifying both the <code>entitlementDate</code> = <code>originalSubscriptionStartDate</code> and the <code>billingDate</code> = <code>nextBillingDate</code>.</p></div>
<div class="paragraph"><p><strong>Note:</strong> The subscription apis allow you to specify both the <code>entitlementDate</code> and <code>billingDate</code>. Some examples on how to use those apis to achieve the migration goal can be found <a href="https://github.com/killbill/killbill/blob/killbill-0.18.0/beatrix/src/test/java/org/killbill/billing/beatrix/integration/TestMigrationSubscriptions.java">here</a>.</p></div>
<div class="paragraph"><p>For information, it is still interesting to show how things were done prior the introduction of those new apis. The sequence was a bit more complex, but this shows that in very complex scenario there is a lot of flexibility through the use of the <a href="http://killbill.io/blog/blockingstate-abstractions"><code>BlockingState</code></a> events. Below is a description of how things could work using <code>BlockingState</code>:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>We create a subscription with a starting date of <code>originalSubscriptionStartDate</code> (we will discuss the choice of the <code>Plan</code> in the next section)</p></li><li><p>We stop the billing by inserting <code>BlockingState</code> events (one event at t = <code>originalSubscriptionStartDate</code> with <code>isBlockBilling=true</code> and one event at t = <code>nextBillingDate</code> with <code>isBlockBilling=false</code>)</p></li></ol></div>
<div class="paragraph"><p>Note that subscription apis to create subscription don&#8217;t allow you to specify different dates for billing and entitlement, so additional apis calls to insert the <code>BlockingState</code> are required. While less practical, this is not really an issue because at that stage we have set <code>AUTO_INVOICING_OFF</code> at the account level so nothing will happen and atomicity is not required.</p></div>
<div class="paragraph"><p>Finally, we should explore a bit more the choice of the per-account <code>cutOverDate</code>: is it better to choose that date close to <code>currentBillingDate</code> or <code>nextBillingDate</code>? A choice of <code>cutOverDate</code> close to <code>currentBillingDate</code> (right after), means that the customer just got invoiced and so the chances for adjustments right after are bigger than if we were to wait. Since we want to minimize actions on the old system after the customer got migrated, it seems a better choice would be to pick <code>cutOverDate</code> right before <code>nextBillingDate</code>. Of course, in situations where customers have multiple subscriptions on different schedules (<code>SUBSCRIPTION</code> billing alignment), there is a choice to be made (probably favor the annual versus monthly and subscriptions on higher <code>Plans</code>).</p></div></div>
<div class="sect3"><h4 id="_multi_phase_plans">Multi-Phase Plans</h4><div class="paragraph"><p>There is another concern we did not discuss yet when migrating subscriptions for multi-phase <code>Plans</code>. Kill Bill supports <code>Plans</code> with multiple <code>PlanPhases</code> (such as <code>TRIAL</code>, <code>DISCOUNT</code>, <code>EVERGREEN</code>). The old billing system may support that concept as well, or it could be that such concepts are implemented in an entirely different fashion:</p></div>
<div class="ulist"><ul><li><p>Use multiple subscriptions for each separate phase (hopefully those are linked by some mechanism otherwise this is quite difficult to understand)</p></li><li><p>Treat each phase as an upgrade/downgrade scenario (i.e move it to a different kind of plan)</p></li><li><p>&#8230;&#8203;</p></li></ul></div>
<div class="paragraph"><p>There is obviously some amount of work to understand the old system&#8217;s model, and how those will translate into the Kill Bill catalog (again part of the Pre-Requisites stage). Assuming we are migrating a subscription into Kill Bill using a multi-phase <code>Plan</code>, we have to be cautious with the entitlement alignments and make sure we end up on the right phase.</p></div>
<div class="paragraph"><p>One strategy is to define more <code>Plans</code> in the Kill Bill catalog to include mono-phase versions of the multi-phase <code>Plans</code>. For example, assuming a subscription with a 2 phases <code>Plan</code> (<code>TRIAL</code>=15 days, followed by <code>EVERGREEN</code>), we could also create another <code>Plan</code> with only the last phase so as to migrate subscriptions that are already on the <code>EVERGREEN</code> phase.</p></div>
<div class="paragraph"><p>Alternatively, we could decide to only use the original <code>Plan</code>, and play with subscription alignments in the following way:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>At t=<code>cutOverDate</code>, the subscription is already in the <code>EVERGREEN</code> phase; in this case we need to make sure we start directly into that phase. Fortunately, this is possible because the Kill Bill api to create a subscription allows you to specify on which phase to start (skipping previous phases).</p></li><li><p>At t=<code>cutOverDate</code>, the subscription is still in TRIAL, but by chosing the <code>originalSubscriptionStartDate</code> as the start date of that subscription in Kill Bill we should end up exactly with the correct state. Let&#8217;s take an example to illustrate that point:</p><div class="ulist"><ul><li><p>The subscription started on February 14th 2016 in the old system</p></li><li><p>We decide on a <code>cutOverDate</code> of February 24th 2016, which means we are 10 days into the trial, so there should still be 5 days of trial when migrating to Kill Bill</p></li><li><p>The <code>nextBillingDate</code> is February 28th 2016 (date at which the trial ends, and billing would have started in old system)</p></li><li><p>We create the subscription in Kill Bill on <code>originalSubscriptionStartDate</code> (February 14th 2016), and because this is a 2 phases <code>Plan</code>, the system will generate a <code>PHASE</code> event on <code>nextBillingDate</code> (February 28th 2016), which is exactly what we need.</p></li></ul></div></li></ol></div></div>
<div class="sect3"><h4 id="_pending_subscription_changes">Pending Subscription Changes</h4><div class="paragraph"><p>Some billing systems also allow you to schedule future changes associated to a subscription (such as upgrading a subscription in the future or cancelling a subscription in the future, &#8230;&#8203;). During the migration, it is important to keep track of those future changes. Fortunately this is fairly straight-forward using the Kill Bill apis to change <code>Plan</code> or cancel in the future.</p></div></div></div></div></div>
<div class="sect1"><h2 id="_conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>Migrations are typically a difficult, lengthy and risky endeavor. We have highlighed some of issues that need to be thought of and suggested a possible design (based on a set of simplification and work-arounds). Obviously each use case is different (migration happens from different systems with different characteristics, data set may be very different, and business requirements may also be different, &#8230;&#8203;).</p></div>
<div class="paragraph"><p>However, migrating to Kill Bill simplifies greatly the process for the following reasons:</p></div>
<div class="ulist"><ul><li><p><strong>Testing</strong>:</p><div class="ulist"><ul><li><p>One can run the migration many times on a test system (except for the cancellation of the active subscriptions on the old system in production, which can only happen once for obvious reasons)</p></li><li><p>One can look closely at the data that was migrated and run some tests by moving the clock forward to ensure things will happen as expected in the future</p></li></ul></div></li><li><p><strong>Altering System Behavior</strong>:</p><div class="ulist"><ul><li><p>One can extend functionality through plugins (could intercept subscription calls, entirely replace catalog using catalog plugin api, modify invoice generation, &#8230;&#8203;)</p></li><li><p>One can maintain a fork of Kill Bill (just during the time of the migration) where migration logic could be inserted as needed</p></li></ul></div></li><li><p><strong>Owning The Data</strong>:</p><div class="ulist"><ul><li><p>Migrated data is easily available to run reports that will highlight potential issues</p></li><li><p>In the very worst case, data can be modified directly (this is certainly not part of the recommendation) but this is a last resort option.</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>Good Luck!</p></div></div></div></div></div></div></div><div class="container-fluid"><div class="row"><div class="col-12 border-columns"></div><div id="footer"><div id="footer-text">Last updated 2021-01-11 23:47:49 +0500</div><script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
          ga('create','UA-32705710-3','auto');
          ga('send','pageview');
          var getOutboundLink = function(url) {
            ga('send', {
              hitType: 'event',
              eventCategory: 'outbound',
              eventAction: 'click',
              eventLabel: url,
              hitCallback: function(){document.location = url;}
            });
          }
          </script></div><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script><script src="https://cdn.staticaly.com/gh/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.js"></script></body></html>