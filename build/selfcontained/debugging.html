<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 2.0.12"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.staticaly.com/gh/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.css"><title>Debugging tips</title><style>/*Default CSS*/

/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
/* html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%} */
body{margin:0}
a{background:transparent; text-decoration: none !important;}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
/* button,input,select,textarea{font-family:inherit;font-size:100%;margin:0} */
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
/* body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto} */
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
    h1{font-size:2.75em}
    h2{font-size:2.3125em}
    h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
    h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
    body.toc2{padding-left:15em;padding-right:0}
    #toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
    #toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
    #toc.toc2>ul{font-size:.9em;margin-bottom:0}
    #toc.toc2 ul ul{margin-left:0;padding-left:1em}
    #toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
    body.toc2.toc-right{padding-left:0;padding-right:15em}
    body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
    #toc.toc2{width:20em}
    #toc.toc2 #toctitle{font-size:1.375em}
    #toc.toc2>ul{font-size:.95em}
    #toc.toc2 ul ul{padding-left:1.25em}
    body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:#2E3336;padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
    *{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
    a{color:inherit!important;text-decoration:underline!important}
    a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
    a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
    abbr[title]:after{content:" (" attr(title) ")"}
    pre,blockquote,tr,img{page-break-inside:avoid}
    thead{display:table-header-group}
    img{max-width:100%!important}
    p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
    h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
    #toc,.sidebarblock,.exampleblock>.content{background:none!important}
    #toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
    .sect1{padding-bottom:0!important}
    .sect1+.sect1{border:0!important}
    #header>h1:first-child{margin-top:1.25rem}
    body.book #header{text-align:center}
    body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
    body.book #header .details{border:0!important;display:block;padding:0!important}
    body.book #header .details span:first-child{margin-left:0!important}
    body.book #header .details br{display:block}
    body.book #header .details br+span:before{content:none!important}
    body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
    body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
    .listingblock code[data-lang]:before{display:block}
    #footer{background:none!important;padding:0 .9375em}
    #footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
    .hide-on-print{display:none!important}
    .print-only{display:block!important}
    .hide-for-print{display:none!important}
    .show-for-print{display:inherit!important}}

  .listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */

/*Custom CSS*/
body {
  background: #F5F5F5;
}
#header-main-title {
  float: left;
}
#cards {
  clear: both;
}
#cards .btn-primary {
  background-color: #1F7CB5;
  border-color: #1F7CB5;
}
#asciinema-player-section {
  margin-bottom: 25px;
}
/* .container{
    max-width: 100%;
} */
.logo{
    width: 70%;
    padding-top: 20px;
    padding-bottom: 10px;
}
#main-row {
  min-height: 100%;
  height: 100%;
}
#toc {
  border-bottom: none;
  /* position: fixed; */
  overflow-y: auto;
  margin:0;
top: 0px;
z-index: 9;
/* position: relative !important; */
  
}

#toc .nav-link {
  font-size: 13px;
}
.toc{
  margin-top: 116px;
  max-width: 223px;

}
#toctitle{
    font-size: 1.2em;
}
#aws-link {
  width: 80%;
}
.sectlevel1{
    padding-left: 7px;
}
/* .border-columns{ */
    /* background-color: #2E3336; */
/* } */
.footer {
    display: block;
    bottom: 0;
    width: 75%;
    height: 40px;
    line-height: 40px;
    background-color: #2E3336;
    margin: 0 auto;
}
.footer > .container {
    padding-right: 15px;
    padding-left: 15px;
}
nav[data-toggle=toc] .nav>li>a {
    display: block;
    padding: 4px 20px;
    font-size: 13px;
    font-weight: 500;
    color: rgba(0,0,0,.65);
}
nav[data-toggle=toc] .nav>li>a:hover {
    background-color: #ba3925;
    color: rgba(0,0,0,.65);
}
.text-muted {
    color: rgba(0,0,0,.65)!important;
}
/* nav[data-toggle='toc'] {
    top: 80px;
} */
nav[data-toggle=toc] .nav .nav>li>a, nav[data-toggle=toc] .nav .nav>li>a:focus, nav[data-toggle=toc] .nav .nav>li>a:hover {
    padding-left: 10px;
}
nav[data-toggle=toc] .nav .nav>li>.active, nav[data-toggle=toc] .nav .nav>li>.active:focus, nav[data-toggle=toc] .nav .nav>li>.active:hover, nav[data-toggle=toc] .nav-link.active, nav[data-toggle=toc] .nav-link.active:focus, nav[data-toggle=toc] .nav-link.active:hover {
    padding-left: 10px;
    font-weight: 700;
    color: #ba3925;
    background-color: transparent;
    border-left: 2px solid #ba3925;
}
#toc > ul > li > ul {
  margin-left: 10px;
}

/* small screens */
@media (max-width: 767px) {
    /* override stickyness so that the navigation does not follow scrolling */
    nav[data-toggle='toc'] {
        margin-bottom: 42px;
        /* position: static !important; */
    }
    nav[data-toggle='toc'] .nav .active .nav {
        display: none;
    }
    #aws-link {
      width: 50%;
      margin-bottom: 5px;
    }
}



html,
body {
  height: 100%;
}

/* Scrollbar styles */
#toc::-webkit-scrollbar {
  width: 3px;
}

/* Track */
#toc::-webkit-scrollbar-track {
  background: transparent;
}

/* Handle */
#toc::-webkit-scrollbar-thumb {
  background: rgb(182, 182, 182);
}

/* Handle on hover */
#toc::-webkit-scrollbar-thumb:hover {
  background: rgb(163, 163, 163);
}

/* Gernal styles */
.toggle-nav-btn {
  position: absolute;
  right: 30px;
  top: 34px;

}
.bd-sidebar {
  height: 100vh !important;
  
}
.bd-sidebar .nav>li>a {
  padding-left: 10px;
  margin-left: 5px;
}
.main-link {
  border-left: 2px solid #ba3925;
  color: #ba3925 !important;
  cursor: pointer;
  font-weight: bold;
}

/* card styles */
.card-wrapper {
  height: 280px;
  -webkit-box-shadow: 0 0 30px rgba(0, 0, 0, 0.1); /* Safari 3-4, iOS 4.0.2 - 4.2, Android 2.3+ */
  -moz-box-shadow: 0 0 30px rgba(0, 0, 0, 0.1); /* Firefox 3.5 - 3.6 */
  box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
}
.card-wrapper .card-body {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}
.card-wrapper .card-body .card-title {
  color: #ba3925;
  font-size: 22px;
  font-weight: 500;
}
#cards .btn-primary {
  background-color: #1f7cb5;
  border-color: #1f7cb5;
}
.LogoAndToggle{
  border-bottom: 1px solid gainsboro;
    margin: 0px;
    display: block;
    padding-bottom: 10px;
     background: whitesmoke;
}
/* media quires */
@media (max-width: 767px) {
  .bd-sidebar {
    height: 100px !important;
    border: 0;
  }

  #toc{
    min-width: 100%;
    top: 93px;
  }
  #toc.show{
    border-bottom: none;
    left: 0;
    min-width: 100%;
    margin: 0;
    box-shadow: 0px 7px 10px 2px #ababab3b;
  }
  .LogoAndToggle{
    display: flex;
    justify-content: space-around;
    position: fixed;
    width: 100%;
   margin: 0;

  }
  .bd-links {
    background: white;
    z-index: 9;
    position: relative;
    max-height: 300px;
    overflow-y: scroll;
    margin-top: -5px;
    border-bottom: 1px solid #d6d6d6;
  }
}
@media (min-width: 768px) {
  .bd-links {
    height: 100% !important;
    overflow-y: auto;
    display: block !important;
  }
  #toc {
   position: relative;
    top: 0;
    max-width: 100%;
    margin: 0;
  }
  .toc{
    height: calc(100vh - 97px) !important;
  }
  .bd-sidebar {
    padding-right: 20px;
    top: 0 !important;
  }
}

.bdr-right{
  border-right: 1px solid gainsboro;
}
.bdr-left{
  border-left: 1px solid gainsboro;
}


nav[data-toggle=toc] .nav>li>a:focus, nav[data-toggle=toc] .nav>li>a:hover{
  border-left: 2px solid #ba3925;
}
nav[data-toggle=toc] .nav>li>a:hover{
  background-color: #ba39251a;
  color: rgba(0,0,0,.65);
}
pre.pygments .tok-n {
    color: rgba(0,0,0,.9) !important;
}</style>
<style>pre { line-height: 125%; }
td.linenos pre { color: #000000; background-color: #f0f0f0; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #000000; background-color: #f0f0f0; padding-left: 5px; padding-right: 5px; }
td.linenos pre.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
pre.pygments .hll { background-color: #49483e }
pre.pygments { background: #272822; color: #f8f8f2 }
pre.pygments .tok-c { color: #75715e } /* Comment */
pre.pygments .tok-err { color: #960050; background-color: #1e0010 } /* Error */
pre.pygments .tok-k { color: #66d9ef } /* Keyword */
pre.pygments .tok-l { color: #ae81ff } /* Literal */
pre.pygments .tok-n { color: #f8f8f2 } /* Name */
pre.pygments .tok-o { color: #f92672 } /* Operator */
pre.pygments .tok-p { color: #f8f8f2 } /* Punctuation */
pre.pygments .tok-ch { color: #75715e } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #75715e } /* Comment.Multiline */
pre.pygments .tok-cp { color: #75715e } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #75715e } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #75715e } /* Comment.Single */
pre.pygments .tok-cs { color: #75715e } /* Comment.Special */
pre.pygments .tok-gd { color: #f92672 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gi { color: #a6e22e } /* Generic.Inserted */
pre.pygments .tok-go { color: #66d9ef } /* Generic.Output */
pre.pygments .tok-gp { color: #f92672; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #75715e } /* Generic.Subheading */
pre.pygments .tok-kc { color: #66d9ef } /* Keyword.Constant */
pre.pygments .tok-kd { color: #66d9ef } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #f92672 } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #66d9ef } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #66d9ef } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #66d9ef } /* Keyword.Type */
pre.pygments .tok-ld { color: #e6db74 } /* Literal.Date */
pre.pygments .tok-m { color: #ae81ff } /* Literal.Number */
pre.pygments .tok-s { color: #e6db74 } /* Literal.String */
pre.pygments .tok-na { color: #a6e22e } /* Name.Attribute */
pre.pygments .tok-nb { color: #f8f8f2 } /* Name.Builtin */
pre.pygments .tok-nc { color: #a6e22e } /* Name.Class */
pre.pygments .tok-no { color: #66d9ef } /* Name.Constant */
pre.pygments .tok-nd { color: #a6e22e } /* Name.Decorator */
pre.pygments .tok-ni { color: #f8f8f2 } /* Name.Entity */
pre.pygments .tok-ne { color: #a6e22e } /* Name.Exception */
pre.pygments .tok-nf { color: #a6e22e } /* Name.Function */
pre.pygments .tok-nl { color: #f8f8f2 } /* Name.Label */
pre.pygments .tok-nn { color: #f8f8f2 } /* Name.Namespace */
pre.pygments .tok-nx { color: #a6e22e } /* Name.Other */
pre.pygments .tok-py { color: #f8f8f2 } /* Name.Property */
pre.pygments .tok-nt { color: #f92672 } /* Name.Tag */
pre.pygments .tok-nv { color: #f8f8f2 } /* Name.Variable */
pre.pygments .tok-ow { color: #f92672 } /* Operator.Word */
pre.pygments .tok-w { color: #f8f8f2 } /* Text.Whitespace */
pre.pygments .tok-mb { color: #ae81ff } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #ae81ff } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #ae81ff } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #ae81ff } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #ae81ff } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #e6db74 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #e6db74 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #e6db74 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #e6db74 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #e6db74 } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #e6db74 } /* Literal.String.Double */
pre.pygments .tok-se { color: #ae81ff } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #e6db74 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #e6db74 } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #e6db74 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #e6db74 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #e6db74 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #e6db74 } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #a6e22e } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #f8f8f2 } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #f8f8f2 } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #f8f8f2 } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #f8f8f2 } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #ae81ff } /* Literal.Number.Integer.Long */</style></head><body data-spy="scroll" data-target="#toc" class="book"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 bd-sidebar sticky-top border-columns border-right p-0"><div class="mx-auto text-center LogoAndToggle"><a href="/0.22/"><img class="logo rounded mx-auto d-block img-fluid" src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/logo.png" /></a><button class="btn btn-link bd-search-docs-toggle d-md-none p-0 ml-3 toggle-nav-btn" type="button" data-toggle="collapse" data-target="#toc" aria-controls="toc" aria-expanded="false" aria-label="Toggle docs navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"></path></svg></button></div><nav class="collapse bd-links toc" id="toc" data-toggle="toc"></nav></div><div class="col-12 col-md-9 col-xl-10 border-right"><div id="header"><h1>Debugging tips</h1></div><div id="content"><div class="sect1"><h2 id="_healthchecks_and_metrics">Healthchecks and metrics</h2><div class="sectionbody"><div class="paragraph"><p>Kill Bill exposes both healthchecks and metrics. These can be accessed via:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v http://&lt;IP_ADDRESS&gt;:8080/1.0/healthcheck?pretty<span class="tok-o">=</span><span class="tok-nb">true</span>
curl -v http://&lt;IP_ADDRESS&gt;:8080/1.0/metrics?pretty<span class="tok-o">=</span><span class="tok-nb">true</span></code></pre></div></div></div></div>
<div class="sect1"><h2 id="_remote_debugging">Remote debugging</h2><div class="sectionbody"><div class="paragraph"><p>Specify <code>-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=12345</code> on startup in your JVM settings to enable remote debugging (this is set by default in our Docker images). You can then connect to Kill Bill on port 12345 from your debugger (e.g. Eclipse or IntelliJ).</p></div>
<div class="paragraph"><p>If Kill Bill is running locally, you can just specify <code>localhost</code> or <code>127.0.0.1</code> as the remote host in your debugger. To debug instances remotely (e.g. in the cloud), you need to specify the publicly accessible IP address of your instance. For Docker, this should be the public IP address of the container. If you are using docker-machine and your machine is named <code>default</code>, you can retrieve the IP address via <code>docker-machine inspect default -f '{{.Driver.IPAddress}}'</code>. Passing this IP address to our Docker images as <code>ENV_HOST_IP</code> enables remote debugging automatically.</p></div>
<div class="paragraph"><p>Make sure also that the port <code>12345</code> is open (e.g. check your security groups in AWS). For Docker, expose the port via <code>-p12345:12345</code>.</p></div></div></div>
<div class="sect1"><h2 id="_turning_on_debug_logging">Turning on DEBUG logging</h2><div class="sectionbody"><div class="paragraph"><p>Specify:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="properties"><span></span><span class="tok-na">-Dcom.sun.management.jmxremote</span><span class="tok-o">=</span><span class="tok-s">true</span>
<span class="tok-na">-Dcom.sun.management.jmxremote.authenticate</span><span class="tok-o">=</span><span class="tok-s">false</span>
<span class="tok-na">-Dcom.sun.management.jmxremote.port</span><span class="tok-o">=</span><span class="tok-s">8000</span>
<span class="tok-na">-Dcom.sun.management.jmxremote.rmi.port</span><span class="tok-o">=</span><span class="tok-s">8000</span>
<span class="tok-na">-Dcom.sun.management.jmxremote.ssl</span><span class="tok-o">=</span><span class="tok-s">false</span>
<span class="tok-na">-Djava.rmi.server.hostname</span><span class="tok-o">=</span><span class="tok-s">localhost</span></code></pre></div></div>
<div class="paragraph"><p>on startup in your JVM settings to enable access via <code>jconsole</code>.</p></div>
<div class="paragraph"><p>You can set at runtime the log level of specific classes and packages (look for  the <code>ch.qos.logback.classic:Name=default,Type=ch.qos.logback.classic.jmx.JMXConfigurator</code> MBean).</p></div>
<div class="paragraph"><p>Similar considerations as the remote debugging section apply regarding the IP address and expose ports (see above). For Docker, <code>java.rmi.server.hostname</code> should point to the host IP address (e.g. <code>192.168.99.100</code>). Passing this IP address to our Docker images as <code>ENV_HOST_IP</code> enables jConsole automatically.</p></div>
<div class="paragraph"><p>Note that setting <code>ENV_HOST_IP</code> can affect Ruby plugins.</p></div></div></div>
<div class="sect1"><h2 id="_following_tokens">Following tokens</h2><div class="sectionbody"><div class="paragraph"><p>To understand why a specific action was taken, it is often useful to follow tokens.</p></div>
<div class="paragraph"><p>When invoking a JAX-RS (HTTP) API, a <code>userToken</code> is automatically generated. You can also specify your own token via the <code>X-Request-Id</code> HTTP header (it <strong>must</strong> be a UUID).</p></div>
<div class="paragraph"><p>Once set, this token is:</p></div>
<div class="ulist"><ul><li><p>attached to the processing thread</p></li><li><p>attached to SLF4J MDC context as <code>kb.userToken</code> and displayed by default in logs (<code>tok=</code>)</p></li><li><p>passed to all APIs as <code>CallContext#getUserToken()</code></p></li><li><p>passed to internal bus events as <code>BusEvent#getUserToken()</code></p></li><li><p>passed to external bus events as <code>ExtBusEvent#getUserToken()</code></p></li><li><p>passed to future notifications as <code>userToken</code></p></li></ul></div>
<div class="paragraph"><p>Note that when a notification is created, a <code>futureUserToken</code> is auto-generated. That <code>futureUserToken</code> becomes the <code>userToken</code> when the notification is dispatched.</p></div>
<div class="paragraph"><p>You can search for these tokens in Kaui, on the <em>Queues</em> screen, accessible from the tenant page or via the per-account sub-menu (you need to be logged-in as the Kaui root user).</p></div>
<div class="sect2"><h3 id="_testing_changes_over_time">Testing changes over time</h3><div class="paragraph"><p>We have a clock abstraction in Kill Bill that can be manipulated through an API, as long as you start Kill Bill with <code>org.killbill.server.test.mode=true</code> (<code>-e KILLBILL_SERVER_TEST_MODE=true</code> in Docker):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-CreatedBy: admin&#39;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/test/clock&quot;</span>

curl -v <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-CreatedBy: admin&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;Accept: application/json&quot;</span> <span class="tok-se">\</span>
     -X POST <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/test/clock?requestedDate=2015-12-14T23:02:15.000Z&quot;</span>

curl -v <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-CreatedBy: admin&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;Accept: application/json&quot;</span> <span class="tok-se">\</span>
     -X PUT <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/test/clock?days=10&quot;</span></code></pre></div></div>
<div class="paragraph"><p>Here is an <a href="https://github.com/killbill/killbill-integration-tests/blob/165b76b5864fb40f1a5774f64c145d56123a5e62/killbill-integration-tests/mixin-utils/helper.rb#L131-L145">example</a> how it could be used in tests.</p></div></div></div></div>
<div class="sect1"><h2 id="_docker_and_ansible">Docker and Ansible</h2><div class="sectionbody"><div class="paragraph"><p>Our Docker images use Ansible behind the scenes to install and configure Kill Bill in the container. The actual Ansible commands run are available in the images via the environment variables <code>$KPM_INSTALL_CMD</code> and <code>$START_TOMCAT_CMD</code>.</p></div>
<div class="paragraph"><p>If you need to debug this setup process, you can start a container via <code>docker run -ti killbill/killbill:0.22.0 bash</code> and execute these commands manually.</p></div>
<div class="paragraph"><p>The Ansible command to start Tomcat can also be modified via the <code>$START_TOMCAT_OPTS</code> variable. One useful setting is to create the container using <code>START_TOMCAT_OPTS='--skip-tags tomcat_cleanup'</code> (e.g. <code>docker run -e START_TOMCAT_OPTS='--skip-tags tomcat_cleanup' -ti killbill/killbill:0.22.0</code>). While by default Ansible will cleanup the Tomcat directories (such as <code>webapps/ROOT</code>), this option will skip this task. This is especially useful when developping on Kill Bill: you can replace specific jars in the <code>webapps/ROOT</code> directory and simply restart the container to test your changes.</p></div></div></div>
<div class="sect1"><h2 id="_performance_and_profiling">Performance and profiling</h2><div class="sectionbody"><div class="paragraph"><p>Kill Bill has some built-in support to profile incoming calls. The mechanism is based on HTTP headers that need to be set to specify what needs to be profiled, and as a result, a new HTTP header is returned.</p></div>
<div class="sect2"><h3 id="_types_of_profiling">Types of profiling</h3><div class="paragraph"><p>In order to return profiling information, one needs to add the HTTP header <code>X-Killbill-Profiling-Req</code> and specify which calls should be instrumented. Today, we support:</p></div>
<div class="ulist"><ul><li><p>JAXRS: The HTTP call will be returned with the time spent in the call.</p></li><li><p>API: Any Kill Bill API call will be returned with the time spent in the call</p></li><li><p>DAO: Any Kill Bill DAO (request to database) call will be returned with the time spent in the call</p></li><li><p>DAO_DETAILS: Any Kill Bill DAO (request to database) call along with specifics about time time spent for audit/history and caching will be returned with the time spent in the call</p></li><li><p>DAO_CONNECTION: The time spent trying to acquire a database connection</p></li><li><p>GLOCK: The time spent trying to acquire the global (<code>Account</code>) lock</p></li><li><p>PLUGIN: Any Kill Bill call spent when calling a plugin will be returned with the time spent in the call</p></li></ul></div>
<div class="sect3"><h4 id="_jaxrs_profiling">JAXRS Profiling</h4><div class="paragraph"><p>The time is extracted from a <a href="https://github.com/killbill/killbill/blob/killbill-0.20.0/profiles/killbill/src/main/java/org/killbill/billing/server/filters/ProfilingContainerResponseFilter.java#L53">Jersey filter</a>, so it should be very close to the time spent into the JAX-RS application handler, not taking into account the time spent in the container itself (i.e. Jetty, Tomcat, &#8230;&#8203;).</p></div></div>
<div class="sect3"><h4 id="_api_profiling">API Profiling</h4><div class="paragraph"><p>We are relying on AOP to profile each of our API calls. We are injecting a <a href="https://github.com/killbill/killbill/blob/killbill-0.20.0/util/src/main/java/org/killbill/billing/util/glue/KillbillApiAopModule.java#L72">Guice AOP module</a> to profile each of our API calls. The time returned does not include the extra time spent to dispatch the request using the AOP handler.</p></div>
<div class="paragraph"><p>In addition, there is another <a href="https://github.com/killbill/killbill/blob/killbill-0.20.0/util/src/main/java/org/killbill/billing/util/glue/KillBillShiroAopModule.java#L45">AOP module</a> that is used to validate the user has the right set of permissions to execute this call. Since this occurs prior we do the profiling this time is currently not included in the profiling of the API call.</p></div>
<div class="paragraph"><p>Finally when making API calls from plugins, there may be also a small overhead to go through OSGI layer and this time is also not included.</p></div></div>
<div class="sect3"><h4 id="_doa_profiling">DOA Profiling</h4><div class="paragraph"><p>Most of the requests issued from Kill Bill Dao (e.g <code>DefaultPaymentDao</code>) classes follow the same mechanism:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>A transaction is started by calling the <code>execute</code> method of the <a href="https://github.com/killbill/killbill/blob/killbill-0.20.0/util/src/main/java/org/killbill/billing/util/entity/dao/EntitySqlDaoTransactionalJdbiWrapper.java#L87">EntitySqlDaoTransactionalJdbiWrapper</a>. Here, we create a <code>Handle</code>, essentially retrieving a database connection. The time taken to get the connection can be profiled by using the <code>DAO_CONNECTION</code> mask.</p></li><li><p>Then, a jdbi transaction is started using cglib, and this transaction is actually run through a series of handlers, such as our <a href="https://github.com/killbill/killbill-commons/blob/killbill-commons-0.22.0/jdbi/src/main/java/org/killbill/commons/jdbi/transaction/RestartTransactionRunner.java">RestartTransactionRunner</a>. This extra time, is not being measured by our profiling layer.</p></li><li><p>Finally, for each SQL operation within the transaction, we also proxy the calls using the java <code>Proxy</code> mechanism, and so all those calls are funneled trough the associated <code>EntitySqlDaoWrapperInvocationHandler</code>, and this is where the timing associated to the <code>DAO</code> (and <code>DAO_DETAILS</code>) mask is taken.</p></li></ol></div>
<div class="paragraph"><p>Note that the profiling time reported by the <code>API</code> mask&#8201;&#8212;&#8201;since it supersedes all dao calls&#8201;&#8212;&#8201;will include everything described above. Therefore it is possible to see an API that would only make a dao call take slightly longer than the dao call itself.</p></div>
<div class="paragraph"><p>The <code>DAO</code> mask will take the total time it takes to run the invocation handler invoke method. Because there are several paths, we also include the option to return <code>DAO_DETAILS</code>:</p></div>
<div class="ulist"><ul><li><p>In most cases, we will have a profiling entry <code>DAO_DETAILS:&lt;method&gt; (raw)</code> that only profiles the call requested.</p></li><li><p>In the case of an insert, update, deletion, the code will also update audit logs, and history table. In this case, we will also see a profiling entry <code>DAO_DETAILS:&lt;method&gt; (history/audit)</code> that will return the time it took to create the additional records in these tables.</p></li><li><p>In the case of a cacheable query (e.g return a <code>record_id</code> associated to an object <code>uuid</code>), we may return the result from the cache and so this is the only case where <code>DAO_DETAILS:&lt;method&gt;:raw</code> will not be printed.</p></li><li><p>In all other cases, the <code>DAO_DETAILS:&lt;method&gt; (raw)</code> should match the <code>DAO:&lt;method&gt;</code> time.</p></li></ul></div></div>
<div class="sect3"><h4 id="_glock_profiling">GLOCK Profiling</h4><div class="paragraph"><p>The <code>GLOCK</code> mask will simply output the time it took to grab the database lock associated with a given <code>Account</code>&#8201;&#8212;&#8201;the only kind of global lock currently supported in Kill Bill.</p></div></div>
<div class="sect3"><h4 id="_plugin_profiling">PLUGIN Profiling</h4><div class="paragraph"><p>This mask can be used to profile the time it takes for Kill Bill to make calls to a given plugin using a given plugin api. Here again, such plugin calls are being proxied using the <code>Proxy</code> mechanism, and the timing is taken from the <a href="https://github.com/killbill/killbill-platform/blob/killbill-platform-0.38.0/osgi/src/main/java/org/killbill/billing/osgi/ContextClassLoaderHelper.java#L106">invocation handler</a>.</p></div>
<div class="paragraph"><p>The information will contain the name of the plugin api class and the method being invoked.</p></div></div></div>
<div class="sect2"><h3 id="_example">Example</h3><div class="paragraph"><p>Kill Bill will return a json object containing the hierarchy for the calls along with the time spent in uSec (1000 nanoseconds or 0.000001 seconds).</p></div>
<div class="paragraph"><p>Example (Note the piping to extract the response header, and format the json nicely):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;Accept: application/json&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-Profiling-Req: JAXRS,API,DAO,DAO_DETAILS,DAO_CONNECTION,GLOCK&#39;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/paymentMethods/3dd4e9d3-2be3-4bf2-b1e4-64a1785afd53&quot;</span> <span class="tok-m">2</span>&gt;<span class="tok-p">&amp;</span><span class="tok-m">1</span> <span class="tok-se">\</span>
     <span class="tok-p">|</span> grep <span class="tok-s1">&#39;X-Killbill-Profiling-Resp&#39;</span> <span class="tok-se">\</span>
     <span class="tok-p">|</span> awk <span class="tok-s1">&#39;{$1=$2=&quot;&quot;; print $0}&#39;</span> <span class="tok-se">\</span>
     <span class="tok-p">|</span> jq <span class="tok-s1">&#39;.&#39;</span></code></pre></div></div>
<div class="paragraph"><p>Response:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;rawData&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;JAXRS:1.0/kb/paymentMethods/3dd4e9d3-2be3-4bf2-b1e4-64a1785afd53&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">7654</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;calls&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;API:getPaymentMethodById&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">4158</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;calls&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
            <span class="tok-p">{</span>
              <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DAO_CONNECTION:get&quot;</span><span class="tok-p">,</span>
              <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">60</span>
            <span class="tok-p">},</span>
            <span class="tok-p">{</span>
              <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DAO:PaymentMethodSqlDao: getById&quot;</span><span class="tok-p">,</span>
              <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1371</span><span class="tok-p">,</span>
              <span class="tok-nt">&quot;calls&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
                <span class="tok-p">{</span>
                  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DAO_DETAILS:PaymentMethodSqlDao (raw): getById&quot;</span><span class="tok-p">,</span>
                  <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1364</span>
                <span class="tok-p">}</span>
              <span class="tok-p">]</span>
            <span class="tok-p">}</span>
          <span class="tok-p">]</span>
        <span class="tok-p">},</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;API:getAccountById&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">2593</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;calls&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
            <span class="tok-p">{</span>
              <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;API:getAccountById&quot;</span><span class="tok-p">,</span>
              <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">2462</span><span class="tok-p">,</span>
              <span class="tok-nt">&quot;calls&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
                <span class="tok-p">{</span>
                  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;API:getAccountByRecordIdInternal&quot;</span><span class="tok-p">,</span>
                  <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">2408</span><span class="tok-p">,</span>
                  <span class="tok-nt">&quot;calls&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
                    <span class="tok-p">{</span>
                      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DAO_CONNECTION:get&quot;</span><span class="tok-p">,</span>
                      <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">40</span>
                    <span class="tok-p">},</span>
                    <span class="tok-p">{</span>
                      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DAO:AccountSqlDao: getByRecordId&quot;</span><span class="tok-p">,</span>
                      <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">877</span><span class="tok-p">,</span>
                      <span class="tok-nt">&quot;calls&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
                        <span class="tok-p">{</span>
                          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DAO_DETAILS:AccountSqlDao (raw): getByRecordId&quot;</span><span class="tok-p">,</span>
                          <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">872</span>
                        <span class="tok-p">}</span>
                      <span class="tok-p">]</span>
                    <span class="tok-p">}</span>
                  <span class="tok-p">]</span>
                <span class="tok-p">}</span>
              <span class="tok-p">]</span>
            <span class="tok-p">}</span>
          <span class="tok-p">]</span>
        <span class="tok-p">},</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;API:getAccountAuditLogs&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">6</span>
        <span class="tok-p">}</span>
      <span class="tok-p">]</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span></code></pre></div></div>
<div class="paragraph"><p>We can see that for each mask there is some profiling data and such data retains the struture of the calls being made.</p></div></div>
<div class="sect2"><h3 id="_client_side">Client Side</h3><div class="paragraph"><p>The Ruby client library (<a class="bare" href="https://github.com/killbill/killbill-client-ruby">https://github.com/killbill/killbill-client-ruby</a>) has been extended to support profiling data. By passing a additional options the library will send the correct header to Kill Bill and capture the resulting information.</p></div>
<div class="paragraph"><p>Currently, only JAXRS profilingData will be requested and returned for simplification.</p></div>
<div class="paragraph"><p>In the example below <code>per_thread_profiling_data</code> will contain the timing for the various calls, which in that scenario would be <code>post:/1.0/kb/payments/uuid</code> and <code>get:/1.0/kb/payments/uuid:</code>. The provided hash will contain one key per call and the values will be an array of timing data expressed in uSec:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="ruby"><span></span><span class="tok-c1"># Add the :profilingData option</span>
<span class="tok-n">per_thread_profiling_data</span> <span class="tok-o">=</span> <span class="tok-p">{}</span>
<span class="tok-n">options</span> <span class="tok-o">=</span> <span class="tok-p">{</span><span class="tok-ss">:username</span> <span class="tok-o">=&gt;</span> <span class="tok-s1">&#39;admin&#39;</span><span class="tok-p">,</span> <span class="tok-ss">:password</span> <span class="tok-o">=&gt;</span> <span class="tok-s1">&#39;password&#39;</span><span class="tok-p">,</span> <span class="tok-ss">:profilingData</span> <span class="tok-o">=&gt;</span> <span class="tok-n">per_thread_profiling_data</span><span class="tok-p">}</span>
<span class="tok-n">res</span> <span class="tok-o">=</span> <span class="tok-n">auth_capture_task</span><span class="tok-o">.</span><span class="tok-n">op_create_capture</span><span class="tok-p">(</span><span class="tok-n">payment_id</span><span class="tok-p">,</span> <span class="tok-n">ext_key</span><span class="tok-p">,</span> <span class="tok-n">amount</span><span class="tok-p">,</span> <span class="tok-n">currency</span><span class="tok-p">,</span> <span class="tok-n">username</span><span class="tok-p">,</span> <span class="tok-n">options</span><span class="tok-p">)</span></code></pre></div></div>
<div class="paragraph"><p>Note that Ruby client gem will not make any attempt to synchronize access the the profiling_data map, when multiple threads are making calls. It is recommended to use per-thread data and potentially merge the results from the different threads at the end.</p></div></div>
<div class="sect2"><h3 id="_tips_and_tricks">Tips and tricks</h3><div class="ulist"><ul><li><p>In most cases, the client will be a bottleneck. Make sure to watch the number of sockets in <code>TIME_WAIT</code> (<code>watch 'netstat -an | grep 8080 | grep WAIT | wc -l'</code>) and speed up the recycling process:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>echo 2 &gt; /proc/sys/net/ipv4/tcp_fin_timeout
echo 15000 65000 &gt; /proc/sys/net/ipv4/ip_local_port_range
echo 1 &gt; /proc/sys/net/ipv4/tcp_tw_recycle
echo 1 &gt; /proc/sys/net/ipv4/tcp_tw_reuse</pre></div></div>
<div class="ulist"><ul><li><p>On the server side, check the expected concurrency level by watching the number of sockets in <code>ESTABLISHED</code> (<code>watch 'netstat -an | grep 8080 | grep EST | wc -l'</code>)</p></li><li><p>Make sure to allocate enough database (<code>org.killbill.dao.maxActive</code> / <code>org.killbill.billing.osgi.dao.maxActive</code>) and plugin (<code>org.killbill.payment.plugin.threads.nb</code>) threads. Check your container thread pool too (e.g. <code>conf/server.xml</code> for Tomcat)</p></li><li><p>Use tools like Siege (<a class="bare" href="http://www.joedog.org/siege-home/">http://www.joedog.org/siege-home/</a>) to verify your basic setup: <code>siege -b -t30S -c100 <a class="bare" href="http://127.0.0.1:8080/1.0/kb/test/clock">http://127.0.0.1:8080/1.0/kb/test/clock</a></code> should yield at least 5k req./s.</p></li><li><p>If Shiro is spending too many CPU cycles for authentication, lower the default number of iterations (e.g. <code>org.killbill.security.shiroNbHashIterations=2000</code>).</p></li><li><p>When using YourKit, turn off probes (especially the database ones). They cause a significant slowdown.</p></li><li><p>Allow a warm-up period, before starting a full test, to avoid contention in the JRuby JIT.</p></li><li><p>Use <a href="https://github.com/AdoptOpenJDK/mjprof">mjprof</a> to extract stacktraces:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>java -jar target/mjprof-1.0.jar jmx/127.0.0.1:8989/.ncontains/name,RMI TCP/.ncontains/name,RMI Reaper/.ncontains/name,RMI RenewClean/.ncontains/name,RMI Scheduler/.ncontains/name,jruby-restarter/.ncontains/name,com.google.inject.internal.util.$Finalizer/.ncontains/name,Finalizer/.ncontains/name,Reference/.ncontains/name,FelixStartLevel/.ncontains/name,FelixDispatchQueue/.ncontains/name,http-nio-8080/.ncontains/name,Abandoned connection cleanup thread/.ncontains/name,CM Event Dispatcher/.ncontains/name,CM Configuration Updater/.ncontains/name,SCR Component Actor/.ncontains/name,Timer-/.ncontains/name,telnetconsole.Listener/.ncontains/name,O worker /.ncontains/name,O boss /.ncontains/name,NioBlockingSelector/.ncontains/name,Signal Dispatcher/.ncontains/name,main/.ncontains/name,JMX server connection timeout/.ncontains/state,WAITING/.sort/state/</pre></div></div></div>
<div class="sect2"><h3 id="_load_tests">Load Tests</h3><div class="sect3"><h4 id="_integration_tests">Integration Tests</h4><div class="paragraph"><p>The <a href="https://github.com/killbill/killbill-integration-tests">integration tests repo</a> allows to run load tests against a running instance of Kill Bill. The <a href="https://github.com/killbill/killbill-integration-tests/blob/master/README.md">README</a> has a section explaining how they work.</p></div>
<div class="paragraph"><p>Note: It is difficult to rely on single process MT threaded Ruby script to generate enough load.</p></div></div>
<div class="sect3"><h4 id="_gnu_parallel_simple_load_testing_script">GNU parallel: simple load testing script</h4><div class="paragraph"><p>Another way to generate load is to rely on <code>GNU parallel</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>seq <span class="tok-m">0</span> <span class="tok-m">500</span> <span class="tok-p">|</span> parallel -j10 --no-notice -u ./perf_test.sh</code></pre></div></div>
<div class="paragraph"><p>Where <code>perf_test.sh</code> is:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nv">iteration_id</span><span class="tok-o">=</span><span class="tok-nv">$1</span>

<span class="tok-nb">echo</span> <span class="tok-s2">&quot;===&gt; Starting </span><span class="tok-nv">$iteration_id</span><span class="tok-s2">&quot;</span>

<span class="tok-nv">account_id</span><span class="tok-o">=</span><span class="tok-k">$(</span>curl -v <span class="tok-se">\</span>
                  -X POST <span class="tok-se">\</span>
                  -u admin:password <span class="tok-se">\</span>
                  -H <span class="tok-s1">&#39;Content-Type: application/json&#39;</span> <span class="tok-se">\</span>
                  -H <span class="tok-s1">&#39;X-Killbill-ApiKey: bob&#39;</span> <span class="tok-se">\</span>
                  -H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
                  -H <span class="tok-s1">&#39;X-Killbill-CreatedBy: creator&#39;</span> <span class="tok-se">\</span>
                  --data-binary <span class="tok-s2">&quot;{\&quot;name\&quot;:\&quot;john\&quot;,\&quot;email\&quot;:\&quot;profiling@example.com\&quot;,\&quot;externalKey\&quot;:\&quot;perf-</span><span class="tok-nv">$RANDOM</span><span class="tok-s2">-</span><span class="tok-nv">$RANDOM</span><span class="tok-s2">-</span><span class="tok-nv">$RANDOM</span><span class="tok-s2">\&quot;,\&quot;currency\&quot;:\&quot;USD\&quot;}&quot;</span> <span class="tok-se">\</span>
                  http://127.0.0.1:8080/1.0/kb/accounts <span class="tok-m">2</span>&gt;<span class="tok-p">&amp;</span><span class="tok-m">1</span> <span class="tok-p">|</span> grep Location <span class="tok-p">|</span> awk <span class="tok-s1">&#39;{print $3}&#39;</span> <span class="tok-p">|</span> awk -F<span class="tok-s1">&#39;/&#39;</span> <span class="tok-s1">&#39;{print $7}&#39;</span><span class="tok-k">)</span>

<span class="tok-nv">account_id</span><span class="tok-o">=</span><span class="tok-k">$(</span>tr -dc <span class="tok-s1">&#39;[[:print:]]&#39;</span> <span class="tok-o">&lt;&lt;&lt;</span> <span class="tok-s2">&quot;</span><span class="tok-nv">$account_id</span><span class="tok-s2">&quot;</span><span class="tok-k">)</span>

curl  <span class="tok-se">\</span>
     -X POST <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;Content-Type: application/json&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiKey: bob&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-CreatedBy: creator&#39;</span> <span class="tok-se">\</span>
     --data-binary <span class="tok-s1">&#39;{&quot;pluginName&quot;:&quot;YOUR-PLUGIN&quot;,&quot;pluginInfo&quot;:{&quot;properties&quot;:[{&quot;key&quot;:&quot;type&quot;,&quot;value&quot;:&quot;CreditCard&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccType&quot;,&quot;value&quot;:&quot;visa&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccName&quot;,&quot;value&quot;:&quot;A Smith&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;email&quot;,&quot;value&quot;:&quot;foo@bar.com&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccExpirationMonth&quot;,&quot;value&quot;:&quot;03&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccExpirationYear&quot;,&quot;value&quot;:&quot;2016&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccVerificationValue&quot;,&quot;value&quot;:&quot;222&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;address1&quot;,&quot;value&quot;:&quot;lskdjf&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;address2&quot;,&quot;value&quot;:&quot;&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;city&quot;,&quot;value&quot;:&quot;sdfsdfsff&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccFirstName&quot;,&quot;value&quot;:&quot;sdfsdf&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccLastName&quot;,&quot;value&quot;:&quot;fdsfdsf&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;zip&quot;,&quot;value&quot;:&quot;23812&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;country&quot;,&quot;value&quot;:&quot;USA&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;state&quot;,&quot;value&quot;:&quot;CA&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccNumber&quot;,&quot;value&quot;:&quot;4111111111111111&quot;,&quot;isUpdatable&quot;:false}]}}&#39;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/accounts/</span><span class="tok-si">${</span><span class="tok-nv">account_id</span><span class="tok-si">}</span><span class="tok-s2">/paymentMethods?isDefault=true&quot;</span> &gt; /dev/null <span class="tok-m">2</span>&gt;<span class="tok-p">&amp;</span><span class="tok-m">1</span>


curl  <span class="tok-se">\</span>
     -X POST <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;Content-Type: application/json&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiKey: bob&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-CreatedBy: creator&#39;</span> <span class="tok-se">\</span>
     --data-binary <span class="tok-s1">&#39;{&quot;transactionType&quot;:&quot;AUTHORIZE&quot;,&quot;amount&quot;:&quot;10&quot;,&quot;currency&quot;:&quot;USD&quot;}&#39;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/accounts/</span><span class="tok-si">${</span><span class="tok-nv">account_id</span><span class="tok-si">}</span><span class="tok-s2">/payments&quot;</span> &gt; /dev/null <span class="tok-m">2</span>&gt;<span class="tok-p">&amp;</span><span class="tok-m">1</span>

<span class="tok-nb">echo</span> <span class="tok-s2">&quot;===&gt; Finished </span><span class="tok-nv">$iteration_id</span><span class="tok-s2">&quot;</span></code></pre></div></div>
<div class="paragraph"><p>Note that on a single machine, this client-side script will most likely be the bottleneck (spawning the processes takes too much time). Use <a href="http://jmeter.apache.org/">JMeter</a> instead.</p></div></div></div></div></div>
<div class="sect1"><h2 id="_ruby_plugins_debugging">Ruby plugins debugging</h2><div class="sectionbody"><div class="sect2"><h3 id="_using_rubymine">Using RubyMine</h3><div class="ulist"><ul><li><p>Add the following dependencies to your Gemfile:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="ruby"><span></span><span class="tok-n">gem</span> <span class="tok-s1">&#39;ruby-debug&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;~&gt; 0.10&#39;</span>
<span class="tok-n">gem</span> <span class="tok-s1">&#39;ruby-debug-ide&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;~&gt; 0.6&#39;</span></code></pre></div></div>
<div class="ulist"><ul><li><p>Add the following snippet at the entry point of your plugin, e.g. top of <code>lib/cybersource.rb</code> for CyberSource:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="ruby"><span></span><span class="tok-k">unless</span> <span class="tok-n">defined?</span><span class="tok-p">(</span><span class="tok-no">Debugger</span><span class="tok-o">::</span><span class="tok-no">PROG_SCRIPT</span><span class="tok-p">)</span>
  <span class="tok-no">JRuby</span><span class="tok-o">.</span><span class="tok-n">objectspace</span> <span class="tok-o">=</span> <span class="tok-kp">true</span>

  <span class="tok-nb">require</span> <span class="tok-s1">&#39;ruby-debug-ide&#39;</span>
  <span class="tok-no">Debugger</span><span class="tok-o">::</span><span class="tok-no">PROG_SCRIPT</span> <span class="tok-o">=</span> <span class="tok-bp">__FILE__</span>

  <span class="tok-nb">require</span> <span class="tok-s1">&#39;ostruct&#39;</span>
  <span class="tok-n">options</span> <span class="tok-o">=</span> <span class="tok-no">OpenStruct</span><span class="tok-o">.</span><span class="tok-n">new</span><span class="tok-p">(</span>
      <span class="tok-c1"># Host name used for remote debugging</span>
      <span class="tok-s1">&#39;host&#39;</span> <span class="tok-o">=&gt;</span> <span class="tok-kp">nil</span><span class="tok-p">,</span>
      <span class="tok-c1"># Port used for remote debugging</span>
      <span class="tok-s1">&#39;port&#39;</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">1234</span><span class="tok-p">,</span>
      <span class="tok-c1"># Port used for multi-process debugging dispatcher</span>
      <span class="tok-s1">&#39;dispatcher_port&#39;</span> <span class="tok-o">=&gt;</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span>
      <span class="tok-c1"># Load mode (experimental)</span>
      <span class="tok-s1">&#39;load_mode&#39;</span> <span class="tok-o">=&gt;</span> <span class="tok-kp">false</span><span class="tok-p">,</span>
      <span class="tok-c1"># Stop when the script is loaded</span>
      <span class="tok-s1">&#39;stop&#39;</span> <span class="tok-o">=&gt;</span> <span class="tok-kp">false</span><span class="tok-p">,</span>
      <span class="tok-c1"># Keep frame bindings</span>
      <span class="tok-s1">&#39;frame_bind&#39;</span> <span class="tok-o">=&gt;</span> <span class="tok-kp">true</span><span class="tok-p">,</span>
      <span class="tok-c1"># Turn on line tracing</span>
      <span class="tok-s1">&#39;tracing&#39;</span> <span class="tok-o">=&gt;</span> <span class="tok-kp">false</span><span class="tok-p">,</span>
      <span class="tok-c1"># Disables interrupt signal handler</span>
      <span class="tok-s1">&#39;int_handler&#39;</span> <span class="tok-o">=&gt;</span> <span class="tok-kp">true</span><span class="tok-p">,</span>
      <span class="tok-c1"># Evaluation timeout in seconds</span>
      <span class="tok-s1">&#39;evaluation_timeout&#39;</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">20</span><span class="tok-p">,</span>
      <span class="tok-c1"># Enable all RubyMine-specific incompatible protocol extensions</span>
      <span class="tok-s1">&#39;rm_protocol_extensions&#39;</span> <span class="tok-o">=&gt;</span> <span class="tok-kp">true</span><span class="tok-p">,</span>
      <span class="tok-c1"># Enable chatchpointDeleted event</span>
      <span class="tok-s1">&#39;catchpoint_deleted_event&#39;</span> <span class="tok-o">=&gt;</span> <span class="tok-kp">false</span><span class="tok-p">,</span>
      <span class="tok-c1"># Allow to pass variable&#39;s value as nested element instead of attribute</span>
      <span class="tok-s1">&#39;value_as_nested_element&#39;</span> <span class="tok-o">=&gt;</span> <span class="tok-kp">true</span>
  <span class="tok-p">)</span>

  <span class="tok-no">Debugger</span><span class="tok-o">.</span><span class="tok-n">keep_frame_binding</span> <span class="tok-o">=</span> <span class="tok-n">options</span><span class="tok-o">.</span><span class="tok-n">frame_bind</span>
  <span class="tok-no">Debugger</span><span class="tok-o">.</span><span class="tok-n">tracing</span> <span class="tok-o">=</span> <span class="tok-n">options</span><span class="tok-o">.</span><span class="tok-n">tracing</span>
  <span class="tok-no">Debugger</span><span class="tok-o">.</span><span class="tok-n">evaluation_timeout</span> <span class="tok-o">=</span> <span class="tok-n">options</span><span class="tok-o">.</span><span class="tok-n">evaluation_timeout</span>
  <span class="tok-no">Debugger</span><span class="tok-o">.</span><span class="tok-n">catchpoint_deleted_event</span> <span class="tok-o">=</span> <span class="tok-n">options</span><span class="tok-o">.</span><span class="tok-n">catchpoint_deleted_event</span> <span class="tok-o">||</span> <span class="tok-n">options</span><span class="tok-o">.</span><span class="tok-n">rm_protocol_extensions</span>
  <span class="tok-no">Debugger</span><span class="tok-o">.</span><span class="tok-n">value_as_nested_element</span> <span class="tok-o">=</span> <span class="tok-n">options</span><span class="tok-o">.</span><span class="tok-n">value_as_nested_element</span> <span class="tok-o">||</span> <span class="tok-n">options</span><span class="tok-o">.</span><span class="tok-n">rm_protocol_extensions</span>

  <span class="tok-no">Debugger</span><span class="tok-o">.</span><span class="tok-n">debug_program</span><span class="tok-p">(</span><span class="tok-n">options</span><span class="tok-p">)</span>

  <span class="tok-nb">exit</span>
<span class="tok-k">end</span></code></pre></div></div>
<div class="ulist"><ul><li><p>Rebuild and redeploy the plugin:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>bundle install <span class="tok-o">&amp;&amp;</span> <span class="tok-se">\</span>
rake killbill:clean <span class="tok-o">&amp;&amp;</span> <span class="tok-se">\</span>
rake build <span class="tok-o">&amp;&amp;</span> <span class="tok-se">\</span>
rake killbill:package <span class="tok-o">&amp;&amp;</span> <span class="tok-se">\</span>
rake killbill:deploy<span class="tok-o">[</span>true<span class="tok-o">]</span></code></pre></div></div>
<div class="ulist"><ul><li><p>Create a Ruby remote debug configuration in RubyMine:</p></li><li><p>Remote host: localhost</p></li><li><p>Remote port: 1234</p></li><li><p>Remote root folder: /var/tmp/bundles/plugins/ruby/\&lt;plugin\&gt;/\&lt;version\&gt;/ROOT</p></li><li><p>Local port: 26162</p></li><li><p>Local root folder: path to your code</p></li><li><p>Restart Kill Bill with the Java property <code>-X+O</code></p></li></ul></div>
<div class="paragraph"><p>The Kill Bill startup sequence will stop at:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code><span></span>Fast Debugger (ruby-debug-ide 0.6.0, ruby-debug-base 0.10.6, file filtering is supported) listens on 127.0.0.1:1234</code></pre></div></div>
<div class="paragraph"><p>until RubyMine is connected.</p></div></div>
<div class="sect2"><h3 id="_using_ruby_debug">Using ruby-debug</h3><div class="paragraph"><p>While RubyMine offers a nice GUI, it can quickly lose its context or have a hard time stepping through gems dependencies. <code>ruby-debug</code> is much more reliable.</p></div>
<div class="ulist"><ul><li><p>Add the following dependency to your Gemfile:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>gem 'ruby-debug', '~&gt; 0.10'</pre></div></div>
<div class="ulist"><ul><li><p>Add the following snippet at the entry point of your plugin, e.g. top of <code>lib/cybersource.rb</code> for CyberSource:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>require 'ruby-debug'
Debugger.wait_connection = true
Debugger.start_remote(nil, 1234)</pre></div></div>
<div class="ulist"><ul><li><p>Set a breakpoint in the source code using <code>debugger</code></p></li><li><p>Rebuild and redeploy the plugin:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>bundle install &amp;&amp; \
rake killbill:clean &amp;&amp; \
rake build &amp;&amp; \
rake killbill:package &amp;&amp; \
rake killbill:deploy[true]</pre></div></div>
<div class="ulist"><ul><li><p>Restart Kill Bill with the Java property <code>-X+O</code></p></li></ul></div>
<div class="paragraph"><p>The Kill Bill startup sequence will stop until <code>ruby-debug</code> is connected. To launch it:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>rdebug --client -p <span class="tok-m">1234</span></code></pre></div></div>
<div class="paragraph"><p>When the breakpoint is hit, you can examine the context and step into the code:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code><span></span>lib/cybersource/api.rb:164
properties = merge_properties(properties, options)
(rdb:9) l
[159, 168] in lib/cybersource/api.rb
   159          # Pass extra parameters for the gateway here
   160          options = {}
   161
   162          debugger
   163
=&gt; 164          properties = merge_properties(properties, options)
   165          super(kb_account_id, kb_payment_method_id, payment_method_props, set_default, properties, context)
   166        end
   167
   168        def delete_payment_method(kb_account_id, kb_payment_method_id, properties, context)
(rdb:9) s
/var/tmp/bundles/plugins/ruby/killbill-cybersource/3.0.0/ROOT/gems/gems/killbill-5.2.0/lib/killbill/helpers/properties_helper.rb:24
merged = properties_to_hash(properties, options)
(rdb:9) l
[19, 28] in /var/tmp/bundles/plugins/ruby/killbill-cybersource/3.0.0/ROOT/gems/gems/killbill-5.2.0/lib/killbill/helpers/properties_helper.rb
   19          end
   20          merged.merge(options)
   21        end
   22
   23        def merge_properties(properties, options = {})
=&gt; 24          merged = properties_to_hash(properties, options)
   25
   26          properties = []
   27          merged.each do |k, v|
   28            properties &lt;&lt; build_property(k, v)</code></pre></div></div></div></div></div>
<div class="sect1"><h2 id="_seeking_help">Seeking help</h2><div class="sectionbody"><div class="paragraph"><p>If all else fail, reach out to our <a href="https://groups.google.com/forum/#!forum/killbilling-users">mailing-list</a> for help (<strong>do not open a Github issue</strong>).</p></div>
<div class="paragraph"><p>In your message, specify:</p></div>
<div class="ulist"><ul><li><p>What you are seeing and what you are expecting</p></li><li><p>How to reproduce your scenario (cURL commands, code snippet, &#8230;&#8203;)</p></li><li><p><a href="https://github.com/killbill/killbill-cloud">KPM</a> diagnostic output, e.g.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>kpm diagnostic --killbill-api-credentials<span class="tok-o">=</span>bob lazar <span class="tok-se">\</span>
               --killbill-credentials<span class="tok-o">=</span>admin password <span class="tok-se">\</span>
               --killbill-url<span class="tok-o">=</span>http://127.0.0.1:8080 <span class="tok-se">\</span>
               --killbill-web-path<span class="tok-o">=</span>/var/lib/tomcat/webapps/ROOT.war <span class="tok-se">\</span>
               --log-dir<span class="tok-o">=</span>/var/lib/tomcat/logs <span class="tok-se">\</span>
               --account-export<span class="tok-o">=</span>ACCOUNT_ID</code></pre></div></div>
<div class="paragraph"><p>If you are using our standard Docker images, you can simply run the following command in the Kill Bill container:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nv">$KPM_DIAGNOSTIC_CMD</span> -e <span class="tok-nv">killbill_user</span><span class="tok-o">=</span>admin <span class="tok-se">\</span>
                    -e <span class="tok-nv">killbill_password</span><span class="tok-o">=</span>password <span class="tok-se">\</span>
                    -e <span class="tok-nv">killbill_api_key</span><span class="tok-o">=</span>bob <span class="tok-se">\</span>
                    -e <span class="tok-nv">killbill_api_secret</span><span class="tok-o">=</span>lazar <span class="tok-se">\</span>
                    -e <span class="tok-nv">killbill_account</span><span class="tok-o">=</span>ACCOUNT_ID</code></pre></div></div></div></div></div></div></div></div><div class="container-fluid"><div class="row"><div class="col-12 border-columns"></div><div id="footer"><div id="footer-text">Last updated 2021-01-11 23:47:49 +0500</div><script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
          ga('create','UA-32705710-3','auto');
          ga('send','pageview');
          var getOutboundLink = function(url) {
            ga('send', {
              hitType: 'event',
              eventCategory: 'outbound',
              eventAction: 'click',
              eventLabel: url,
              hitCallback: function(){document.location = url;}
            });
          }
          </script></div><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script><script src="https://cdn.staticaly.com/gh/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.js"></script></body></html>