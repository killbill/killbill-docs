<!DOCTYPE html><html lang="en"><head><title>Kill Bill deployment guide</title><style>pre.pygments .hll { background-color: #ffffcc }
pre.pygments { background: #f8f8f8; }
pre.pygments .tok-c { color: #3D7B7B; font-style: italic } /* Comment */
pre.pygments .tok-err { border: 1px solid #FF0000 } /* Error */
pre.pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
pre.pygments .tok-o { color: #666666 } /* Operator */
pre.pygments .tok-ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #9C6500 } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
pre.pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gr { color: #E40000 } /* Generic.Error */
pre.pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { color: #008400 } /* Generic.Inserted */
pre.pygments .tok-go { color: #717171 } /* Generic.Output */
pre.pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
pre.pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
pre.pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #B00040 } /* Keyword.Type */
pre.pygments .tok-m { color: #666666 } /* Literal.Number */
pre.pygments .tok-s { color: #BA2121 } /* Literal.String */
pre.pygments .tok-na { color: #687822 } /* Name.Attribute */
pre.pygments .tok-nb { color: #008000 } /* Name.Builtin */
pre.pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
pre.pygments .tok-no { color: #880000 } /* Name.Constant */
pre.pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
pre.pygments .tok-ni { color: #717171; font-weight: bold } /* Name.Entity */
pre.pygments .tok-ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
pre.pygments .tok-nf { color: #0000FF } /* Name.Function */
pre.pygments .tok-nl { color: #767600 } /* Name.Label */
pre.pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
pre.pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #19177C } /* Name.Variable */
pre.pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
pre.pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
pre.pygments .tok-se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #008000 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #A45A77 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */</style><link rel="icon" type="image/x-icon" href="/stylesheets/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"><link rel="preconnect" href="https://S2ISXITURI-dsn.algolia.net"><link rel="stylesheet" href='stylesheets/bootstrap.min.css'><link rel="stylesheet" href='stylesheets/bootstrap-toc.min.css'><link rel="stylesheet" href="stylesheets/kb.css"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Kill Bill deployment guide"></head><body data-spy="scroll" data-target="#myScrollspy" data-offset="100"><div class="loader-wrapper"><div id="loading"></div></div><header class="header sticky" id="header"><div class="header-wrapper"><div class="container-fluid"><div class="row flex-xl-nowrap justify-content-evenly"><div class="header-logo"><div class="logo"><a href="/"><img src="/stylesheets/images/logo/light-logo.svg" style="height:38px" alt="Kill Bill Docs" id="logo" height="38" width="146"></a></div><div class="switch"><input type="checkbox" aria-label="Search" name="theme-toggle" id="theme-toggle"><span class="slider round"></span></div></div><div class="nav-toggler sidebar-toggler"><svg class="hamburger" xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 7C20.75 7.41421 20.4142 7.75 20 7.75L4 7.75C3.58579 7.75 3.25 7.41421 3.25 7C3.25 6.58579 3.58579 6.25 4 6.25L20 6.25C20.4142 6.25 20.75 6.58579 20.75 7Z" fill=""/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 12C20.75 12.4142 20.4142 12.75 20 12.75L4 12.75C3.58579 12.75 3.25 12.4142 3.25 12C3.25 11.5858 3.58579 11.25 4 11.25L20 11.25C20.4142 11.25 20.75 11.5858 20.75 12Z" fill=""/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 17C20.75 17.4142 20.4142 17.75 20 17.75L4 17.75C3.58579 17.75 3.25 17.4142 3.25 17C3.25 16.5858 3.58579 16.25 4 16.25L20 16.25C20.4142 16.25 20.75 16.5858 20.75 17Z" fill=""/></svg></div><div class="header-search"><div class="search-form-wrapper"><div id="docsearch" style="height: 43px; display: flex; align-items: center; width: 100%;"></div></div></div></div></div></div></header><main class="main sidebar-show"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="sidebar-wrapper"><aside class="sidebar"><div class="sidebar__control"><svg width="8" height="12" viewBox="0 0 8 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.33316 10.6665L1.6665 5.99992L6.33316 1.33325" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div><nav class="sidebar-nav"><ul class="nav navbar-nav"><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Getting Started</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li><a class="nav-link" href="/latest/what_is_kill_bill.html">What is Kill Bill?</a></li><li><a class="nav-link" href="/latest/getting_started.html">Getting Started (Installation)</a></li><li><a class="nav-link" href="/latest/quick_start_with_kaui.html">Quick Start with Kaui</a></li><li><a class="nav-link" href="/latest/quick_start_with_kb_api.html">Quick Start with the Kill Bill API</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Installation</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/stripe_plugin.html">Kill Bill + Stripe DIY</a></li><li><a class="nav-link" href="/latest/userguide_deployment.html">Going to Production</a></li><li><a class="nav-link" href="/latest/how-to-upgrade-the-database.html">Database Migrations</a></li><li><a class="nav-link" href="/latest/PostgreSQL.html">PostgreSQL Setup</a></li><li><a class="nav-link" href="https://github.com/killbill/killbill/releases" onclick="getOutboundLink('https://github.com/killbill/killbill/releases'); return false;">Release&nbsp;Notes</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">AWS</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/how-to-set-up-a-single-tier-system.html">Single-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-multi-tier-system.html">Multi-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-cloud-formation-system.html">CloudFormation Setup</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/how-to-maintain-a-single-tier-system.html">Single-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-multi-tier-system.html">Multi-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-cloud-formation-system.html">CloudFormation Maintenance</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Manuals</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/userguide_subscription.html">Subscription&nbsp;Billing</a></li><li><a class="nav-link" href="/latest/userguide_payment.html">Payment Processing</a></li><li><a class="nav-link" href="/latest/userguide_kaui.html">Kaui, the Administrative&nbsp;UI</a></li><li><a class="nav-link" href="/latest/email-notification-plugin.html">Email Notification Plugin</a></li><li><a class="nav-link" href="/latest/custom-email-invoice-formatter.html">Custom Email Formatter</a></li><li><a class="nav-link" href="/latest/userguide_analytics.html">Analytics Plugin</a></li><li><a class="nav-link" href="/latest/userguide_configuration.html">Kill Bill&nbsp;Configuration</a></li><li><a class="nav-link" href="/latest/internationalization.html">Kill Bill&nbsp;Internationalization</a></li><li><a class="nav-link" href="/latest/migration_guide.html">Migrating to Kill Bill</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Tutorials</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plan_alignment.html">Plans Alignments</a></li><li><a class="nav-link" href="/latest/overdue.html">Overdue System</a></li><li><a class="nav-link" href="/latest/consumable_in_arrear.html">In Arrear UsageBilling</a></li><li><a class="nav-link" href="/latest/ha.html">Hierarchical Accounts</a></li><li><a class="nav-link" href="/latest/catalog-examples.html">Catalog Examples</a></li><li><a class="nav-link" href="/latest/invoice_examples.html">Invoice Examples</a></li><li><a class="nav-link" href="/latest/invoice_templates.html">Invoice Templates</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Integration</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="http://killbill.github.io/slate" onclick="getOutboundLink('http://killbill.github.io/slate'); return false;">REST API Reference</a></li><li><a class="nav-link" href="/latest/swagger_documentation.html">Swagger UI Documentation</a></li><li><a class="nav-link" href="/latest/postman.html">Postman Integration</a></li><li><a class="nav-link" href="/latest/debugging.html">Debugging</a></li><li><a class="nav-link" href="/latest/push_notifications.html">Push Notifications</a></li><li><a class="nav-link" href="/latest/kill_bill_events.html">Kill Bill Events</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Plugin Development</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_introduction.html">Plugin Introduction</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_development.html">Plugin Development</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_installation.html">Plugin Installation</a></li><li><a class="nav-link" href="/latest/plugin_use_cases.html">Special Plugin Use Cases</a></li><li><a class="nav-link" href="/latest/notification_plugin.html">Notification Plugins</a></li><li><a class="nav-link" href="/latest/payment_plugin.html">Payment Plugins</a></li><li><a class="nav-link" href="/latest/payment_control_plugin.html">Payment Control Plugins</a></li><li><a class="nav-link" href="/latest/usage_plugin.html">Usage Plugins</a></li><li><a class="nav-link" href="/latest/invoice_plugin.html">Invoice Plugins</a></li><li><a class="nav-link" href="/latest/catalog_plugin.html">Catalog Plugins</a></li><li><a class="nav-link" href="/latest/entitlement_plugin.html">Entitlement Plugins</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Operational Guides</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/deploy_to_kubernetes.html">Kubernetes (K8s) Deployment</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/user_management.html">Users, Roles, and Permissions</a></li><li><a class="nav-link" href="/latest/plugin_management.html">Plugin Management</a></li><li><a class="nav-link" href="/latest/aws-tools.html">AWS Analytics Tools</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Client Libraries</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/java_client.html">Java</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-ruby" onclick="getOutboundLink('http://github.com/killbill/killbill-client-ruby'); return false;">Ruby</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-php" onclick="getOutboundLink('http://github.com/killbill/killbill-client-php'); return false;">PHP</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-js" onclick="getOutboundLink('http://github.com/killbill/killbill-client-js'); return false;">Node.js</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-python" onclick="getOutboundLink('http://github.com/killbill/killbill-client-python'); return false;">Python</a></li><li><a class="nav-link" href="http://github.com/killbill/kbcli" onclick="getOutboundLink('http://github.com/killbill/kbcli'); return false;">KillBill Go </a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">About Kill Bill</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/demo.html">Demo</a></li><li><a class="nav-link" href="/latest/features.html">Features List</a></li><li><a class="nav-link" href="/latest/faq.html">Technical FAQs</a></li><li><a class="nav-link" href="/latest/Kill-Bill-Glossary.html">Glossary</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Internal</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/internal_design.html">Internal Design</a></li><li><a class="nav-link" href="/latest/entitlement_subsystem.html">Entitlement Subsystem</a></li><li><a class="nav-link" href="/latest/invoice_subsystem.html">Invoice Subsystem</a></li><li><a class="nav-link" href="/latest/development.html">Development Environment</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">References</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="https://github.com/killbill/killbill-docs/tree/v3/swagger" onclick="getOutboundLink('https://github.com/killbill/killbill-docs/tree/v3/swagger'); return false;">Swagger&nbsp;API Schema</a></li><li><a class="nav-link" href="/latest/catalog.xsd">Catalog XSD Reference</a></li><li><a class="nav-link" href="/latest/overdue.xsd">Overdue XSD Reference</a></li></ul></li></ul></nav><script>
  jQuery(document).ready(function($){
    $('.sidebar-nav .icon-title').on('click', function (e) {
      e.preventDefault();
      $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
      $('.sidebar-nav > .navbar-nav > li').removeClass('open');

      if($(this).next().is(':visible')){
        $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
        $('.sidebar-nav > .navbar-nav > li').removeClass('open');
      } else {
        $(this).parent().addClass('open');
        $(this).next().slideDown(200);
      }
    });

    let pageURL = $(location).attr("href");
    pageURL = pageURL.includes('.html') ? pageURL : pageURL + '.html';
    $('.nav-link').each(function() {
      if (pageURL.toLowerCase().includes($(this).attr('href').toLowerCase())) {
        $(this).parent().addClass('list-item-active');
        $(this).parent().parent().addClass('active-list');
        $(this).parent().parent().prev().addClass('bd-link-active-wrap');
      }
    });
  });
</script><a class="doclink" href="mailto:support@killbill.io">Report a doc problem</a></aside></div><div class="article-container"><div class="center-content"><div class="main-wrapper"><article class="content-wrapper"><div class="banner"><h1>Kill Bill deployment guide</h1></div><div id="content"><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This deployment guide lists the best practices to consider once you are ready to move to production.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_best_practices">Best practices</h3>
<div class="paragraph">
<p>Kill Bill is fundamentally a backend system, so the following considerations should apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Don&#8217;t make the system visible to the outside world, instead you should have a front end system, or a reverse proxy in front of it (e.g. if you need to handle gateway notifications like PayPal IPN/Internal Payment Notification).</p>
</li>
<li>
<p>Always deploy at least 2 instances (for reliability purposes) in front of a load balancer.</p>
</li>
<li>
<p>Setup your database with a master and a slave instances, and configure it to take regular snapshots.</p>
</li>
<li>
<p>Aggregate your logs across instances (for example using <a href="http://logstash.net/">LogStash</a> or <a href="https://www.graylog.org/">GrayLog2</a>).</p>
</li>
<li>
<p>Look at the all the existing Kill Bill JMX metrics (using VisualVM, jconsole, &#8230;&#8203;) and set some alerts (for instance by using the following <a href="https://github.com/killbill/nagios-jmx-plugin">script</a>).</p>
</li>
<li>
<p>Configure your system properly, especially when it comes to the settings of the bus and notification queue.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_pre_and_post_deployment_checklist">Pre- and Post-deployment checklist</h3>
<div class="ulist">
<ul>
<li>
<p>Test, test, test: we work hard to make the core of the platform solid. But your deployment, with your own combination of plugins and configuration (catalog, overdue, etc.) is unique. Write business-level regression tests that you can run before each upgrade.</p>
</li>
<li>
<p>Timezone of your servers and databases has to be UTC and ensure NTP is properly configured to avoid any drift between instances.</p>
</li>
<li>
<p>Consider encrypting sensitive configuration properties, like database passwords, with Jasypt. See <a href="http://www.jasypt.org/cli.html" class="bare">http://www.jasypt.org/cli.html</a> for details on how to generate encrypted values. Example configuration:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="properties"><span></span><span class="tok-na">-Dorg.killbill.server.enableJasypt</span><span class="tok-o">=</span><span class="tok-s">true</span>
<span class="tok-na">-Djasypt.encryptor.password</span><span class="tok-o">=</span><span class="tok-s">myTopSecretPassword</span>
<span class="tok-na">-Djasypt.encryptor.algorithm</span><span class="tok-o">=</span><span class="tok-s">PBeWithshA1andDeSede</span>
<span class="tok-na">-Dorg.killbill.billing.osgi.dao.password</span><span class="tok-o">=</span><span class="tok-s">ENC(+PeDGcp3DTonUpB3lPuoegack9kb0hJi)</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure the servers have enough entropy: <code>/proc/sys/kernel/random/entropy_avail</code> should be &gt; 3k (otherwise install <code>haveged</code> / <code>rng-tools</code>). Kill Bill should also be started with <code>-Djava.security.egd=file:/dev/./urandom</code>.</p>
</li>
<li>
<p>Adjust <code>org.killbill.security.shiroNbHashIterations</code> as needed. This setting configures the number of iterations run to hash API secrets and user passwords. The default value is high for security reasons, but can be adjusted down if required (e.g. for Docker <code>-e KILLBILL_SECURITY_SHIRO_NB_HASH_ITERATIONS=1</code>) as this can have a significant performance impact. Note that changing the value requires re-hashing manually all tenants secrets and user passwords.</p>
</li>
<li>
<p>Make sure your database and queues configuration are adequate: the <code>bus_events</code> table should almost always be empty and the <code>notifications</code> table should never have any <code>AVAILABLE</code> entry with an effective date in the past. Otherwise, in both cases, the system will be late (invoices not generated, etc.). These two metrics should always be monitored in production (potentially a paging event).</p>
</li>
<li>
<p>Verify the integration with your payment gateway(s): very few payment transactions (if any) should be in an <code>UNKNOWN</code> state. Make sure to fix these manually via the Payment Admin API, if the plugin is unable to do it automatically.</p>
</li>
<li>
<p>Have a monitoring system in place (we recommend <a href="https://github.com/killbill/killbill-cloud/tree/master/docker/compose">Elasticseach, Logstash, Kibana, InfluxDB and Grafana</a>, which can be easily setup for Kill Bill) and watch your logs constantly: any <code>WARN</code> or <code>ERROR</code> entry should be reviewed, as well as stacktraces.</p>
</li>
<li>
<p>Monitor metrics at <code>/1.0/metrics</code> and integrate the healthcheck at <code>/1.0/healthcheck</code> with your load balancer.</p>
</li>
<li>
<p>Join our <a href="https://groups.google.com/forum/#!forum/killbilling-users">mailing-list</a> to get notified of new releases or ask questions. Due to the high traffic, we&#8217;re not always available for help right away: if you need peace of mind for your production deployment, consider becoming a <a href="https://github.com/sponsors/pierre">GitHub Sponsor</a> to get priority support via alternative channels.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deployment_options">Deployment options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When deploying Kill Bill, the following pieces will need to be deployed in addition to your OS, VM or container (Docker, &#8230;&#8203;):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <a href="https://en.wikipedia.org/wiki/Web_container">Web container</a> (Jetty, Tomcat, &#8230;&#8203;)</p>
</li>
<li>
<p>The killbill <a href="https://en.wikipedia.org/wiki/WAR_(file_format)">web application</a></p>
</li>
<li>
<p>The plugins</p>
</li>
<li>
<p>The configuration files and system properties</p>
</li>
<li>
<p>The database along with the various schemas (see our <a href="https://docs.killbill.io/latest/database_migrations.html">database migrations guide</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because a lot of pieces need to be in place, and because a lot can go wrong, users are <strong>strongly</strong> encouraged to use either our pre-built <a href="https://docs.killbill.io/latest/aws.html">AMIs</a> on AWS or our pre-built <a href="https://registry.hub.docker.com/u/killbill/killbill">Docker images</a>.</p>
</div>
<div class="paragraph">
<p>If these options aren&#8217;t possible in your environment, default to a manual Tomcat installation.</p>
</div>
<div class="paragraph">
<p>Our <a href="https://docs.killbill.io/latest/getting_started.html">Getting Started</a> guide has step by step instructions for all of these options.</p>
</div>
<div class="paragraph">
<p>Finally, experienced users can also opt for our <a href="https://github.com/killbill/killbill-cloud/tree/master">Ansible playbooks</a> (Ansible is an open-source IT Automation tool), to install and configure <a href="https://tomcat.apache.org/">Apache Tomcat</a>, <a href="https://github.com/killbill/killbill-cloud/tree/master/kpm">KPM</a> and Kill Bill individually.</p>
</div>
<div class="paragraph">
<p>Note that all these deployment options rely on <a href="https://github.com/killbill/killbill-cloud/tree/master/kpm">KPM</a>, the Kill Bill Package Manager. KPM can fetch existing (signed) artifacts for the main killbill war and for each of the plugins, and deploy them at the right place. Using KPM directly gives you the most flexibility without having to re-invent the wheel, but significantly increases the deployment complexity. To be used by our most advanced users only.</p>
</div>
<div class="sect2">
<h3 id="_docker">Docker</h3>
<div class="paragraph">
<p>Documentation to configure our images is available <a href="https://github.com/killbill/killbill-cloud/blob/master/docker/README.adoc">here</a>.</p>
</div>
<div class="paragraph">
<p>You can perform container configuration by bind mounting a custom <code>killbill.properties</code> (for configuration) and/or a custom <code>kpm.yml</code> (to specify plugins to install) file: <code>-v /path/to/killbill.properties:/var/lib/killbill/killbill.properties -v /path/to/kpm.yml:/var/lib/killbill/kpm.yml</code>. Note that on MacOS, <code>/path/to</code> must be under <code>/Users</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_database_engine">Database engine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Kill Bill core team is typically using <code>mysql</code> for most of the production deployments and for its testing, but we also run regression tests against both MariaDB 10 and PostgreSQL 12, and users have successfully deployed Kill Bill with Oracle MySQL, Percona, Aurora, etc.</p>
</div>
<div class="paragraph">
<p>We have kept our DDL schema (and the queries we run) as simple as possible so it is easy to adapt it for other RDBMS.</p>
</div>
<div class="sect2">
<h3 id="_kill_bill">Kill Bill</h3>
<div class="paragraph">
<p>You can find the Kill Bill DDL <a href="https://docs.killbill.io/latest/ddl.sql">here</a>. For PostgreSQL users, you will need to also add the following <a href="https://github.com/killbill/killbill/blob/master/util/src/main/resources/org/killbill/billing/util/ddl-postgresql.sql">schema extension</a>, <strong>before installing the main DDL</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_kaui">Kaui</h3>
<div class="paragraph">
<p>You can find the Kaui DDL <a href="https://github.com/killbill/killbill-admin-ui/blob/master/db/ddl.sql">here</a>&#8201;&#8212;&#8201;based on the version you are running, you can adjust the corresponding URL.</p>
</div>
</div>
<div class="sect2">
<h3 id="_failover">Failover</h3>
<div class="paragraph">
<p>We&#8217;ve tested various failover scenarios (Aurora RDS, master/slave MariaDB Docker setup and master/slave Percona Server on real hardware) and could confirm that Kill Bill is behaving as expected, i.e. queries in-flight will fail during a failover, but reconnection is automatic.</p>
</div>
<div class="paragraph">
<p>Specifically for Aurora though, we did notice that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reconnection is r/o by default after the failover. <code>jdbc:mysql:aurora:</code> must be specified in the JDBC url for the reconnection to be r/w.</p>
</li>
<li>
<p>Triggering a failover in the RDS UI leads to a pretty short Kill Bill downtime (few secs). Terminating the master though ("delete instance") takes a bit longer (few minutes)&#8201;&#8212;&#8201;this could be mitigated with more aggressive timeouts in the JDBC pool.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bus_and_notification_queues">Bus and Notification queues</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_bus_events">Bus events</h3>
<div class="paragraph">
<p>The notifications across Kill Bill core services rely on a proprietary <a href="https://killbill.io/blog/persistent-bus-in-kill-bill/">bus event</a>. There are actually 2 buses, the <strong>main</strong> bus which is used by core services and an <strong>external</strong> bus which is used by plugins. The main reason for having 2 buses is that the main bus is critical for internal operations to work, and so we want to prevent plugin code that could interact with 3rd party systems to block on long operations and impact the rest of the system.</p>
</div>
<div class="paragraph">
<p>There are 2 sets of two tables to manage those bus events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For the <strong>main</strong> bus, a <code>bus_events</code> and a <code>bus_events_history</code> table.</p>
</li>
<li>
<p>For the <strong>external</strong> bus, a <code>bus_ext_events</code> and a <code>bus_ext_events_history</code> table.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Events are moved from the <code>bus_events</code> to the <code>bus_events_history</code> as they are processed. That allows to keep a history of what happened in the system and avoid having the <code>bus_events</code> table grow too much. The <code>bus_events_history</code> is only there for debugging and is never used by the system.</p>
</div>
<div class="sect3">
<h4 id="_bus_event_modes">Bus Event Modes</h4>
<div class="paragraph">
<p>The bus event can be run in multiple modes (<code>instanceName</code> below is either <code>main</code> or <code>external</code>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>POLLING</strong>: the bus will poll the database for new available entries and dispatch them across the nodes.</p>
</li>
<li>
<p><strong>STICKY_POLLING</strong>: the bus will poll the database for new available entries and dispatch them to the same node that created the entry.</p>
</li>
<li>
<p><strong>STICKY_EVENTS</strong> (default mode): in that mode, the bus now behaves as a blocking queue where entries are dispatched as soon as they have been committed to disk. This is a much more efficient mechanism both in terms of latency (because entries are picked up right away) and throughput (because there is no time for entries to accumulate).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In a cloud environment, where nodes are more prone to appear and disappear, the following choices are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <strong>POLLING mode</strong></p>
</li>
<li>
<p>Use the <strong>STICKY_EVENTS</strong> (or <strong>STICKY_POLLING</strong>) mode. In that scenario, you need to be cautious of Kill Bill instances restarting on a different node:</p>
</li>
<li>
<p>Each instance can be started with a specific system property <code>org.killbill.queue.creator.name=&lt;MY_VIRTUAL_INSTANCE_NAME&gt;</code>, which overrides the <code>creating_owner</code> value string associated with each entry which defaults to the hostname of the machine. When using that property, an instance that restarts on a different node but with the same property will continue processing the same entries.</p>
</li>
<li>
<p>Or, alternatively if failovers don&#8217;t occur too often, run a query to update rows associated with the instance that failed over so they get picked by an other node. Note that events are never lost because they are persistent, but in that case, they may linger until updated. The query to update the rows is the following (only showed for bus_events table, but similar query needs to happen for bus_events_history):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><span></span><span class="tok-k">update</span><span class="tok-w"> </span><span class="tok-n">bus_events</span><span class="tok-w"> </span><span class="tok-k">set</span><span class="tok-w"> </span><span class="tok-n">creating_owner</span><span class="tok-o">=</span><span class="tok-s1">&#39;MY_NEW_NODE_HOSTNAME&#39;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">processing_available_date</span><span class="tok-o">=</span><span class="tok-k">NULL</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">processing_state</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s1">&#39;AVAILABLE&#39;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">processing_owner</span><span class="tok-o">=</span><span class="tok-k">NULL</span><span class="tok-w"> </span><span class="tok-k">where</span><span class="tok-w"> </span><span class="tok-n">creating_owner</span><span class="tok-o">=</span><span class="tok-s1">&#39;MY_INSTANCE_NAME_THAT_FAILED&#39;</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_future_notifications">Future Notifications</h3>
<div class="sect3">
<h4 id="_overview_2">Overview</h4>
<div class="paragraph">
<p>In addition to the bus events, which are dispatched immediately, Kill Bill also manages future notifications. The mechanism is very similar to the <strong>POLLING</strong> we described earlier, but the main difference is that those notifications are dispatched when the <code>effective_date</code> of the notification has been reached. There is no <strong>STICKY_EVENTS</strong> mode for the future notifications.</p>
</div>
<div class="paragraph">
<p>The future notifications also rely on two tables: the <code>notifications</code> and <code>notifications_history</code>, and the mechanism to move processed entries is similar to what we described for the bus event.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_logging_and_data_governance">Logging and Data Governance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are using Tomcat, <code>CATALINA_BASE/logs/catalina.out</code> does not rotate. Make sure to make your main appender <code>ch.qos.logback.core.rolling.RollingFileAppender</code> instead of the default <code>ch.qos.logback.core.ConsoleAppender</code> (<code>STDOUT</code>/<code>STDERR</code> is redirected to <code>CATALINA_BASE/logs/catalina.out</code>).</p>
</div>
<div class="paragraph">
<p>Make sure also to install the <a href="https://github.com/killbill/killbill-platform/tree/master/osgi-bundles/bundles/logger">Kill Bill Log bundle</a> in your <code>platform</code> directory (<code>/var/tmp/bundles/platform</code> by default), otherwise OSGI logs (including from JRuby plugins) will end up in <code>STDOUT</code>/<code>STDERR</code> (hence in <code>CATALINA_BASE/logs/catalina.out</code>). It is included in the <a href="https://github.com/killbill/killbill-platform/tree/master/osgi-bundles/defaultbundles">defaultbundles package</a>.</p>
</div>
<div class="sect2">
<h3 id="_pii_and_gdpr">PII and GDPR</h3>
<div class="paragraph">
<p>We recommend not storing any Personally Identifiable Information (PII) in Kill bill, such as names, email addresses, etc. to limit your compliance burden. Kill Bill accounts have an external key property, which can be set to an id in an external system (e.g. CRM). Have your custom code and plugins fetch this information on-demand instead of storing it inside Kill Bill.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mask_pans">Mask PANs</h3>
<div class="paragraph">
<p>Use the converter class <code>org.killbill.billing.server.log.obfuscators.ObfuscatorConverter</code>.</p>
</div>
<div class="paragraph">
<p>If you are passing PANs via plugin properties, make sure to disable query parameters logging in Tomcat. Use the following <code>org.apache.catalina.valves.AccessLogValve</code> pattern: <code>%h %l %u %t &quot;%m %U&quot; %s %b %D</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_redirect_plugin_logs_to_a_different_file">Redirect plugin logs to a different file</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;configuration</span><span class="tok-w"> </span><span class="tok-na">debug=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;appender</span><span class="tok-w"> </span><span class="tok-na">name=</span><span class="tok-s">&quot;MAIN&quot;</span><span class="tok-w"> </span><span class="tok-na">class=</span><span class="tok-s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;filter</span><span class="tok-w"> </span><span class="tok-na">class=</span><span class="tok-s">&quot;ch.qos.logback.core.filter.EvaluatorFilter&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;evaluator</span><span class="tok-w"> </span><span class="tok-na">name=</span><span class="tok-s">&quot;loggingTaskEval&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-w">                </span><span class="tok-nt">&lt;expression&gt;</span>
<span class="tok-w">                </span><span class="tok-cp">&lt;![CDATA[</span>
<span class="tok-cp">                    message!=null &amp;&amp;</span>
<span class="tok-cp">                    message.contains(&quot;[cybersource-plugin]&quot;)</span>
<span class="tok-cp">                ]]&gt;</span>
<span class="tok-w">                </span><span class="tok-nt">&lt;/expression&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;/evaluator&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;OnMatch&gt;</span>DENY<span class="tok-nt">&lt;/OnMatch&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;/filter&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;file&gt;</span>${LOGS_DIR:-./logs}/killbill.out<span class="tok-nt">&lt;/file&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;rollingPolicy</span><span class="tok-w"> </span><span class="tok-na">class=</span><span class="tok-s">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;fileNamePattern&gt;</span>${LOGS_DIR:-./logs}/killbill-%d{yyyy-MM-dd}.%i.out.gz<span class="tok-nt">&lt;/fileNamePattern&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;maxHistory&gt;</span>3<span class="tok-nt">&lt;/maxHistory&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;cleanHistoryOnStart&gt;</span>true<span class="tok-nt">&lt;/cleanHistoryOnStart&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;timeBasedFileNamingAndTriggeringPolicy</span><span class="tok-w"> </span><span class="tok-na">class=</span><span class="tok-s">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-w">                </span><span class="tok-nt">&lt;maxFileSize&gt;</span>100MB<span class="tok-nt">&lt;/maxFileSize&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;/timeBasedFileNamingAndTriggeringPolicy&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;/rollingPolicy&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;encoder&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;pattern&gt;</span>%date<span class="tok-w"> </span>[%thread]<span class="tok-w"> </span>%-5level<span class="tok-w"> </span>%logger{36}<span class="tok-w"> </span>-<span class="tok-w"> </span>%msg%n<span class="tok-nt">&lt;/pattern&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;/encoder&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;/appender&gt;</span>

<span class="tok-w">    </span><span class="tok-nt">&lt;appender</span><span class="tok-w"> </span><span class="tok-na">name=</span><span class="tok-s">&quot;CYBERSOURCE&quot;</span><span class="tok-w"> </span><span class="tok-na">class=</span><span class="tok-s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;filter</span><span class="tok-w"> </span><span class="tok-na">class=</span><span class="tok-s">&quot;ch.qos.logback.core.filter.EvaluatorFilter&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;evaluator</span><span class="tok-w"> </span><span class="tok-na">name=</span><span class="tok-s">&quot;loggingTaskEval&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-w">                </span><span class="tok-nt">&lt;expression&gt;</span>
<span class="tok-w">                </span><span class="tok-cp">&lt;![CDATA[</span>
<span class="tok-cp">                    message!=null &amp;&amp;</span>
<span class="tok-cp">                    message.contains(&quot;[cybersource-plugin]&quot;)</span>
<span class="tok-cp">                ]]&gt;</span>
<span class="tok-w">                </span><span class="tok-nt">&lt;/expression&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;/evaluator&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;OnMismatch&gt;</span>DENY<span class="tok-nt">&lt;/OnMismatch&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;/filter&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;file&gt;</span>${LOGS_DIR:-./logs}/cybersource.out<span class="tok-nt">&lt;/file&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;rollingPolicy</span><span class="tok-w"> </span><span class="tok-na">class=</span><span class="tok-s">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;fileNamePattern&gt;</span>${LOGS_DIR:-./logs}/cybersource-%d{yyyy-MM-dd}.%i.out.gz<span class="tok-nt">&lt;/fileNamePattern&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;maxHistory&gt;</span>3<span class="tok-nt">&lt;/maxHistory&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;cleanHistoryOnStart&gt;</span>true<span class="tok-nt">&lt;/cleanHistoryOnStart&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;timeBasedFileNamingAndTriggeringPolicy</span><span class="tok-w"> </span><span class="tok-na">class=</span><span class="tok-s">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-w">                </span><span class="tok-nt">&lt;maxFileSize&gt;</span>100MB<span class="tok-nt">&lt;/maxFileSize&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;/timeBasedFileNamingAndTriggeringPolicy&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;/rollingPolicy&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;encoder&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;pattern&gt;</span>%date<span class="tok-w"> </span>[%thread]<span class="tok-w"> </span>%msg%n<span class="tok-nt">&lt;/pattern&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;/encoder&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;/appender&gt;</span>

<span class="tok-w">    </span><span class="tok-nt">&lt;root</span><span class="tok-w"> </span><span class="tok-na">level=</span><span class="tok-s">&quot;INFO&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-w">       </span><span class="tok-nt">&lt;appender-ref</span><span class="tok-w"> </span><span class="tok-na">ref=</span><span class="tok-s">&quot;MAIN&quot;</span><span class="tok-w"> </span><span class="tok-nt">/&gt;</span>
<span class="tok-w">       </span><span class="tok-nt">&lt;appender-ref</span><span class="tok-w"> </span><span class="tok-na">ref=</span><span class="tok-s">&quot;CYBERSOURCE&quot;</span><span class="tok-w"> </span><span class="tok-nt">/&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;/root&gt;</span>
<span class="tok-nt">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handling_plugin_logs">Handling plugin logs</h3>
<div class="paragraph">
<p>In order for plugin logs to be handled by the main logger, make sure to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install <code>killbill-platform-osgi-bundles-logger</code> under <code>/var/tmp/bundles/platform</code> (also provided in the default plugins package)</p>
</li>
<li>
<p>Add <code>org.osgi.service.log</code> to <code>Import-Package</code> in your <code>MANIFEST.MF</code></p>
</li>
<li>
<p>Add the following dependencies in compile scope in your plugin:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;groupId&gt;</span>org.kill-bill.billing<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;artifactId&gt;</span>killbill-platform-osgi-bundles-lib-killbill<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;groupId&gt;</span>org.kill-bill.billing<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;artifactId&gt;</span>killbill-platform-osgi-bundles-lib-slf4j-osgi<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reverse_proxy">Reverse Proxy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend setting up NGINX to forward external notifications to Kill Bill.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a working example for Adyen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="nginx"><span></span><span class="tok-k">server</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kn">listen</span><span class="tok-w">       </span><span class="tok-mi">443</span><span class="tok-p">;</span>
<span class="tok-w">  </span><span class="tok-kn">server_name</span><span class="tok-w">  </span><span class="tok-s">killbill-public.acme.com</span><span class="tok-p">;</span>

<span class="tok-w">  </span><span class="tok-kn">location</span><span class="tok-w"> </span><span class="tok-s">/notifications/killbill-adyen</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-kn">proxy_set_header</span><span class="tok-w"> </span><span class="tok-s">X-Real-IP</span><span class="tok-w"> </span><span class="tok-nv">$remote_addr</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-kn">proxy_set_header</span><span class="tok-w"> </span><span class="tok-s">X-Forwarded-For</span><span class="tok-w"> </span><span class="tok-nv">$proxy_add_x_forwarded_for</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-kn">proxy_set_header</span><span class="tok-w"> </span><span class="tok-s">X-Forwarded-Proto</span><span class="tok-w"> </span><span class="tok-nv">$scheme</span><span class="tok-p">;</span>

<span class="tok-w">      </span><span class="tok-kn">proxy_set_header</span><span class="tok-w"> </span><span class="tok-s">Authorization</span><span class="tok-w"> </span><span class="tok-s">&quot;Basic</span><span class="tok-w"> </span><span class="tok-s">YWRtaW46cGFzc3dvcmQ=&quot;</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-kn">proxy_set_header</span><span class="tok-w"> </span><span class="tok-s">X-Killbill-ApiKey</span><span class="tok-w"> </span><span class="tok-s">bob</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-kn">proxy_set_header</span><span class="tok-w"> </span><span class="tok-s">X-Killbill-ApiSecret</span><span class="tok-w"> </span><span class="tok-s">lazar</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-kn">proxy_set_header</span><span class="tok-w"> </span><span class="tok-s">X-Killbill-CreatedBy</span><span class="tok-w"> </span><span class="tok-s">Adyen</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-kn">proxy_pass</span><span class="tok-w"> </span><span class="tok-s">http://killbill-internal.acme.com:8080/1.0/kb/paymentGateways/notification/killbill-adyen</span><span class="tok-p">;</span>

<span class="tok-w">      </span><span class="tok-kn">proxy_hide_header</span><span class="tok-w"> </span><span class="tok-s">Set-Cookie</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-kn">proxy_hide_header</span><span class="tok-w"> </span><span class="tok-s">Access-Control-Allow-Origin</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-kn">proxy_hide_header</span><span class="tok-w"> </span><span class="tok-s">Access-Control-Allow-Methods</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-kn">proxy_hide_header</span><span class="tok-w"> </span><span class="tok-s">Access-Control-Allow-Headers</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-kn">proxy_hide_header</span><span class="tok-w"> </span><span class="tok-s">Access-Control-Expose-Headers</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-kn">proxy_hide_header</span><span class="tok-w"> </span><span class="tok-s">Access-Control-Allow-Credentials</span><span class="tok-p">;</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_discovery_with_eureka">Service Discovery with Eureka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For easier integration into a microservice architecture, Kill Bill supports client-side service discovery via a <a href="https://github.com/Netflix/eureka/wiki/Eureka-at-a-glance">Eureka registry</a>. A module (disabled by default) is provided that allows Kill Bill to register with a Eureka server.</p>
</div>
<div class="paragraph">
<p>To register as a Eureka client, first add the following dependency to your profile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;groupId&gt;</span>org.kill-bill.billing<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;artifactId&gt;</span>killbill-platform-service-registry<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, add the Eureka Guice module to the module list in your server module (i.e. KillbillServerModule.java)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-w"> </span><span class="tok-n">install</span><span class="tok-p">(</span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">EurekaModule</span><span class="tok-p">(</span><span class="tok-n">configSource</span><span class="tok-p">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, add the Eureka client config properties to <code>killbill.properties</code>. For example, assuming a Eureka server is running on port 8761 and Kill Bill is on port 8080:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="properties"><span></span><span class="tok-na">eureka.serviceUrl.default</span><span class="tok-o">=</span><span class="tok-s">http://localhost:8761/eureka</span>

<span class="tok-na">eureka.registration.enabled</span><span class="tok-o">=</span><span class="tok-s">true</span>
<span class="tok-na">eureka.name</span><span class="tok-o">=</span><span class="tok-s">killbill</span>
<span class="tok-na">eureka.port</span><span class="tok-o">=</span><span class="tok-s">8080</span>
<span class="tok-na">eureka.port.enabled</span><span class="tok-o">=</span><span class="tok-s">true</span>
<span class="tok-na">eureka.securePort.enabled</span><span class="tok-o">=</span><span class="tok-s">false</span>

<span class="tok-na">eureka.statusPageUrlPath</span><span class="tok-o">=</span><span class="tok-s">/1.0/metrics</span>
<span class="tok-na">eureka.healthCheckUrlPath</span><span class="tok-o">=</span><span class="tok-s">/1.0/healthCheck</span>

<span class="tok-na">eureka.decoderName</span><span class="tok-o">=</span><span class="tok-s">JacksonJson</span>
<span class="tok-na">eureka.preferSameZone</span><span class="tok-o">=</span><span class="tok-s">true</span>
<span class="tok-na">eureka.shouldUseDns</span><span class="tok-o">=</span><span class="tok-s">false</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_https">Enabling HTTPS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You first need to import your SSL certificate (see <a href="https://tomcat.apache.org/tomcat-8.5-doc/ssl-howto.html">docs</a>). For testing, you can just create a self-signed certificate. For example, on Ubuntu or our Docker images:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>sudo<span class="tok-w"> </span>apt-get<span class="tok-w"> </span>update
sudo<span class="tok-w"> </span>apt-get<span class="tok-w"> </span>install<span class="tok-w"> </span>ssl-cert
sudo<span class="tok-w"> </span>usermod<span class="tok-w"> </span>-a<span class="tok-w"> </span>-G<span class="tok-w"> </span>ssl-cert<span class="tok-w"> </span>tomcat</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, update Tomcat’s configuration (<code>/var/lib/tomcat/conf/server.xml</code> in our Docker images):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;Connector</span><span class="tok-w"> </span><span class="tok-na">executor=</span><span class="tok-s">&quot;tomcatThreadPool&quot;</span>
<span class="tok-w">           </span><span class="tok-na">port=</span><span class="tok-s">&quot;8443&quot;</span>
<span class="tok-w">           </span><span class="tok-na">connectionTimeout=</span><span class="tok-s">&quot;20000&quot;</span>
<span class="tok-w">           </span><span class="tok-na">acceptorThreadCount=</span><span class="tok-s">&quot;2&quot;</span>
<span class="tok-w">           </span><span class="tok-na">SSLEnabled=</span><span class="tok-s">&quot;true&quot;</span>
<span class="tok-w">           </span><span class="tok-na">SSLCertificateFile=</span><span class="tok-s">&quot;/etc/ssl/certs/ssl-cert-snakeoil.pem&quot;</span>
<span class="tok-w">           </span><span class="tok-na">SSLCertificateKeyFile=</span><span class="tok-s">&quot;/etc/ssl/private/ssl-cert-snakeoil.key&quot;</span>
<span class="tok-w">           </span><span class="tok-na">scheme=</span><span class="tok-s">&quot;https&quot;</span>
<span class="tok-w">           </span><span class="tok-na">secure=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-w"> </span><span class="tok-nt">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, make sure port 8443 is open (and exported from the Docker containers).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ssl_termination_and_x_forwarded_headers_support">SSL termination and X-Forwarded headers support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When <code>org.killbill.jaxrs.location.full.url=true</code> (default), Kill Bill will build location headers using a full URL. In a typical load balancer scenario, which receives traffic on port 8443 and forwards it to port 8080 on the Kill Bill instances (i.e. SSL terminated at the load balancer), you probably want the headers to return something like <a href="https://killbill-vip.mycompany.net:8443" class="bare">https://killbill-vip.mycompany.net:8443</a> instead of <a href="http://10.1.2.3:8080" class="bare">http://10.1.2.3:8080</a>.</p>
</div>
<div class="paragraph">
<p>To do so, <code>RemoteIpValve</code> should be enabled in your Tomcat configuration (done by default in our Docker images, see <code>/var/lib/tomcat/conf/server.xml</code>). This will make Kill Bill build the right location headers using <code>X-Forwarded-For</code>, <code>X-Forwarded-Proto</code> and <code>X-Forwarded-Port</code> sent by your load balancer or reverse proxy.</p>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You might also need to configure Tomcat&#8217;s <code>internalProxies</code> and <code>trustedProxies</code> attributes (see the <a href="https://tomcat.apache.org/tomcat-7.0-doc/config/valve.html#Proxies_Support">docs</a>).</p>
</li>
<li>
<p>You might also need to set <code>org.killbill.jaxrs.location.host</code> in your <code>killbill.properties</code> file (e.g. <code>org.killbill.jaxrs.location.host=killbill-vip.mycompany.net</code>).</p>
</li>
<li>
<p>You might also want to set <code>requestAttributesEnabled="true"</code> to <code>org.apache.catalina.valves.AccessLogValve</code>, to log the IP address from the <code>X-Forwarded-For</code> header in the access logs.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nagios_integration">Nagios integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To integrate JMX beans with Nagios, download the plugin from <a href="https://github.com/killbill/nagios-jmx-plugin" class="bare">https://github.com/killbill/nagios-jmx-plugin</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-c1"># Whether the persistent bus is turned on (warns if off)</span>
./check_jmx_ng<span class="tok-w"> </span>-v<span class="tok-w"> </span>-U<span class="tok-w"> </span>service:jmx:rmi:///jndi/rmi://127.0.0.1:8989/jmxrmi<span class="tok-w"> </span>-O<span class="tok-w"> </span>org.killbill.bus.api:name<span class="tok-o">=</span>PersistentBus<span class="tok-w"> </span>-A<span class="tok-w"> </span>NotificationProcessingSuspended<span class="tok-w"> </span>-w<span class="tok-w"> </span><span class="tok-nb">false</span>
<span class="tok-c1"># Whether the notification queue is turned on (warns if off)</span>
./check_jmx_ng<span class="tok-w"> </span>-v<span class="tok-w"> </span>-U<span class="tok-w"> </span>service:jmx:rmi:///jndi/rmi://127.0.0.1:8989/jmxrmi<span class="tok-w"> </span>-O<span class="tok-w"> </span>org.killbill.notificationq.api:name<span class="tok-o">=</span>NotificationQueueService<span class="tok-w"> </span>-A<span class="tok-w"> </span>NotificationProcessingSuspended<span class="tok-w"> </span>-w<span class="tok-w"> </span><span class="tok-nb">false</span>
<span class="tok-c1"># Generic Kill Bill healthcheck, checks the overall state of the application (warns if unhealthy)</span>
./check_jmx_ng<span class="tok-w"> </span>-v<span class="tok-w"> </span>-U<span class="tok-w"> </span>service:jmx:rmi:///jndi/rmi://127.0.0.1:8989/jmxrmi<span class="tok-w"> </span>-O<span class="tok-w"> </span>org.killbill.billing.server.healthchecks:name<span class="tok-o">=</span>KillbillHealthcheck<span class="tok-w"> </span>-A<span class="tok-w"> </span>Healthy<span class="tok-w"> </span>-w<span class="tok-w"> </span><span class="tok-nb">true</span>
<span class="tok-c1"># Monitors the size of the notification queue. Warning and Critical alerts often mean an overload of the system</span>
./check_jmx_ng<span class="tok-w"> </span>-v<span class="tok-w"> </span>-U<span class="tok-w"> </span>service:jmx:rmi:///jndi/rmi://127.0.0.1:8989/jmxrmi<span class="tok-w"> </span>-O<span class="tok-w"> </span>metrics:name<span class="tok-o">=</span>org.killbill.notificationq.NotificationQueueDispatcher.pending-notifications<span class="tok-w"> </span>-A<span class="tok-w"> </span>Value<span class="tok-w"> </span>-w<span class="tok-w"> </span><span class="tok-m">50</span><span class="tok-w"> </span>-c<span class="tok-w"> </span><span class="tok-m">100</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Other interesting metrics (use of the <code>-P</code> flag to get Nagios performance data):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>./check_jmx_ng<span class="tok-w"> </span>-v<span class="tok-w"> </span>-U<span class="tok-w"> </span>service:jmx:rmi:///jndi/rmi://127.0.0.1:8989/jmxrmi<span class="tok-w"> </span>-P<span class="tok-w"> </span>-O<span class="tok-w"> </span><span class="tok-s1">&#39;java.lang:type=ClassLoading&#39;</span><span class="tok-w"> </span>-A<span class="tok-w"> </span>LoadedClassCount
./check_jmx_ng<span class="tok-w"> </span>-v<span class="tok-w"> </span>-U<span class="tok-w"> </span>service:jmx:rmi:///jndi/rmi://127.0.0.1:8989/jmxrmi<span class="tok-w"> </span>-P<span class="tok-w"> </span>-O<span class="tok-w"> </span><span class="tok-s1">&#39;java.lang:type=Compilation&#39;</span><span class="tok-w"> </span>-A<span class="tok-w"> </span>TotalCompilationTime
./check_jmx_ng<span class="tok-w"> </span>-v<span class="tok-w"> </span>-U<span class="tok-w"> </span>service:jmx:rmi:///jndi/rmi://127.0.0.1:8989/jmxrmi<span class="tok-w"> </span>-P<span class="tok-w"> </span>-O<span class="tok-w"> </span><span class="tok-s1">&#39;java.lang:type=OperatingSystem&#39;</span><span class="tok-w"> </span>-A<span class="tok-w"> </span>SystemCpuLoad
./check_jmx_ng<span class="tok-w"> </span>-v<span class="tok-w"> </span>-U<span class="tok-w"> </span>service:jmx:rmi:///jndi/rmi://127.0.0.1:8989/jmxrmi<span class="tok-w"> </span>-P<span class="tok-w"> </span>-O<span class="tok-w"> </span><span class="tok-s1">&#39;java.lang:type=Runtime&#39;</span><span class="tok-w"> </span>-A<span class="tok-w"> </span>Uptime
./check_jmx_ng<span class="tok-w"> </span>-v<span class="tok-w"> </span>-U<span class="tok-w"> </span>service:jmx:rmi:///jndi/rmi://127.0.0.1:8989/jmxrmi<span class="tok-w"> </span>-P<span class="tok-w"> </span>-O<span class="tok-w"> </span><span class="tok-s1">&#39;java.lang:type=Threading&#39;</span><span class="tok-w"> </span>-A<span class="tok-w"> </span>ThreadCount
./check_jmx_ng<span class="tok-w"> </span>-v<span class="tok-w"> </span>-U<span class="tok-w"> </span>service:jmx:rmi:///jndi/rmi://127.0.0.1:8989/jmxrmi<span class="tok-w"> </span>-P<span class="tok-w"> </span>-O<span class="tok-w"> </span><span class="tok-s1">&#39;java.nio:type=BufferPool,name=direct&#39;</span><span class="tok-w"> </span>-A<span class="tok-w"> </span>MemoryUsed
./check_jmx_ng<span class="tok-w"> </span>-v<span class="tok-w"> </span>-U<span class="tok-w"> </span>service:jmx:rmi:///jndi/rmi://127.0.0.1:8989/jmxrmi<span class="tok-w"> </span>-P<span class="tok-w"> </span>-O<span class="tok-w"> </span><span class="tok-s1">&#39;java.nio:type=BufferPool,name=mapped&#39;</span><span class="tok-w"> </span>-A<span class="tok-w"> </span>MemoryUsed
./check_jmx_ng<span class="tok-w"> </span>-v<span class="tok-w"> </span>-U<span class="tok-w"> </span>service:jmx:rmi:///jndi/rmi://127.0.0.1:8989/jmxrmi<span class="tok-w"> </span>-P<span class="tok-w"> </span>-O<span class="tok-w"> </span><span class="tok-s1">&#39;metrics:name=org.killbill.bus.dao.PersistentBusSqlDao.getReadyEntries&#39;</span><span class="tok-w"> </span>-A<span class="tok-w"> </span>95thPercentile</code></pre>
</div>
</div>
</div>
</div></div><div class="bottom-nav-links"><a href="#" id="prev-nav-link" class="bottom-nav-link card prev"><span class="arrow-icon left"><svg class="i-arrow" width="12" height="11" viewBox="0 0 12 11" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.19526 1.02876C4.45561 0.768409 4.87772 0.768409 5.13807 1.02876C5.39842 1.28911 5.39842 1.71122 5.13807 1.97157L2.27614 4.8335H11.3333C11.7015 4.8335 12 5.13197 12 5.50016C12 5.86835 11.7015 6.16683 11.3333 6.16683H2.27614L5.13807 9.02876C5.39842 9.28911 5.39842 9.71122 5.13807 9.97157C4.87772 10.2319 4.45561 10.2319 4.19526 9.97157L0.195261 5.97157C-0.0650883 5.71122 -0.0650883 5.28911 0.195261 5.02876L4.19526 1.02876Z" fill=""/></svg><span class="prev-text">Previous</span></span><span id="prev-navigator" class="bottom-nav-text">Prev</span>                               </a><a href="#" id="next-nav-link" class="bottom-nav-link card next"><span class="arrow-icon"><span class="next-text">Next</span><svg class="i-arrow icon-left" width="12" height="11" viewBox="0 0 12 11" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.19526 1.02876C4.45561 0.768409 4.87772 0.768409 5.13807 1.02876C5.39842 1.28911 5.39842 1.71122 5.13807 1.97157L2.27614 4.8335H11.3333C11.7015 4.8335 12 5.13197 12 5.50016C12 5.86835 11.7015 6.16683 11.3333 6.16683H2.27614L5.13807 9.02876C5.39842 9.28911 5.39842 9.71122 5.13807 9.97157C4.87772 10.2319 4.45561 10.2319 4.19526 9.97157L0.195261 5.97157C-0.0650883 5.71122 -0.0650883 5.28911 0.195261 5.02876L4.19526 1.02876Z" fill=""/></svg></span><span id="next-navigator" class="bottom-nav-text">Next</span></a></div></article></div><div class="bd-links-wrapper"><nav class="bd-links toc right-side-menu" id="myScrollspy" data-toggle="toc"></nav></div></div></div></div></div></main><script src="javascripts/jquery-3.6.1.min.js"></script><script src="javascripts/bootstrap.min.js"></script><script src="javascripts/bootstrap-toc.min.js"></script><script type="module" src="javascripts/kb.js"></script><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script><script>docsearch({apiKey: '3ef227e7fd5e2e1a3fffd880484934bf', container: '#docsearch', appId: 'S2ISXITURI', indexName: 'killbill'});</script></body></html>