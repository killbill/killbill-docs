<!DOCTYPE html><html lang="en"><head><title>Plugin Development</title><style>pre.pygments .hll { background-color: #ffffcc }
pre.pygments { background: #f8f8f8; }
pre.pygments .tok-c { color: #3D7B7B; font-style: italic } /* Comment */
pre.pygments .tok-err { border: 1px solid #FF0000 } /* Error */
pre.pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
pre.pygments .tok-o { color: #666666 } /* Operator */
pre.pygments .tok-ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #9C6500 } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
pre.pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gr { color: #E40000 } /* Generic.Error */
pre.pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { color: #008400 } /* Generic.Inserted */
pre.pygments .tok-go { color: #717171 } /* Generic.Output */
pre.pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
pre.pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
pre.pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #B00040 } /* Keyword.Type */
pre.pygments .tok-m { color: #666666 } /* Literal.Number */
pre.pygments .tok-s { color: #BA2121 } /* Literal.String */
pre.pygments .tok-na { color: #687822 } /* Name.Attribute */
pre.pygments .tok-nb { color: #008000 } /* Name.Builtin */
pre.pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
pre.pygments .tok-no { color: #880000 } /* Name.Constant */
pre.pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
pre.pygments .tok-ni { color: #717171; font-weight: bold } /* Name.Entity */
pre.pygments .tok-ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
pre.pygments .tok-nf { color: #0000FF } /* Name.Function */
pre.pygments .tok-nl { color: #767600 } /* Name.Label */
pre.pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
pre.pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #19177C } /* Name.Variable */
pre.pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
pre.pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
pre.pygments .tok-se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #008000 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #A45A77 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */</style><link rel="icon" type="image/x-icon" href="/stylesheets/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"><link rel="preconnect" href="https://S2ISXITURI-dsn.algolia.net"><link rel="stylesheet" href='stylesheets/bootstrap.min.css'><link rel="stylesheet" href='stylesheets/bootstrap-toc.min.css'><link rel="stylesheet" href="stylesheets/kb.css"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Plugin Development"></head><body data-spy="scroll" data-target="#myScrollspy" data-offset="100"><div class="loader-wrapper"><div id="loading"></div></div><header class="header sticky" id="header"><div class="header-wrapper"><div class="container-fluid"><div class="row flex-xl-nowrap justify-content-evenly"><div class="header-logo"><div class="logo"><a href="/"><img src="/stylesheets/images/logo/light-logo.svg" style="height:38px" alt="Kill Bill Docs" id="logo" height="38" width="146"></a></div><div class="switch"><input type="checkbox" aria-label="Search" name="theme-toggle" id="theme-toggle"><span class="slider round"></span></div></div><div class="nav-toggler sidebar-toggler"><svg class="hamburger" xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 7C20.75 7.41421 20.4142 7.75 20 7.75L4 7.75C3.58579 7.75 3.25 7.41421 3.25 7C3.25 6.58579 3.58579 6.25 4 6.25L20 6.25C20.4142 6.25 20.75 6.58579 20.75 7Z" fill=""/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 12C20.75 12.4142 20.4142 12.75 20 12.75L4 12.75C3.58579 12.75 3.25 12.4142 3.25 12C3.25 11.5858 3.58579 11.25 4 11.25L20 11.25C20.4142 11.25 20.75 11.5858 20.75 12Z" fill=""/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 17C20.75 17.4142 20.4142 17.75 20 17.75L4 17.75C3.58579 17.75 3.25 17.4142 3.25 17C3.25 16.5858 3.58579 16.25 4 16.25L20 16.25C20.4142 16.25 20.75 16.5858 20.75 17Z" fill=""/></svg></div><div class="header-search"><div class="search-form-wrapper"><div id="docsearch" style="height: 43px; display: flex; align-items: center; width: 100%;"></div></div></div></div></div></div></header><main class="main sidebar-show"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="sidebar-wrapper"><aside class="sidebar"><div class="sidebar__control"><svg width="8" height="12" viewBox="0 0 8 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.33316 10.6665L1.6665 5.99992L6.33316 1.33325" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div><nav class="sidebar-nav"><ul class="nav navbar-nav"><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Getting Started</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li><a class="nav-link" href="/latest/what_is_kill_bill.html">What is Kill Bill?</a></li><li><a class="nav-link" href="/latest/getting_started.html">Getting Started (Installation)</a></li><li><a class="nav-link" href="/latest/quick_start_with_kaui.html">Quick Start with Kaui</a></li><li><a class="nav-link" href="/latest/quick_start_with_kb_api.html">Quick Start with the Kill Bill API</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Installation</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/stripe_plugin.html">Kill Bill + Stripe DIY</a></li><li><a class="nav-link" href="/latest/userguide_deployment.html">Going to Production</a></li><li><a class="nav-link" href="/latest/how-to-upgrade-the-database.html">Database Migrations</a></li><li><a class="nav-link" href="/latest/PostgreSQL.html">PostgreSQL Setup</a></li><li><a class="nav-link" href="https://github.com/killbill/killbill/releases" onclick="getOutboundLink('https://github.com/killbill/killbill/releases'); return false;">Release&nbsp;Notes</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">AWS</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/how-to-set-up-a-single-tier-system.html">Single-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-multi-tier-system.html">Multi-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-cloud-formation-system.html">CloudFormation Setup</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/how-to-maintain-a-single-tier-system.html">Single-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-multi-tier-system.html">Multi-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-cloud-formation-system.html">CloudFormation Maintenance</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Manuals</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/userguide_subscription.html">Subscription&nbsp;Billing</a></li><li><a class="nav-link" href="/latest/userguide_payment.html">Payment Processing</a></li><li><a class="nav-link" href="/latest/userguide_kaui.html">Kaui, the Administrative&nbsp;UI</a></li><li><a class="nav-link" href="/latest/email-notification-plugin.html">Email Notification Plugin</a></li><li><a class="nav-link" href="/latest/custom-email-invoice-formatter.html">Custom Email Formatter</a></li><li><a class="nav-link" href="/latest/userguide_analytics.html">Analytics Plugin</a></li><li><a class="nav-link" href="/latest/userguide_configuration.html">Kill Bill&nbsp;Configuration</a></li><li><a class="nav-link" href="/latest/internationalization.html">Kill Bill&nbsp;Internationalization</a></li><li><a class="nav-link" href="/latest/migration_guide.html">Migrating to Kill Bill</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Tutorials</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plan_alignment.html">Plans Alignments</a></li><li><a class="nav-link" href="/latest/overdue.html">Overdue System</a></li><li><a class="nav-link" href="/latest/consumable_in_arrear.html">In Arrear UsageBilling</a></li><li><a class="nav-link" href="/latest/ha.html">Hierarchical Accounts</a></li><li><a class="nav-link" href="/latest/catalog-examples.html">Catalog Examples</a></li><li><a class="nav-link" href="/latest/invoice_examples.html">Invoice Examples</a></li><li><a class="nav-link" href="/latest/invoice_templates.html">Invoice Templates</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Integration</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="http://killbill.github.io/slate" onclick="getOutboundLink('http://killbill.github.io/slate'); return false;">REST API Reference</a></li><li><a class="nav-link" href="/latest/swagger_documentation.html">Swagger UI Documentation</a></li><li><a class="nav-link" href="/latest/postman.html">Postman Integration</a></li><li><a class="nav-link" href="/latest/debugging.html">Debugging</a></li><li><a class="nav-link" href="/latest/push_notifications.html">Push Notifications</a></li><li><a class="nav-link" href="/latest/kill_bill_events.html">Kill Bill Events</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Plugin Development</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_introduction.html">Plugin Introduction</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_development.html">Plugin Development</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_installation.html">Plugin Installation</a></li><li><a class="nav-link" href="/latest/plugin_use_cases.html">Special Plugin Use Cases</a></li><li><a class="nav-link" href="/latest/notification_plugin.html">Notification Plugins</a></li><li><a class="nav-link" href="/latest/payment_plugin.html">Payment Plugins</a></li><li><a class="nav-link" href="/latest/payment_control_plugin.html">Payment Control Plugins</a></li><li><a class="nav-link" href="/latest/usage_plugin.html">Usage Plugins</a></li><li><a class="nav-link" href="/latest/invoice_plugin.html">Invoice Plugins</a></li><li><a class="nav-link" href="/latest/catalog_plugin.html">Catalog Plugins</a></li><li><a class="nav-link" href="/latest/entitlement_plugin.html">Entitlement Plugins</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Operational Guides</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/deploy_to_kubernetes.html">Kubernetes (K8s) Deployment</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/user_management.html">Users, Roles, and Permissions</a></li><li><a class="nav-link" href="/latest/plugin_management.html">Plugin Management</a></li><li><a class="nav-link" href="/latest/aws-tools.html">AWS Analytics Tools</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Client Libraries</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/java_client.html">Java</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-ruby" onclick="getOutboundLink('http://github.com/killbill/killbill-client-ruby'); return false;">Ruby</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-php" onclick="getOutboundLink('http://github.com/killbill/killbill-client-php'); return false;">PHP</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-js" onclick="getOutboundLink('http://github.com/killbill/killbill-client-js'); return false;">Node.js</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-python" onclick="getOutboundLink('http://github.com/killbill/killbill-client-python'); return false;">Python</a></li><li><a class="nav-link" href="http://github.com/killbill/kbcli" onclick="getOutboundLink('http://github.com/killbill/kbcli'); return false;">KillBill Go </a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">About Kill Bill</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/demo.html">Demo</a></li><li><a class="nav-link" href="/latest/features.html">Features List</a></li><li><a class="nav-link" href="/latest/faq.html">Technical FAQs</a></li><li><a class="nav-link" href="/latest/Kill-Bill-Glossary.html">Glossary</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Internal</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/internal_design.html">Internal Design</a></li><li><a class="nav-link" href="/latest/entitlement_subsystem.html">Entitlement Subsystem</a></li><li><a class="nav-link" href="/latest/invoice_subsystem.html">Invoice Subsystem</a></li><li><a class="nav-link" href="/latest/development.html">Development Environment</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">References</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="https://github.com/killbill/killbill-docs/tree/v3/swagger" onclick="getOutboundLink('https://github.com/killbill/killbill-docs/tree/v3/swagger'); return false;">Swagger&nbsp;API Schema</a></li><li><a class="nav-link" href="/latest/catalog.xsd">Catalog XSD Reference</a></li><li><a class="nav-link" href="/latest/overdue.xsd">Overdue XSD Reference</a></li></ul></li></ul></nav><script>
  $(document).ready(function () {
    $('.sidebar-nav .icon-title').on('click', function (e) {
      e.preventDefault();
      $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
      $('.sidebar-nav > .navbar-nav > li').removeClass('open');

      if($(this).next().is(':visible')){
        $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
        $('.sidebar-nav > .navbar-nav > li').removeClass('open');
      } else {
        $(this).parent().addClass('open');
        $(this).next().slideDown(200);
      }
    });

    let pageURL = $(location).attr("href");
    pageURL = pageURL.includes('.html') ? pageURL : pageURL + '.html';
    $('.nav-link').each(function() {
      if (pageURL.toLowerCase().includes($(this).attr('href').toLowerCase())) {
        $(this).parent().addClass('list-item-active');
        $(this).parent().parent().addClass('active-list');
        $(this).parent().parent().prev().addClass('bd-link-active-wrap');
      }
    });
  });
</script><a class="doclink" href="mailto:support@killbill.io">Report a doc problem</a></aside></div><div class="article-container"><div class="center-content"><div class="main-wrapper"><article class="content-wrapper"><div class="banner"><h1>Plugin Development</h1></div><div id="content"><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document can be used as a guide to develop custom plugins.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scope">Scope</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>How to start plugin development?</p>
</li>
<li>
<p>Tooling and APIs to build and deploy plugins</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_where_to_start">Where to Start?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We provide a sample <a href="https://github.com/killbill/killbill-hello-world-java-plugin"><em>hello world plugin</em></a> which can be used as the starting point for developing a custom plugin.</p>
</div>
<div class="paragraph">
<p>In addition, we have separate docs for different types of plugins. A good starting point would be to assess what the plugin should do and then based on that, read the various docs that describe the different types of plugins offered in Kill Bill:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.killbill.io/latest/catalog_plugin.html">Catalog Plugin</a></p>
</li>
<li>
<p><a href="https://docs.killbill.io/latest/payment_plugin.html">Payment Plugin</a></p>
</li>
<li>
<p><a href="https://docs.killbill.io/latest/payment_control_plugin.html">(Payment) Control Plugin</a></p>
</li>
<li>
<p><a href="https://docs.killbill.io/latest/entitlement_plugin.html">Entitlement Plugin</a></p>
</li>
<li>
<p><a href="https://docs.killbill.io/latest/invoice_plugin.html">Invoice Plugin</a></p>
</li>
<li>
<p><a href="https://docs.killbill.io/latest/notification_plugin.html">Notification Plugin</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next stage is to identify existing (similar) plugins which could be used as a starting point to write the code. At this point, this becomes a normal software development cycle, including writing unit tests for that plugin (independent of Kill Bill).</p>
</div>
<div class="paragraph">
<p>The rest of this document will explain how to setup and work with the <code>hello-world-plugin</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Ensure that you have gone through the <a href="https://docs.killbill.io/latest/what_is_kill_bill.html"><em>What is Kill Bill</em></a> document and are familiar with Kill Bill.</p>
</li>
<li>
<p>Ensure that you have gone through the <a href="https://docs.killbill.io/latest/plugin_introduction.html"><em>Plugin Introduction</em></a> document and are familiar with Kill Bill plugins.</p>
</li>
<li>
<p>Ensure that you have <strong>Maven 3.5.2</strong> or higher (It can be downloaded from <a href="http://maven.apache.org/download.cgi"><em>here</em></a>).</p>
</li>
<li>
<p>Ensure that you have <strong>JDK 8</strong> or higher (It can be downloaded from <a href="https://www.oracle.com/in/java/technologies/javase-downloads.html"><em>here</em></a>).</p>
</li>
<li>
<p>Ensure that <strong>JAVA_HOME</strong> environment variable is set to the path of your JDK installation (For example, if JDK is installed at <strong>C:\Software\jdk1.8.0_102</strong>, you need to set <strong>JAVA_HOME</strong> to <strong>C:\Software\jdk1.8.0_102</strong>).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let us now take a look at the steps involved in setting up the <code>hello world plugin</code>.</p>
</div>
<div class="sect2">
<h3 id="_setting_up_the_code_in_an_ide">Setting up the Code in an IDE</h3>
<div class="paragraph">
<p>The first step is to set up the plugin code in an IDE. For this, you need to do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clone the <code>hello-world-plugin</code> repository from <a href="https://github.com/killbill/killbill-hello-world-java-plugin"><em>Github</em></a>.</p>
</li>
<li>
<p>Set up the code in the IDE of your choice. You can refer to our <a href="https://docs.killbill.io/latest/development.html#_setting_up_code_in_an_ide"><em>Development Document</em></a> for detailed instructions on how to clone a repository and set up the code in Eclipse.</p>
</li>
<li>
<p>This path where the repository is cloned will be referred to as <strong>PROJECT_ROOT</strong> from now on. For example, if you choose <code>C:/MyProjects/killbill-hello-world-java-plugin</code>, <strong>PROJECT_ROOT</strong> refers to this path.</p>
</li>
<li>
<p>Once the code is set up in Eclipse, your Eclipse workspace should look like this:</p>
<div class="imageblock text-center">
<div class="content">
<img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/plugin_development/eclipse_workspace_with_helloworldplugin.png" alt="eclipse workspace with helloworldplugin">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="build">Build</h3>
<div class="paragraph">
<p>The <code>hello-world-plugin</code> is a standard Maven project. So you can build it as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a command prompt/terminal window and navigate to the <strong>PROJECT_ROOT</strong>  directory.</p>
</li>
<li>
<p>Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>mvn<span class="tok-w"> </span>clean<span class="tok-w"> </span>install<span class="tok-w"> </span>-DskipTests</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that a <strong>BUILD SUCCESS</strong> message is displayed on the console and that the plugin jar file
is created as <code>PROJECT_ROOT/target/&lt;artifact_id&gt;-&lt;version&gt;.jar</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="deployment">Deployment</h3>
<div class="paragraph">
<p>The <code>hello-world-plugin</code> can be deployed in an AWS, Docker or Tomcat Kill Bill installation as explained in the <a href="https://docs.killbill.io/latest/getting_started.html"><em>Getting Started</em></a> guide. However, if you are using the plugin as a basis to develop your own plugin, it would be useful to deploy the plugin in a <a href="https://docs.killbill.io/latest/development.html#_setting_up_kill_bill_in_your_development_environment"><em>standalone Kill Bill installation</em></a>. Let us take a look at how to do this.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that the Kill Bill application is configured and running in a Jetty server as explained <a href="https://docs.killbill.io/latest/development.html#_setting_up_kill_bill_in_your_development_environment">here</a>.</p>
</li>
<li>
<p>Ensure that you have <strong>kpm</strong> installed as per the instructions  <a href="https://github.com/killbill/killbill-cloud/tree/master/kpm">here</a>.</p>
</li>
<li>
<p>Open a command prompt/terminal window and run the following command to install the plugin (Replace <code>PROJECT_ROOT</code> with your actual project root, <code>&lt;artifact_id&gt;-&lt;version&gt;</code> with your JAR file name and  <code>path_to_install_plugin</code> with the actual path where you would like to install the plugin):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>kpm<span class="tok-w"> </span>install_java_plugin<span class="tok-w"> </span><span class="tok-s1">&#39;dev:hello&#39;</span><span class="tok-w"> </span>--from-source-file<span class="tok-o">=</span>PROJECT_ROOT/target/&lt;artifact_id&gt;-&lt;version&gt;.jar<span class="tok-w"> </span>--destination<span class="tok-o">=</span>&lt;path_to_install_plugin&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the <code>&lt;artifact_id&gt;-&lt;version&gt;.jar</code> is copied at the <code>path_to_install_plugin</code> path.</p>
</li>
<li>
<p>Open <code>PROJECT_ROOT/profiles/killbill/src/main/resources/killbill-server.properties</code> and specify the following property (Replace <code>plugin_path</code> with the actual path where the plugin is installed. Note that if this property is not specified, Kill Bill looks for the plugin at the <code>/var/tmp/bundles/</code> path):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="properties"><span></span><span class="tok-na">org.killbill.osgi.bundle.install.dir</span><span class="tok-o">=</span><span class="tok-s">&lt;plugin_path&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Open a command prompt/terminal window and navigate to the <strong>PROJECT_ROOT</strong>  directory. Start Kill Bill by running the following command (Replace <code>PROJECT_ROOT</code> with your actual project root):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-w"> </span>mvn<span class="tok-w"> </span>-Dorg.killbill.server.properties<span class="tok-o">=</span>file:///PROJECT_ROOT/profiles/killbill/src/main/resources/killbill-server.properties<span class="tok-w"> </span>-Dlogback.configurationFile<span class="tok-o">=</span>./profiles/killbill/src/main/resources/logback.xml<span class="tok-w"> </span>jetty:run</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the following is displayed in the Kill Bill logs which confirms that the plugin is installed successfully:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-w">  </span>GET<span class="tok-w"> </span>/<span class="tok-w">               </span><span class="tok-o">[</span>*/*<span class="tok-o">]</span><span class="tok-w">     </span><span class="tok-o">[</span>*/*<span class="tok-o">]</span><span class="tok-w">    </span><span class="tok-o">(</span>/HelloWorldServlet.hello<span class="tok-o">)</span>
<span class="tok-w">  </span>GET<span class="tok-w"> </span>/healthcheck<span class="tok-w">    </span><span class="tok-o">[</span>*/*<span class="tok-o">]</span><span class="tok-w">     </span><span class="tok-o">[</span>*/*<span class="tok-o">]</span><span class="tok-w">    </span><span class="tok-o">(</span>/HelloWorldHealthcheckServlet.check<span class="tok-o">)</span>
listening<span class="tok-w"> </span>on:
<span class="tok-w">  </span>http://localhost:8080/plugins/hello-world-plugin/</code></pre>
</div>
</div>
</li>
<li>
<p>Open a browser and type http://localhost:8080/plugins/hello-world-plugin/. If the plugin is installed properly, the following should be displayed in the Kill Bill logs:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-m">2020</span>-12-09T04:58:15,750+0000<span class="tok-w"> </span><span class="tok-nv">lvl</span><span class="tok-o">=</span><span class="tok-s1">&#39;INFO&#39;</span>,<span class="tok-w"> </span><span class="tok-nv">log</span><span class="tok-o">=</span><span class="tok-s1">&#39;HelloWorldServlet&#39;</span>,<span class="tok-w"> </span><span class="tok-nv">th</span><span class="tok-o">=</span><span class="tok-s1">&#39;http-nio-8080-exec-1&#39;</span>,<span class="tok-w"> </span><span class="tok-nv">xff</span><span class="tok-o">=</span><span class="tok-s1">&#39;&#39;</span>,<span class="tok-w"> </span><span class="tok-nv">rId</span><span class="tok-o">=</span><span class="tok-s1">&#39;b79decfb-e809-4c01-9064-cff18722a67c&#39;</span>,<span class="tok-w"> </span><span class="tok-nv">tok</span><span class="tok-o">=</span><span class="tok-s1">&#39;&#39;</span>,<span class="tok-w"> </span><span class="tok-nv">aRId</span><span class="tok-o">=</span><span class="tok-s1">&#39;&#39;</span>,<span class="tok-w"> </span><span class="tok-nv">tRId</span><span class="tok-o">=</span><span class="tok-s1">&#39;&#39;</span>,<span class="tok-w"> </span>Hello<span class="tok-w"> </span>world</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a_closer_look_at_plugin_code">A Closer Look at Plugin Code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let us now take a look at some of the important classes in the hello world plugin.</p>
</div>
<div class="sect2">
<h3 id="_helloworldservlet">HelloWorldServlet</h3>
<div class="paragraph">
<p>Plugins can export their own HTTP endpoints. The <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldServlet.java"><em>HelloWorldServet</em></a> provides an example of this. It exports the <code>plugins/hello-world-plugin/</code> endpoint. You can extend the <code>HelloWorldServlet</code> to add other endpoints as required.</p>
</div>
<div class="paragraph">
<p>A few pointers about the <code>HelloWorldServlet.hello</code> method (which provides the code for the <code>plugins/hello-world-plugin/</code> endpoint):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-w">    </span><span class="tok-nd">@GET</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">hello</span><span class="tok-p">(</span><span class="tok-nd">@Local</span><span class="tok-w"> </span><span class="tok-nd">@Named</span><span class="tok-p">(</span><span class="tok-s">&quot;killbill_tenant&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">Optional</span><span class="tok-o">&lt;</span><span class="tok-n">Tenant</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">tenant</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// Find me on http://127.0.0.1:8080/plugins/hello-world-plugin</span>
<span class="tok-w">        </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;Hello world&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">tenant</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-n">tenant</span><span class="tok-p">.</span><span class="tok-na">isPresent</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        	</span><span class="tok-n">Tenant</span><span class="tok-w"> </span><span class="tok-n">t1</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">tenant</span><span class="tok-p">.</span><span class="tok-na">get</span><span class="tok-p">();</span>
<span class="tok-w">        	</span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;tenant id:&quot;</span><span class="tok-o">+</span><span class="tok-n">t1</span><span class="tok-p">.</span><span class="tok-na">getId</span><span class="tok-p">());</span>
<span class="tok-w">        	</span><span class="tok-n">login</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        	</span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;tenant is not available&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This method provides the code for the http://localhost:8080/plugins/hello-world-plugin endpoint.</p>
</li>
<li>
<p>It accepts a parameter corresponding to <code>Tenant</code> which is an <code>Optional</code>.</p>
</li>
<li>
<p>If the headers <strong>X-Killbill-ApiKey / X-Killbill-ApiSecret</strong> are set while accessing this endpoint as shown below, Kill Bill automatically injects a <code>Tenant</code> object into the servlet.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl<span class="tok-w"> </span>-v<span class="tok-w"> </span>-u<span class="tok-w"> </span>admin:password<span class="tok-w"> </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span><span class="tok-w"> </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span><span class="tok-w"> </span><span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/hello-world-plugin&quot;</span></code></pre>
</div>
</div>
</li>
<li>
<p>The <code>Tenant</code> object can then be used to retrieve tenant information like <code>tenantId</code> as demonstrated in the code above.</p>
</li>
<li>
<p>If the headers <strong>X-Killbill-ApiKey / X-Killbill-ApiSecret</strong> are NOT set while accessing this endpoint as shown below, Kill Bill injects an empty <code>Optional</code> into the servlet.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl<span class="tok-w"> </span>-v<span class="tok-w"> </span>-u<span class="tok-w"> </span>admin:password<span class="tok-w"> </span><span class="tok-s2">&quot;http://127.0.0.1:8080/plugins/hello-world-plugin&quot;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_helloworldlistener">HelloWorldListener</h3>
<div class="paragraph">
<p>The <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldListener.java"><em>HelloWorldListener</em></a> provides sample code for developing a notification plugin.  It listens to <a href="https://docs.killbill.io/latest/kill_bill_events.html"><em>Kill Bill events</em></a> and takes actions. You can extend this class to handle other events as required. See the <a href="https://docs.killbill.io/latest/notification_plugin.html"><em>Notification Plugin Tutorial</em></a> for further information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_helloworldpaymentpluginapi">HelloWorldPaymentPluginApi</h3>
<div class="paragraph">
<p>The <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldPaymentPluginApi.java"><em>HelloWorldPaymentPluginApi</em></a> class provides sample code for developing a payment plugin. It implements the <a href="https://github.com/killbill/killbill-plugin-api/blob/d9eca5af0e37541069b1c608f95e100dbe13b301/payment/src/main/java/org/killbill/billing/payment/plugin/api/PaymentPluginApi.java"><em>PaymentPluginApi</em></a> interface. You can extend this class as required to develop a payment plugin. See the <a href="https://docs.killbill.io/latest/payment_plugin.html"><em>Payment Plugin Tutorial</em></a> for further information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_other_classes">Other Classes</h3>
<div class="paragraph">
<p>In addition to the classes listed above, some of the other classes in the <code>hello-world-plugin</code> are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldActivator.java"><em>HelloWorldActivator</em></a>: While building a plugin, you need to create a class similar to <code>HelloWorldActivator</code>. You need to specify your plugin name here.</p>
</li>
<li>
<p><a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldConfigurationHandler.java"><em>HelloWorldConfigurationHandler</em></a>: Most plugins require custom configuration. A configuration handler similar to the <code>HelloWorldConfigurationHandler</code> can be used to read the configuration properties.</p>
</li>
<li>
<p><a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldHealthcheck.java"><em>HelloWorldHealthcheck</em></a> and <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldHealthcheckServlet.java"><em>HelloWorldHealthcheckServlet</em></a>: Can be used to provide the health status of the plugin.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_per_tenant_configuration">Enabling Per-tenant Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As explained <a href="https://docs.killbill.io/latest/plugin_installation.html#per-tenant-configuration"><em>here</em></a>, Kill Bill supports per tenant configuration for plugins. In order enable per tenant configuration, the following needs to be done:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a custom configuration handler similar to <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldConfigurationHandler.java"><em>HelloWorldConfigurationHandler</em></a></p>
</li>
<li>
<p>Initialize it in the <code>start</code> method of your activator class as follows (see <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldActivator.java#L57">HelloWorldActivator.start</a>):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">helloWorldConfigurationHandler</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">HelloWorldConfigurationHandler</span><span class="tok-p">(</span><span class="tok-n">region</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PLUGIN_NAME</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">killbillAPI</span><span class="tok-p">);</span>
<span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">Properties</span><span class="tok-w"> </span><span class="tok-n">globalConfiguration</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">helloWorldConfigurationHandler</span><span class="tok-p">.</span><span class="tok-na">createConfigurable</span><span class="tok-p">(</span><span class="tok-n">configProperties</span><span class="tok-p">.</span><span class="tok-na">getProperties</span><span class="tok-p">());</span>
<span class="tok-n">helloWorldConfigurationHandler</span><span class="tok-p">.</span><span class="tok-na">setDefaultConfigurable</span><span class="tok-p">(</span><span class="tok-n">globalConfiguration</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now, you can use the <code>ConfigurationHandler</code> to retrieve per-tenant properties. You can see an example of this in the <a href="#retrieve_configuration_example">Authentication Steps</a> section below.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_a_breakpoint_and_debugging">Setting Up a Breakpoint and Debugging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you start developing your own plugin, it would be useful to be able to set up a break point and debug the plugin code. This section explains how you can achieve this.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new environment variable <strong>MAVEN_OPTS</strong> and set it to <code>-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=n</code>.</p>
</li>
<li>
<p>Open Eclipse and do the following:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Set up a break point in the HelloWorldServlet#L41.</p>
</li>
<li>
<p>Click <strong>Run &gt; Debug Configurations</strong>.</p>
</li>
<li>
<p>Double-click  <strong>New Remote Java Application</strong>.</p>
</li>
<li>
<p>Enter the name that you would like to give to this debug configuration in the <strong>Name</strong> field.</p>
</li>
<li>
<p>Click <strong>Apply</strong>.</p>
</li>
<li>
<p>Click <strong>Close</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Restart the Kill Bill application as explained in the <a href="#deployment">"Deployment"</a> section above.</p>
</li>
<li>
<p>Click <code>Run &gt; Debug Configurations</code> and double click the  the Debug configuration that you created above.</p>
</li>
<li>
<p>This runs the application in debug mode. You can also set additional breakpoints as required.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authentication_within_plugins">Authentication Within Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to invoke write API operations like <code>AccountUserApi#createAccount</code>, plugin code must authenticate against Kill Bill first. Otherwise, it will result in an <code>org.apache.shiro.authz.UnauthenticatedException</code>. This section explains how authentication can be done.</p>
</div>
<div class="sect2">
<h3 id="authentication_steps">Authentication Steps</h3>
<div class="paragraph">
<p>In order to authenticate against Kill Bill, the following needs to be done:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the plugin with custom credentials - Although plugins can use the <code>admin/password</code> credentials for authentication, it is typically not advisable to do so. This is to limit the scope of operations that plugins can execute. It is thus recommended to <em>configure plugins with custom credentials</em>. (See <a href="https://docs.killbill.io/latest/plugin_installation.html#_per-tenant-configuration"><em>Per-tenant Plugin Configuration</em></a>). So, you can configure the <code>hello-world-plugin</code> with custom credentials as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl<span class="tok-w"> </span>-v<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-X<span class="tok-w"> </span>POST<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-u<span class="tok-w"> </span>admin:password<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;Content-Type: text/plain&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;Accept: application/json&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-CreatedBy: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-Reason: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span>-H<span class="tok-w"> </span><span class="tok-s2">&quot;X-Killbill-Comment: demo&quot;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">   </span>-d<span class="tok-w"> </span><span class="tok-s1">&#39;org.killbill.billing.plugin.hello-world.credentials.username=hello-world-user</span>
<span class="tok-s1">org.killbill.billing.plugin.hello-world.credentials.password=hello-world-password&#39;</span><span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginConfig/hello-world-plugin&quot;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Retrieve credentials in the code. For example, you can retrieve the credentials in the <code>HelloWorldListener</code> class as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Properties</span><span class="tok-w"> </span><span class="tok-n">properties</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">helloWorldConfigurationHandler</span><span class="tok-p">.</span><span class="tok-na">getConfigurable</span><span class="tok-p">(</span><span class="tok-n">killbillEvent</span><span class="tok-p">.</span><span class="tok-na">getTenantId</span><span class="tok-p">());</span>
<span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">username</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">properties</span><span class="tok-p">.</span><span class="tok-na">getProperty</span><span class="tok-p">(</span><span class="tok-s">&quot;org.killbill.billing.plugin.hello-world.credentials.username&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">password</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">properties</span><span class="tok-p">.</span><span class="tok-na">getProperty</span><span class="tok-p">(</span><span class="tok-s">&quot;org.killbill.billing.plugin.hello-world.credentials.password&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</li>
<li>
<p>Invoke SecurityApi - Use the credentials obtained above to login as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">killbillAPI</span><span class="tok-p">.</span><span class="tok-na">getSecurityApi</span><span class="tok-p">().</span><span class="tok-na">login</span><span class="tok-p">(</span><span class="tok-n">login</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">password</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</li>
<li>
<p>Invoke the necessary write API method (The code below invokes the <code>accountUserApi.createAccount</code> method):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-w"> </span><span class="tok-n">osgiKillbillAPI</span><span class="tok-p">.</span><span class="tok-na">getAccountUserApi</span><span class="tok-p">().</span><span class="tok-na">createAccount</span><span class="tok-p">(</span><span class="tok-n">accountData</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">context</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</li>
<li>
<p>Invoke the <code>logout</code> method. This should typically be done within a <code>finally</code> clause:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">osgiKillbillAPI</span><span class="tok-p">.</span><span class="tok-na">getSecurityApi</span><span class="tok-p">().</span><span class="tok-na">logout</span><span class="tok-p">();</span></code></pre>
</div>
</div>
</li>
<li>
<p>You can also perform authentication within the <code>HelloWorldPaymentPluginApi</code> as well as <code>HelloWorldServlet</code>. Within the servlet, you will need to write code similar to the following:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">login</span><span class="tok-p">(</span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">HttpServletRequest</span><span class="tok-w"> </span><span class="tok-n">req</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">authHeader</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">req</span><span class="tok-p">.</span><span class="tok-na">getHeader</span><span class="tok-p">(</span><span class="tok-s">&quot;Authorization&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">authHeader</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-o">[]</span><span class="tok-w"> </span><span class="tok-n">authHeaderChunks</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">authHeader</span><span class="tok-p">.</span><span class="tok-na">split</span><span class="tok-p">(</span><span class="tok-s">&quot; &quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">authHeaderChunks</span><span class="tok-p">.</span><span class="tok-na">length</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">credentials</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-p">(</span><span class="tok-n">BaseEncoding</span><span class="tok-p">.</span><span class="tok-na">base64</span><span class="tok-p">().</span><span class="tok-na">decode</span><span class="tok-p">(</span><span class="tok-n">authHeaderChunks</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">p</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">credentials</span><span class="tok-p">.</span><span class="tok-na">indexOf</span><span class="tok-p">(</span><span class="tok-s">&quot;:&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-k">return</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-p">}</span>

<span class="tok-w">        </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">login</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">credentials</span><span class="tok-p">.</span><span class="tok-na">substring</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">p</span><span class="tok-p">).</span><span class="tok-na">trim</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">password</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">credentials</span><span class="tok-p">.</span><span class="tok-na">substring</span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">).</span><span class="tok-na">trim</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-n">killbillAPI</span><span class="tok-p">.</span><span class="tok-na">getSecurityApi</span><span class="tok-p">().</span><span class="tok-na">login</span><span class="tok-p">(</span><span class="tok-n">login</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">password</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">UnsupportedEncodingException</span><span class="tok-w"> </span><span class="tok-n">ignored</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_skipping_authentication">Skipping Authentication</h3>
<div class="paragraph">
<p>It is also possible to skip authentication in the plugin code. For this, the following needs to be done:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the following property in the <a href="https://docs.killbill.io/latest/userguide_configuration.html#global_configuration_properties">Kill Bill config file</a>:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>org.killbill.security.skipAuthForPlugins<span class="tok-o">=</span><span class="tok-nb">true</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>PluginCallContext</code> class in your code similar to the <a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/8df47156a2e80c65ce574e0ad689afd02b926f59/src/main/java/org/killbill/billing/plugin/notification/setup/PluginCallContext.java">email notification plugin PluginCallContext</a> class.</p>
</li>
<li>
<p>Create a <code>PluginCallContext</code> instance with <code>CallOrigin.INTERNAL</code> and <code>UserType.ADMIN</code> as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">PluginCallContext</span><span class="tok-w"> </span><span class="tok-n">callContext</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">PluginCallContext</span><span class="tok-p">(</span><span class="tok-n">UUID</span><span class="tok-p">.</span><span class="tok-na">randomUUID</span><span class="tok-p">(),</span><span class="tok-n">pluginName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">CallOrigin</span><span class="tok-p">.</span><span class="tok-na">INTERNAL</span><span class="tok-p">,</span><span class="tok-n">UserType</span><span class="tok-p">.</span><span class="tok-na">ADMIN</span><span class="tok-p">,</span><span class="tok-n">reasonCode</span><span class="tok-p">,</span><span class="tok-n">comments</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">createdDate</span><span class="tok-p">,</span><span class="tok-n">updatedDate</span><span class="tok-p">,</span><span class="tok-n">accountId</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">tenantId</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use the above <code>callContext</code> while invoking the desired api method:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">accountUserApi</span><span class="tok-p">.</span><span class="tok-na">createAccount</span><span class="tok-p">(</span><span class="tok-n">accountData</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">callContext</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_notes">Additional Notes</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>We provide a <a href="https://github.com/killbill/killbill-plugin-framework-java">Java plugin framework</a> that can be used to implement some of the work that plugins need to do - although your plugin does not have to rely on this framework, it is often a good idea to leverage it to avoid boilerplate code.</p>
</li>
<li>
<p>Also, for internal reference, you might want to take a look at <a href="https://github.com/killbill/killbill-platform/blob/killbill-platform-0.36.2/osgi-bundles/libs/killbill/src/main/java/org/killbill/billing/osgi/libs/killbill/KillbillActivatorBase.java#L59">KillbillActivatorBase</a>, which provides all the abstractions that plugins require (access to java APIs, database connections, system properties, logging, &#8230;&#8203;).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_osgi_configuration">OSGi Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As explained earlier, Kill Bill plugins are based on the OSGi standard. Let us now take a look at how this works and some additional OSGi configuration which may be required in some situations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>Note:</strong> OSGi configuration is an advanced configuration option and may be required only in rare situations. So, feel free to skip this section.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_brief_osgi_overview">Brief OSGi Overview</h3>
<div class="paragraph">
<p>Let us first briefly understand how OSGi works. OSGi allows creating modular Java components (known as bundles) that run within an <a href="https://felix.apache.org/"><em>OSGi container</em></a>. The OSGi container ensures that each bundle is isolated from other bundles. Thus, each bundle can use any external dependencies that it requires without having to worry about conflicts.</p>
</div>
<div class="paragraph">
<p>A bundle is nothing but a JAR file. However, its <code>manifest.mf</code> has some additional OSGi related headers.</p>
</div>
<div class="paragraph">
<p>Although each bundle is isolated from other bundles, sometimes bundles may need to communicate/share classes with other bundles. A bundle can export a package to make the corresponding classes available for use by other bundles. A bundle can also import a package to use the classes of another bundle.</p>
</div>
<div class="paragraph">
<p>For example if a bundle <code>bundle1</code> requires a class <code>p1.p2.A</code> from <code>bundle2</code>, <code>bundle2</code> needs to export the <code>p1.p2</code> package and <code>bundle1</code> needs to import this package. The packages imported by a bundle are specified as a <code>Import-package</code> header in the <code>manifest.mf</code> while packages exported by a bundle are specified as a <code>Export-package</code> header in the <code>manifest.mf</code>.</p>
</div>
<div class="paragraph">
<p>The OSGi container ensures that a given bundle&#8217;s package dependencies can be satisfied before the bundle runs. Thus, if the package dependencies cannot be satisfied, the bundle will not run.</p>
</div>
</div>
<div class="sect2">
<h3 id="_kill_bill_osgi_overview">Kill Bill OSGi Overview</h3>
<div class="paragraph">
<p>Before we dive into the details, let us understand at a high-level how the import-export mechanism works in case of the core Kill Bill system and its plugins.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Kill Bill core itself is packaged as an OSGi bundle (referred to as system bundle). It exports several packages. This is explained in the <a href="#packages_exported_by_killbill">"Packages exported by Kill Bill"</a> section.</p>
</li>
<li>
<p>A plugin automatically imports any packages exported by Kill Bill. This is explained in the <a href="#packages_imported_by_plugins_by_default">"Packages Imported by Plugins by Default"</a> section.</p>
</li>
<li>
<p>However, in some cases, a plugin may need to explicitly import packages exported by Kill Bill. This is explained in the <a href="#importing_additional_packages_in_plugins">"Importing Additional Packages in Plugins"</a> section.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="packages_exported_by_killbill">Packages Exported by Kill Bill</h3>
<div class="paragraph">
<p>As explained earlier, the Kill Bill system bundle exports the packages which it desires to share with plugins. Refer to the value of the <code>org.killbill.osgi.system.bundle.export.packages.api</code> property in the <a href="https://docs.killbill.io/latest/userguide_configuration.html#configuration_properties_table"><em>Kill Bill Configuration Properties Table</em></a> to see the complete list of packages exported by default.</p>
</div>
<div class="paragraph">
<p>Additionally, Kill Bill also offers the <code>org.killbill.osgi.system.bundle.export.packages.extra</code> property which can be used to specify additional packages to be exported by the system bundle and that could in turn be imported by a plugin.  This property can be configured as explained in the <a href="https://docs.killbill.io/latest/userguide_configuration.html"><em>Kill Bill configuration document</em></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="packages_imported_by_plugins_by_default">Packages Imported by Plugins by Default</h3>
<div class="paragraph">
<p>As explained earlier, Kill Bill plugins are packaged as OSGi bundles. The <a href="http://felix.apache.org/documentation/subprojects/apache-felix-maven-bundle-plugin-bnd.html"><em>maven-bundle-plugin</em></a> specified in the <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/3aa938d19fdfba81c7c035b45c3f17cac74db177/pom.xml"><em>pom.xml</em></a> is responsible for packaging a plugin as an OSGi bundle. Thus, the <code>maven-bundle-plugin</code> takes care of creating the jar with the correct OSGi headers (including adding the required packages to the <code>Import-Package</code> header). In addition, the <a href="https://github.com/killbill/killbill-oss-parent/blob/f3d9725cc7759a54eb6f978b3d3f763e1d170021/pom.xml"><em>killbill-oss-parent pom</em></a> file (which is the parent of the plugin <code>pom.xml</code> file) also specifies the packages to be included in the <code>Import-Package</code> header.</p>
</div>
<div class="paragraph">
<p>Thus, when a plugin is built, the <code>Import-Package</code> header is automatically computed based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Packages computed by the <code>maven-bundle-plugin</code>.</p>
</li>
<li>
<p>Packages specified in the <code>killbill-oss-parent</code> pom file.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="importing_additional_packages_in_plugins">Importing Additional Packages in Plugins</h3>
<div class="paragraph">
<p>Sometimes, a plugin may require to use some additional packages from Kill Bill (other than those automatically imported as specified above). In such cases, you will need to explicitly <strong>export</strong> the package from Kill Bill and <strong>import</strong> it in the plugin as explained below.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All the packages exported by Kill Bill by default are specified as the value of the <code>org.killbill.osgi.system.bundle.export.packages.api</code> property in the <a href="https://docs.killbill.io/latest/userguide_configuration.html"><em>Kill Bill Configuration Properties Table</em></a>. Check whether the desired package is already present in this list.</p>
</li>
<li>
<p>If Kill Bill does not already export the package, add the following property in the <a href="https://docs.killbill.io/latest/userguide_configuration.html"><em>Kill Bill configuration file</em></a>:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>org.killbill.osgi.system.bundle.export.packages.extra<span class="tok-o">=</span>&lt;package1&gt;,&lt;package2&gt;..&lt;packagen&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Open plugin <code>pom.xml</code> and specify the following in the <code>properties</code> section (Replace <code>&lt;package&gt;</code> with the fully qualified name of the package that you would like to export):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-w"> </span><span class="tok-nt">&lt;osgi.extra-import&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;package1&gt;</span>;
<span class="tok-w">            </span><span class="tok-nt">&lt;package2&gt;</span>;
<span class="tok-w">            </span>....
<span class="tok-w">            </span><span class="tok-nt">&lt;packagen&gt;</span>
<span class="tok-nt">&lt;/osgi.extra-import&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p><a href="#build">Build</a> the plugin using Maven as specified above.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This causes the package to be added to the <code>Import-Package</code> header of the plugin jar. You can see an example of this in the <a href="https://github.com/killbill/killbill-adyen-plugin/blob/0c5205d2ee42b543852e7cbd1a6f6f065ad575e5/pom.xml#L44"><em>Kill Bill Adyen Plugin pom file</em></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exporting_additional_packages_from_a_plugin">Exporting Additional Packages from a Plugin</h3>
<div class="paragraph">
<p>A plugin can also export packages corresponding to the classes that it wants to share with other plugins. This mechanism is particularly useful since it allows plugins to share custom functionality with other plugins.</p>
</div>
<div class="paragraph">
<p>To <strong>export</strong> a package from a plugin, you need to follow the steps given below.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open plugin <code>pom.xml</code>. Specify the following in the <code>properties</code> section (Replace <code>&lt;package&gt;</code> with the fully qualified name of the package that you would like to export):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;osgi.export&gt;</span>
<span class="tok-w">  </span><span class="tok-nt">&lt;package1&gt;</span>,
<span class="tok-w">  </span><span class="tok-nt">&lt;package2&gt;</span>
<span class="tok-w">   </span>....
<span class="tok-w">  </span><span class="tok-nt">&lt;packagen&gt;</span>
<span class="tok-nt">&lt;/osgi.export&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p><a href="#build">Build</a> the plugin using Maven as specified above.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This causes the specified packages to be added to the <code>Export-Package</code> header of the plugin jar. Other plugins can then use the classes in these packages by importing them as explained above.</p>
</div>
<div class="paragraph">
<p>In order to see an example of a plugin exporting packages, you can refer to the <a href="https://github.com/killbill/killbill-email-notifications-plugin"><em>email notification plugin</em></a>. It <a href="https://github.com/killbill/killbill-email-notifications-plugin/blob/819f4659825684131cf9a5f77b818d56dd86d163/pom.xml#L46"><em>exports</em></a> packages required for creating a custom invoice formatter. The <a href="https://github.com/killbill/killbill-custom-invoice-formatter-example"><em>custom invoice formatter</em></a> plugin (which is a sample plugin) then <a href="https://github.com/killbill/killbill-custom-invoice-formatter-example/blob/79e2f63cb536263f0272fdc9182e961f2616c5e3/pom.xml#L43"><em>imports</em></a> these packages to customize the email invoice.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_faq">FAQ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section lists some common errors that are encountered while developing plugins and how you can fix them.</p>
</div>
<div class="sect2">
<h3 id="_authentication_error">Authentication Error</h3>
<div class="paragraph">
<p>Sometimes, you may see the <code>org.apache.shiro.authz.UnauthenticatedException: This subject is anonymous</code>. This occurs when your plugin code invokes any of the read/write Kill Bill operations without authenticating against Kill Bill. So, you first need to invoke <code>SecurityApi#login</code> API. See <a href="#authentication_steps">"Authentication Steps"</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="_maven_build_error">Maven Build Error</h3>
<div class="paragraph">
<p>Sometimes, when you build the code using <code>mvn clean install</code> you may see some build errors as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enforcer error:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>Failed<span class="tok-w"> </span>to<span class="tok-w"> </span>execute<span class="tok-w"> </span>goal<span class="tok-w"> </span>org.apache.maven.plugins:maven-enforcer-plugin:3.0.0-M3:enforce<span class="tok-w"> </span><span class="tok-o">(</span>default<span class="tok-o">)</span><span class="tok-w"> </span>on<span class="tok-w"> </span>project<span class="tok-w"> </span>killbill-plugin-momo:<span class="tok-w"> </span>Some<span class="tok-w"> </span>Enforcer<span class="tok-w"> </span>rules<span class="tok-w"> </span>have<span class="tok-w"> </span>failed.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This generally occurs when your <code>pom.xml</code> contains dependencies that are not recommended. In such cases, we recommend that you fix the POM file and rerun the build, or run the build with the <code>-Dcheck.fail-enforcer=false</code> option.</p>
</div>
</li>
<li>
<p>Spotbugs error:
Kill Bill automatically performs <code>spotbugs</code> checks when running <code>mvn verify</code>. So, this may result in some <a href="https://spotbugs.readthedocs.io/en/stable/bugDescriptions.html">spotbugs</a> errors.</p>
<div class="paragraph">
<p>In such cases, we recommend that you fix the spotbugs errors and rerun the build, or run the build with the <code>-Dcheck.fail-spotbugs=false</code> option.</p>
</div>
</li>
<li>
<p>Other errors:
The build process has several checks in place to make sure the right dependencies are pulled in (for example, there are no duplicate dependencies, there are no obvious bugs, etc.). If you&#8217;d like to ignore all these checks and still proceed with the build, you can run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>mvn<span class="tok-w"> </span>clean<span class="tok-w"> </span>install<span class="tok-w"> </span>-Dcheck.fail-enforcer<span class="tok-o">=</span><span class="tok-nb">false</span><span class="tok-w"> </span>-Dcheck.fail-dependency<span class="tok-o">=</span><span class="tok-nb">false</span><span class="tok-w"> </span>-Dcheck.fail-dependency-scope<span class="tok-o">=</span><span class="tok-nb">false</span><span class="tok-w"> </span>-Dcheck.fail-dependency-versions<span class="tok-o">=</span><span class="tok-nb">false</span><span class="tok-w"> </span>-Dcheck.fail-duplicate-finder<span class="tok-o">=</span><span class="tok-nb">false</span><span class="tok-w"> </span>-Dcheck.fail-enforcer<span class="tok-o">=</span><span class="tok-nb">false</span><span class="tok-w"> </span>-Dcheck.fail-spotbugs<span class="tok-o">=</span><span class="tok-nb">false</span><span class="tok-w"> </span>-Dcheck.ignore-rat<span class="tok-o">=</span><span class="tok-nb">true</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_java_lang_noclassdeffounderror_or_java_lang_classnotfoundexception">java.lang.NoClassDefFoundError or java.lang.ClassNotFoundException</h3>
<div class="paragraph">
<p>Sometimes, when you develop a custom plugin, a <code>java.lang.NoClassDefFoundError</code> or a <code>java.lang.ClassNotFoundException</code> exception may occur on starting Kill Bill. This is most probably because the class in question is not present on the classpath.</p>
</div>
<div class="paragraph">
<p>For a plugin to work, any classes used by the plugin must be present on the classpath. So, the class needs to be present in the <strong>plugin jar</strong> itself or it must be <strong>imported</strong> from Kill Bill. Refer to the <a href="#importing_additional_packages_in_plugins">"Importing Additional Packages in Plugins"</a> section above for further details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_payment_plugin_xxx_is_not_registered_error">"Payment plugin xxx is not registered" Error</h3>
<div class="paragraph">
<p>Sometimes, when you develop a custom payment plugin, you may see a <code>Payment plugin xxx is not registered</code> error. This is typically because the plugin is not registered as a payment plugin in your activator class. Ensure that it is registered as shown <a href="https://github.com/killbill/killbill-hello-world-java-plugin/blob/2dd9cbddb3f9e7a56cb4a217fcc12bc97c0795e2/src/main/java/org/killbill/billing/plugin/helloworld/HelloWorldActivator.java#L70">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_further_reading">Further Reading</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.killbill.io/latest/plugin_installation.html"><em>Plugin Layout, Installation, and Configuration</em></a></p>
</li>
<li>
<p><a href="https://docs.killbill.io/latest/plugin_management.html"><em>Plugin Management</em></a></p>
</li>
</ul>
</div>
</div>
</div></div><div class="bottom-nav-links"><a href="#" id="prev-nav-link" class="bottom-nav-link card prev"><span class="arrow-icon left"><svg class="i-arrow" width="12" height="11" viewBox="0 0 12 11" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.19526 1.02876C4.45561 0.768409 4.87772 0.768409 5.13807 1.02876C5.39842 1.28911 5.39842 1.71122 5.13807 1.97157L2.27614 4.8335H11.3333C11.7015 4.8335 12 5.13197 12 5.50016C12 5.86835 11.7015 6.16683 11.3333 6.16683H2.27614L5.13807 9.02876C5.39842 9.28911 5.39842 9.71122 5.13807 9.97157C4.87772 10.2319 4.45561 10.2319 4.19526 9.97157L0.195261 5.97157C-0.0650883 5.71122 -0.0650883 5.28911 0.195261 5.02876L4.19526 1.02876Z" fill=""/></svg><span class="prev-text">Previous</span></span><span id="prev-navigator" class="bottom-nav-text">Prev</span>                               </a><a href="#" id="next-nav-link" class="bottom-nav-link card next"><span class="arrow-icon"><span class="next-text">Next</span><svg class="i-arrow icon-left" width="12" height="11" viewBox="0 0 12 11" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.19526 1.02876C4.45561 0.768409 4.87772 0.768409 5.13807 1.02876C5.39842 1.28911 5.39842 1.71122 5.13807 1.97157L2.27614 4.8335H11.3333C11.7015 4.8335 12 5.13197 12 5.50016C12 5.86835 11.7015 6.16683 11.3333 6.16683H2.27614L5.13807 9.02876C5.39842 9.28911 5.39842 9.71122 5.13807 9.97157C4.87772 10.2319 4.45561 10.2319 4.19526 9.97157L0.195261 5.97157C-0.0650883 5.71122 -0.0650883 5.28911 0.195261 5.02876L4.19526 1.02876Z" fill=""/></svg></span><span id="next-navigator" class="bottom-nav-text">Next</span></a></div></article></div><div class="bd-links-wrapper"><nav class="bd-links toc right-side-menu" id="myScrollspy" data-toggle="toc"></nav></div></div></div></div></div></main><script src="javascripts/jquery-3.6.1.min.js"></script><script src="javascripts/bootstrap.min.js"></script><script src="javascripts/bootstrap-toc.min.js"></script><script type="module" src="javascripts/kb.js"></script><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script><script>docsearch({apiKey: '3ef227e7fd5e2e1a3fffd880484934bf', container: '#docsearch', appId: 'S2ISXITURI', indexName: 'killbill'});</script></body></html>