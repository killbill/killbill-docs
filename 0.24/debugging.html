<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 2.0.20"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticaly.com/gh/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"><link rel="preconnect" href="https://S2ISXITURI-dsn.algolia.net"><style type="text/css"></style><title>Debugging tips</title><style>/*Default CSS*/

/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */

@import "https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap";

*,
*::before,
*::after {
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
}

ul,
ol {
  padding: 0;
  list-style-type: none;
}

body,
h1,
h2,
h3,
h4,
p,
ul[class],
ol[class],
li,
figure,
figcaption,
blockquote,
dl,
dd {
  margin: 0;
}

body {
  min-height: 100vh;
  scroll-behavior: smooth;
  text-rendering: optimizeSpeed;
  font-family: 'Inter', sans-serif;
  font-size: 16px;
  line-height: 150%;
  color: #374151;
  max-width: 100%;
  overflow-x: hidden;
}

ul[class],
ol[class] {
  list-style: none;
}

img {
  max-width: 100%;
  display: block;
}

img[align=center] {
  margin: 0 auto;
}

button {
  cursor: pointer;
}

input,
button,
textarea,
select {
  font: inherit;
}
a {
  color: #167BB7;
}
h1,
h3,
h4 {
  font-weight: 400;
}
h2,
h3,
h4 {
  color: #1F2937;
}
h1 {
  font-size: 40px;
  line-height: 120%;
  letter-spacing: -0.025em;
  color: #FFFFFF;
}
h2 {
  font-weight: 600;
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
  font-weight: 500;
}

.header {
  padding: 16px 0;
  background: #FFFFFF;
  box-shadow: 0 1px 3px rgba(0, 0, 0, .1), 0 1px 2px rgba(0, 0, 0, .06);
}
@media (min-width: 768px) {
  .header-logo {
    width: 320px;
  }
}
.header-wrapper .logo {
  max-width: 215px;
  margin: auto;
  width: 80%;
}
.header-wrapper .logo img {
  object-fit: contain;
}
@media (max-width: 767px) {
  .header-wrapper .logo a {
    display: flex;
    justify-content: center;
  }
}
.header-search {
  flex-grow: 1;
  padding-right: 16px;
}
@media (min-width: 768px) {
  .header-search {
    /*flex-grow: 1;*/
    /*max-width: calc(100% - 590px);*/
    /*padding-right: 53px;*/
    /*padding-left: 45px;*/
  }
}
@media (min-width: 1200px) {
  .header-search {
    max-width: calc(100% - 590px);
    padding-right: 53px;
    padding-left: 45px;
  }
}

.header-wrapper .search-form-wrapper {
  flex-grow: 1;
}
.header-wrapper .search-form {
  position: relative;
}
.header-wrapper .search-form .algolia-autocomplete {
  width: 100%;
}
.header-wrapper .search-form input[type="search"] {
  width: 100%;
  padding: 9px 9px 9px 40px;
  border: 1px solid #D1D5DB;
  border-radius: 6px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
}
.header-wrapper .search-form .ds-dropdown-menu {
  max-width: none;
  width: 100%;
}
.header-wrapper .search-form .search-form-icon {
  position: absolute;
  left: 13px;
  top: 9px;
  z-index: 1;
  width: 20px;
  height: 20px;
  pointer-events: none;
}
.content-wrapper {
  padding: 24px 20px;
}
@media (min-width: 1024px) {
  .content-wrapper {
    padding-right: 54px;
    padding-left: 54px;
  }
}

.content-wrapper .banner {
  position: relative;
  display: flex;
  align-items: center;
  min-height: 174px;
  margin-bottom: 24px;
  padding: 0 40px;
  background-color: #167BB7;
  border-radius: 8px;
}
.content-wrapper .banner .bg-image {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
}

.main {
  position: relative;
  line-height: 1.5;
}

.main p {
  margin-bottom: 12px;
}

.main .sidebar {
  width: calc(100% + 15px);
  flex-shrink: 0;
  margin-right: 40px;
  position: sticky;
  top: 0;
  margin-left: -15px;
  padding: 24px 16px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, .1), 0 1px 2px rgba(0, 0, 0, .06);
}

.main .sidebar .icon-title {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-top: 8px;
  padding-bottom: 8px;
  cursor: pointer;
}

.main .sidebar .icon-title .left-part{
  display: flex;
  align-items: center;
  order: 2;
  flex-grow: 1;
}

.main .sidebar .icon-title .chevron,
.main .sidebar .icon-title.bd-link-active-wrap .chevron.rotated {
  transform: rotate(180deg);
}

.main .sidebar .icon-title.bd-link-active-wrap .bd-toc-link {
  color: #167BB7;
}

.main .sidebar .open .icon-title .chevron,
.main .sidebar .icon-title.bd-link-active-wrap .chevron{
  transform: rotate(0);
  transition-duration: .25s;
  transform-origin: center;
}

.main .sidebar .bd-link-active-wrap  .chevron path {
  fill: #D1D5DB;
}

.main .sidebar .bd-link-active-wrap svg path {
  fill: #167BB7;
}

.main .sidebar .icon-title svg {
  width: 16px;
  order: 1;
}
.main .sidebar-nav {
  height: 100vh;
}
.main .sidebar-nav,
.main .right-side-menu {
  overflow-y: scroll;
  padding: 0 24px;
}

.main .right-side-menu {
  direction: rtl;
  padding: 24px 0 0 24px;
}

.main .right-side-menu .navbar-nav {
  direction: ltr;
}

.main .sidebar-nav::-webkit-scrollbar,
.main .right-side-menu::-webkit-scrollbar
{
  width: 8px;
}

.main .sidebar-nav::-webkit-scrollbar-track,
.main .right-side-menu::-webkit-scrollbar-track
{
  background-color: transparent;
}

.main .sidebar-nav::-webkit-scrollbar-thumb,
.main .right-side-menu::-webkit-scrollbar-thumb
{
  background-color: #F3F4F6;
  width: 6px;
  border-radius: 32px;
}

.main .sidebar-nav a.nav-link {
  transition-duration: .25s;
  transition-property: color;
}
.main .sidebar-nav a.nav-link:hover {
  color: #167BB7;
}
.main .sidebar-nav a {
  color: #6B7280;
}

.main .sidebar-nav a.bd-toc-link {
  padding-left: 12px;
  font-weight: 500;
  font-size: 14px;
  display: block;
  color: #6B7280;
  transition-duration: .25s;
  transition-property: color;
}
.main .sidebar-nav li:hover a.bd-toc-link,
.main .sidebar-nav li.active a.bd-toc-link,
.main .sidebar-nav .open a.bd-toc-link {
  color: #374151;
}
@media (min-width: 768px) {
  .main .sidebar:after {
    content: '';
    position: absolute;
    top: 30px;
    right: -12px;
    width: 13px;
    height: 24px;
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
  }
}
.sidebar-toggler {
  display: none;
}
@media (min-width: 768px) {
  .sidebar-toggler {
    display: block;
    position: absolute;
    top: 30px;
    right: -12px;
    width: 24px;
    height: 24px;
    border-radius: 4px;
    cursor: pointer;
    background-color: #F3F4F6;
    transition-duration: .25s;
    z-index: 2;
  }
  .sidebar-toggler:hover {
    background-color: #efefef;
  }
  .sidebar-toggler:after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 8px;
    height: 12px;
    transform: translate(-50%, -50%) rotate(0deg);
    background-image: url("data:image/svg+xml,%3Csvg width='8' height='12' viewBox='0 0 8 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M6.33337 10.6666L1.66671 5.99998L6.33337 1.33331' stroke='%23167BB7' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A");
    background-size: contain;
    background-repeat: no-repeat;
    transition-duration: .25s;
  }
  .sidebar-toggler.active:after {
    transform: translate(-50%, -50%) rotate(180deg);
  }
}


pre.pygments .tok-o {
  color: #167BB7;
}

.main p code {
  color: inherit;
  font-size: inherit;
}

.main table,.main table td,.main table th {
  border: 1px solid #dedede;
  padding: 10px;
}

.main .note table,.main .note table td,.main .note table th {
  border: none;
}

.main .note .icon {
  width: 60px;
}

.main .note .icon .fa.icon-note {
  display: none;
}

.main .note .content {
  font-weight: normal;
  color: #374151;
}

.main table td.icon svg{
  width: 30px;
  height: auto;
}

.main table td.icon .title {
  display: none;
}

.main table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 15px;
}

.main table .title {
  text-transform: uppercase;
  font-weight: 600;
  padding: 0 5px;
}

pre.pygments .tok-o {
  color: #167BB7!important;
}

.main .sidebar-nav > ul li ul {
  display: none;
  padding-left: 16px;
  padding-bottom: 8px;
  font-size: 14px;
  border-bottom: 1px solid #F3F4F6;
}

.main .sidebar-nav > ul li ul.active-list {
  display: block;
}

.main .sidebar-nav > ul li ul li a{
  display: block;
  position: relative;
  padding-left: 16px;
  font-size: 14px;
}

.main .sidebar-nav .list-item-active a {
  color: #167BB7;
}

.main .sidebar-nav > .navbar-nav  > li {
  margin-bottom: 8px;
}

.main .right-side-menu {
  position: sticky;
  top: 16px;
  height: calc(100vh - 40px);
  margin-top: 24px;
}

.main .right-side-menu > .navbar-nav {
  position: relative;
}

.sidebar-wrapper {
  margin-left: 0;
  transition-duration: .25s;
  flex-shrink: 0;
  width: calc(100% - 16px);
}
.main-wrapper {
  flex-grow: 1;
}
.bd-links-wrapper {
  flex-shrink: 0;
}
.right-side-menu ul ul {
  padding-left: 16px;
}
@media (min-width: 768px) {
  .sidebar-wrapper {
    width: 310px;
  }
  .sidebar-hide .sidebar-wrapper {
    margin-left: -280px;
  }
  .main-wrapper {
    width: calc(100% - 520px);
  }
}
@media (min-width: 1200px) {
  .main-wrapper {
    width: calc(100% - 590px);
  }
  .bd-links-wrapper {
    width: 268px;
  }
}


.main .right-side-menu > .navbar-nav:before {
  content: "In this document";
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  font-size: 14px;
  line-height: 16px;
  text-transform: uppercase;
  color: #1F2937;
}

.main .right-side-menu > ul > li > a {
  font-size: 14px;
  font-weight: 300;
  margin-bottom: 7px;
  padding: 4px 0;
}

.main .right-side-menu .nav-link {
  border: none!important;
  color: #6B7280!important;
}

.main .right-side-menu .nav-link.active{
  padding-left: 0;
  color: #167BB7!important;
  font-weight: 500;
}

.main .right-side-menu .navbar-nav {
  display: block;
}
.main nav[data-toggle=toc] .nav > li > a {
  padding-left: 0;
  transition-property: color;
  transition-duration: .25s;
}
.main nav[data-toggle=toc] .nav > li > a:focus,
.main nav[data-toggle=toc] .nav > li > a:hover {
  color: #167BB7!important;
}
.main nav[data-toggle=toc] .nav .nav > li > a:focus,
.main nav[data-toggle=toc] .nav .nav > li > a:hover,
.main nav[data-toggle=toc] .nav .nav > li > .active,
.main nav[data-toggle=toc] .nav .nav > li > .active:focus,
.main nav[data-toggle=toc] .nav .nav > li > .active:hover {
  padding-left: 0;
}
.main nav[data-toggle=toc] .nav-link.active:hover {
  padding-left: 0;
}

.main img {
  box-shadow: none;
  border-radius: 0;
  margin-bottom: 24px;
  margin-top: 10px;
  display: inline;
}

.main .note img {
  box-shadow: none;
  border-radius: 0;
  min-width: 40px;
  width: 40px;
  margin-bottom: 10px;
}

.main .imageblock img {
  height: auto;
}
.main p span.image {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  height: 16px;
  width: 20px;
  margin-left: 4px;
  margin-right: 4px;
}
.main p span.image img {
  height: 100%;
  width: 100%;
  margin-bottom: 0;
  margin-top: 0;
  box-shadow: none;
  object-fit: cover;
}

.main .listingblock, .literalblock > .content pre {
  padding: 8px 14px;
  background: #50576A;
  border-radius: 4px;
  margin-bottom: 24px;
  font-size: 14px;
  font-weight: 400;
  color: #CECECE;
}

pre.pygments {
  background: #50576A!important;
  margin-bottom: 0;
}

.main .listingblock  .tok-nt {
  color: #29A9C9;
}

.main .listingblock .tok-s {
  color: #E44C3A;
}

.main .listingblock  .tok-p {
  color: #F5FBFF;
}

.main ol {
  counter-reset: my-awesome-counter;
  list-style: none;
  color: #167BB7;
  margin-left: 20px;
  margin-bottom: 16px;
}

.main ol > li {
  position: relative;
  counter-increment: my-awesome-counter;
  font-weight: 600;
}

.main ol.arabic > li::before {
  content: counter(my-awesome-counter);
  position: absolute;
  top: -1px;
  left: -20px;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background-color: #E5E7EB;
  color: #6B7280;
  font-weight: 400;
  font-size: inherit;
}
.main ol > li::before {
}

.main ol.arabic:first-child p {
  color: #374151;
  margin-left: 10px;
  font-weight: 400;
}

.main .content-wrapper ul{
  color: #374151;
  list-style: disc;
  margin-left: 20px;
}

.main .content-wrapper ul > li ul {
  margin-left: 0;
  list-style-type: none;
}

.main .content-wrapper ul.nav-tabs{
  list-style: none;
}
.main ol ol {
  margin-left: 30px;
}
.main ol.loweralpha[type=a] > li {
  list-style-type: lower-alpha;
}
.main ol.lowerroman[type=i] > li {
  list-style-type: lower-roman;
}
.main ol li::marker {
  color: #6B7280;
}

.main h2, .main h3 {
  margin-bottom: 16px;
  padding-top: 24px;
}

.main h4 {
  margin-bottom: 16px;
  padding-top: 16px;
}

.content-wrapper h2 a, .content-wrapper h3 a, .content-wrapper h4 a {
  display: none;
  margin-left: 5px;
}

.content-wrapper h4 a svg {
  height: 14px;
  width: auto;
}

.content-wrapper h2:hover a, .content-wrapper h3:hover a, .content-wrapper h4:hover a {
  display: inline;
}

.breadcrumbs-wrapper {
  margin-bottom: 24px;
}
.breadcrumbs-list {
  display: flex;
  align-items: center;
}
.breadcrumbs-list li {
  display: flex;
  align-items: center;
}
.breadcrumbs-list li:not(:last-of-type):after {
  content: '/';
  margin-left: 6px;
  margin-right: 6px;
}
.breadcrumbs-list a {
  display: flex;
  align-items: center;
  letter-spacing: -0.025em;
  color: #374151;
}
.breadcrumbs-list a svg {
  width: 24px;
  height: 24px;
  margin-right: 4px;
}

.note table code {
  color: #374151;
}

.banner .absolute-figure {
  position: absolute;
}

.banner .absolute-figure.abstract-figure {
  right: 0;
}

.banner .absolute-figure.circle2 {
  right: 30%;
  top: 10%;
}

.banner .absolute-figure.circle3 {
  right: 15%;
  top: 10%;
}

.banner .absolute-figure.circle4 {
  left: 5%;
  top: 10%;
}

.banner .absolute-figure.circle5 {
  left: 30%;
}

.banner .absolute-figure.circle6 {
  left: 6%;
  bottom: 0;
}

.banner .absolute-figure.circle7 {
  left: 35%;
  bottom: 15%;
}

.banner .absolute-figure.circle8 {
  left: 55%;
  bottom: 0;
}

.banner .absolute-figure.circle9 {
  bottom: 0;
  right: 0;
}

.doclink {
  position: fixed;
  bottom: 0;
  padding: 0 15px 10px;
  background-color: #FBFDFF;
  z-index: 1000;
  font-size: 12px;
}

.btn-primary, .btn-primary:hover {
  background-color: #167BB7;
  border-color: #167BB7;
}

.card {
  height: 100%;
}
.card-wrapper .card-text {
  min-height: 80px;
  margin-bottom: 16px;
}

.card-wrapper .card-body {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 1rem 0.25rem;
}

pre.pygments .tok-c1 {
  color: #29A9C9!important;
}

@media screen and (max-width: 1520px) {
  .card-wrapper .card-text {
    min-height: 110px;
  }
}

.DocSearch.DocSearch-Button {
    margin-left: 0;
    width: 100%;
    height: 38px;
    padding: 0 15px;
    background-color: transparent;
    border: 1px solid #D1D5DB;
    box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
    border-radius: 6px;
    font-weight: 400;
    font-size: 14px;
    line-height: 20px;
    color: #6B7280;
}
.search-form-wrapper .DocSearch-Button-Keys {
  display: none;
}
.DocSearch-Hit-content-wrapper {
  overflow-x: inherit !important;
}
.search-form-wrapper .DocSearch-Button .DocSearch-Search-Icon {
  color: #9CA3AF;
  width: 16px;
  height: 16px;
}
.search-form-wrapper .DocSearch-Button-Placeholder {
  padding-left: 10px;
}
.oneline_with_image img {
    display: inline-block;
    height: 30px;
    margin: 0 10px;
}

.warning table td, .warning table,
.important table td, .important table {
  border: none;
}
.copy-icon {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  height: 40px;
  margin: -8px -14px 8px;
  padding: 0 16px;
  background-color: #3C4356;
  border-top-left-radius: 4px;
  border-top-right-radius: 4px;
}
.copy-icon svg {
  cursor: pointer;
}
.icon-tip {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 502 502' xml:space='preserve'%3E%3Cpath d='M230.523 78.722c-35.583-.342-69.221 13.48-94.756 38.802-25.528 25.316-39.587 58.839-39.587 94.396 0 34.708 13.278 67.567 37.387 92.524 24 24.844 37.216 57.409 37.216 91.697v70.281c0 5.523 4.477 10 10 10h12.756C197.871 491.185 211.53 502 227.676 502s29.805-10.815 34.138-25.578h16.166c5.523 0 10-4.477 10-10v-70.275c0-34.627 12.99-66.961 36.576-91.044 24.522-25.04 38.027-58.133 38.027-93.185 0-35.38-13.723-68.697-38.64-93.812-24.902-25.1-58.079-39.086-93.42-39.384zM227.676 482c-4.787 0-9.076-2.17-11.936-5.578h23.872c-2.86 3.408-7.149 5.578-11.936 5.578zm40.304-25.578h-77.197v-37.125h77.197v37.125zm42.287-165.313c-27.269 27.844-42.287 65.148-42.287 105.039v3.15h-77.197v-3.156c0-39.5-15.211-77-42.832-105.593-20.488-21.208-31.771-49.133-31.771-78.629 0-30.183 11.958-58.663 33.67-80.194 21.72-21.538 50.338-33.226 80.505-33.005 61.882.521 112.228 51.301 112.228 113.197 0 29.789-11.477 57.912-32.316 79.191zM229.381 55.584c5.523 0 10-4.477 10-10V10c0-5.523-4.477-10-10-10s-10 4.477-10 10v35.584c0 5.523 4.477 10 10 10zM85.246 29.896a9.988 9.988 0 0 0 8.099 4.123 9.96 9.96 0 0 0 5.87-1.91c4.468-3.247 5.458-9.5 2.212-13.968l-7.108-9.783C91.073 3.89 84.82 2.9 80.351 6.146c-4.468 3.247-5.458 9.5-2.212 13.968l7.107 9.782zM124.729 84.239a9.988 9.988 0 0 0 8.099 4.123 9.96 9.96 0 0 0 5.87-1.91c4.468-3.246 5.458-9.5 2.212-13.968l-19.113-26.308c-3.246-4.468-9.499-5.459-13.968-2.212-4.468 3.246-5.458 9.5-2.212 13.968l19.112 26.307zM37.031 160.15l33.843 10.996a10.01 10.01 0 0 0 3.092.492c4.215 0 8.136-2.687 9.509-6.913 1.707-5.253-1.168-10.894-6.42-12.601l-33.843-10.996c-5.251-1.705-10.894 1.168-12.601 6.42-1.707 5.254 1.167 10.895 6.42 12.602zM84.808 260.51c-1.707-5.253-7.346-8.126-12.601-6.42l-33.843 10.996c-5.252 1.707-8.127 7.348-6.42 12.601 1.373 4.226 5.293 6.913 9.509 6.913a10.01 10.01 0 0 0 3.092-.492l33.843-10.996c5.252-1.708 8.126-7.349 6.42-12.602zM102.626 391.668c-4.467-3.246-10.721-2.255-13.968 2.212l-8.903 12.253c-3.246 4.468-2.256 10.722 2.212 13.968a9.952 9.952 0 0 0 5.87 1.91 9.99 9.99 0 0 0 8.099-4.123l8.903-12.253c3.246-4.467 2.256-10.72-2.213-13.967z'/%3E%3Cpath d='M134.544 347.736c-4.468-3.246-10.722-2.255-13.968 2.212l-8.845 12.175c-3.246 4.468-2.255 10.722 2.212 13.968a9.952 9.952 0 0 0 5.87 1.91 9.99 9.99 0 0 0 8.099-4.123l8.845-12.175c3.246-4.467 2.255-10.721-2.213-13.967zM338.347 336.895c-3.246-4.468-9.499-5.459-13.968-2.212-4.468 3.247-5.458 9.5-2.212 13.968l20.916 28.789a9.988 9.988 0 0 0 8.099 4.123 9.96 9.96 0 0 0 5.87-1.91c4.468-3.247 5.458-9.5 2.212-13.968l-20.917-28.79zM426.045 260.984l-33.843-10.997c-5.252-1.705-10.894 1.168-12.601 6.42-1.707 5.252 1.168 10.894 6.42 12.601l33.843 10.997a10.01 10.01 0 0 0 3.092.492c4.215 0 8.136-2.687 9.509-6.913 1.707-5.251-1.167-10.893-6.42-12.6zM471.39 130.367c-1.706-5.252-7.347-8.127-12.601-6.42l-14.678 4.769c-5.252 1.707-8.127 7.348-6.42 12.601 1.373 4.226 5.293 6.913 9.509 6.913a10.01 10.01 0 0 0 3.092-.492l14.678-4.769c5.252-1.708 8.126-7.349 6.42-12.602zM387.777 167.536a10.01 10.01 0 0 0 3.092-.492l25.994-8.446c5.252-1.707 8.127-7.348 6.42-12.601-1.707-5.252-7.347-8.127-12.601-6.42l-25.994 8.446c-5.252 1.707-8.127 7.348-6.42 12.601 1.374 4.225 5.294 6.912 9.509 6.912zM320.89 83.916a9.952 9.952 0 0 0 5.87 1.91 9.99 9.99 0 0 0 8.099-4.123l20.916-28.789c3.246-4.468 2.255-10.722-2.212-13.968-4.469-3.246-10.722-2.255-13.968 2.212l-20.916 28.789c-3.248 4.469-2.257 10.722 2.211 13.969zM288.349 135.549c-11.289-8.76-24.609-14.981-38.521-17.992-5.395-1.169-10.721 2.26-11.889 7.659-1.168 5.398 2.261 10.721 7.659 11.889 11.007 2.382 21.55 7.308 30.491 14.245a9.954 9.954 0 0 0 6.124 2.1 9.981 9.981 0 0 0 7.907-3.87c3.385-4.363 2.592-10.645-1.771-14.031zM202.914 119.066c-41.096 11.729-69.797 49.799-69.797 92.579 0 5.523 4.477 10 10 10s10-4.477 10-10c0-33.895 22.735-64.056 55.287-73.346 5.311-1.516 8.387-7.05 6.872-12.361-1.518-5.31-7.052-8.388-12.362-6.872z'/%3E%3C/svg%3E");
  width: 42px;
  height: 42px;
  background-repeat: no-repeat;
  background-position: center;
}
.main table td.icon {
  text-align: center;
}
.icon-warning {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='554.2' height='554.199' xml:space='preserve' fill='%23E44C3A'%3E%3Cpath d='M538.5 386.199 356.5 70.8a91.803 91.803 0 0 0-79.501-45.9c-32.8 0-63.1 17.5-79.5 45.9L12.3 391.6a91.793 91.793 0 0 0 0 91.8c16.4 28.4 46.7 45.9 79.5 45.9H462.4c50.7 0 91.8-41.101 91.8-91.8 0-19-5.8-36.7-15.7-51.301zm-222.2 30.7c0 21.7-16.7 38.3-39.2 38.3s-39.2-16.6-39.2-38.3V416c0-21.601 16.7-38.301 39.2-38.301S316.3 394.3 316.3 416v.899zm.9-258.199-19.4 169.4c-1.3 12.2-9.4 19.8-20.7 19.8s-19.4-7.7-20.7-19.8L237 158.6c-1.3-13.1 5.801-23 18-23h44.1c12.2.1 19.4 10 18.1 23.1z'/%3E%3C/svg%3E%0A");
  width: 40px;
  height: 39px;
  background-size: 100%;
}
.icon-important {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cg transform='scale(.521)'%3E%3Ccircle cx='96' cy='96' r='74' fill='%23E44C3A'/%3E%3Cpath d='M86 48h20l-4 72H90z' fill='%23fff'/%3E%3Ccircle cx='96' cy='140' r='10' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E");
  width: 40px;
  height: 40px;
  background-size: 100%;
}
.main .admonitionblock.tip table,
.main .admonitionblock.tip table td {
  border: none;
}
/*Light box start*/

.lightbox-modal {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  background-color: #ebebeb;
  padding: 20px;
  transform: translate(-50%, -50%);
  z-index: 100;
  border-radius: 8px;
  max-width: 95vw;
  width: 100%;
  height: 90vh;
}
.lightbox-modal .img {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}
.lightbox-modal .img img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  margin: 0;
}
@media (max-width: 1023px) {
  .lightbox-modal {
    height: auto;
    max-width: 95vw;
  }
}
#close-ligtbox {
  position: absolute;
  right: -35px;
  top: -35px;
  display: block;
  width: 30px;
  font-size: 36px;
  border-radius: 8px;
  cursor: pointer;
  color: #fff;
}
@media (max-width: 1023px) {
  #close-ligtbox {
    right: 0;
    top: -40px;
    width: 24px;
    font-size: 28px;
  }
}
.overlay {
  display: none;
  position: fixed;
  background-color: rgba(0,0,0,.5);
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  z-index: 99;
}
.imageblock img, .paragraph .image img {
  cursor: pointer;
}
/*Light box end*/

.ulist {
  margin-left: 10px;
}
.main ol.arabic:first-child .ulist p,
.ulist ul li p {
  margin-left: 0!important;
}

.ulist li::marker {
  font-size: 20px;
  color: #6d7176;
}
.ulist li ul {
  list-style-type: none;
}
.ulist li ul li {
  position: relative;
  padding-left: 24px;
}
.ulist li ul li:before {
  content: '';
  position: absolute;
  left: 0;
  top: 9px;
  width: 8px;
  height: 8px;
  background-color: #E5E7EB;
  border: 1px solid #9CA3AF;
  border-radius: 100%;
}
.right-side-menu ul ul li:not(:last-child) {
  margin-bottom: 5px;
}
.imageblock .title {
  margin-bottom: 24px;
}
</style>
<style>pre.pygments .hll { background-color: #49483e }
pre.pygments { background: #272822; color: #f8f8f2 }
pre.pygments .tok-c { color: #75715e } /* Comment */
pre.pygments .tok-err { color: #960050; background-color: #1e0010 } /* Error */
pre.pygments .tok-k { color: #66d9ef } /* Keyword */
pre.pygments .tok-l { color: #ae81ff } /* Literal */
pre.pygments .tok-n { color: #f8f8f2 } /* Name */
pre.pygments .tok-o { color: #f92672 } /* Operator */
pre.pygments .tok-p { color: #f8f8f2 } /* Punctuation */
pre.pygments .tok-ch { color: #75715e } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #75715e } /* Comment.Multiline */
pre.pygments .tok-cp { color: #75715e } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #75715e } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #75715e } /* Comment.Single */
pre.pygments .tok-cs { color: #75715e } /* Comment.Special */
pre.pygments .tok-gd { color: #f92672 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gi { color: #a6e22e } /* Generic.Inserted */
pre.pygments .tok-go { color: #66d9ef } /* Generic.Output */
pre.pygments .tok-gp { color: #f92672; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #75715e } /* Generic.Subheading */
pre.pygments .tok-kc { color: #66d9ef } /* Keyword.Constant */
pre.pygments .tok-kd { color: #66d9ef } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #f92672 } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #66d9ef } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #66d9ef } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #66d9ef } /* Keyword.Type */
pre.pygments .tok-ld { color: #e6db74 } /* Literal.Date */
pre.pygments .tok-m { color: #ae81ff } /* Literal.Number */
pre.pygments .tok-s { color: #e6db74 } /* Literal.String */
pre.pygments .tok-na { color: #a6e22e } /* Name.Attribute */
pre.pygments .tok-nb { color: #f8f8f2 } /* Name.Builtin */
pre.pygments .tok-nc { color: #a6e22e } /* Name.Class */
pre.pygments .tok-no { color: #66d9ef } /* Name.Constant */
pre.pygments .tok-nd { color: #a6e22e } /* Name.Decorator */
pre.pygments .tok-ni { color: #f8f8f2 } /* Name.Entity */
pre.pygments .tok-ne { color: #a6e22e } /* Name.Exception */
pre.pygments .tok-nf { color: #a6e22e } /* Name.Function */
pre.pygments .tok-nl { color: #f8f8f2 } /* Name.Label */
pre.pygments .tok-nn { color: #f8f8f2 } /* Name.Namespace */
pre.pygments .tok-nx { color: #a6e22e } /* Name.Other */
pre.pygments .tok-py { color: #f8f8f2 } /* Name.Property */
pre.pygments .tok-nt { color: #f92672 } /* Name.Tag */
pre.pygments .tok-nv { color: #f8f8f2 } /* Name.Variable */
pre.pygments .tok-ow { color: #f92672 } /* Operator.Word */
pre.pygments .tok-w { color: #f8f8f2 } /* Text.Whitespace */
pre.pygments .tok-mb { color: #ae81ff } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #ae81ff } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #ae81ff } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #ae81ff } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #ae81ff } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #e6db74 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #e6db74 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #e6db74 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #e6db74 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #e6db74 } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #e6db74 } /* Literal.String.Double */
pre.pygments .tok-se { color: #ae81ff } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #e6db74 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #e6db74 } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #e6db74 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #e6db74 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #e6db74 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #e6db74 } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #a6e22e } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #f8f8f2 } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #f8f8f2 } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #f8f8f2 } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #f8f8f2 } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #ae81ff } /* Literal.Number.Integer.Long */</style></head><body data-spy="scroll" data-target="#toc" class="book"><header class="header"><div class="header-wrapper"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="header-logo"><div class="logo"><a href="https://docs.killbill.io"><img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/logo.png" style="height:41px" alt="KillBill Docs"></a></div></div><div class="header-search"><div class="search-form-wrapper"><div id="docsearch" style="height: 43px; display: flex; align-items: center; width: 100%;"></div></div></div></div></div></div></header><main class="main"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="sidebar-wrapper"><aside class="sidebar"><nav class="sidebar-nav"><ul class="nav navbar-nav"><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Getting Started</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li><a class="nav-link" href="/latest/what_is_kill_bill.html">What is Kill Bill?</a></li><li><a class="nav-link" href="/latest/getting_started.html">Getting Started (Installation)</a></li><li><a class="nav-link" href="/latest/quick_start_with_kaui.html">Quick Start with Kaui</a></li><li><a class="nav-link" href="/latest/quick_start_with_kb_api.html">Quick Start with the Kill Bill API</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Installation</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/stripe_plugin.html">Kill Bill + Stripe DIY</a></li><li><a class="nav-link" href="/latest/userguide_deployment.html">Going to Production</a></li><li><a class="nav-link" href="/latest/how-to-upgrade-the-database.html">Database Migrations</a></li><li><a class="nav-link" href="/latest/PostgreSQL.html">PostgreSQL Setup</a></li><li><a class="nav-link" href="https://github.com/killbill/killbill/releases" onclick="getOutboundLink('https://github.com/killbill/killbill/releases'); return false;">Release&nbsp;Notes</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">AWS</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/how-to-set-up-a-single-tier-system.html">Single-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-multi-tier-system.html">Multi-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-cloud-formation-system.html">CloudFormation Setup</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/how-to-maintain-a-single-tier-system.html">Single-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-multi-tier-system.html">Multi-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-cloud-formation-system.html">CloudFormation Maintenance</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Manuals</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/userguide_subscription.html">Subscription&nbsp;Billing</a></li><li><a class="nav-link" href="/latest/userguide_payment.html">Payment Processing</a></li><li><a class="nav-link" href="/latest/userguide_kaui.html">Kaui, the Administrative&nbsp;UI</a></li><li><a class="nav-link" href="/latest/email-notification-plugin.html">Email Notification Plugin</a></li><li><a class="nav-link" href="/latest/custom-email-invoice-formatter.html">Custom Email Formatter</a></li><li><a class="nav-link" href="/latest/userguide_analytics.html">Analytics Plugin</a></li><li><a class="nav-link" href="/latest/userguide_configuration.html">Kill Bill&nbsp;Configuration</a></li><li><a class="nav-link" href="/latest/internationalization.html">Kill Bill&nbsp;Internationalization</a></li><li><a class="nav-link" href="/latest/migration_guide.html">Migrating to Kill Bill</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Tutorials</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plan_alignment.html">Plans Alignments</a></li><li><a class="nav-link" href="/latest/overdue.html">Overdue System</a></li><li><a class="nav-link" href="/latest/consumable_in_arrear.html">In Arrear UsageBilling</a></li><li><a class="nav-link" href="/latest/ha.html">Hierarchical Accounts</a></li><li><a class="nav-link" href="/latest/catalog-examples.html">Catalog Examples</a></li><li><a class="nav-link" href="/latest/invoice_examples.html">Invoice Examples</a></li><li><a class="nav-link" href="/latest/invoice_templates.html">Invoice Templates</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Integration</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="http://killbill.github.io/slate" onclick="getOutboundLink('http://killbill.github.io/slate'); return false;">REST API Reference</a></li><li><a class="nav-link" href="/latest/swagger_documentation.html">Swagger UI Documentation</a></li><li><a class="nav-link" href="/latest/postman.html">Postman Integration</a></li><li><a class="nav-link" href="/latest/debugging.html">Debugging</a></li><li><a class="nav-link" href="/latest/push_notifications.html">Push Notifications</a></li><li><a class="nav-link" href="/latest/kill_bill_events.html">Kill Bill Events</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Plugin Development</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_introduction.html">Plugin Introduction</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_development.html">Plugin Development</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_installation.html">Plugin Installation</a></li><li><a class="nav-link" href="/latest/plugin_use_cases.html">Special Plugin Use Cases</a></li><li><a class="nav-link" href="/latest/notification_plugin.html">Notification Plugins</a></li><li><a class="nav-link" href="/latest/payment_plugin.html">Payment Plugins</a></li><li><a class="nav-link" href="/latest/payment_control_plugin.html">Payment Control Plugins</a></li><li><a class="nav-link" href="/latest/usage_plugin.html">Usage Plugins</a></li><li><a class="nav-link" href="/latest/invoice_plugin.html">Invoice Plugins</a></li><li><a class="nav-link" href="/latest/catalog_plugin.html">Catalog Plugins</a></li><li><a class="nav-link" href="/latest/entitlement_plugin.html">Entitlement Plugins</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Operational Guides</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/deploy_to_kubernetes.html">Kubernetes (K8s) Deployment</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/user_management.html">Users, Roles, and Permissions</a></li><li><a class="nav-link" href="/latest/plugin_management.html">Plugin Management</a></li><li><a class="nav-link" href="/latest/aws-tools.html">AWS Analytics Tools</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Client Libraries</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/java_client.html">Java</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-ruby" onclick="getOutboundLink('http://github.com/killbill/killbill-client-ruby'); return false;">Ruby</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-php" onclick="getOutboundLink('http://github.com/killbill/killbill-client-php'); return false;">PHP</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-js" onclick="getOutboundLink('http://github.com/killbill/killbill-client-js'); return false;">Node.js</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-python" onclick="getOutboundLink('http://github.com/killbill/killbill-client-python'); return false;">Python</a></li><li><a class="nav-link" href="http://github.com/killbill/kbcli" onclick="getOutboundLink('http://github.com/killbill/kbcli'); return false;">Go</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">About Kill Bill</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/demo.html">Demo</a></li><li><a class="nav-link" href="/latest/features.html">Features List</a></li><li><a class="nav-link" href="/latest/faq.html">Technical FAQs</a></li><li><a class="nav-link" href="/latest/Kill-Bill-Glossary.html">Glossary</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">Internal</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/internal_design.html">Internal Design</a></li><li><a class="nav-link" href="/latest/entitlement_subsystem.html">Entitlement Subsystem</a></li><li><a class="nav-link" href="/latest/invoice_subsystem.html">Invoice Subsystem</a></li><li><a class="nav-link" href="/latest/development.html">Development Environment</a></li></ul></li><li><div class="icon-title"><div class="left-part"><a class="bd-toc-link main-link">References</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="https://github.com/killbill/killbill-docs/tree/v3/swagger" onclick="getOutboundLink('https://github.com/killbill/killbill-docs/tree/v3/swagger'); return false;">Swagger&nbsp;API Schema</a></li><li><a class="nav-link" href="/latest/catalog.xsd">Catalog XSD Reference</a></li><li><a class="nav-link" href="/latest/overdue.xsd">Overdue XSD Reference</a></li></ul></li></ul><div class="sidebar-toggler"></div></nav><script src="https://code.jquery.com/jquery-3.6.1.min.js"></script><script>
  let $ = jQuery;
  $('.sidebar-nav .icon-title').on('click', function (e) {
    e.preventDefault();
    $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
    $('.sidebar-nav > .navbar-nav > li').removeClass('open');

    if($(this).next().is(':visible')){
      $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
      $('.sidebar-nav > .navbar-nav > li').removeClass('open');
    } else {
      $(this).parent().addClass('open');
      $(this).next().slideDown(200);
    }
  });

  let pageURL = $(location).attr("href");
  $('.nav-link').each(function() {
    if (pageURL.includes($(this).attr('href'))) {
      $(this).parent().addClass('list-item-active');
      $(this).parent().parent().addClass('active-list');
      $(this).parent().parent().prev().addClass('bd-link-active-wrap');
    }
  });
</script><a class="doclink" href="mailto:support@killbill.io">Report a doc problem</a></aside></div><div class="main-wrapper"><article class="content-wrapper"><div class="banner"><div class="bg-image"><svg class="absolute-figure circle1" width="41" height="38" viewBox="0 0 41 38" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="12.5" cy="10.5" rx="28.5" ry="27.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle2" width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="10" cy="9.5" rx="10" ry="9.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle3" width="97" height="97" viewBox="0 0 97 97" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="48.5" cy="48.5" r="48.5" fill="white" fill-opacity="0.4"/>
</svg>
<svg class="absolute-figure circle4" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="7" cy="7" r="7" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle5" width="65" height="23" viewBox="0 0 65 23" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="32.5" cy="-9.5" r="32.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle6" width="48" height="31" viewBox="0 0 48 31" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="24" cy="24" r="24" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle7" width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="10" cy="9.5" rx="10" ry="9.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle8" width="20" height="10" viewBox="0 0 20 10" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="10" cy="9.5" rx="10" ry="9.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle9" width="49" height="48" viewBox="0 0 49 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="48.5" cy="48.5" r="48.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure abstract-figure" width="703" height="174" viewBox="0 0 703 174" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M25.5 246C-96 87.7673 245.949 67.3215 475.548 64.1799C705.146 61.0384 565.01 -188.501 629.653 -188.741C694.297 -188.982 766.062 221.014 766.062 221.014L297.072 460.733C297.072 460.733 147 404.233 25.5 246Z" fill="white" fill-opacity="0.2"/>
</svg></div><h1>Debugging tips</h1></div><div id="content"><div class="sect1"><h2 id="_finding_the_current_kill_bill_versionplugin_information">Finding the Current Kill Bill Version/Plugin Information</h2><div class="sectionbody"><div class="paragraph"><p>You can find the current Kill Bill version/information about plugins by invoking the following endpoint:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     http://127.0.0.1:8080/1.0/kb/nodesInfo</code></pre></div></div>
<div class="paragraph"><p>This displays a response similar to the following:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-o">[</span>
  <span class="tok-o">{</span>
    <span class="tok-s2">&quot;nodeName&quot;</span>: <span class="tok-s2">&quot;DESKTOP-NCUS49R&quot;</span>,
    <span class="tok-s2">&quot;bootTime&quot;</span>: <span class="tok-s2">&quot;2022-08-10T06:30:52.000Z&quot;</span>,
    <span class="tok-s2">&quot;lastUpdatedDate&quot;</span>: <span class="tok-s2">&quot;2022-08-10T06:30:52.000Z&quot;</span>,
    <span class="tok-s2">&quot;kbVersion&quot;</span>: <span class="tok-s2">&quot;0.22.18&quot;</span>,
    <span class="tok-s2">&quot;apiVersion&quot;</span>: <span class="tok-s2">&quot;0.53.17&quot;</span>,
    <span class="tok-s2">&quot;pluginApiVersion&quot;</span>: <span class="tok-s2">&quot;0.26.4&quot;</span>,
    <span class="tok-s2">&quot;commonVersion&quot;</span>: <span class="tok-s2">&quot;0.24.9&quot;</span>,
    <span class="tok-s2">&quot;platformVersion&quot;</span>: <span class="tok-s2">&quot;0.40.4&quot;</span>,
    <span class="tok-s2">&quot;pluginsInfo&quot;</span>: <span class="tok-o">[</span>
      <span class="tok-o">{</span>
        <span class="tok-s2">&quot;bundleSymbolicName&quot;</span>: <span class="tok-s2">&quot;org.kill-bill.billing.plugin.java.analytics-plugin&quot;</span>,
        <span class="tok-s2">&quot;pluginKey&quot;</span>: <span class="tok-s2">&quot;analytics&quot;</span>,
        <span class="tok-s2">&quot;pluginName&quot;</span>: <span class="tok-s2">&quot;analytics-plugin&quot;</span>,
        <span class="tok-s2">&quot;version&quot;</span>: <span class="tok-s2">&quot;7.3.0-SNAPSHOT&quot;</span>,
        <span class="tok-s2">&quot;state&quot;</span>: <span class="tok-s2">&quot;STOPPED&quot;</span>,
        <span class="tok-s2">&quot;isSelectedForStart&quot;</span>: true,
        <span class="tok-s2">&quot;services&quot;</span>: <span class="tok-o">[]</span>
      <span class="tok-o">}</span>
    <span class="tok-o">]</span>
  <span class="tok-o">}</span>
<span class="tok-o">]</span></code></pre></div></div>
<div class="paragraph"><p>Alternatively, you can also find the Kill Bill version via Kaui by accessing http://&lt;KAUI_HOME&gt;/kpm.</p></div></div></div>
<div class="sect1"><h2 id="_healthchecks_and_metrics">Healthchecks and metrics</h2><div class="sectionbody"><div class="paragraph"><p>Kill Bill exposes both healthchecks and metrics. These can be accessed via:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v http://&lt;IP_ADDRESS&gt;:8080/1.0/healthcheck?pretty<span class="tok-o">=</span><span class="tok-nb">true</span>
curl -v http://&lt;IP_ADDRESS&gt;:8080/1.0/metrics?pretty<span class="tok-o">=</span><span class="tok-nb">true</span></code></pre></div></div></div></div>
<div class="sect1"><h2 id="_remote_debugging">Remote Debugging</h2><div class="sectionbody"><div class="sect2"><h3 id="_remote_debuggging_kill_bill_running_in_tomcat">Remote debuggging Kill Bill running in Tomcat</h3><div class="paragraph"><p>In order to remote debug Kill Bill running in Tomcat, the following needs to be done:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Ensure that you have Kill Bill and Kaui installed in Tomcat as explained in the <a href="https://docs.killbill.io/latest/getting_started.html#_tomcat">Getting Started</a> guide.</p></li><li><p>Set the following environment variable:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nv">JPDA_OPTS</span><span class="tok-o">=</span>-agentlib:jdwp<span class="tok-o">=</span><span class="tok-nv">transport</span><span class="tok-o">=</span>dt_socket,address<span class="tok-o">=</span><span class="tok-m">12345</span>,server<span class="tok-o">=</span>y,suspend<span class="tok-o">=</span>n</code></pre></div></div></li><li><p>Start Tomcat as follows:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>catalina.sh jpda start</code></pre></div></div></li><li><p>Create a new remote debug configuration in Eclipse/Intellij with <code>Host=localhost</code> and <code>Port=12345</code>.</p></li><li><p>Add a breakpoint to the code.</p></li><li><p>Execute any action that invokes the code with the breakpoint. This will run the code in debug mode.</p></li></ol></div></div>
<div class="sect2"><h3 id="_remote_debuggging_kill_bill_running_in_docker">Remote debuggging Kill Bill running in Docker</h3><div class="paragraph"><p>In order to remote debug Kill Bill running in Docker, the following needs to be done:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Expose port <code>12345</code> and specify the <code>JVM_JDWP_PORT</code> environment variable in your <a href="https://docs.killbill.io/latest/getting_started.html#_kill_bill_installation">docker-compose</a> file as follows:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>version: <span class="tok-s1">&#39;3.2&#39;</span>
volumes:
  db:
services:
  killbill:
    image: killbill/killbill:0.24.0
    ports:
      - <span class="tok-s2">&quot;8080:8080&quot;</span>
      - <span class="tok-m">12345</span>:12345
    environment:
      - <span class="tok-nv">JVM_JDWP_PORT</span><span class="tok-o">=</span>*:12345
      - <span class="tok-nv">KILLBILL_DAO_URL</span><span class="tok-o">=</span>jdbc:mysql://db:3306/killbill
      - <span class="tok-nv">KILLBILL_DAO_USER</span><span class="tok-o">=</span>root
      - <span class="tok-nv">KILLBILL_DAO_PASSWORD</span><span class="tok-o">=</span>killbill
      - <span class="tok-nv">KILLBILL_CATALOG_URI</span><span class="tok-o">=</span>SpyCarAdvanced.xml
      - <span class="tok-nv">KB_org_killbill_server_test_mode</span><span class="tok-o">=</span><span class="tok-nb">true</span>
  kaui:
    image: killbill/kaui:2.0.11
    ports:
      - <span class="tok-s2">&quot;9090:8080&quot;</span>
    environment:
      - <span class="tok-nv">KAUI_CONFIG_DAO_URL</span><span class="tok-o">=</span>jdbc:mysql://db:3306/kaui
      - <span class="tok-nv">KAUI_CONFIG_DAO_USER</span><span class="tok-o">=</span>root
      - <span class="tok-nv">KAUI_CONFIG_DAO_PASSWORD</span><span class="tok-o">=</span>killbill
      - <span class="tok-nv">KAUI_KILLBILL_URL</span><span class="tok-o">=</span>http://killbill:8080
  db:
    image: killbill/mariadb:0.24
    volumes:
      - type: volume
        source: db
        target: /var/lib/mysql
    expose:
      - <span class="tok-s2">&quot;3306&quot;</span>
    environment:
      - <span class="tok-nv">MYSQL_ROOT_PASSWORD</span><span class="tok-o">=</span>killbill</code></pre></div></div></li><li><p>Create a new remote debug configuration in Eclipse/Intellij with <code>Host=localhost</code> and <code>Port=12345</code>.</p></li><li><p>Add a breakpoint to the code.</p></li><li><p>Execute any action that invokes the code with the breakpoint. This will run the code in debug mode.</p></li></ol></div>
<div class="paragraph"><p>Alternatively, you may also start Kill Bill in Docker using the following command at step 1:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>docker run -p <span class="tok-m">12345</span>:12345 -p <span class="tok-m">8080</span>:8080 -e <span class="tok-s1">&#39;JVM_JDWP_PORT=*:12345&#39;</span> killbill/killbill:0.24.1</code></pre></div></div></div>
<div class="sect2"><h3 id="_other_notes">Other Notes</h3><div class="ulist"><ul><li><p>To debug instances remotely (e.g. in the cloud), you need to specify the publicly accessible IP address of your instance.</p></li><li><p>Make sure also that the port <code>12345</code> is open (e.g. check your security groups in AWS)</p></li></ul></div></div></div></div>
<div class="sect1"><h2 id="_turning_on_debug_logging">Turning on DEBUG logging</h2><div class="sectionbody"><div class="paragraph"><p>Specify:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="properties"><span></span><span class="tok-na">-Dcom.sun.management.jmxremote</span><span class="tok-o">=</span><span class="tok-s">true</span>
<span class="tok-na">-Dcom.sun.management.jmxremote.authenticate</span><span class="tok-o">=</span><span class="tok-s">false</span>
<span class="tok-na">-Dcom.sun.management.jmxremote.port</span><span class="tok-o">=</span><span class="tok-s">8000</span>
<span class="tok-na">-Dcom.sun.management.jmxremote.rmi.port</span><span class="tok-o">=</span><span class="tok-s">8000</span>
<span class="tok-na">-Dcom.sun.management.jmxremote.ssl</span><span class="tok-o">=</span><span class="tok-s">false</span>
<span class="tok-na">-Djava.rmi.server.hostname</span><span class="tok-o">=</span><span class="tok-s">localhost</span></code></pre></div></div>
<div class="paragraph"><p>on startup in your JVM settings to enable access via <code>jconsole</code>.</p></div>
<div class="paragraph"><p>You can set at runtime the log level of specific classes and packages (look for  the <code>ch.qos.logback.classic:Name=default,Type=ch.qos.logback.classic.jmx.JMXConfigurator</code> MBean).</p></div>
<div class="paragraph"><p>Similar considerations as the remote debugging section apply regarding the IP address and expose ports (see above). For Docker, <code>java.rmi.server.hostname</code> should point to the host IP address (e.g. <code>192.168.99.100</code>). Passing this IP address to our Docker images as <code>ENV_HOST_IP</code> enables jConsole automatically.</p></div></div></div>
<div class="sect1"><h2 id="_following_tokens">Following tokens</h2><div class="sectionbody"><div class="paragraph"><p>To understand why a specific action was taken, it is often useful to follow tokens.</p></div>
<div class="paragraph"><p>When invoking a JAX-RS (HTTP) API, a <code>userToken</code> is automatically generated. You can also specify your own token via the <code>X-Request-Id</code> HTTP header (it <strong>must</strong> be a UUID).</p></div>
<div class="paragraph"><p>Once set, this token is:</p></div>
<div class="ulist"><ul><li><p>attached to the processing thread</p></li><li><p>attached to SLF4J MDC context as <code>kb.userToken</code> and displayed by default in logs (<code>tok=</code>)</p></li><li><p>passed to all APIs as <code>CallContext#getUserToken()</code></p></li><li><p>passed to internal bus events as <code>BusEvent#getUserToken()</code></p></li><li><p>passed to external bus events as <code>ExtBusEvent#getUserToken()</code></p></li><li><p>passed to future notifications as <code>userToken</code></p></li></ul></div>
<div class="paragraph"><p>Note that when a notification is created, a <code>futureUserToken</code> is auto-generated. That <code>futureUserToken</code> becomes the <code>userToken</code> when the notification is dispatched.</p></div>
<div class="paragraph"><p>You can search for these tokens in Kaui, on the <em>Queues</em> screen, accessible from the tenant page or via the per-account sub-menu (you need to be logged-in as the Kaui root user).</p></div>
<div class="sect2"><h3 id="_testing_changes_over_time">Testing changes over time</h3><div class="paragraph"><p>We have a clock abstraction in Kill Bill that can be manipulated through an API, as long as you start Kill Bill with <code>org.killbill.server.test.mode=true</code> (<code>-e KILLBILL_SERVER_TEST_MODE=true</code> in Docker):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-CreatedBy: admin&#39;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/test/clock&quot;</span>

curl -v <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-CreatedBy: admin&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;Accept: application/json&quot;</span> <span class="tok-se">\</span>
     -X POST <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/test/clock?requestedDate=2015-12-14T23:02:15.000Z&quot;</span>

curl -v <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-CreatedBy: admin&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;Accept: application/json&quot;</span> <span class="tok-se">\</span>
     -X PUT <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/test/clock?days=10&quot;</span></code></pre></div></div>
<div class="paragraph"><p>Here is an <a href="https://github.com/killbill/killbill-integration-tests/blob/165b76b5864fb40f1a5774f64c145d56123a5e62/killbill-integration-tests/mixin-utils/helper.rb#L131-L145">example</a> how it could be used in tests.</p></div></div></div></div>
<div class="sect1"><h2 id="_docker_and_ansible">Docker and Ansible</h2><div class="sectionbody"><div class="paragraph"><p>Our Docker images use Ansible behind the scenes to install and configure Kill Bill in the container. The actual Ansible commands run are available in the images via the environment variables <code>$KPM_INSTALL_CMD</code> and <code>$START_TOMCAT_CMD</code>.</p></div>
<div class="paragraph"><p>If you need to debug this setup process, you can start a container via <code>docker run -ti killbill/killbill:0.22.0 bash</code> and execute these commands manually.</p></div>
<div class="paragraph"><p>The Ansible command to start Tomcat can also be modified via the <code>$START_TOMCAT_OPTS</code> variable. One useful setting is to create the container using <code>START_TOMCAT_OPTS='--skip-tags tomcat_cleanup'</code> (e.g. <code>docker run -e START_TOMCAT_OPTS='--skip-tags tomcat_cleanup' -ti killbill/killbill:0.22.0</code>). While by default Ansible will cleanup the Tomcat directories (such as <code>webapps/ROOT</code>), this option will skip this task. This is especially useful when developping on Kill Bill: you can replace specific jars in the <code>webapps/ROOT</code> directory and simply restart the container to test your changes.</p></div></div></div>
<div class="sect1"><h2 id="_performance_and_profiling">Performance and profiling</h2><div class="sectionbody"><div class="paragraph"><p>Kill Bill has some built-in support to profile incoming calls. The mechanism is based on HTTP headers that need to be set to specify what needs to be profiled, and as a result, a new HTTP header is returned.</p></div>
<div class="sect2"><h3 id="_types_of_profiling">Types of profiling</h3><div class="paragraph"><p>In order to return profiling information, one needs to add the HTTP header <code>X-Killbill-Profiling-Req</code> and specify which calls should be instrumented. Today, we support:</p></div>
<div class="ulist"><ul><li><p>JAXRS: The HTTP call will be returned with the time spent in the call.</p></li><li><p>API: Any Kill Bill API call will be returned with the time spent in the call</p></li><li><p>DAO: Any Kill Bill DAO (request to database) call will be returned with the time spent in the call</p></li><li><p>DAO_DETAILS: Any Kill Bill DAO (request to database) call along with specifics about time time spent for audit/history and caching will be returned with the time spent in the call</p></li><li><p>DAO_CONNECTION: The time spent trying to acquire a database connection</p></li><li><p>GLOCK: The time spent trying to acquire the global (<code>Account</code>) lock</p></li><li><p>PLUGIN: Any Kill Bill call spent when calling a plugin will be returned with the time spent in the call</p></li></ul></div>
<div class="sect3"><h4 id="_jaxrs_profiling">JAXRS Profiling</h4><div class="paragraph"><p>The time is extracted from a <a href="https://github.com/killbill/killbill/blob/killbill-0.20.0/profiles/killbill/src/main/java/org/killbill/billing/server/filters/ProfilingContainerResponseFilter.java#L53">Jersey filter</a>, so it should be very close to the time spent into the JAX-RS application handler, not taking into account the time spent in the container itself (i.e. Jetty, Tomcat, &#8230;&#8203;).</p></div></div>
<div class="sect3"><h4 id="_api_profiling">API Profiling</h4><div class="paragraph"><p>We are relying on AOP to profile each of our API calls. We are injecting a <a href="https://github.com/killbill/killbill/blob/killbill-0.20.0/util/src/main/java/org/killbill/billing/util/glue/KillbillApiAopModule.java#L72">Guice AOP module</a> to profile each of our API calls. The time returned does not include the extra time spent to dispatch the request using the AOP handler.</p></div>
<div class="paragraph"><p>In addition, there is another <a href="https://github.com/killbill/killbill/blob/killbill-0.20.0/util/src/main/java/org/killbill/billing/util/glue/KillBillShiroAopModule.java#L45">AOP module</a> that is used to validate the user has the right set of permissions to execute this call. Since this occurs prior we do the profiling this time is currently not included in the profiling of the API call.</p></div>
<div class="paragraph"><p>Finally when making API calls from plugins, there may be also a small overhead to go through OSGI layer and this time is also not included.</p></div></div>
<div class="sect3"><h4 id="_doa_profiling">DOA Profiling</h4><div class="paragraph"><p>Most of the requests issued from Kill Bill Dao (e.g <code>DefaultPaymentDao</code>) classes follow the same mechanism:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>A transaction is started by calling the <code>execute</code> method of the <a href="https://github.com/killbill/killbill/blob/killbill-0.20.0/util/src/main/java/org/killbill/billing/util/entity/dao/EntitySqlDaoTransactionalJdbiWrapper.java#L87">EntitySqlDaoTransactionalJdbiWrapper</a>. Here, we create a <code>Handle</code>, essentially retrieving a database connection. The time taken to get the connection can be profiled by using the <code>DAO_CONNECTION</code> mask.</p></li><li><p>Then, a jdbi transaction is started using cglib, and this transaction is actually run through a series of handlers, such as our <a href="https://github.com/killbill/killbill-commons/blob/killbill-commons-0.22.0/jdbi/src/main/java/org/killbill/commons/jdbi/transaction/RestartTransactionRunner.java">RestartTransactionRunner</a>. This extra time, is not being measured by our profiling layer.</p></li><li><p>Finally, for each SQL operation within the transaction, we also proxy the calls using the java <code>Proxy</code> mechanism, and so all those calls are funneled trough the associated <code>EntitySqlDaoWrapperInvocationHandler</code>, and this is where the timing associated to the <code>DAO</code> (and <code>DAO_DETAILS</code>) mask is taken.</p></li></ol></div>
<div class="paragraph"><p>Note that the profiling time reported by the <code>API</code> mask&#8201;&#8212;&#8201;since it supersedes all dao calls&#8201;&#8212;&#8201;will include everything described above. Therefore it is possible to see an API that would only make a dao call take slightly longer than the dao call itself.</p></div>
<div class="paragraph"><p>The <code>DAO</code> mask will take the total time it takes to run the invocation handler invoke method. Because there are several paths, we also include the option to return <code>DAO_DETAILS</code>:</p></div>
<div class="ulist"><ul><li><p>In most cases, we will have a profiling entry <code>DAO_DETAILS:&lt;method&gt; (raw)</code> that only profiles the call requested.</p></li><li><p>In the case of an insert, update, deletion, the code will also update audit logs, and history table. In this case, we will also see a profiling entry <code>DAO_DETAILS:&lt;method&gt; (history/audit)</code> that will return the time it took to create the additional records in these tables.</p></li><li><p>In the case of a cacheable query (e.g return a <code>record_id</code> associated to an object <code>uuid</code>), we may return the result from the cache and so this is the only case where <code>DAO_DETAILS:&lt;method&gt;:raw</code> will not be printed.</p></li><li><p>In all other cases, the <code>DAO_DETAILS:&lt;method&gt; (raw)</code> should match the <code>DAO:&lt;method&gt;</code> time.</p></li></ul></div></div>
<div class="sect3"><h4 id="_glock_profiling">GLOCK Profiling</h4><div class="paragraph"><p>The <code>GLOCK</code> mask will simply output the time it took to grab the database lock associated with a given <code>Account</code>&#8201;&#8212;&#8201;the only kind of global lock currently supported in Kill Bill.</p></div></div>
<div class="sect3"><h4 id="_plugin_profiling">PLUGIN Profiling</h4><div class="paragraph"><p>This mask can be used to profile the time it takes for Kill Bill to make calls to a given plugin using a given plugin api. Here again, such plugin calls are being proxied using the <code>Proxy</code> mechanism, and the timing is taken from the <a href="https://github.com/killbill/killbill-platform/blob/killbill-platform-0.38.0/osgi/src/main/java/org/killbill/billing/osgi/ContextClassLoaderHelper.java#L106">invocation handler</a>.</p></div>
<div class="paragraph"><p>The information will contain the name of the plugin api class and the method being invoked.</p></div></div></div>
<div class="sect2"><h3 id="_example">Example</h3><div class="paragraph"><p>Kill Bill will return a json object containing the hierarchy for the calls along with the time spent in uSec (1000 nanoseconds or 0.000001 seconds).</p></div>
<div class="paragraph"><p>Example (Note the piping to extract the response header, and format the json nicely):</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;Accept: application/json&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-Profiling-Req: JAXRS,API,DAO,DAO_DETAILS,DAO_CONNECTION,GLOCK&#39;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/paymentMethods/3dd4e9d3-2be3-4bf2-b1e4-64a1785afd53&quot;</span> <span class="tok-m">2</span>&gt;<span class="tok-p">&amp;</span><span class="tok-m">1</span> <span class="tok-se">\</span>
     <span class="tok-p">|</span> grep <span class="tok-s1">&#39;X-Killbill-Profiling-Resp&#39;</span> <span class="tok-se">\</span>
     <span class="tok-p">|</span> awk <span class="tok-s1">&#39;{$1=$2=&quot;&quot;; print $0}&#39;</span> <span class="tok-se">\</span>
     <span class="tok-p">|</span> jq <span class="tok-s1">&#39;.&#39;</span></code></pre></div></div>
<div class="paragraph"><p>Response:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;rawData&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;JAXRS:1.0/kb/paymentMethods/3dd4e9d3-2be3-4bf2-b1e4-64a1785afd53&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">7654</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;calls&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;API:getPaymentMethodById&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">4158</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;calls&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
            <span class="tok-p">{</span>
              <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DAO_CONNECTION:get&quot;</span><span class="tok-p">,</span>
              <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">60</span>
            <span class="tok-p">},</span>
            <span class="tok-p">{</span>
              <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DAO:PaymentMethodSqlDao: getById&quot;</span><span class="tok-p">,</span>
              <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1371</span><span class="tok-p">,</span>
              <span class="tok-nt">&quot;calls&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
                <span class="tok-p">{</span>
                  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DAO_DETAILS:PaymentMethodSqlDao (raw): getById&quot;</span><span class="tok-p">,</span>
                  <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1364</span>
                <span class="tok-p">}</span>
              <span class="tok-p">]</span>
            <span class="tok-p">}</span>
          <span class="tok-p">]</span>
        <span class="tok-p">},</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;API:getAccountById&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">2593</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;calls&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
            <span class="tok-p">{</span>
              <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;API:getAccountById&quot;</span><span class="tok-p">,</span>
              <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">2462</span><span class="tok-p">,</span>
              <span class="tok-nt">&quot;calls&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
                <span class="tok-p">{</span>
                  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;API:getAccountByRecordIdInternal&quot;</span><span class="tok-p">,</span>
                  <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">2408</span><span class="tok-p">,</span>
                  <span class="tok-nt">&quot;calls&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
                    <span class="tok-p">{</span>
                      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DAO_CONNECTION:get&quot;</span><span class="tok-p">,</span>
                      <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">40</span>
                    <span class="tok-p">},</span>
                    <span class="tok-p">{</span>
                      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DAO:AccountSqlDao: getByRecordId&quot;</span><span class="tok-p">,</span>
                      <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">877</span><span class="tok-p">,</span>
                      <span class="tok-nt">&quot;calls&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
                        <span class="tok-p">{</span>
                          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DAO_DETAILS:AccountSqlDao (raw): getByRecordId&quot;</span><span class="tok-p">,</span>
                          <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">872</span>
                        <span class="tok-p">}</span>
                      <span class="tok-p">]</span>
                    <span class="tok-p">}</span>
                  <span class="tok-p">]</span>
                <span class="tok-p">}</span>
              <span class="tok-p">]</span>
            <span class="tok-p">}</span>
          <span class="tok-p">]</span>
        <span class="tok-p">},</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;API:getAccountAuditLogs&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;durationUsec&quot;</span><span class="tok-p">:</span> <span class="tok-mi">6</span>
        <span class="tok-p">}</span>
      <span class="tok-p">]</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span></code></pre></div></div>
<div class="paragraph"><p>We can see that for each mask there is some profiling data and such data retains the struture of the calls being made.</p></div></div>
<div class="sect2"><h3 id="_client_side">Client Side</h3><div class="paragraph"><p>The Ruby client library (<a class="bare" href="https://github.com/killbill/killbill-client-ruby">https://github.com/killbill/killbill-client-ruby</a>) has been extended to support profiling data. By passing a additional options the library will send the correct header to Kill Bill and capture the resulting information.</p></div>
<div class="paragraph"><p>Currently, only JAXRS profilingData will be requested and returned for simplification.</p></div>
<div class="paragraph"><p>In the example below <code>per_thread_profiling_data</code> will contain the timing for the various calls, which in that scenario would be <code>post:/1.0/kb/payments/uuid</code> and <code>get:/1.0/kb/payments/uuid:</code>. The provided hash will contain one key per call and the values will be an array of timing data expressed in uSec:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="ruby"><span></span><span class="tok-c1"># Add the :profilingData option</span>
<span class="tok-n">per_thread_profiling_data</span> <span class="tok-o">=</span> <span class="tok-p">{}</span>
<span class="tok-n">options</span> <span class="tok-o">=</span> <span class="tok-p">{</span><span class="tok-ss">:username</span> <span class="tok-o">=&gt;</span> <span class="tok-s1">&#39;admin&#39;</span><span class="tok-p">,</span> <span class="tok-ss">:password</span> <span class="tok-o">=&gt;</span> <span class="tok-s1">&#39;password&#39;</span><span class="tok-p">,</span> <span class="tok-ss">:profilingData</span> <span class="tok-o">=&gt;</span> <span class="tok-n">per_thread_profiling_data</span><span class="tok-p">}</span>
<span class="tok-n">res</span> <span class="tok-o">=</span> <span class="tok-n">auth_capture_task</span><span class="tok-o">.</span><span class="tok-n">op_create_capture</span><span class="tok-p">(</span><span class="tok-n">payment_id</span><span class="tok-p">,</span> <span class="tok-n">ext_key</span><span class="tok-p">,</span> <span class="tok-n">amount</span><span class="tok-p">,</span> <span class="tok-n">currency</span><span class="tok-p">,</span> <span class="tok-n">username</span><span class="tok-p">,</span> <span class="tok-n">options</span><span class="tok-p">)</span></code></pre></div></div>
<div class="paragraph"><p>Note that Ruby client gem will not make any attempt to synchronize access the the profiling_data map, when multiple threads are making calls. It is recommended to use per-thread data and potentially merge the results from the different threads at the end.</p></div></div>
<div class="sect2"><h3 id="_tips_and_tricks">Tips and tricks</h3><div class="ulist"><ul><li><p>In most cases, the client will be a bottleneck. Make sure to watch the number of sockets in <code>TIME_WAIT</code> (<code>watch 'netstat -an | grep 8080 | grep WAIT | wc -l'</code>) and speed up the recycling process:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nb">echo</span> <span class="tok-m">2</span> &gt; /proc/sys/net/ipv4/tcp_fin_timeout
<span class="tok-nb">echo</span> <span class="tok-m">15000</span> <span class="tok-m">65000</span> &gt; /proc/sys/net/ipv4/ip_local_port_range
<span class="tok-nb">echo</span> <span class="tok-m">1</span> &gt; /proc/sys/net/ipv4/tcp_tw_recycle
<span class="tok-nb">echo</span> <span class="tok-m">1</span> &gt; /proc/sys/net/ipv4/tcp_tw_reuse</code></pre></div></div>
<div class="ulist"><ul><li><p>On the server side, check the expected concurrency level by watching the number of sockets in <code>ESTABLISHED</code> (<code>watch 'netstat -an | grep 8080 | grep EST | wc -l'</code>)</p></li><li><p>Make sure to allocate enough database (<code>org.killbill.dao.maxActive</code> / <code>org.killbill.billing.osgi.dao.maxActive</code>) and plugin (<code>org.killbill.payment.plugin.threads.nb</code>) threads. Check your container thread pool too (e.g. <code>conf/server.xml</code> for Tomcat)</p></li><li><p>Use tools like Siege (<a class="bare" href="http://www.joedog.org/siege-home/">http://www.joedog.org/siege-home/</a>) to verify your basic setup: <code>siege -b -t30S -c100 <a class="bare" href="http://127.0.0.1:8080/1.0/kb/test/clock">http://127.0.0.1:8080/1.0/kb/test/clock</a></code> should yield at least 5k req./s.</p></li><li><p>If Shiro is spending too many CPU cycles for authentication, lower the default number of iterations (e.g. <code>org.killbill.security.shiroNbHashIterations=2000</code>).</p></li><li><p>When using YourKit, turn off probes (especially the database ones). They cause a significant slowdown.</p></li><li><p>Allow a warm-up period, before starting a full test, to avoid contention in the JRuby JIT.</p></li><li><p>Use <a href="https://github.com/AdoptOpenJDK/mjprof">mjprof</a> to extract stacktraces:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>java -jar target/mjprof-1.0.jar jmx/127.0.0.1:8989/.ncontains/name,RMI TCP/.ncontains/name,RMI Reaper/.ncontains/name,RMI RenewClean/.ncontains/name,RMI Scheduler/.ncontains/name,jruby-restarter/.ncontains/name,com.google.inject.internal.util.<span class="tok-nv">$Finalizer</span>/.ncontains/name,Finalizer/.ncontains/name,Reference/.ncontains/name,FelixStartLevel/.ncontains/name,FelixDispatchQueue/.ncontains/name,http-nio-8080/.ncontains/name,Abandoned connection cleanup thread/.ncontains/name,CM Event Dispatcher/.ncontains/name,CM Configuration Updater/.ncontains/name,SCR Component Actor/.ncontains/name,Timer-/.ncontains/name,telnetconsole.Listener/.ncontains/name,O worker /.ncontains/name,O boss /.ncontains/name,NioBlockingSelector/.ncontains/name,Signal Dispatcher/.ncontains/name,main/.ncontains/name,JMX server connection timeout/.ncontains/state,WAITING/.sort/state/</code></pre></div></div></div>
<div class="sect2"><h3 id="_load_tests">Load Tests</h3><div class="sect3"><h4 id="_integration_tests">Integration Tests</h4><div class="paragraph"><p>The <a href="https://github.com/killbill/killbill-integration-tests">integration tests repo</a> allows to run load tests against a running instance of Kill Bill. The <a href="https://github.com/killbill/killbill-integration-tests/blob/master/README.md">README</a> has a section explaining how they work.</p></div>
<div class="paragraph"><p>Note: It is difficult to rely on single process MT threaded Ruby script to generate enough load.</p></div></div>
<div class="sect3"><h4 id="_gnu_parallel_simple_load_testing_script">GNU parallel: simple load testing script</h4><div class="paragraph"><p>Another way to generate load is to rely on <code>GNU parallel</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>seq <span class="tok-m">0</span> <span class="tok-m">500</span> <span class="tok-p">|</span> parallel -j10 --no-notice -u ./perf_test.sh</code></pre></div></div>
<div class="paragraph"><p>Where <code>perf_test.sh</code> is:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nv">iteration_id</span><span class="tok-o">=</span><span class="tok-nv">$1</span>

<span class="tok-nb">echo</span> <span class="tok-s2">&quot;===&gt; Starting </span><span class="tok-nv">$iteration_id</span><span class="tok-s2">&quot;</span>

<span class="tok-nv">account_id</span><span class="tok-o">=</span><span class="tok-k">$(</span>curl -v <span class="tok-se">\</span>
                  -X POST <span class="tok-se">\</span>
                  -u admin:password <span class="tok-se">\</span>
                  -H <span class="tok-s1">&#39;Content-Type: application/json&#39;</span> <span class="tok-se">\</span>
                  -H <span class="tok-s1">&#39;X-Killbill-ApiKey: bob&#39;</span> <span class="tok-se">\</span>
                  -H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
                  -H <span class="tok-s1">&#39;X-Killbill-CreatedBy: creator&#39;</span> <span class="tok-se">\</span>
                  --data-binary <span class="tok-s2">&quot;{\&quot;name\&quot;:\&quot;john\&quot;,\&quot;email\&quot;:\&quot;profiling@example.com\&quot;,\&quot;externalKey\&quot;:\&quot;perf-</span><span class="tok-nv">$RANDOM</span><span class="tok-s2">-</span><span class="tok-nv">$RANDOM</span><span class="tok-s2">-</span><span class="tok-nv">$RANDOM</span><span class="tok-s2">\&quot;,\&quot;currency\&quot;:\&quot;USD\&quot;}&quot;</span> <span class="tok-se">\</span>
                  http://127.0.0.1:8080/1.0/kb/accounts <span class="tok-m">2</span>&gt;<span class="tok-p">&amp;</span><span class="tok-m">1</span> <span class="tok-p">|</span> grep Location <span class="tok-p">|</span> awk <span class="tok-s1">&#39;{print $3}&#39;</span> <span class="tok-p">|</span> awk -F<span class="tok-s1">&#39;/&#39;</span> <span class="tok-s1">&#39;{print $7}&#39;</span><span class="tok-k">)</span>

<span class="tok-nv">account_id</span><span class="tok-o">=</span><span class="tok-k">$(</span>tr -dc <span class="tok-s1">&#39;[[:print:]]&#39;</span> <span class="tok-o">&lt;&lt;&lt;</span> <span class="tok-s2">&quot;</span><span class="tok-nv">$account_id</span><span class="tok-s2">&quot;</span><span class="tok-k">)</span>

curl  <span class="tok-se">\</span>
     -X POST <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;Content-Type: application/json&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiKey: bob&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-CreatedBy: creator&#39;</span> <span class="tok-se">\</span>
     --data-binary <span class="tok-s1">&#39;{&quot;pluginName&quot;:&quot;YOUR-PLUGIN&quot;,&quot;pluginInfo&quot;:{&quot;properties&quot;:[{&quot;key&quot;:&quot;type&quot;,&quot;value&quot;:&quot;CreditCard&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccType&quot;,&quot;value&quot;:&quot;visa&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccName&quot;,&quot;value&quot;:&quot;A Smith&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;email&quot;,&quot;value&quot;:&quot;foo@bar.com&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccExpirationMonth&quot;,&quot;value&quot;:&quot;03&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccExpirationYear&quot;,&quot;value&quot;:&quot;2016&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccVerificationValue&quot;,&quot;value&quot;:&quot;222&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;address1&quot;,&quot;value&quot;:&quot;lskdjf&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;address2&quot;,&quot;value&quot;:&quot;&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;city&quot;,&quot;value&quot;:&quot;sdfsdfsff&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccFirstName&quot;,&quot;value&quot;:&quot;sdfsdf&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccLastName&quot;,&quot;value&quot;:&quot;fdsfdsf&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;zip&quot;,&quot;value&quot;:&quot;23812&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;country&quot;,&quot;value&quot;:&quot;USA&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;state&quot;,&quot;value&quot;:&quot;CA&quot;,&quot;isUpdatable&quot;:false},{&quot;key&quot;:&quot;ccNumber&quot;,&quot;value&quot;:&quot;4111111111111111&quot;,&quot;isUpdatable&quot;:false}]}}&#39;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/accounts/</span><span class="tok-si">${</span><span class="tok-nv">account_id</span><span class="tok-si">}</span><span class="tok-s2">/paymentMethods?isDefault=true&quot;</span> &gt; /dev/null <span class="tok-m">2</span>&gt;<span class="tok-p">&amp;</span><span class="tok-m">1</span>


curl  <span class="tok-se">\</span>
     -X POST <span class="tok-se">\</span>
     -u admin:password <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;Content-Type: application/json&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiKey: bob&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
     -H <span class="tok-s1">&#39;X-Killbill-CreatedBy: creator&#39;</span> <span class="tok-se">\</span>
     --data-binary <span class="tok-s1">&#39;{&quot;transactionType&quot;:&quot;AUTHORIZE&quot;,&quot;amount&quot;:&quot;10&quot;,&quot;currency&quot;:&quot;USD&quot;}&#39;</span> <span class="tok-se">\</span>
     <span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/accounts/</span><span class="tok-si">${</span><span class="tok-nv">account_id</span><span class="tok-si">}</span><span class="tok-s2">/payments&quot;</span> &gt; /dev/null <span class="tok-m">2</span>&gt;<span class="tok-p">&amp;</span><span class="tok-m">1</span>

<span class="tok-nb">echo</span> <span class="tok-s2">&quot;===&gt; Finished </span><span class="tok-nv">$iteration_id</span><span class="tok-s2">&quot;</span></code></pre></div></div>
<div class="paragraph"><p>Note that on a single machine, this client-side script will most likely be the bottleneck (spawning the processes takes too much time). Use <a href="http://jmeter.apache.org/">JMeter</a> instead.</p></div></div></div></div></div>
<div class="sect1"><h2 id="_seeking_help">Seeking help</h2><div class="sectionbody"><div class="paragraph"><p>If all else fail, reach out to our <a href="https://groups.google.com/forum/#!forum/killbilling-users">mailing-list</a> for help (<strong>do not open a GitHub issue</strong>).</p></div>
<div class="paragraph"><p>In your message, specify:</p></div>
<div class="ulist"><ul><li><p>What you are seeing and what you are expecting</p></li><li><p>How to reproduce your scenario (cURL commands, code snippet, &#8230;&#8203;)</p></li><li><p><a href="https://github.com/killbill/killbill-cloud/tree/9305e1abb8840f22a03d2c36269710bff3dc1996/kpm#kpm-diagnostic">KPM diagnostic</a> output (see notes below)</p></li></ul></div>
<div class="sect2"><h3 id="_kpm_diagnostics_notes">KPM Diagnostics Notes</h3><div class="paragraph"><p>The <code>kpm diagnostic</code> command gathers information about your Kill Bill installation (Kill Bill/Kaui versions, Java version, plugins that you use, etc), Kill Bill logs, tenant configuration data and account data. It generates a zip file with this data. When this file is shared with us, it allows us to replicate your Kill Bill environment and diagnose the issue.</p></div>
<div class="paragraph"><p>In case of a <a href="https://docs.killbill.io/latest/getting_started.html#_tomcat">Tomcat installation</a>, the <code>kpm diagnostic</code> command can be run as follows:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>kpm diagnostic --killbill-api-credentials<span class="tok-o">=</span>bob lazar --account-export<span class="tok-o">=</span>ACCOUNT_ID</code></pre></div></div>
<div class="paragraph"><p>Note that the parameters specified above are optional and refer to the following:</p></div>
<div class="ulist"><ul><li><p><code>killbill-api-credentials</code> - specifies the <strong>tenant api key</strong> and <strong>tenant api secret</strong> corresponding to the tenant for which you want to export data. If this parameter is skipped, data is exported for the default tenant (<code>bob/lazar</code>)</p></li><li><p><code>--account-export</code> specifies the <strong>account id</strong> for which account data (data from the Kill Bill database tables related) needs to be exported. If this parameter is skipped, account data is not exported.</p></li></ul></div>
<div class="paragraph"><p>For a complete list of <code>kpm diagnostic</code> options, you can run <code>kpm help diagnostic</code>.</p></div>
<div class="paragraph"><p>If you are using a <a href="https://docs.killbill.io/latest/getting_started.html#_docker">Docker installation</a>, you can simply run the following command in the Kill Bill container:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nv">$KPM_DIAGNOSTIC_CMD</span> -e <span class="tok-nv">killbill_user</span><span class="tok-o">=</span>admin <span class="tok-se">\</span>
                    -e <span class="tok-nv">killbill_password</span><span class="tok-o">=</span>password <span class="tok-se">\</span>
                    -e <span class="tok-nv">killbill_api_key</span><span class="tok-o">=</span>bob <span class="tok-se">\</span>
                    -e <span class="tok-nv">killbill_api_secret</span><span class="tok-o">=</span>lazar <span class="tok-se">\</span>
                    -e <span class="tok-nv">killbill_account</span><span class="tok-o">=</span>ACCOUNT_ID</code></pre></div></div>
<div class="paragraph"><p>If you are using an <a href="https://docs.killbill.io/latest/getting_started.html#_aws_one_click">AWS installation</a>, you can run the <code>kpm diagnostic</code> command as specified <a href="https://docs.killbill.io/latest/aws-singletier.html#_diagnostic_command">here</a>.</p></div>
<div class="paragraph"><p>Once the <code>kpm diagnostic</code> command completes, it displays the path of the generated file.
For example, with a Tomcat installation on a Windows machine, it displays the following:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>Diagnostic data exported under C:/Users/&lt;USERNAME&gt;/AppData/Local/Temp/killbill-diagnostics-20220215-10768-1pplgn6/killbill-diagnostics-02-15-22.zip</code></pre></div></div>
<div class="paragraph"><p>The zip file named <code>killbill-diagnostics-02-15-22.zip</code> can be copied from this path and shared with us.</p></div></div></div></div></div></article></div><div class="bd-links-wrapper"><nav class="bd-links toc right-side-menu" id="toc" data-toggle="toc"></nav></div></div></div></main><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script><script src="https://cdn.staticaly.com/gh/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script><script src="https://www.googletagmanager.com/gtag/js?id=G-C0HVJ1E78Z"></script><script>
    setTimeout(function(){
      $('.content-wrapper h2, .content-wrapper h3, .content-wrapper h4').append('<a href=""><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>');
      $('.content-wrapper h2, .content-wrapper h3, .content-wrapper h4').each(function(){
        let itemHref = '#' + $(this).attr('id');
        $(this).find('a').attr("href", itemHref);
      })
      $('.content-wrapper table').each(function() {
        $(this).wrap('<div class="table-wrap"></div>')
        $('.table-wrap').each(function() {
          if ($(this).find('table').width() > $(this).width()){
            $(this).css('max-width', '100%');
            $(this).css('overflow-x', 'scroll');
          }
        })
      })
      function copyToClipboard(text) {
        let sampleTextarea = document.createElement("textarea");
        document.body.appendChild(sampleTextarea);
        sampleTextarea.value = text;
        sampleTextarea.select();
        document.execCommand("copy");
        document.body.removeChild(sampleTextarea);
      }
      $('.content-wrapper h2 a, .content-wrapper h3 a, .content-wrapper h4 a').on('click', function(){
        setTimeout(function(){
          copyToClipboard($(location).attr("href"));
        }, 500);
      });
      $('.content-wrapper .note td.icon').append('<img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/note-icon.png">');

      $('.content pre').parent('.content').prepend('<div class="copy-icon"><svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a1 1 0 0 1 1-1h2a1 1 0 1 1 0 2H9a1 1 0 0 1-1-1Z" fill="#78AECD"/><path d="M6 3a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2 3 3 0 0 1-3 3H9a3 3 0 0 1-3-3Z" fill="#78AECD"/></svg></div>');
      $('.copy-icon svg').on('click', function () {
        copyToClipboard($(this).parent().next().find('code').text());
      });
    }, 1000);

    $('.main').append('<div class="lightbox-modal"> <div id="close-ligtbox">✕</div> <div class="img"><img src="" alt=""></div></div><div class="overlay"></div>');
    $('.main img').on('click', function () {
      let path = $(this).attr('src');
      $('.lightbox-modal img').attr('src', path);
      $('.lightbox-modal, .overlay').show();
    });
    $('#close-ligtbox, .overlay').on('click',function () {
      $('.lightbox-modal, .overlay').hide();
    });

$('.sidebar-toggler').on('click', function () {
  $(this).toggleClass('active');
  $('main.main').toggleClass('sidebar-hide');
});

$('.content-wrapper a').filter(function() {
  return this.hostname && this.hostname !== location.hostname;
}).each(function() {
  $(this).attr({
    target: '_blank',
    title: 'Visit ' + this.href + ' (click to open in a new window)'
  });
});

  </script><script>docsearch({apiKey: '3ef227e7fd5e2e1a3fffd880484934bf', container: '#docsearch', appId: 'S2ISXITURI', indexName: 'killbill'});</script><script>window.dataLayer = window.dataLayer || [];
function gtag(){window.dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-C0HVJ1E78Z');</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create','UA-32705710-3','auto');
  ga('send','pageview');
  var getOutboundLink = function(url) {
    ga('send', {
      hitType: 'event',
      eventCategory: 'outbound',
      eventAction: 'click',
      eventLabel: url,
      hitCallback: function(){document.location = url;}
    });
  }</script></body></html>