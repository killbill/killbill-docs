<!DOCTYPE html><html lang="en"><head><title>Invoice Examples</title><style>pre.pygments .hll { background-color: #ffffcc }
pre.pygments { background: #f8f8f8; }
pre.pygments .tok-c { color: #3D7B7B; font-style: italic } /* Comment */
pre.pygments .tok-err { border: 1px solid #FF0000 } /* Error */
pre.pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
pre.pygments .tok-o { color: #666666 } /* Operator */
pre.pygments .tok-ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #9C6500 } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
pre.pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gr { color: #E40000 } /* Generic.Error */
pre.pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { color: #008400 } /* Generic.Inserted */
pre.pygments .tok-go { color: #717171 } /* Generic.Output */
pre.pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
pre.pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
pre.pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #B00040 } /* Keyword.Type */
pre.pygments .tok-m { color: #666666 } /* Literal.Number */
pre.pygments .tok-s { color: #BA2121 } /* Literal.String */
pre.pygments .tok-na { color: #687822 } /* Name.Attribute */
pre.pygments .tok-nb { color: #008000 } /* Name.Builtin */
pre.pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
pre.pygments .tok-no { color: #880000 } /* Name.Constant */
pre.pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
pre.pygments .tok-ni { color: #717171; font-weight: bold } /* Name.Entity */
pre.pygments .tok-ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
pre.pygments .tok-nf { color: #0000FF } /* Name.Function */
pre.pygments .tok-nl { color: #767600 } /* Name.Label */
pre.pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
pre.pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #19177C } /* Name.Variable */
pre.pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
pre.pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
pre.pygments .tok-se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #008000 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #A45A77 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */</style><link rel="icon" type="image/x-icon" href="/stylesheets/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"><link rel="preconnect" href="https://S2ISXITURI-dsn.algolia.net"><link rel="stylesheet" href='stylesheets/bootstrap.min.css'><link rel="stylesheet" href='stylesheets/bootstrap-toc.min.css'><link rel="stylesheet" href="stylesheets/kb.css"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Invoice Examples"></head><body data-spy="scroll" data-target="#myScrollspy" data-offset="100"><div class="loader-wrapper"><div id="loading"></div></div><header class="header sticky" id="header"><div class="header-wrapper"><div class="container-fluid"><div class="row flex-xl-nowrap justify-content-evenly"><div class="header-logo"><div class="logo"><a href="/"><img src="/stylesheets/images/logo/light-logo.svg" style="height:38px" alt="Kill Bill Docs" id="logo" height="38" width="146"></a></div><div class="switch"><input type="checkbox" aria-label="Search" name="theme-toggle" id="theme-toggle"><span class="slider round"></span></div></div><div class="nav-toggler sidebar-toggler"><svg class="hamburger" xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 7C20.75 7.41421 20.4142 7.75 20 7.75L4 7.75C3.58579 7.75 3.25 7.41421 3.25 7C3.25 6.58579 3.58579 6.25 4 6.25L20 6.25C20.4142 6.25 20.75 6.58579 20.75 7Z" fill=""/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 12C20.75 12.4142 20.4142 12.75 20 12.75L4 12.75C3.58579 12.75 3.25 12.4142 3.25 12C3.25 11.5858 3.58579 11.25 4 11.25L20 11.25C20.4142 11.25 20.75 11.5858 20.75 12Z" fill=""/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 17C20.75 17.4142 20.4142 17.75 20 17.75L4 17.75C3.58579 17.75 3.25 17.4142 3.25 17C3.25 16.5858 3.58579 16.25 4 16.25L20 16.25C20.4142 16.25 20.75 16.5858 20.75 17Z" fill=""/></svg></div><div class="header-search"><div class="search-form-wrapper"><div id="docsearch" style="height: 43px; display: flex; align-items: center; width: 100%;"></div></div></div></div></div></div></header><main class="main sidebar-show"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="sidebar-wrapper"><aside class="sidebar"><div class="sidebar__control"><svg width="8" height="12" viewBox="0 0 8 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.33316 10.6665L1.6665 5.99992L6.33316 1.33325" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div><nav class="sidebar-nav"><ul class="nav navbar-nav"><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Getting Started</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li><a class="nav-link" href="/latest/what_is_kill_bill.html">What is Kill Bill?</a></li><li><a class="nav-link" href="/latest/getting_started.html">Getting Started (Installation)</a></li><li><a class="nav-link" href="/latest/quick_start_with_kaui.html">Quick Start with Kaui</a></li><li><a class="nav-link" href="/latest/quick_start_with_kb_api.html">Quick Start with the Kill Bill API</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Installation</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/stripe_plugin.html">Kill Bill + Stripe DIY</a></li><li><a class="nav-link" href="/latest/userguide_deployment.html">Going to Production</a></li><li><a class="nav-link" href="/latest/how-to-upgrade-the-database.html">Database Migrations</a></li><li><a class="nav-link" href="/latest/PostgreSQL.html">PostgreSQL Setup</a></li><li><a class="nav-link" href="https://github.com/killbill/killbill/releases" onclick="getOutboundLink('https://github.com/killbill/killbill/releases'); return false;">Release&nbsp;Notes</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">AWS</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/aws.html">AWS Introduction</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-single-tier-system.html">Single-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-multi-tier-system.html">Multi-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-cloud-formation-system.html">CloudFormation Setup</a></li><li><a class="nav-link" href="/latest/aws-container.html">AWS Container Setup</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-single-tier-system.html">Single-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-multi-tier-system.html">Multi-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-cloud-formation-system.html">CloudFormation Maintenance</a></li><li><a class="nav-link" href="/latest/explanation-https-and-certificates.html">HTTPS and Certificates</a></li><li><a class="nav-link" href="/latest/how-to-add-a-certificate-using-ACM.html">How to add a certificate using ACM</a></li><li><a class="nav-link" href="/latest/using-ses-with-aws.html">Using SES with AWS</a></li><li><a class="nav-link" href="/latest/aws-tools.html">AWS Observability Tools</a></li><li><a class="nav-link" href="/latest/metrics-datadog.html">Managing Metrics with Datadog</a></li><li><a class="nav-link" href="/latest/metrics-newrelic.html">Managing Metrics with New Relic</a></li><li><a class="nav-link" href="/latest/metrics-cloudwatch.html">Managing Metrics with Cloudwatch</a></li><li><a class="nav-link" href="/latest/errors-rollbar.html">Error Tracking with Rollbar</a></li><li><a class="nav-link" href="/latest/errors-sentry.html">Error Tracking with Sentry</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Manuals</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/userguide_subscription.html">Subscription&nbsp;Billing</a></li><li><a class="nav-link" href="/latest/userguide_payment.html">Payment Processing</a></li><li><a class="nav-link" href="/latest/userguide_kaui.html">Kaui, the Administrative&nbsp;UI</a></li><li><a class="nav-link" href="/latest/email-notification-plugin.html">Email Notification Plugin</a></li><li><a class="nav-link" href="/latest/custom-email-invoice-formatter.html">Custom Email Formatter</a></li><li><a class="nav-link" href="/latest/userguide_analytics.html">Analytics Plugin</a></li><li><a class="nav-link" href="/latest/userguide_configuration.html">Kill Bill&nbsp;Configuration</a></li><li><a class="nav-link" href="/latest/internationalization.html">Kill Bill&nbsp;Internationalization</a></li><li><a class="nav-link" href="/latest/migration_guide.html">Migrating to Kill Bill</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Tutorials</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plan_alignment.html">Plans Alignments</a></li><li><a class="nav-link" href="/latest/overdue.html">Overdue System</a></li><li><a class="nav-link" href="/latest/consumable_in_arrear.html">In Arrear UsageBilling</a></li><li><a class="nav-link" href="/latest/ha.html">Hierarchical Accounts</a></li><li><a class="nav-link" href="/latest/catalog-examples.html">Catalog Examples</a></li><li><a class="nav-link" href="/latest/invoice_examples.html">Invoice Examples</a></li><li><a class="nav-link" href="/latest/invoice_templates.html">Invoice Templates</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Integration</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="http://killbill.github.io/slate" onclick="getOutboundLink('http://killbill.github.io/slate'); return false;">REST API Reference</a></li><li><a class="nav-link" href="/latest/swagger_documentation.html">Swagger UI Documentation</a></li><li><a class="nav-link" href="/latest/postman.html">Postman Integration</a></li><li><a class="nav-link" href="/latest/debugging.html">Debugging</a></li><li><a class="nav-link" href="/latest/push_notifications.html">Push Notifications</a></li><li><a class="nav-link" href="/latest/kill_bill_events.html">Kill Bill Events</a></li><li><a class="nav-link" href="/latest/events-to-aws-sqs.html">Kill Bill Events to AWS SQS</a></li><li><a class="nav-link" href="/latest/how-to-use-kpm-diagnostic.html">KPM Diagnostic Usage</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Plugin Development</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_introduction.html">Plugin Introduction</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_development.html">Plugin Development</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_installation.html">Plugin Installation</a></li><li><a class="nav-link" href="/latest/plugin_use_cases.html">Special Plugin Use Cases</a></li><li><a class="nav-link" href="/latest/notification_plugin.html">Notification Plugins</a></li><li><a class="nav-link" href="/latest/payment_plugin.html">Payment Plugins</a></li><li><a class="nav-link" href="/latest/payment_control_plugin.html">Payment Control Plugins</a></li><li><a class="nav-link" href="/latest/usage_plugin.html">Usage Plugins</a></li><li><a class="nav-link" href="/latest/invoice_plugin.html">Invoice Plugins</a></li><li><a class="nav-link" href="/latest/catalog_plugin.html">Catalog Plugins</a></li><li><a class="nav-link" href="/latest/entitlement_plugin.html">Entitlement Plugins</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Operational Guides</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/deploy_to_kubernetes.html">Kubernetes (K8s) Deployment</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/user_management.html">Users, Roles, and Permissions</a></li><li><a class="nav-link" href="/latest/plugin_management.html">Plugin Management</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Client Libraries</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/java_client.html">Java</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-ruby" onclick="getOutboundLink('http://github.com/killbill/killbill-client-ruby'); return false;">Ruby</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-php" onclick="getOutboundLink('http://github.com/killbill/killbill-client-php'); return false;">PHP</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-js" onclick="getOutboundLink('http://github.com/killbill/killbill-client-js'); return false;">Node.js</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-python" onclick="getOutboundLink('http://github.com/killbill/killbill-client-python'); return false;">Python</a></li><li><a class="nav-link" href="http://github.com/killbill/kbcli" onclick="getOutboundLink('http://github.com/killbill/kbcli'); return false;">KillBill Go </a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">About Kill Bill</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/demo.html">Demo</a></li><li><a class="nav-link" href="/latest/features.html">Features List</a></li><li><a class="nav-link" href="/latest/faq.html">Technical FAQs</a></li><li><a class="nav-link" href="/latest/Kill-Bill-Glossary.html">Glossary</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Internal</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/internal_design.html">Internal Design</a></li><li><a class="nav-link" href="/latest/entitlement_subsystem.html">Entitlement Subsystem</a></li><li><a class="nav-link" href="/latest/invoice_subsystem.html">Invoice Subsystem</a></li><li><a class="nav-link" href="/latest/development.html">Development Environment</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">References</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="https://github.com/killbill/killbill-docs/tree/v3/swagger" onclick="getOutboundLink('https://github.com/killbill/killbill-docs/tree/v3/swagger'); return false;">Swagger&nbsp;API Schema</a></li><li><a class="nav-link" href="/latest/catalog.xsd">Catalog XSD Reference</a></li><li><a class="nav-link" href="/latest/overdue.xsd">Overdue XSD Reference</a></li></ul></li></ul></nav><a class="doclink" href="mailto:support@killbill.io">Report a doc problem</a></aside></div><div class="article-container"><div class="center-content"><div class="main-wrapper"><article class="content-wrapper"><div class="banner"><h1>Invoice Examples</h1></div><div id="content"><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Whenever there is a change in the system (a recurring subscription billing, an external charge, a change in plan, and so on), Kill Bill generates an invoice. An invoice consists of one or more invoice items of different types. In addition, an invoice has the <code>balance</code> and <code>chargedAmount</code> attributes which are computed each time an invoice is generated. This document aims to explain these computations in different invoicing scenarios.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Ensure that you have gone through the <a href="https://docs.killbill.io/latest/userguide_subscription.html#components-invoicing"><em>Subscription User Guide</em></a> and are familiar with the basic invoicing concepts.</p>
</li>
<li>
<p>Ensure that you are familiar with the invoice related terminology explained in the <a href="https://docs.killbill.io/latest/Kill-Bill-Glossary.html"><em>Kill Bill Glossary</em></a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_more_about_charged_amount_and_balance">More about Charged Amount and Balance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we look at each scenario, let us understand how <code>charged amount</code> and <code>balance</code> are calculated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>Note:</strong> An invoice consists of one or more invoice items. Each invoice item is of a different type and its amount is either positive, negative or zero depending on the type. The invoice item <code>type</code> and <code>amount</code> heavily influence the <code>charged amount</code> and <code>balance</code> calculations explained in this document. It is therefore advisable to familiarize with invoice item type/amount by reading the <a href="https://docs.killbill.io/latest/userguide_subscription.html#components-invoicing-overview">subscription billing</a> document before proceeding further.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_charged_amount">Charged Amount</h3>
<div class="paragraph">
<p>The <code>charged amount</code> (also known as <code>invoice amount</code>, <code>invoice total</code> or simply <code>amount</code>) specifies the amount that the customer is charged as part of an invoice. It is computed by adding up the amounts on invoice items of type <code>FIXED</code>, <code>RECURRING</code>, <code>EXTERNAL_CHARGE</code>, <code>USAGE</code>, <code>TAX</code>, <code>ITEM_ADJ</code>, <code>REPAIR_ADJ</code>, <code>PARENT_SUMMARY</code> and <code>CREDIT_ADJ</code>. Note that <code>PARENT_SUMMARY</code> invoice items are only applicable in the case of <a href="https://docs.killbill.io/latest/ha.html">hierarchical accounts</a> and will be skipped in the rest of this document.</p>
</div>
<div class="paragraph">
<p>So, <code>charged amount</code> can be expressed as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">FIXED</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">RECURRING</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">EXTERNAL_CHARGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">USAGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">TAX</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">ITEM_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">REPAIR_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">CREDIT_ADJ</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>Note:</strong> In the case of a credit invoice (invoice corresponding to a credit), the <code>CREDIT_ADJ</code> invoice items are not taken into account while calculating the charged amount. This is to prevent getting a negative amount as explained in the <a href="#account_credit">account credit</a> scenario below.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_invoice_balance">Invoice Balance</h3>
<div class="paragraph">
<p><code>Invoice balance</code> specifies the amount that the customer owes as part of an invoice. It is positive if the customer owes something or zero otherwise. It is calculated by subtracting the sum of the <code>paid amount</code> (amount paid by the customer) and <code>refunded amount</code> (amount refunded to the customer) from the sum of the <code>charged amount</code> and internal credit adjustment (<code>CBA_ADJ</code> items) amount.</p>
</div>
<div class="paragraph">
<p>So, <code>Invoice Balance</code> can be expressed as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">INVOICE</span><span class="tok-w"> </span><span class="tok-n">BALANCE</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">SUM</span><span class="tok-p">(</span><span class="tok-n">CBA_ADJ</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">PAID</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">REFUNDED</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>Note:</strong> In the case of a credit invoice (invoice corresponding to a credit), the sum of the <code>CREDIT_ADJ</code> items is also added. This is done to keep the invoice balance <code>0</code> as explained in the <a href="#account_credit">account credit</a> scenario below.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The invoice balance is <strong>always</strong> <code>0</code> if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The invoice is in a <code>DRAFT</code> or <code>VOID</code> status</p>
</li>
<li>
<p>The invoice is tagged as <code>WRITTEN_OFF</code> specifying that its balance should be <code>0</code></p>
</li>
<li>
<p>The invoice is a migration invoice (imported from a different billing system into Kill Bill)</p>
</li>
<li>
<p>The invoice corresponds to a child account and has a zero parent invoice balance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let us now understand how the <code>charged amount</code> and <code>invoice balance</code> are computed in various scenarios.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recurring_subscription">Recurring Subscription</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a recurring subscription is billed, the system generates an invoice corresponding to it. For example, consider the <a href="https://github.com/killbill/killbill-docs/blob/4671dcd9da1cf021e85629ab67e3ffb6fb553bb1/catalogs/monthly-no-trial.xml">monthly-no-trial</a> catalog. It specifies the <code>standard-monthly</code> plan with a monthly recurring charge of <code>$24.95</code>.</p>
</div>
<div class="paragraph">
<p>Let us understand what happens in this scenario:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>As soon as a subscription is created, the <code>EVERGREEN</code> phase starts. An invoice is generated with one invoice item of type <code>RECURRING</code> and amount <code>24.95</code>.</p>
<div class="paragraph">
<p>So, <code>CHARGED AMOUNT</code> and <code>BALANCE</code> are calculated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">FIXED</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">RECURRING</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">EXTERNAL_CHARGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">USAGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">TAX</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">ITEM_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">REPAIR_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">CREDIT_ADJ</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mf">24.95</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mf">24.95</span>

<span class="tok-c1">// Assuming the account has a valid default payment method, the invoice is automatically paid. So, AMOUNT PAID=24.95</span>

<span class="tok-n">INVOICE</span><span class="tok-w"> </span><span class="tok-n">BALANCE</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">SUM</span><span class="tok-p">(</span><span class="tok-n">CBA_ADJ</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">PAID</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">REFUNDED</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mf">24.95</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mf">24.95</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_add_credit">Add Credit</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to <a href="https://killbill.github.io/slate/#credit-create-credits">add a credit</a>. The credit can either be added at the account level or to a particular invoice.</p>
</div>
<div class="paragraph">
<p>Let us understand what happens in each of these cases.</p>
</div>
<div class="sect2">
<h3 id="account_credit">Case 1: Add Account Credit</h3>
<div class="paragraph">
<p>Whenever a <a href="https://killbill.github.io/slate/#credit-create-credits">credit is added</a> but not on a particular invoice, it is treated as account credit. In this case, the system generates a new invoice that has a <code>CREDIT_ADJ</code> and a <code>CBA_ADJ</code> item. The credit is then adjusted against the amount/balance in other unpaid invoices (if any).</p>
</div>
<div class="paragraph">
<p>Let us understand what happens in this scenario:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When a <a href="https://killbill.github.io/slate/#credit-create-credits">credit is added</a> (let&#8217;s say for <code>$20</code>), an invoice is generated with two invoice items: <code>Type=CREDIT_ADJ, Amount=-20</code> and <code>Type=CBA_ADJ, Amount=20</code>. The <code>CREDIT_ADJ</code> invoice item is negative and corresponds to the credit while the <code>CBA_ADJ</code> item is positive and is automatically inserted by the system to bring the invoice balance to <code>0</code>.</p>
<div class="paragraph">
<p>So, <code>CHARGED AMOUNT</code> and <code>BALANCE</code> are calculated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">FIXED</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">RECURRING</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">EXTERNAL_CHARGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">USAGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">TAX</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">ITEM_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">REPAIR_ADJ</span><span class="tok-w"> </span><span class="tok-c1">// CREDIT_ADJ not taken into account for credit invoice</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span>

<span class="tok-n">INVOICE</span><span class="tok-w"> </span><span class="tok-n">BALANCE</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">SUM</span><span class="tok-p">(</span><span class="tok-n">CBA_ADJ</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">SUM</span><span class="tok-p">(</span><span class="tok-n">CREDIT_ADJ</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">PAID</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">REFUNDED</span><span class="tok-p">)</span><span class="tok-w">  </span><span class="tok-c1">//CREDIT_ADJ taken into account for credit invoice</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">20</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">20</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span></code></pre>
</div>
</div>
</li>
<li>
<p>When the account is charged (either due to a recurring subscription or an external charge), any existing previously generated credit will be used (consumed). So, for example, if an external charge is created for <code>$100</code>, it will have an invoice item of type <code>EXTERNAL_CHARGE</code> and amount <code>100</code>. In addition, it will also have an invoice item of type <code>CBA_ADJ</code> and amount <code>-20</code> automatically generated by the system corresponding to the credit adjustment.</p>
<div class="paragraph">
<p>So, <code>CHARGED AMOUNT</code> and <code>BALANCE</code> are calculated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">FIXED</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">RECURRING</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">EXTERNAL_CHARGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">USAGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">TAX</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">ITEM_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">REPAIR_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">CREDIT_ADJ</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">100</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">100</span>

<span class="tok-c1">//Assuming that the account does not have a valid payment method, the invoice is NOT automatically paid. So, AMOUNT PAID=0</span>

<span class="tok-n">INVOICE</span><span class="tok-w"> </span><span class="tok-n">BALANCE</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">SUM</span><span class="tok-p">(</span><span class="tok-n">CBA_ADJ</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">PAID</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">REFUNDED</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">100</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">20</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">80</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_case_2_add_invoice_credit_invoice_adjustment">Case 2: Add Invoice Credit (Invoice Adjustment)</h3>
<div class="paragraph">
<p>Whenever a <a href="https://killbill.github.io/slate/#credit-create-credits">credit is added</a> on a particular invoice, it is treated as an invoice adjustment (Note that the invoice needs to be in <code>DRAFT</code> status for this). In such a case, an invoice item of type <code>CREDIT_ADJ</code> is added to the invoice and the <code>charged amount</code> is adjusted against it.</p>
</div>
<div class="paragraph">
<p>Let us understand what happens in this scenario:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Let us assume that a <code>DRAFT</code> invoice is created corresponding to an <code>EXTERNAL CHARGE</code> of <code>$100</code>. It will have a single invoice item of type <code>EXTERNAL_CHARGE</code> and amount <code>100</code>.</p>
<div class="paragraph">
<p>So, <code>CHARGED AMOUNT</code> and <code>BALANCE</code> are calculated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">FIXED</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">RECURRING</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">EXTERNAL_CHARGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">USAGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">TAX</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">ITEM_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">REPAIR_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">CREDIT_ADJ</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">100</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">100</span>

<span class="tok-n">INVOICE</span><span class="tok-w"> </span><span class="tok-n">BALANCE</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w">  </span><span class="tok-c1">// since invoice is in DRAFT status</span></code></pre>
</div>
</div>
</li>
<li>
<p>Next, when a <a href="https://killbill.github.io/slate/#credit-create-credits">credit is added</a> to the invoice (say <code>$20</code>), the invoice is modified.  A new invoice item is added of type <code>CREDIT_ADJ</code> and amount <code>-20</code>. In this case, an invoice item of type <code>CBA_ADJ</code> is NOT added as the credit is directly consumed.</p>
<div class="paragraph">
<p>So, <code>CHARGED AMOUNT</code> and <code>BALANCE</code> are calculated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">FIXED</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">RECURRING</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">EXTERNAL_CHARGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">USAGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">TAX</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">ITEM_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">REPAIR_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">CREDIT_ADJ</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">100</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">20</span><span class="tok-p">)</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">80</span>

<span class="tok-n">INVOICE</span><span class="tok-w"> </span><span class="tok-n">BALANCE</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w">  </span><span class="tok-c1">//since invoice is still in DRAFT status</span></code></pre>
</div>
</div>
</li>
<li>
<p>Finally, when the invoice is committed, the balance is updated:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">INVOICE</span><span class="tok-w"> </span><span class="tok-n">BALANCE</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">SUM</span><span class="tok-p">(</span><span class="tok-n">CBA_ADJ</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">PAID</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">REFUNDED</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">80</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">80</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_invoice_item_adjustment">Invoice Item Adjustment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to <a href="https://killbill.github.io/slate/#invoice-adjust-an-invoice-item">adjust an invoice item</a>. An operator often generates an invoice item adjustment, which is associated with a refund. In such a case, the system adds a new invoice item of type <code>ITEM_ADJ</code> to the invoice. If the invoice was already paid for, the system also adds another invoice item of type <code>CBA_ADJ</code> so as to adjust the credit amount in the next invoice.</p>
</div>
<div class="paragraph">
<p>There are several cases in this scenario, let us understand each one.</p>
</div>
<div class="sect2">
<h3 id="_case_1_invoice_item_adjustment_when_invoice_is_not_paid">Case 1: Invoice item adjustment when invoice is not paid</h3>
<div class="paragraph">
<p>This scenario demonstrates what happens when an invoice item belonging to an unpaid invoice is <a href="https://killbill.github.io/slate/#invoice-adjust-an-invoice-item">adjusted</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Let us assume that an invoice is generated corresponding to a recurring subscription for <code>$100</code>. It will have an invoice item of type <code>RECURRING</code> and amount <code>100</code>. Assuming that the account does not have a valid default payment method, the invoice is not automatically paid, so its <code>invoice balance</code> is <code>100</code>.</p>
</li>
<li>
<p>When the <a href="https://killbill.github.io/slate/#invoice-adjust-an-invoice-item">invoice item is adjusted</a> (say for <code>$10</code>), the invoice is modified. A new invoice item is added of type <code>ITEM_ADJ</code> and amount <code>-10</code>.</p>
<div class="paragraph">
<p>So, <code>CHARGED AMOUNT</code> and <code>BALANCE</code> are calculated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">FIXED</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">RECURRING</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">EXTERNAL_CHARGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">USAGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">TAX</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">ITEM_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">REPAIR_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">CREDIT_ADJ</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">100</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">10</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">90</span>

<span class="tok-n">INVOICE</span><span class="tok-w"> </span><span class="tok-n">BALANCE</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">SUM</span><span class="tok-p">(</span><span class="tok-n">CBA_ADJ</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">PAID</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">REFUNDED</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">90</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">90</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="invoice_item_adjustment_for_paid_invoice">Case 2: Invoice item adjustment when invoice is paid</h3>
<div class="paragraph">
<p>This scenario demonstrates what happens when an invoice item belonging to a paid invoice is <a href="https://killbill.github.io/slate/#invoice-adjust-an-invoice-item">adjusted</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Let us assume that an invoice is generated corresponding to a recurring subscription for <code>$100</code>. It will have an invoice item of type <code>RECURRING</code> and amount <code>100</code>. Assuming that the account has a valid default payment method, the invoice is automatically paid, so its <code>invoice balance</code> is <code>0</code>.</p>
</li>
<li>
<p>When this <a href="https://killbill.github.io/slate/#invoice-adjust-an-invoice-item">invoice item is adjusted</a>, the invoice is modified. As before, an invoice item of type <code>ITEM_ADJ</code> and amount <code>-10</code> is added. In addition, another invoice item of type <code>CBA_ADJ</code> and amount <code>10</code> is added to bring the balance to zero. The addition of this positive <code>CBA_ADJ</code> item represents a credit generation by the system.</p>
<div class="paragraph">
<p>So, <code>CHARGED AMOUNT</code> and <code>BALANCE</code> are calculated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">FIXED</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">RECURRING</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">EXTERNAL_CHARGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">USAGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">TAX</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">ITEM_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">REPAIR_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">CREDIT_ADJ</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">100</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">10</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">90</span>

<span class="tok-n">INVOICE</span><span class="tok-w"> </span><span class="tok-n">BALANCE</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">SUM</span><span class="tok-p">(</span><span class="tok-n">CBA_ADJ</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">PAID</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">REFUNDED</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">90</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">10</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">100</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_refund_invoice_payment">Refund Invoice Payment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to <a href="https://killbill.github.io/slate/#invoice-payment-refund-a-payment-and-adjust-the-invoice-if-needed">refund an invoice payment and adjust invoice if needed</a>. If the invoice is adjusted, a new invoice item of type <code>ITEM_ADJ</code> is added to the invoice, otherwise, the invoice remains unmodified.</p>
</div>
<div class="paragraph">
<p>Let us understand both these cases.</p>
</div>
<div class="sect2">
<h3 id="_case_1_refund_with_invoice_item_adjustment">Case 1: Refund with invoice item adjustment</h3>
<div class="paragraph">
<p>This scenario demonstrates what happens when a <a href="https://killbill.github.io/slate/#invoice-payment-refund-a-payment-and-adjust-the-invoice-if-needed">refund with an invoice item adjustment</a> is performed on an invoice.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Let us assume that an invoice is generated corresponding to a recurring subscription for <code>$100</code>. It will have an invoice item of type <code>RECURRING</code> and amount <code>100</code>. Assuming that the account has a valid default payment method, the invoice is automatically paid, so its <code>invoice balance</code> is <code>0</code>.</p>
</li>
<li>
<p>When a <a href="https://killbill.github.io/slate/#invoice-payment-refund-a-payment-and-adjust-the-invoice-if-needed">refund with invoice item adjustment</a> is performed (say for <code>$10</code>), the invoice is modified. A new invoice item of type <code>ITEM_ADJ</code> and amount <code>-10</code> is added. However, unlike the <a href="#invoice_item_adjustment_for_paid_invoice">invoice item adjustment for paid invoice</a> case, an invoice item of type <code>CBA_ADJ</code> is NOT added. Since a refund is performed, the amount (<code>$10</code>) is refunded to the customer. So there is no need to generate a credit and thus no need for a <code>CBA_ADJ</code> item.</p>
<div class="paragraph">
<p>So, <code>CHARGED AMOUNT</code> and <code>BALANCE</code> are calculated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">FIXED</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">RECURRING</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">EXTERNAL_CHARGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">USAGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">TAX</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">ITEM_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">REPAIR_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">CREDIT_ADJ</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">100</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">10</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">90</span>

<span class="tok-n">INVOICE</span><span class="tok-w"> </span><span class="tok-n">BALANCE</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">SUM</span><span class="tok-p">(</span><span class="tok-n">CBA_ADJ</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">PAID</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">REFUNDED</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">90</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">100</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">10</span><span class="tok-p">))</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_case_2_refund_without_invoice_item_adjustment">Case 2: Refund without invoice item adjustment</h3>
<div class="paragraph">
<p>This scenario demonstrates what happens when a <a href="https://killbill.github.io/slate/#invoice-payment-refund-a-payment-and-adjust-the-invoice-if-needed">refund without an invoice item adjustment</a> is performed on an invoice.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Let us assume that an invoice is generated corresponding to a recurring subscription for <code>$100</code>. It will have an invoice item of type <code>RECURRING</code> and amount <code>100</code>. Assuming that the account has a valid default payment method, the invoice is automatically paid, so its <code>invoice balance</code> is <code>0</code>.</p>
</li>
<li>
<p>When a <a href="https://killbill.github.io/slate/#invoice-payment-refund-a-payment-and-adjust-the-invoice-if-needed">refund without invoice item adjustment</a> is performed (say for <code>$10</code>), the invoice is not modified since the invoice item adjustment option is not chosen.</p>
<div class="paragraph">
<p>So, <code>CHARGED AMOUNT</code> and <code>BALANCE</code> are calculated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">FIXED</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">RECURRING</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">EXTERNAL_CHARGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">USAGE</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">TAX</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">ITEM_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">REPAIR_ADJ</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">CREDIT_ADJ</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">100</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span>
<span class="tok-w">               </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">100</span>

<span class="tok-n">INVOICE</span><span class="tok-w"> </span><span class="tok-n">BALANCE</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">CHARGED</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">SUM</span><span class="tok-p">(</span><span class="tok-n">CBA_ADJ</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">PAID</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">AMOUNT</span><span class="tok-w"> </span><span class="tok-n">REFUNDED</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">100</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">100</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">10</span><span class="tok-p">))</span>
<span class="tok-w">                </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">10</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_information">Additional Information</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://docs.killbill.io/latest/invoice_subsystem.html"><em>Invoice Subsystem</em></a></p>
</div>
</div>
</div></div><div class="bottom-nav-links"><a href="#" id="prev-nav-link" class="bottom-nav-link card prev"><span class="arrow-icon left"><svg class="i-arrow" width="12" height="11" viewBox="0 0 12 11" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.19526 1.02876C4.45561 0.768409 4.87772 0.768409 5.13807 1.02876C5.39842 1.28911 5.39842 1.71122 5.13807 1.97157L2.27614 4.8335H11.3333C11.7015 4.8335 12 5.13197 12 5.50016C12 5.86835 11.7015 6.16683 11.3333 6.16683H2.27614L5.13807 9.02876C5.39842 9.28911 5.39842 9.71122 5.13807 9.97157C4.87772 10.2319 4.45561 10.2319 4.19526 9.97157L0.195261 5.97157C-0.0650883 5.71122 -0.0650883 5.28911 0.195261 5.02876L4.19526 1.02876Z" fill=""/></svg><span class="prev-text">Previous</span></span><span id="prev-navigator" class="bottom-nav-text">Prev</span>                               </a><a href="#" id="next-nav-link" class="bottom-nav-link card next"><span class="arrow-icon"><span class="next-text">Next</span><svg class="i-arrow icon-left" width="12" height="11" viewBox="0 0 12 11" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.19526 1.02876C4.45561 0.768409 4.87772 0.768409 5.13807 1.02876C5.39842 1.28911 5.39842 1.71122 5.13807 1.97157L2.27614 4.8335H11.3333C11.7015 4.8335 12 5.13197 12 5.50016C12 5.86835 11.7015 6.16683 11.3333 6.16683H2.27614L5.13807 9.02876C5.39842 9.28911 5.39842 9.71122 5.13807 9.97157C4.87772 10.2319 4.45561 10.2319 4.19526 9.97157L0.195261 5.97157C-0.0650883 5.71122 -0.0650883 5.28911 0.195261 5.02876L4.19526 1.02876Z" fill=""/></svg></span><span id="next-navigator" class="bottom-nav-text">Next</span></a></div></article></div><div class="bd-links-wrapper"><nav class="bd-links toc right-side-menu" id="myScrollspy" data-toggle="toc"></nav></div></div></div></div></div></main><script src="javascripts/jquery-3.6.1.min.js"></script><script src="javascripts/bootstrap.min.js"></script><script src="javascripts/bootstrap-toc.min.js"></script><script type="module" src="javascripts/kb.js"></script><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script><script>docsearch({apiKey: '3ef227e7fd5e2e1a3fffd880484934bf', container: '#docsearch', appId: 'S2ISXITURI', indexName: 'killbill'});</script><script>
  jQuery(document).ready(function($){
    $('.sidebar-nav .icon-title').on('click', function (e) {
      e.preventDefault();
      $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
      $('.sidebar-nav > .navbar-nav > li').removeClass('open');

      if($(this).next().is(':visible')){
        $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
        $('.sidebar-nav > .navbar-nav > li').removeClass('open');
      } else {
        $(this).parent().addClass('open');
        $(this).next().slideDown(200);
      }
    });

    let pageURL = $(location).attr("href");
    pageURL = pageURL.includes('.html') ? pageURL : pageURL + '.html';
    $('.nav-link').each(function() {
      if (pageURL.toLowerCase().includes($(this).attr('href').toLowerCase())) {
        $(this).parent().addClass('list-item-active');
        $(this).parent().parent().addClass('active-list');
        $(this).parent().parent().prev().addClass('bd-link-active-wrap');
      }
    });
  });
</script>
</body></html>